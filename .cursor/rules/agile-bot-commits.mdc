---
description: Generate meaningful commit messages based on current bot behavior, action, and scope
alwaysApply: true
---

# Agile Bot Commit Message Generation

When the user types `/commit` or requests a commit, automatically generate a meaningful commit message based on the current bot context.
sce## Scope

**Story Scope:** Perform Action

Please only work on the following scope.

Scope Filter: "Perform Action"

Scope:

{
  "path": "C:\\dev\\agile_bots\\docs\\story\\story-graph.json",
  "has_epics": true,
  "has_increments": false,
  "has_domain_concepts": true,
  "epic_count": 1,
  "content": {
    "epics": [
      {
        "name": "Invoke Bot",
        "sub_epics": [
          {
            "name": "Perform Action",
            "sub_epics": [
              {
                "name": "Prepare Common Instructions For Behavior, Action, and Scope",
                "sub_epics": [],
                "story_groups": [
                  {
                    "name": null,
                    "stories": [
                      {
                        "name": "Inject Context Into Instructions",
                        "acceptance_criteria": [],
                        "scenarios": [
                          {
                            "name": "Action Loads Context Data Into Instructions",
                            "background": [],
                            "steps": []
                          },
                          {
                            "name": "Next behavior reminder is NOT injected when action is not final",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given validate is NOT the final action (render comes after)",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When validate action executes",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then base_instructions do NOT include next behavior reminder",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then And bot_config.json defines behavior sequence",
                                "sequential_order": 4.0
                              }
                            ]
                          },
                          {
                            "name": "Next behavior reminder is NOT injected when current behavior is last in sequence",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given discovery is the last behavior in bot_config.json",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When render action executes",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then base_instructions do NOT include next behavior reminder",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then And render is the final action",
                                "sequential_order": 4.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Get Action Instructions Through CLI",
                        "acceptance_criteria": [
                          {
                            "name": "WHEN user navigates to behavior.action.instructions\nTHEN CLI displays formatted instructions for that action",
                            "text": "WHEN user navigates to behavior.action.instructions\nTHEN CLI displays formatted instructions for that action",
                            "sequential_order": 1.0
                          },
                          {
                            "name": "WHEN user enters action name only as shortcut\nTHEN CLI executes instructions on current behavior's action",
                            "text": "WHEN user enters action name only as shortcut\nTHEN CLI executes instructions on current behavior's action",
                            "sequential_order": 2.0
                          }
                        ],
                        "scenarios": [
                          {
                            "name": "User gets instructions using full path",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: CLI is at shape.build.instructions",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: user enters 'shape.build.instructions'",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: CLI displays formatted instructions",
                                "sequential_order": 3.0
                              }
                            ]
                          },
                          {
                            "name": "User calls action by name shortcut",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: CLI is at shape.build.instructions",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: user enters just 'build'",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: CLI executes instructions operation on current behavior's build action",
                                "sequential_order": 3.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Submit Instructions Through CLI",
                        "acceptance_criteria": [
                          {
                            "name": "WHEN User executes submit command\nTHEN System tracks instruction submission AND System returns success status with timestamp",
                            "text": "WHEN User executes submit command\nTHEN System tracks instruction submission AND System returns success status with timestamp",
                            "sequential_order": 1.0
                          }
                        ],
                        "scenarios": [
                          {
                            "name": "User submits current action instructions",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: CLI is at shape.clarify",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: user enters 'submit'",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: CLI tracks instruction submission",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "AND: CLI returns success message with behavior and action",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "AND: CLI includes timestamp of submission",
                                "sequential_order": 5.0
                              }
                            ]
                          },
                          {
                            "name": "Submit command fails when no current action",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: CLI has no current action set",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: user enters 'submit'",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: CLI displays error message",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "AND: Error indicates no current action",
                                "sequential_order": 4.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Display Base Instructions Panel",
                        "acceptance_criteria": [
                          {
                            "name": "WHEN User views panel\nTHEN System displays base instructions section AND System displays behavior name AND System displays action name",
                            "text": "WHEN User views panel\nTHEN System displays base instructions section AND System displays behavior name AND System displays action name",
                            "sequential_order": 1.0
                          }
                        ],
                        "scenarios": [
                          {
                            "name": "",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Bot is at shape.clarify",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When Panel displays instructions section",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then Panel displays base instructions",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And Panel displays behavior name (shape)",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And Panel displays action name (clarify)",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And Instructions are scrollable",
                                "sequential_order": 6.0
                              }
                            ]
                          },
                          {
                            "name": "",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Panel displays base instructions",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When User clicks copy button",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then Instructions are copied to clipboard",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And Panel displays confirmation message",
                                "sequential_order": 4.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Display Raw Format Instructions In Panel",
                        "acceptance_criteria": [
                          {
                            "name": "WHEN User clicks action instruction in Behavior Action Hierarchy\nTHEN System displays entire instructions exactly as it should be sent to the AI chat",
                            "text": "WHEN User clicks action instruction in Behavior Action Hierarchy\nTHEN System displays entire instructions exactly as it should be sent to the AI chat",
                            "sequential_order": 1.0
                          }
                        ],
                        "scenarios": [
                          {
                            "name": "",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Panel displays formatted instructions",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When User clicks raw format toggle button",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then Panel displays instructions in raw text format",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And Instructions show exactly as they would be sent to AI",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And Raw format is scrollable",
                                "sequential_order": 5.0
                              }
                            ]
                          },
                          {
                            "name": "",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Panel displays instructions in raw format",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When User clicks formatted view toggle button",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then Panel displays instructions in formatted view",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And Instructions show with sections and styling",
                                "sequential_order": 4.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Save Clarification Answers",
                        "acceptance_criteria": [],
                        "scenarios": [
                          {
                            "name": "Save new clarification answers",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: Bot with no existing clarifications",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: User saves answers via Bot.save()",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: Answers saved to clarification.json in test workspace",
                                "sequential_order": 3.0
                              }
                            ]
                          },
                          {
                            "name": "Save merges with existing clarification answers",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: Bot with existing clarification answers",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: User saves additional/modified answers",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: New answers merged with existing, new overrides existing for same question",
                                "sequential_order": 3.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Save Clarification Evidence",
                        "acceptance_criteria": [],
                        "scenarios": [
                          {
                            "name": "Save evidence provided",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: Bot with clarification requirements",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: User provides evidence via Bot.save()",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: Evidence saved to clarification.json",
                                "sequential_order": 3.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Save Strategy Decisions",
                        "acceptance_criteria": [],
                        "scenarios": [
                          {
                            "name": "Save strategy decisions",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: Bot with strategy decision criteria",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: User makes decisions via Bot.save()",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: Only chosen decisions saved (not entire criteria template)",
                                "sequential_order": 3.0
                              }
                            ]
                          },
                          {
                            "name": "Save strategy assumptions",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: Bot with strategy context",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: User saves assumptions via Bot.save()",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: Assumptions saved to strategy.json",
                                "sequential_order": 3.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Save Multiple Guardrails Together",
                        "acceptance_criteria": [],
                        "scenarios": [
                          {
                            "name": "Save all guardrails at once",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: Bot with current behavior",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: User saves answers, evidence, decisions, and assumptions together",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: All data saved to respective files",
                                "sequential_order": 3.0
                              }
                            ]
                          },
                          {
                            "name": "Save preserves data across behaviors",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: Multiple behaviors with saved guardrails",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: Switching between behaviors and saving",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: Each behavior's data is preserved independently",
                                "sequential_order": 3.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Save File Isolation",
                        "acceptance_criteria": [],
                        "scenarios": [
                          {
                            "name": "Save uses test workspace not production",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: Bot initialized with tmp_path workspace",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: Saving any data",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: Data saved to tmp_path workspace, NOT production agile_bots/docs/story",
                                "sequential_order": 3.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Save Guardrails Through Panel",
                        "acceptance_criteria": [
                          {
                            "name": "WHEN User fills in answers in panel form\nTHEN System validates input format AND System enables submit button",
                            "text": "WHEN User fills in answers in panel form\nTHEN System validates input format AND System enables submit button",
                            "sequential_order": 1.0
                          },
                          {
                            "name": "WHEN User clicks submit for answers\nTHEN System saves answers to clarification.json under current behavior AND System merges with existing answers AND System displays success message",
                            "text": "WHEN User clicks submit for answers\nTHEN System saves answers to clarification.json under current behavior AND System merges with existing answers AND System displays success message",
                            "sequential_order": 2.0
                          }
                        ],
                        "scenarios": [
                          {
                            "name": "",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Bot is at shape.clarify",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When Panel renders clarify instructions",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then Panel displays save button for answers",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And Panel displays save button for evidence",
                                "sequential_order": 4.0
                              }
                            ]
                          },
                          {
                            "name": "",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Bot is at shape.strategy",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When Panel renders strategy instructions",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then Panel displays save button for decisions",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And Panel displays save button for assumptions",
                                "sequential_order": 4.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Submit Scope Instructions",
                        "acceptance_criteria": [],
                        "scenarios": [
                          {
                            "name": "Scope appears in instructions display_content markdown",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: Build action with story scope set",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: Instructions are retrieved via action.get_instructions()",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: instructions.display_content contains \"## Scope\" section",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "AND: instructions.display_content contains story_graph markdown from scope.results",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "AND: bot.submit_instructions() can use display_content to submit scope instructions",
                                "sequential_order": 5.0
                              }
                            ]
                          },
                          {
                            "name": "Domain concepts are properly serialized in JSON story graph",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: Story graph with domain_concepts at epic and sub-epic levels",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: Instructions are retrieved with scope",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: display_content contains JSON with domain_concepts properly serialized",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "AND: Domain concepts from both epic and sub-epic levels are included",
                                "sequential_order": 4.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Handle Operation Errors and Validation in CLI",
                        "acceptance_criteria": [],
                        "scenarios": [
                          {
                            "name": "Invalid command shows error",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: CLI is at shape.build",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: user enters 'invalid_command'",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: CLI displays error message in appropriate channel format",
                                "sequential_order": 3.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Save Guardrails Through CLI",
                        "acceptance_criteria": [
                          {
                            "name": "WHEN user runs save command with answers parameter\nTHEN CLI saves answers to clarification.json under current behavior AND CLI merges with existing answers",
                            "text": "WHEN user runs save command with answers parameter\nTHEN CLI saves answers to clarification.json under current behavior AND CLI merges with existing answers",
                            "sequential_order": 1.0
                          },
                          {
                            "name": "WHEN user runs save command with decisions parameter\nTHEN CLI saves decisions to strategy.json under current behavior",
                            "text": "WHEN user runs save command with decisions parameter\nTHEN CLI saves decisions to strategy.json under current behavior",
                            "sequential_order": 2.0
                          }
                        ],
                        "scenarios": [
                          {
                            "name": "Save answers via CLI command",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: CLI is at shape.clarify",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: user runs 'save --answers {\"What is the scope?\": \"Bot system\"}'",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: CLI shows success message",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "AND: clarification.json is updated",
                                "sequential_order": 4.0
                              }
                            ]
                          },
                          {
                            "name": "Save decisions via CLI command",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: CLI is at shape.strategy",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: user runs 'save --decisions {\"drill_down\": \"Deep\"}'",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: CLI shows success message",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "AND: strategy.json is updated",
                                "sequential_order": 4.0
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                ],
                "domain_concepts": [
                  {
                    "name": "ActionDataSubSection",
                    "responsibilities": [
                      {
                        "name": "Wraps action JSON",
                        "collaborators": [
                          "Action JSON"
                        ]
                      },
                      {
                        "name": "Displays action properties",
                        "collaborators": [
                          "Object",
                          "Action JSON"
                        ]
                      }
                    ],
                    "module": "actions",
                    "inherits_from": "SubSectionView",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "TTYInstructions",
                    "responsibilities": [
                      {
                        "name": "Serialize instructions to TTY",
                        "collaborators": [
                          "Instructions",
                          "String"
                        ]
                      },
                      {
                        "name": "Format instruction sections",
                        "collaborators": [
                          "Sections",
                          "String"
                        ]
                      },
                      {
                        "name": "Wraps domain instructions",
                        "collaborators": [
                          "Instructions"
                        ]
                      }
                    ],
                    "module": "instructions",
                    "inherits_from": "TTYAdapter",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "JSONInstructions",
                    "responsibilities": [
                      {
                        "name": "Serialize instructions to JSON",
                        "collaborators": [
                          "Instructions",
                          "Dict"
                        ]
                      },
                      {
                        "name": "Include instruction sections",
                        "collaborators": [
                          "Sections",
                          "Array"
                        ]
                      },
                      {
                        "name": "Wraps domain instructions",
                        "collaborators": [
                          "Instructions"
                        ]
                      }
                    ],
                    "module": "instructions",
                    "inherits_from": "JSONAdapter",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "MarkdownInstructions",
                    "responsibilities": [
                      {
                        "name": "Serialize instructions to Markdown",
                        "collaborators": [
                          "Instructions",
                          "String"
                        ]
                      },
                      {
                        "name": "Format instruction sections",
                        "collaborators": [
                          "Sections",
                          "Markdown"
                        ]
                      },
                      {
                        "name": "Wraps domain instructions",
                        "collaborators": [
                          "Instructions"
                        ]
                      }
                    ],
                    "module": "instructions",
                    "inherits_from": "MarkdownAdapter",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "InstructionsSection",
                    "responsibilities": [
                      {
                        "name": "Wraps instructions JSON",
                        "collaborators": [
                          "Instructions JSON"
                        ]
                      },
                      {
                        "name": "Wraps action JSON",
                        "collaborators": [
                          "Action JSON"
                        ]
                      },
                      {
                        "name": "Displays base instructions subsection",
                        "collaborators": [
                          "BaseInstructionsSubSection"
                        ]
                      },
                      {
                        "name": "Displays raw format subsection",
                        "collaborators": [
                          "RawFormatSubSection"
                        ]
                      },
                      {
                        "name": "Submits to AI chat",
                        "collaborators": [
                          "CLI",
                          "Instructions JSON"
                        ]
                      }
                    ],
                    "module": "instructions",
                    "inherits_from": "SectionView (Base)",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "BaseInstructionsSubSection",
                    "responsibilities": [
                      {
                        "name": "Wraps instructions JSON",
                        "collaborators": [
                          "Instructions JSON"
                        ]
                      },
                      {
                        "name": "Displays behavior name",
                        "collaborators": [
                          "String",
                          "Instructions JSON"
                        ]
                      },
                      {
                        "name": "Displays action name",
                        "collaborators": [
                          "String",
                          "Instructions JSON"
                        ]
                      },
                      {
                        "name": "Displays  Instructions",
                        "collaborators": [
                          "Instructions JSON"
                        ]
                      }
                    ],
                    "module": "instructions",
                    "inherits_from": "SubSectionView",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "RawFormatSubSection",
                    "responsibilities": [
                      {
                        "name": "Wraps instructions JSON",
                        "collaborators": [
                          "Instructions JSON"
                        ]
                      },
                      {
                        "name": "Displays raw instructions",
                        "collaborators": [
                          "String",
                          "Instructions JSON"
                        ]
                      }
                    ],
                    "module": "instructions",
                    "inherits_from": "SubSectionView",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  }
                ]
              },
              {
                "name": "Clarify Requirements",
                "sub_epics": [],
                "story_groups": [
                  {
                    "name": null,
                    "stories": [
                      {
                        "name": "Clarify Requirements",
                        "acceptance_criteria": [],
                        "scenarios": [
                          {
                            "name": "Action injects questions and evidence from production guardrails",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Production story_bot with shape behavior (has guardrails)",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When Action injects guardrails",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then Instructions contain questions and evidence from production files",
                                "sequential_order": 3.0
                              }
                            ]
                          },
                          {
                            "name": "Save clarification data when parameters are provided",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Production story_bot clarify action",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When do_execute is called with key_questions_answered and evidence_provided",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then clarification.json file is created in docs/story/ folder",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then And file contains behavior section with key_questions and evidence",
                                "sequential_order": 4.0
                              }
                            ]
                          },
                          {
                            "name": "Preserve existing clarification data when saving",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given clarification.json already exists with data for 'discovery' behavior",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When do_execute is called with parameters",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then clarification.json contains both 'discovery' and 'shape' sections",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then And Production story_bot clarify action for 'shape' behavior",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "Then And existing 'discovery' data is preserved",
                                "sequential_order": 5.0
                              }
                            ]
                          },
                          {
                            "name": "Skip saving when no clarification parameters are provided",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Production story_bot clarify action",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When do_execute is called with empty parameters",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then clarification.json file is not created",
                                "sequential_order": 3.0
                              }
                            ]
                          },
                          {
                            "name": "Guardrails loads required context from workspace",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Workspace with guardrails files (questions and evidence)",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When Behavior loads guardrails",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then Questions and evidence are loaded correctly",
                                "sequential_order": 3.0
                              }
                            ]
                          },
                          {
                            "name": "Guardrails loads strategy assumptions from workspace",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Workspace with strategy guardrails files",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When Behavior loads guardrails",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then Strategy assumptions are loaded correctly",
                                "sequential_order": 3.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Clarify Requirements Using CLI",
                        "acceptance_criteria": [],
                        "scenarios": [
                          {
                            "name": "Clarify action shows questions and evidence in CLI output",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: CLI is at shape.clarify",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: user navigates to shape.clarify",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: CLI output contains questions and evidence from guardrails",
                                "sequential_order": 3.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Display Clarification Data Through CLI",
                        "acceptance_criteria": [],
                        "scenarios": [
                          {
                            "name": "Display stored clarification data",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: Clarification data exists",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: user views clarify instructions",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: CLI displays stored clarification data",
                                "sequential_order": 3.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Display Clarify Instructions Panel",
                        "acceptance_criteria": [
                          {
                            "name": "WHEN Current action is clarify\nTHEN System displays key questions with editable answer textareas AND System displays evidence list",
                            "text": "WHEN Current action is clarify\nTHEN System displays key questions with editable answer textareas AND System displays evidence list",
                            "sequential_order": 1.0
                          },
                          {
                            "name": "WHEN User edits answer textarea\nTHEN System updates answer",
                            "text": "WHEN User edits answer textarea\nTHEN System updates answer",
                            "sequential_order": 2.0
                          },
                          {
                            "name": "WHEN saved key questions and answers exists\nTHEN System displays saved key questions and answers",
                            "text": "WHEN saved key questions and answers exists\nTHEN System displays saved key questions and answers",
                            "sequential_order": 3.0
                          },
                          {
                            "name": "WHEN User is on non-clarify actions and has previously made strategy decisions\nTHEN System displays saved strategy decisions and criteria as read-only",
                            "text": "WHEN User is on non-clarify actions and has previously made strategy decisions\nTHEN System displays saved strategy decisions and criteria as read-only",
                            "sequential_order": 4.0
                          }
                        ],
                        "scenarios": [
                          {
                            "name": "",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Bot is at shape.clarify",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And Guardrails define key questions and evidence",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When Panel displays instructions section",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then Panel displays key questions list",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And Panel displays evidence requirements",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And Each question has editable textarea for answers",
                                "sequential_order": 6.0
                              }
                            ]
                          },
                          {
                            "name": "",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Panel displays clarify instructions with questions",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When User types answer in question textarea",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then System saves answer",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And Answer persists across panel refreshes",
                                "sequential_order": 4.0
                              }
                            ]
                          },
                          {
                            "name": "",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given User has previously answered clarify questions",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And Answers are saved in clarification.json",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When Panel displays clarify instructions",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then Panel displays saved answers in textareas",
                                "sequential_order": 4.0
                              }
                            ]
                          },
                          {
                            "name": "",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Bot is at shape.clarify",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And User has previously made strategy decisions",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When Panel displays clarify instructions",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then Panel displays Strategy section",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And Strategy section shows all decision criteria with selected options",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And Strategy section shows saved assumptions",
                                "sequential_order": 6.0
                              },
                              {
                                "text": "And Strategy data is read-only (not editable in clarify action)",
                                "sequential_order": 7.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Get Clarify Instructions Through CLI",
                        "acceptance_criteria": [],
                        "scenarios": [
                          {
                            "name": "Get clarify instructions with questions",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: CLI is at shape.clarify.instructions",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: user enters 'shape.clarify.instructions'",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: CLI displays key questions and required evidence",
                                "sequential_order": 3.0
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                ],
                "domain_concepts": [
                  {
                    "name": "GatherContextAction",
                    "responsibilities": [
                      {
                        "name": "Inject gather context instructions",
                        "collaborators": [
                          "Behavior",
                          "Guardrails",
                          "Required Clarifications"
                        ]
                      },
                      {
                        "name": "Inject questions and evidence",
                        "collaborators": [
                          "Behavior",
                          "Guardrails",
                          "Key Questions",
                          "Evidence"
                        ]
                      }
                    ],
                    "module": "actions.clarify",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "TTYGatherContext",
                    "responsibilities": [
                      {
                        "name": "Serialize clarify action to TTY",
                        "collaborators": [
                          "GatherContextAction",
                          "TTY String"
                        ]
                      },
                      {
                        "name": "Format key questions",
                        "collaborators": [
                          "Questions",
                          "Evidence",
                          "TTY String"
                        ]
                      },
                      {
                        "name": "Wraps domain action",
                        "collaborators": [
                          "GatherContextAction"
                        ]
                      }
                    ],
                    "module": "actions.clarify",
                    "inherits_from": "TTYProgressAdapter",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "JSONGatherContext",
                    "responsibilities": [
                      {
                        "name": "Serialize clarify action to JSON",
                        "collaborators": [
                          "GatherContextAction",
                          "JSON String"
                        ]
                      },
                      {
                        "name": "Include questions and evidence",
                        "collaborators": [
                          "Questions",
                          "Evidence",
                          "JSON"
                        ]
                      },
                      {
                        "name": "Wraps domain action",
                        "collaborators": [
                          "GatherContextAction"
                        ]
                      }
                    ],
                    "module": "actions.clarify",
                    "inherits_from": "JSONProgressAdapter",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "MarkdownGatherContext",
                    "responsibilities": [
                      {
                        "name": "Serialize clarify action to Markdown",
                        "collaborators": [
                          "GatherContextAction",
                          "Markdown String"
                        ]
                      },
                      {
                        "name": "Format questions list",
                        "collaborators": [
                          "Questions",
                          "Evidence",
                          "Markdown"
                        ]
                      },
                      {
                        "name": "Wraps domain action",
                        "collaborators": [
                          "GatherContextAction"
                        ]
                      }
                    ],
                    "module": "actions.clarify",
                    "inherits_from": "MarkdownProgressAdapter",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "ClarifyInstructionsSection",
                    "responsibilities": [
                      {
                        "name": "Wraps clarify subsection",
                        "collaborators": [
                          "ClarifyDataSubSection"
                        ]
                      }
                    ],
                    "realization": [
                      {
                        "scope": "Invoke Bot Through Panel.Display Instructions.Display Clarify Instructions",
                        "scenario": "When current action is clarify, panel displays ClarifyInstructionsSection with key questions in editable textareas, user edits answer, system saves via CLI",
                        "walks": [
                          {
                            "covers": "Rendering clarify-specific instructions from JSON",
                            "object_flow": [
                              "InstructionsSection.create(instructionsJSON, actionJSON, cliClient)",
                              "  -> actionType: String = actionJSON.type",
                              "  -> section: InstructionsSection = this.create_section_for_type(actionType, instructionsJSON, actionJSON, cliClient)",
                              "     -> section: ClarifyInstructionsSection = new ClarifyInstructionsSection(instructionsJSON, actionJSON, cliClient)",
                              "        -> this.keyQuestionsJSON = instructionsJSON.clarify.key_questions",
                              "        -> this.cliClient = cliClient",
                              "     return section",
                              "html: String = section.render()",
                              "  -> baseHTML: String = this.renderBase()",
                              "     return `<div>${this.instructionsJSON.behavior_name}.${this.actionJSON.name}</div>`",
                              "  -> questionsHTML: String = this.render_all_questions()",
                              "     return questionsHTML: \"<div class='question'>...</div>...\"",
                              "return `${baseHTML}${questionsHTML}`"
                            ]
                          },
                          {
                            "covers": "User edits answer and saves via CLI",
                            "object_flow": [
                              "ClarifyInstructionsSection.onAnswerChange(questionId, newAnswer)",
                              "  -> question: Object = this.get_question_by_id(questionId)",
                              "  -> result: JSON = this.cliClient.execute(`update_answer \"${question.question}\" \"${newAnswer}\"`)",
                              "     -> cli:  = spawn('python', ['repl_main.py'])",
                              "     -> stdin.write('update_answer ...')",
                              "     -> Bot.update_question_answer(question, newAnswer)",
                              "        -> clarificationFile: Path = behavior.get_clarification_file()",
                              "        -> this.persist_clarification_answer(clarificationFile, question, newAnswer)",
                              "        return {status: 'saved', question: question, answer: newAnswer}",
                              "     return resultJSON",
                              "  -> question.answer = newAnswer",
                              "return"
                            ]
                          }
                        ],
                        "model_updates": []
                      }
                    ],
                    "module": "actions.clarify",
                    "inherits_from": "InstructionsSection",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "ClarifyDataSubSection",
                    "responsibilities": [
                      {
                        "name": "Wraps key questions JSON",
                        "collaborators": [
                          "KeyQuestions JSON"
                        ]
                      },
                      {
                        "name": "Displays key questions",
                        "collaborators": [
                          "List",
                          "KeyQuestion JSON"
                        ]
                      },
                      {
                        "name": "Updates evidence",
                        "collaborators": [
                          "CLI",
                          "Evidence JSON"
                        ]
                      },
                      {
                        "name": "Edits answer",
                        "collaborators": [
                          "CLI",
                          "KeyQuestion JSON"
                        ]
                      }
                    ],
                    "module": "actions.clarify",
                    "inherits_from": "SubSectionView",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  }
                ]
              },
              {
                "name": "Decide Strategy",
                "sub_epics": [],
                "story_groups": [
                  {
                    "name": null,
                    "stories": [
                      {
                        "name": "Decide Strategy",
                        "acceptance_criteria": [],
                        "scenarios": [
                          {
                            "name": "Action Injects Decision Criteria And Assumptions",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Production story_bot with shape behavior (has guardrails)",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When Action injects strategy criteria and assumptions",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then Instructions contain all required strategy fields",
                                "sequential_order": 3.0
                              }
                            ]
                          },
                          {
                            "name": "Save strategy data when parameters are provided",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Production story_bot strategy action",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When do_execute is called with decisions_made and assumptions_made",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then strategy.json file is created in docs/story/ folder",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then And file contains behavior section with decisions_made and assumptions_made",
                                "sequential_order": 4.0
                              }
                            ]
                          },
                          {
                            "name": "Preserve existing strategy data when saving",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given strategy.json already exists with data for 'discovery' behavior",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When do_execute is called with parameters",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then strategy.json contains both 'discovery' and 'shape' sections",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then And Production story_bot strategy action for 'shape' behavior",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "Then And existing 'discovery' data is preserved",
                                "sequential_order": 5.0
                              }
                            ]
                          },
                          {
                            "name": "Skip saving when no strategy parameters are provided",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Production story_bot strategy action",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When do_execute is called with empty parameters",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then strategy.json file is not created",
                                "sequential_order": 3.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Decide Strategy Using CLI",
                        "acceptance_criteria": [],
                        "scenarios": [
                          {
                            "name": "Strategy action shows criteria and assumptions in CLI output",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: CLI is at shape.strategy",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: user navigates to shape.strategy",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: CLI output contains decision criteria and assumptions",
                                "sequential_order": 3.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Display Strategy Data Through CLI",
                        "acceptance_criteria": [],
                        "scenarios": [
                          {
                            "name": "Display stored strategy data",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: Strategy data exists",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: user views strategy instructions",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: CLI displays stored strategy decisions and assumptions",
                                "sequential_order": 3.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Display Strategy Instructions Panel",
                        "acceptance_criteria": [
                          {
                            "name": "WHEN Current action is strategy\nTHEN System displays decision criteria with radio button options AND System displays assumptions textarea",
                            "text": "WHEN Current action is strategy\nTHEN System displays decision criteria with radio button options AND System displays assumptions textarea",
                            "sequential_order": 1.0
                          },
                          {
                            "name": "WHEN Saved strategy exists\nTHEN System displays selected option for each decision criterion AND Assumptions textarea remains editable AND Textarea is pre-filled with saved assumptions",
                            "text": "WHEN Saved strategy exists\nTHEN System displays selected option for each decision criterion AND Assumptions textarea remains editable AND Textarea is pre-filled with saved assumptions",
                            "sequential_order": 2.0
                          },
                          {
                            "name": "WHEN User edits assumptions textarea\nTHEN System updates assumptions",
                            "text": "WHEN User edits assumptions textarea\nTHEN System updates assumptions",
                            "sequential_order": 3.0
                          },
                          {
                            "name": "WHEN User is on non-strategy actions (clarify, build, validate, render)\nTHEN System displays saved strategy decisions and criteria as read-only",
                            "text": "WHEN User is on non-strategy actions (clarify, build, validate, render)\nTHEN System displays saved strategy decisions and criteria as read-only",
                            "sequential_order": 4.0
                          }
                        ],
                        "scenarios": [
                          {
                            "name": "",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Bot is at shape.strategy",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When Panel displays instructions section",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then Panel displays decision criteria with radio options",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And Panel displays assumptions textarea",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And User can select option for each criterion",
                                "sequential_order": 5.0
                              }
                            ]
                          },
                          {
                            "name": "",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Panel displays strategy instructions",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When User selects radio option for decision criterion",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then System saves selected option",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And Selection persists across panel refreshes",
                                "sequential_order": 4.0
                              }
                            ]
                          },
                          {
                            "name": "",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Bot is at shape.strategy",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And User has previously saved assumptions",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When Panel displays strategy instructions",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then Assumptions textarea is displayed as editable input",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And Textarea is pre-filled with saved assumptions",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And User can edit and update assumptions",
                                "sequential_order": 6.0
                              }
                            ]
                          },
                          {
                            "name": "",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Bot is at shape.strategy",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And User has previously answered clarify questions",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When Panel displays strategy instructions",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then Panel displays Clarify section",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And Clarify section shows answered questions",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And Clarify data is read-only (not editable in strategy action)",
                                "sequential_order": 6.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Submit Instructions To AI Agent Panel",
                        "acceptance_criteria": [
                          {
                            "name": "When user has clicked on a Behavior Action's Instructions AND User clicks submit button THEN System sends instructions to AI chat",
                            "text": "When user has clicked on a Behavior Action's Instructions AND User clicks submit button THEN System sends instructions to AI chat",
                            "sequential_order": 1.0
                          },
                          {
                            "name": "WHEN User clicks submit button\nTHEN Submitted instructions include scope section AND Scope section includes scope type (story/files/all) AND Scope section includes scope filter values AND Scope section includes complete story graph tree when scope is story-based",
                            "text": "WHEN User clicks submit button\nTHEN Submitted instructions include scope section AND Scope section includes scope type (story/files/all) AND Scope section includes scope filter values AND Scope section includes complete story graph tree when scope is story-based",
                            "sequential_order": 2.0
                          },
                          {
                            "name": "WHEN User has answered clarify questions or made strategy decisions\nTHEN Submitted instructions include all saved guardrails",
                            "text": "WHEN User has answered clarify questions or made strategy decisions\nTHEN Submitted instructions include all saved guardrails",
                            "sequential_order": 3.0
                          }
                        ],
                        "scenarios": [
                          {
                            "name": "",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Panel displays instructions for current action",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When User clicks submit button",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then System sends instructions to Cursor AI chat",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And Panel displays success confirmation message",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And AI chat receives instructions",
                                "sequential_order": 5.0
                              }
                            ]
                          },
                          {
                            "name": "",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Panel displays instructions",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And Cursor AI chat is not available",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When User clicks submit button",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then Panel displays error message",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And Error message indicates chat unavailable",
                                "sequential_order": 5.0
                              }
                            ]
                          },
                          {
                            "name": "",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Panel displays instructions",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When User clicks copy button",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then Instructions are copied to clipboard",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "When User clicks submit button",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "Then Instructions are also sent to AI chat",
                                "sequential_order": 5.0
                              }
                            ]
                          },
                          {
                            "name": "",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Bot has scope set to story Open Panel",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And Scope.results contains full story graph hierarchy",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When User clicks submit in panel",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then Submitted instructions contain Scope section at top",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And Scope section shows Story Scope: Open Panel",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And Scope section shows complete epic/sub-epic/story hierarchy",
                                "sequential_order": 6.0
                              }
                            ]
                          },
                          {
                            "name": "",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Bot is at shape.build",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And User has answered clarify questions",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "And User has made strategy decisions",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "When User clicks submit in panel",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "Then Submitted instructions include Clarify section with answers",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And Submitted instructions include Strategy section with decisions and assumptions",
                                "sequential_order": 6.0
                              },
                              {
                                "text": "And All saved guardrails are visible in submitted markdown",
                                "sequential_order": 7.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Get Strategy Instructions Through CLI",
                        "acceptance_criteria": [],
                        "scenarios": [
                          {
                            "name": "Get strategy instructions with criteria",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: CLI is at shape.strategy.instructions",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: user enters 'shape.strategy.instructions'",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: CLI displays planning criteria and assumptions",
                                "sequential_order": 3.0
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                ],
                "domain_concepts": [
                  {
                    "name": "StrategyAction",
                    "responsibilities": [
                      {
                        "name": "Inject Strategy instructions",
                        "collaborators": [
                          "Behavior",
                          "Guardrails",
                          "Strategy"
                        ]
                      },
                      {
                        "name": "Inject decision criteria and assumptions",
                        "collaborators": [
                          "Behavior",
                          "Guardrails",
                          "Decision Criteria",
                          "Assumptions",
                          "Recommended Human Activity"
                        ]
                      }
                    ],
                    "module": "actions.strategy",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "TTYStrategy",
                    "responsibilities": [
                      {
                        "name": "Serialize strategy action to TTY",
                        "collaborators": [
                          "StrategyAction",
                          "TTY String"
                        ]
                      },
                      {
                        "name": "Format decision criteria",
                        "collaborators": [
                          "Criteria",
                          "Assumptions",
                          "TTY String"
                        ]
                      },
                      {
                        "name": "Wraps domain action",
                        "collaborators": [
                          "StrategyAction"
                        ]
                      }
                    ],
                    "module": "actions.strategy",
                    "inherits_from": "TTYProgressAdapter",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "JSONStrategy",
                    "responsibilities": [
                      {
                        "name": "Serialize strategy action to JSON",
                        "collaborators": [
                          "StrategyAction",
                          "JSON String"
                        ]
                      },
                      {
                        "name": "Include criteria and assumptions",
                        "collaborators": [
                          "Criteria",
                          "Assumptions",
                          "JSON"
                        ]
                      },
                      {
                        "name": "Wraps domain action",
                        "collaborators": [
                          "StrategyAction"
                        ]
                      }
                    ],
                    "module": "actions.strategy",
                    "inherits_from": "JSONProgressAdapter",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "MarkdownStrategy",
                    "responsibilities": [
                      {
                        "name": "Serialize strategy action to Markdown",
                        "collaborators": [
                          "StrategyAction",
                          "Markdown String"
                        ]
                      },
                      {
                        "name": "Format strategy documentation",
                        "collaborators": [
                          "Criteria",
                          "Assumptions",
                          "Markdown"
                        ]
                      },
                      {
                        "name": "Wraps domain action",
                        "collaborators": [
                          "StrategyAction"
                        ]
                      }
                    ],
                    "module": "actions.strategy",
                    "inherits_from": "MarkdownProgressAdapter",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "StrategyInstructionsSection",
                    "responsibilities": [
                      {
                        "name": "Wraps strategy subsection",
                        "collaborators": [
                          "StrategyDataSubSection"
                        ]
                      }
                    ],
                    "module": "actions.strategy",
                    "inherits_from": "InstructionsSection",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "StrategyDataSubSection",
                    "responsibilities": [
                      {
                        "name": "Wraps strategy JSON",
                        "collaborators": [
                          "Strategy JSON"
                        ]
                      },
                      {
                        "name": "Displays decision criteria",
                        "collaborators": [
                          "List",
                          "DecisionCriteria JSON"
                        ]
                      },
                      {
                        "name": "Displays assumptions",
                        "collaborators": [
                          "String",
                          "Assumptions JSON"
                        ]
                      },
                      {
                        "name": "Edits decision criterion",
                        "collaborators": [
                          "CLI",
                          "DecisionCriterion JSON"
                        ]
                      },
                      {
                        "name": "Edits assumption",
                        "collaborators": [
                          "CLI",
                          "Assumption JSON"
                        ]
                      }
                    ],
                    "module": "actions.strategy",
                    "inherits_from": "SubSectionView",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  }
                ]
              },
              {
                "name": "Build Story Graph",
                "sub_epics": [],
                "story_groups": [
                  {
                    "name": null,
                    "stories": [
                      {
                        "name": "Build Story Graph",
                        "acceptance_criteria": [],
                        "scenarios": [
                          {
                            "name": "Action Injects Story Graph Template",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Production story_bot with shape behavior (has story graph templates)",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When Action injects story graph template",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then Instructions contain template_path from existing templates",
                                "sequential_order": 3.0
                              }
                            ]
                          },
                          {
                            "name": "Action Loads And Merges Instructions",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Production story_bot with shape behavior (has story graph templates)",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When Action injects story graph and instructions",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then Instructions contain all BuildStoryGraphAction-specific fields",
                                "sequential_order": 3.0
                              }
                            ]
                          },
                          {
                            "name": "All Template Variables Are Replaced In Instructions",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Production story_bot with shape behavior (has story graph templates)",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When Action injects all template variables",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then Instructions contain all required BuildStoryGraphAction fields",
                                "sequential_order": 3.0
                              }
                            ]
                          },
                          {
                            "name": "Prioritization behavior updates existing story-graph.json",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Production prioritization behavior with increments templates",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When Action injects story graph template for increments",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then Instructions use production template (story_graph_increments.json) that updates existing file",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then And Existing story-graph.json in workspace",
                                "sequential_order": 4.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Build Story Graph Using CLI",
                        "acceptance_criteria": [],
                        "scenarios": [
                          {
                            "name": "Build action shows story graph template in CLI output",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: CLI is at shape.build",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: user navigates to shape.build",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: CLI output contains template_path information",
                                "sequential_order": 3.0
                              }
                            ]
                          },
                          {
                            "name": "Build action shows complete build story graph instructions",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: CLI is at shape.build",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: user navigates to shape.build",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: CLI output contains all BuildStoryGraphAction fields",
                                "sequential_order": 3.0
                              }
                            ]
                          },
                          {
                            "name": "Prioritization validate action shows increments validation",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: CLI is at prioritization.validate",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "AND: Story graph exists in workspace",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "WHEN: user navigates to prioritization.validate",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "THEN: CLI output shows validation instructions for increments",
                                "sequential_order": 4.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Get Build Instructions Through CLI",
                        "acceptance_criteria": [],
                        "scenarios": [
                          {
                            "name": "Get build instructions without scope",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: CLI is at shape.build.instructions",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: user enters 'shape.build.instructions'",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: CLI displays build instructions with full knowledge graph",
                                "sequential_order": 3.0
                              }
                            ]
                          },
                          {
                            "name": "Get build instructions with scope",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: CLI is at shape.build.instructions",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: user enters 'shape.build.instructions scope=\"Story1\"'",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: CLI displays build instructions filtered to Story1",
                                "sequential_order": 3.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Build Story Graph Using API",
                        "acceptance_criteria": [
                          {
                            "name": "WHEN Bot is called through StoryMap API\nTHEN caller uses create_epic(), create_child(), create_story() for fine-grained construction\nAND caller validates each node during creation\nAND validation errors caught immediately before invalid structure created",
                            "text": "WHEN Bot is called through StoryMap API\nTHEN caller uses create_epic(), create_child(), create_story() for fine-grained construction\nAND caller validates each node during creation\nAND validation errors caught immediately before invalid structure created",
                            "sequential_order": 1.0
                          },
                          {
                            "name": "WHEN Bot is called with large story graph structures\nTHEN caller uses create_epic_from_dict() for batch operations\nAND caller passes dictionary notation with epic/sub-epic/story hierarchy\nAND StoryMap converts dict notation to domain objects\nAND StoryMap validates entire structure before committing",
                            "text": "WHEN Bot is called with large story graph structures\nTHEN caller uses create_epic_from_dict() for batch operations\nAND caller passes dictionary notation with epic/sub-epic/story hierarchy\nAND StoryMap converts dict notation to domain objects\nAND StoryMap validates entire structure before committing",
                            "sequential_order": 2.0
                          },
                          {
                            "name": "WHEN StoryMap uses save() method\nTHEN StoryMap persists story_graph dict to JSON file\nAND file format matches existing story-graph.json structure\nAND all nodes converted to dict representation before saving",
                            "text": "WHEN StoryMap uses save() method\nTHEN StoryMap persists story_graph dict to JSON file\nAND file format matches existing story-graph.json structure\nAND all nodes converted to dict representation before saving",
                            "sequential_order": 3.0
                          },
                          {
                            "name": "WHEN StoryMap uses load() method\nTHEN StoryMap reads JSON file\nAND StoryMap rebuilds domain model from JSON\nAND StoryMap reconstructs all Epic, SubEpic, Story objects with relationships",
                            "text": "WHEN StoryMap uses load() method\nTHEN StoryMap reads JSON file\nAND StoryMap rebuilds domain model from JSON\nAND StoryMap reconstructs all Epic, SubEpic, Story objects with relationships",
                            "sequential_order": 4.0
                          },
                          {
                            "name": "WHEN fine-grained and batch APIs implement same interface\nTHEN both validate hierarchy rules (no mixing sub-epics and stories)\nAND both handle positioning and resequencing\nAND both update story_graph dict representation\nAND interface enables incremental construction or bulk creation",
                            "text": "WHEN fine-grained and batch APIs implement same interface\nTHEN both validate hierarchy rules (no mixing sub-epics and stories)\nAND both handle positioning and resequencing\nAND both update story_graph dict representation\nAND interface enables incremental construction or bulk creation",
                            "sequential_order": 5.0
                          }
                        ],
                        "scenarios": []
                      },
                      {
                        "name": "Display Build Instructions Panel",
                        "acceptance_criteria": [
                          {
                            "name": "WHEN Current action is build\nTHEN System displays knowledge graph section with template path link AND System displays knowledge graph output file link AND System displays knowledge graph directory path AND System displays rules list with clickable rule file links",
                            "text": "WHEN Current action is build\nTHEN System displays knowledge graph section with template path link AND System displays knowledge graph output file link AND System displays knowledge graph directory path AND System displays rules list with clickable rule file links",
                            "sequential_order": 1.0
                          }
                        ],
                        "scenarios": [
                          {
                            "name": "",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Bot is at shape.build",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When Panel displays instructions section",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then Panel displays knowledge graph template link",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And Panel displays knowledge graph output file link",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And Panel displays rules list with clickable links",
                                "sequential_order": 5.0
                              }
                            ]
                          },
                          {
                            "name": "",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Panel displays build instructions",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When User clicks template path link",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then VS Code opens knowledge graph template file in editor",
                                "sequential_order": 3.0
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                ],
                "domain_concepts": [
                  {
                    "name": "BuildKnowledgeAction",
                    "responsibilities": [
                      {
                        "name": "Inject knowledge graph template",
                        "collaborators": [
                          "Behavior",
                          "Content",
                          "Knowledge Graph Spec",
                          "Knowledge Graph"
                        ]
                      },
                      {
                        "name": "Inject builder instructions",
                        "collaborators": [
                          "Behavior",
                          "Content",
                          "Build Instructions"
                        ]
                      },
                      {
                        "name": "Save Knowledge graph",
                        "collaborators": [
                          "Behavior",
                          "Content",
                          "Knowledge Graph"
                        ]
                      }
                    ],
                    "module": "actions.build",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "TTYBuildKnowledge",
                    "responsibilities": [
                      {
                        "name": "Serialize build action to TTY",
                        "collaborators": [
                          "BuildKnowledgeAction",
                          "String"
                        ]
                      },
                      {
                        "name": "Format build status",
                        "collaborators": [
                          "Status",
                          "TTY String"
                        ]
                      },
                      {
                        "name": "Wraps domain action",
                        "collaborators": [
                          "BuildKnowledgeAction"
                        ]
                      }
                    ],
                    "module": "actions.build",
                    "inherits_from": "TTYProgressAdapter",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "JSONBuildKnowledge",
                    "responsibilities": [
                      {
                        "name": "Serialize build action to JSON",
                        "collaborators": [
                          "BuildKnowledgeAction",
                          "JSON String"
                        ]
                      },
                      {
                        "name": "Include build metadata",
                        "collaborators": [
                          "Knowledge Graph Spec",
                          "JSON"
                        ]
                      },
                      {
                        "name": "Wraps domain action",
                        "collaborators": [
                          "BuildKnowledgeAction"
                        ]
                      }
                    ],
                    "module": "actions.build",
                    "inherits_from": "JSONProgressAdapter",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "MarkdownBuildKnowledge",
                    "responsibilities": [
                      {
                        "name": "Serialize build action to Markdown",
                        "collaborators": [
                          "BuildKnowledgeAction",
                          "Markdown String"
                        ]
                      },
                      {
                        "name": "Format build documentation",
                        "collaborators": [
                          "Knowledge Graph Spec",
                          "Markdown"
                        ]
                      },
                      {
                        "name": "Wraps domain action",
                        "collaborators": [
                          "BuildKnowledgeAction"
                        ]
                      }
                    ],
                    "module": "actions.build",
                    "inherits_from": "MarkdownProgressAdapter",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "BuildInstructionsSection",
                    "responsibilities": [
                      {
                        "name": "Wraps build subsection",
                        "collaborators": [
                          "BuildDataSubSection"
                        ]
                      }
                    ],
                    "module": "actions.build",
                    "inherits_from": "InstructionsSection",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "BuildDataSubSection",
                    "responsibilities": [
                      {
                        "name": "Wraps build JSON",
                        "collaborators": [
                          "Build JSON"
                        ]
                      },
                      {
                        "name": "Displays knowledge graph spec",
                        "collaborators": [
                          "Object",
                          "KnowledgeGraphSpec JSON"
                        ]
                      },
                      {
                        "name": "Displays graph structure",
                        "collaborators": [
                          "Object",
                          "KnowledgeGraphSpec JSON"
                        ]
                      },
                      {
                        "name": "Displays builder instructions",
                        "collaborators": [
                          "String",
                          "BuilderInstructions JSON"
                        ]
                      },
                      {
                        "name": "Opens graph file",
                        "collaborators": [
                          "CLI",
                          "Path JSON"
                        ]
                      }
                    ],
                    "module": "actions.build",
                    "inherits_from": "SubSectionView",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  }
                ]
              },
              {
                "name": "Render Content",
                "sub_epics": [],
                "story_groups": [
                  {
                    "name": null,
                    "stories": [
                      {
                        "name": "Render Output Usng Story API",
                        "acceptance_criteria": [],
                        "scenarios": [
                          {
                            "name": "Action injects render configs and instructions",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Production story_bot with shape behavior (has render configs)",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When Action injects render data",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then Instructions contain all required render fields",
                                "sequential_order": 3.0
                              }
                            ]
                          },
                          {
                            "name": "Synchronizers are executed automatically during render action",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Production story_bot with shape behavior (has synchronizers)",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When Render output action executes",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then Synchronizers are executed automatically",
                                "sequential_order": 3.0
                              }
                            ]
                          },
                          {
                            "name": "Template configs remain in instructions for AI handling",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Production story_bot with shape behavior (has templates)",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When Render output action executes",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then Result includes instructions",
                                "sequential_order": 3.0
                              }
                            ]
                          },
                          {
                            "name": "Executed synchronizers information is included in AI instructions",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Production story_bot with shape behavior (has synchronizers)",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When Render output action executes",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then Instructions include synchronizer execution info",
                                "sequential_order": 3.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Render Output Using CLI",
                        "acceptance_criteria": [],
                        "scenarios": [
                          {
                            "name": "Render action shows render configs in CLI output",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: CLI is at shape.render",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: user navigates to shape.render",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: CLI output contains render configurations",
                                "sequential_order": 3.0
                              }
                            ]
                          },
                          {
                            "name": "Render output mentions synchronizers execution",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: CLI is at shape.render",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: user navigates to shape.render",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: CLI output mentions synchronizers",
                                "sequential_order": 3.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Display Synchronizer Output Through CLI",
                        "acceptance_criteria": [],
                        "scenarios": [
                          {
                            "name": "Display rendered output locations",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: Synchronizers have run",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: user views render instructions",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: CLI displays output file paths",
                                "sequential_order": 3.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Display Render Configurations Through CLI",
                        "acceptance_criteria": [],
                        "scenarios": [
                          {
                            "name": "Display loaded render configurations",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: Render configurations exist",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: user views render instructions",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: CLI displays templates and synchronizers",
                                "sequential_order": 3.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Get Render Instructions Through CLI",
                        "acceptance_criteria": [],
                        "scenarios": [
                          {
                            "name": "Get render instructions with templates",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: CLI is at shape.render.instructions",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: user enters 'shape.render.instructions'",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: CLI displays render instructions with templates and synchronizers",
                                "sequential_order": 3.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Display Render Instructions Panel",
                        "acceptance_criteria": [
                          {
                            "name": "WHEN Current action is render\nTHEN System displays config file paths as clickable links AND System displays template file paths as clickable links AND System displays output file paths as clickable links",
                            "text": "WHEN Current action is render\nTHEN System displays config file paths as clickable links AND System displays template file paths as clickable links AND System displays output file paths as clickable links",
                            "sequential_order": 1.0
                          },
                          {
                            "name": "WHEN User clicks on any of these links\nTHEN System opens the corresponding file in the editor",
                            "text": "WHEN User clicks on any of these links\nTHEN System opens the corresponding file in the editor",
                            "sequential_order": 2.0
                          }
                        ],
                        "scenarios": [
                          {
                            "name": "",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Bot is at shape.render",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When Panel displays instructions section",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then Panel displays config file paths as clickable links",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And Panel displays template file paths as clickable links",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And Panel displays output file paths as clickable links",
                                "sequential_order": 5.0
                              }
                            ]
                          },
                          {
                            "name": "",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Panel displays render instructions",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When User clicks config file link",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then VS Code opens render config file in editor",
                                "sequential_order": 3.0
                              }
                            ]
                          },
                          {
                            "name": "",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Panel displays render instructions",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When User clicks template file link",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then VS Code opens template file in editor",
                                "sequential_order": 3.0
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                ],
                "domain_concepts": [
                  {
                    "name": "RenderOutputAction",
                    "responsibilities": [
                      {
                        "name": "Inject render output instructions",
                        "collaborators": [
                          "Behavior",
                          "Content",
                          "Render Spec",
                          "Renderer"
                        ]
                      },
                      {
                        "name": "Inject templates",
                        "collaborators": [
                          "Behavior",
                          "Content",
                          "Render Spec",
                          "Template"
                        ]
                      },
                      {
                        "name": "Inject transformers",
                        "collaborators": [
                          "Behavior",
                          "Content",
                          "Transformer"
                        ]
                      },
                      {
                        "name": "Load + inject structured content",
                        "collaborators": [
                          "Behavior",
                          "Content",
                          "Knowledge Graph"
                        ]
                      }
                    ],
                    "module": "actions.render",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "TTYRenderOutput",
                    "responsibilities": [
                      {
                        "name": "Serialize render action to TTY",
                        "collaborators": [
                          "RenderOutputAction",
                          "TTY String"
                        ]
                      },
                      {
                        "name": "Format render status",
                        "collaborators": [
                          "Render Spec",
                          "TTY String"
                        ]
                      },
                      {
                        "name": "Wraps domain action",
                        "collaborators": [
                          "RenderOutputAction"
                        ]
                      }
                    ],
                    "module": "actions.render",
                    "inherits_from": "TTYProgressAdapter",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "JSONRenderOutput",
                    "responsibilities": [
                      {
                        "name": "Serialize render action to JSON",
                        "collaborators": [
                          "RenderOutputAction",
                          "JSON String"
                        ]
                      },
                      {
                        "name": "Include render spec",
                        "collaborators": [
                          "Render Spec",
                          "Templates",
                          "JSON"
                        ]
                      },
                      {
                        "name": "Wraps domain action",
                        "collaborators": [
                          "RenderOutputAction"
                        ]
                      }
                    ],
                    "module": "actions.render",
                    "inherits_from": "JSONProgressAdapter",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "MarkdownRenderOutput",
                    "responsibilities": [
                      {
                        "name": "Serialize render action to Markdown",
                        "collaborators": [
                          "RenderOutputAction",
                          "Markdown String"
                        ]
                      },
                      {
                        "name": "Format render documentation",
                        "collaborators": [
                          "Render Spec",
                          "Templates",
                          "Markdown"
                        ]
                      },
                      {
                        "name": "Wraps domain action",
                        "collaborators": [
                          "RenderOutputAction"
                        ]
                      }
                    ],
                    "module": "actions.render",
                    "inherits_from": "MarkdownProgressAdapter",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "Renderer",
                    "responsibilities": [
                      {
                        "name": "Render complex output",
                        "collaborators": [
                          "Template",
                          "Knowledge Graph",
                          "Transformer"
                        ]
                      },
                      {
                        "name": "Render outputs using components in context",
                        "collaborators": [
                          "AI Chat",
                          "Template",
                          "Content"
                        ]
                      }
                    ],
                    "module": "actions.render",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "Template",
                    "responsibilities": [
                      {
                        "name": "Define output structure",
                        "collaborators": [
                          "Placeholder"
                        ]
                      },
                      {
                        "name": "Transform content",
                        "collaborators": [
                          "Transformer",
                          "Content"
                        ]
                      },
                      {
                        "name": "Load template",
                        "collaborators": [
                          "Behavior",
                          "Content"
                        ]
                      }
                    ],
                    "module": "actions.render",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "Content",
                    "responsibilities": [
                      {
                        "name": "Render outputs",
                        "collaborators": [
                          "Template",
                          "Renderer",
                          "Render Spec"
                        ]
                      },
                      {
                        "name": "Synchronize formats",
                        "collaborators": [
                          "Synchronizer",
                          "Extractor",
                          "Synchronizer Spec"
                        ]
                      },
                      {
                        "name": "Save knowledge graph",
                        "collaborators": [
                          "Knowledge Graph"
                        ]
                      },
                      {
                        "name": "Load rendered content",
                        "collaborators": [
                          "na"
                        ]
                      },
                      {
                        "name": "Present rendered content",
                        "collaborators": [
                          "na"
                        ]
                      }
                    ],
                    "module": "actions.render",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "RenderInstructionsSection",
                    "responsibilities": [
                      {
                        "name": "Wraps render subsection",
                        "collaborators": [
                          "RenderDataSubSection"
                        ]
                      }
                    ],
                    "module": "actions.render",
                    "inherits_from": "InstructionsSection",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "RenderDataSubSection",
                    "responsibilities": [
                      {
                        "name": "Wraps render JSON",
                        "collaborators": [
                          "Render JSON"
                        ]
                      },
                      {
                        "name": "Displays render spec",
                        "collaborators": [
                          "Object",
                          "RenderSpec JSON"
                        ]
                      },
                      {
                        "name": "Displays templates",
                        "collaborators": [
                          "List",
                          "Template JSON"
                        ]
                      },
                      {
                        "name": "Displays render instructions",
                        "collaborators": [
                          "String",
                          "RenderInstructions JSON"
                        ]
                      },
                      {
                        "name": "Opens template file",
                        "collaborators": [
                          "CLI",
                          "Path JSON"
                        ]
                      }
                    ],
                    "module": "actions.render",
                    "inherits_from": "SubSectionView",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  }
                ]
              },
              {
                "name": "Synchronized Graph with Rendered Diagram Content",
                "sub_epics": [],
                "story_groups": [
                  {
                    "name": null,
                    "stories": [
                      {
                        "name": "Render story map",
                        "acceptance_criteria": [
                          {
                            "name": "When user requests outline diagram from story graph then system renders epics sub-epics and stories to DrawIO file and each node has position and size and output is valid DrawIO XML",
                            "text": "When user requests outline diagram from story graph then system renders epics sub-epics and stories to DrawIO file and each node has position and size and output is valid DrawIO XML",
                            "sequential_order": 1.0
                          },
                          {
                            "name": "When diagram is first rendered (no layout data) then epics at top at fixed Y; epic width equals combined width of sub-epics; sub-epics below epic; sub-epic width equals combined width of stories; stories left-to-right with spacing; actors above stories; epic-level and sub-epic-level actors above containers",
                            "text": "When diagram is first rendered (no layout data) then epics at top at fixed Y; epic width equals combined width of sub-epics; sub-epics below epic; sub-epic width equals combined width of stories; stories left-to-right with spacing; actors above stories; epic-level and sub-epic-level actors above containers",
                            "sequential_order": 2.0
                          },
                          {
                            "name": "When layout data from previous render exists then system applies saved positions for epics and sub-epics; story positions from sequential order (left-to-right preserved); new stories that would overlap go below them for manual positioning; other new nodes get default spacing",
                            "text": "When layout data from previous render exists then system applies saved positions for epics and sub-epics; story positions from sequential order (left-to-right preserved); new stories that would overlap go below them for manual positioning; other new nodes get default spacing",
                            "sequential_order": 3.0
                          },
                          {
                            "name": "When render completes then system writes DrawIO file to specified path and summary reports epics count and sub_epic_count and diagram_generated",
                            "text": "When render completes then system writes DrawIO file to specified path and summary reports epics count and sub_epic_count and diagram_generated",
                            "sequential_order": 4.0
                          },
                          {
                            "name": "When story graph has E epics S sub-epics and N stories then diagram contains exactly E epic cells S sub-epic cells N story cells and summary reports epics E and sub_epic_count S",
                            "text": "When story graph has E epics S sub-epics and N stories then diagram contains exactly E epic cells S sub-epic cells N story cells and summary reports epics E and sub_epic_count S",
                            "sequential_order": 5.0
                          },
                          {
                            "name": "When stories and sub-epics have sequential_order then diagram orders sub-epics left-to-right and stories within each sub-epic by sequential_order",
                            "text": "When stories and sub-epics have sequential_order then diagram orders sub-epics left-to-right and stories within each sub-epic by sequential_order",
                            "sequential_order": 6.0
                          },
                          {
                            "name": "When story has story_type user (or none) then system renders story cell with yellow fill (#fff2cc) stroke (#d6b656) and black text",
                            "text": "When story has story_type user (or none) then system renders story cell with yellow fill (#fff2cc) stroke (#d6b656) and black text",
                            "sequential_order": 7.0
                          },
                          {
                            "name": "When story has story_type system then system renders story cell with dark blue fill (#1a237e) stroke (#0d47a1) and white text",
                            "text": "When story has story_type system then system renders story cell with dark blue fill (#1a237e) stroke (#0d47a1) and white text",
                            "sequential_order": 8.0
                          },
                          {
                            "name": "When story has story_type technical then system renders story cell with black fill (#000000) stroke (#333333) and white text",
                            "text": "When story has story_type technical then system renders story cell with black fill (#000000) stroke (#333333) and white text",
                            "sequential_order": 9.0
                          },
                          {
                            "name": "When epic cells are rendered then system uses rounded shape fill (#e1d5e7) stroke (#9673a6) and black text",
                            "text": "When epic cells are rendered then system uses rounded shape fill (#e1d5e7) stroke (#9673a6) and black text",
                            "sequential_order": 10.0
                          },
                          {
                            "name": "When sub-epic cells are rendered then system uses rounded shape fill (#d5e8d4) stroke (#82b366) and black text",
                            "text": "When sub-epic cells are rendered then system uses rounded shape fill (#d5e8d4) stroke (#82b366) and black text",
                            "sequential_order": 11.0
                          },
                          {
                            "name": "When actor (user) labels are rendered then system uses fixed-aspect cell fill (#dae8fc) stroke (#6c8ebf) and black text (8px)",
                            "text": "When actor (user) labels are rendered then system uses fixed-aspect cell fill (#dae8fc) stroke (#6c8ebf) and black text (8px)",
                            "sequential_order": 12.0
                          }
                        ],
                        "scenarios": [
                          {
                            "name": "Render outline diagram from StoryMap with default layout",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {StoryMap} has {StoryMap.epics} with {DrawIOStoryNode.sequential_order} and nested {DrawIOSubEpic} and {DrawIOStory} nodes",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And no {LayoutData} exists for this diagram",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} renders outline from {StoryMap}",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} positions {DrawIOEpic} at top at fixed Y",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And {DrawIOEpic} width equals combined width of its {DrawIOSubEpic} children",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And {DrawIOSubEpic} positioned below {DrawIOEpic}",
                                "sequential_order": 6.0
                              },
                              {
                                "text": "And {DrawIOSubEpic} width equals combined width of its {DrawIOStory} children",
                                "sequential_order": 7.0
                              },
                              {
                                "text": "And {DrawIOStory} cells arranged left-to-right by {DrawIOStoryNode.sequential_order} with spacing",
                                "sequential_order": 8.0
                              },
                              {
                                "text": "And actor labels positioned above {DrawIOStory} cells",
                                "sequential_order": 9.0
                              },
                              {
                                "text": "And output is valid DrawIO XML written to {DrawIOStoryMap} file path",
                                "sequential_order": 10.0
                              }
                            ]
                          },
                          {
                            "name": "Render outline diagram from StoryMap with saved LayoutData",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {StoryMap} has {StoryMap.epics} with {DrawIOEpic} and {DrawIOSubEpic} and {DrawIOStory} nodes",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And {LayoutData} exists with saved positions for each {DrawIOStoryNode}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} renders outline from {StoryMap}",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} applies {LayoutData} saved positions for {DrawIOEpic} and {DrawIOSubEpic}",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And {DrawIOStory} positions derived from {DrawIOStoryNode.sequential_order} left-to-right",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And new {DrawIOStory} that would overlap existing nodes positioned below for manual placement",
                                "sequential_order": 6.0
                              },
                              {
                                "text": "And other new {DrawIOStoryNode} get default spacing",
                                "sequential_order": 7.0
                              }
                            ]
                          },
                          {
                            "name": "Diagram contains correct count of cells matching StoryMap structure",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {StoryMap} has {StoryMap.epics} E epics and S {DrawIOSubEpic} and N {DrawIOStory}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} renders outline from {StoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} contains exactly E {DrawIOEpic} cells and S {DrawIOSubEpic} cells and N {DrawIOStory} cells",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And summary reports epics E and sub_epic_count S and diagram_generated true",
                                "sequential_order": 4.0
                              }
                            ]
                          },
                          {
                            "name": "Sub-epics and stories ordered by sequential_order",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {StoryMap} has {DrawIOSubEpic} with {DrawIOStoryNode.sequential_order} values",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And each {DrawIOSubEpic} has {DrawIOStory} with {DrawIOStoryNode.sequential_order} values",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} renders outline from {StoryMap}",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then {DrawIOSubEpic} cells ordered left-to-right by {DrawIOStoryNode.sequential_order}",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And {DrawIOStory} cells within each {DrawIOSubEpic} ordered left-to-right by {DrawIOStoryNode.sequential_order}",
                                "sequential_order": 5.0
                              }
                            ]
                          },
                          {
                            "name": "DrawIOStoryMap styles story cells by story_type",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {StoryMap} has a {DrawIOStory} with {DrawIOStory.story_type}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} renders outline from {StoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {DrawIOStory} cell has fill {DrawIOElement.fill} and stroke {DrawIOElement.stroke} and font color {DrawIOElement.font_color}",
                                "sequential_order": 3.0
                              }
                            ]
                          },
                          {
                            "name": "DrawIOStoryMap styles container and label cells by node type",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {StoryMap} has a {DrawIOStoryNode} of type {DrawIOStoryNode.node_type}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} renders outline from {StoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {DrawIOElement} cell has shape {DrawIOElement.shape} and fill {DrawIOElement.fill} and stroke {DrawIOElement.stroke} and font color {DrawIOElement.font_color}",
                                "sequential_order": 3.0
                              }
                            ]
                          },
                          {
                            "name": "Render completes and writes DrawIO file to specified path",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {StoryMap} has been loaded from story graph",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And output file path is specified for {DrawIOStoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} renders outline from {StoryMap}",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} is written to the specified file path",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And summary reports epics count and sub_epic_count and diagram_generated",
                                "sequential_order": 5.0
                              }
                            ]
                          },
                          {
                            "name": "Render outline from empty StoryMap produces empty diagram",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {StoryMap} has no {StoryMap.epics}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} renders outline from {StoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} contains zero {DrawIOEpic} cells",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And summary reports epics 0 and sub_epic_count 0 and diagram_generated true",
                                "sequential_order": 4.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Render story map increments",
                        "acceptance_criteria": [
                          {
                            "name": "When user requests increments diagram then system renders outline with epics and sub-epics but WITHOUT story cells in the outline; stories appear ONLY in increment lanes (no duplication); story cells styled per story_type as in outline",
                            "text": "When user requests increments diagram then system renders outline with epics and sub-epics but WITHOUT story cells in the outline; stories appear ONLY in increment lanes (no duplication); story cells styled per story_type as in outline",
                            "sequential_order": 1.0
                          },
                          {
                            "name": "When story graph has increments with priority then system preserves priority order in diagram (lane order equals increment order) and lane Y positions derived from outline bottom and lane height",
                            "text": "When story graph has increments with priority then system preserves priority order in diagram (lane order equals increment order) and lane Y positions derived from outline bottom and lane height",
                            "sequential_order": 2.0
                          },
                          {
                            "name": "When layout data exists for increments view then system applies saved positions for epics and sub-epics and increment lane Y positions computed from outline bottom and lane height (saved layout for increment lanes not applied on re-render)",
                            "text": "When layout data exists for increments view then system applies saved positions for epics and sub-epics and increment lane Y positions computed from outline bottom and lane height (saved layout for increment lanes not applied on re-render)",
                            "sequential_order": 3.0
                          },
                          {
                            "name": "When render completes then system writes DrawIO file and summary includes increment count",
                            "text": "When render completes then system writes DrawIO file and summary includes increment count",
                            "sequential_order": 4.0
                          },
                          {
                            "name": "All increment lanes use uniform neutral style: fill #f5f5f5 stroke #666666 (no priority-based colors); both lane backgrounds and labels use this style",
                            "text": "All increment lanes use uniform neutral style: fill #f5f5f5 stroke #666666 (no priority-based colors); both lane backgrounds and labels use this style",
                            "sequential_order": 5.0
                          },
                          {
                            "name": "Actor labels rendered above stories within each increment lane; deduplicated per lane (same user not repeated within one lane); each lane has its own deduplication scope",
                            "text": "Actor labels rendered above stories within each increment lane; deduplicated per lane (same user not repeated within one lane); each lane has its own deduplication scope",
                            "sequential_order": 6.0
                          }
                        ],
                        "scenarios": [
                          {
                            "name": "Render increments diagram with stories assigned to increment lanes",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {StoryMap} has {StoryMap.epics} with {DrawIOSubEpic} and {DrawIOStory} nodes",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And {StoryMap} has increments with stories assigned to each increment",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} renders increments from {StoryMap}",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} outline contains {DrawIOEpic} and {DrawIOSubEpic} but no {DrawIOStory} cells",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And {DrawIOStory} cells appear only in increment lanes (not duplicated in outline)",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And increment lanes rendered with {DrawIOStory} cells assigned to lanes from story graph increments",
                                "sequential_order": 6.0
                              },
                              {
                                "text": "And {DrawIOStory} cells styled per story_type as in outline",
                                "sequential_order": 7.0
                              }
                            ]
                          },
                          {
                            "name": "Increment lanes ordered by priority with Y positions from outline bottom",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {StoryMap} has increments with priority values",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} renders increments from {StoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then lane order equals increment priority order",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And lane Y positions derived from outline bottom and lane height",
                                "sequential_order": 4.0
                              }
                            ]
                          },
                          {
                            "name": "Re-render increments with existing LayoutData recomputes lane positions",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {StoryMap} has increments with {DrawIOStory} assigned",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And {LayoutData} exists with saved positions for {DrawIOEpic} and {DrawIOSubEpic}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} renders increments from {StoryMap}",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} applies {LayoutData} saved positions for {DrawIOEpic} and {DrawIOSubEpic}",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And increment lane Y positions computed from outline bottom and lane height",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And saved layout for increment lanes not applied on re-render",
                                "sequential_order": 6.0
                              }
                            ]
                          },
                          {
                            "name": "Render increments completes and summary includes increment count",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {StoryMap} has increments",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} renders increments from {StoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} is written to file",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And summary includes increment count",
                                "sequential_order": 4.0
                              }
                            ]
                          },
                          {
                            "name": "Increment lane cells styled for extractor detection",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {StoryMap} has increments",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} renders increments from {StoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then all increment lane {DrawIOElement} backgrounds use uniform fill #f5f5f5 and stroke #666666 (no priority-based colors)",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And lane labels use fill #f5f5f5 and stroke #666666 and bold text and black font",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And lane cell style has strokeColor consistent with {DrawIOStoryMap}.get_increments_and_boundaries",
                                "sequential_order": 5.0
                              }
                            ]
                          },
                          {
                            "name": "Render increments with no increments defined produces outline-only diagram",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {StoryMap} has {StoryMap.epics} but no increments defined",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} renders increments from {StoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} contains {DrawIOEpic} and {DrawIOSubEpic} without increment lanes",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And summary reports increment count 0",
                                "sequential_order": 4.0
                              }
                            ]
                          },
                          {
                            "name": "Actor labels rendered above stories in increment lanes",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {StoryMap} has increments with {DrawIOStory} that have users assigned",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} renders increments from {StoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then actor labels appear above {DrawIOStory} within each increment lane",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And actor labels are deduplicated per lane (same user not repeated within one lane)",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And each lane has its own deduplication scope (same user can appear in multiple lanes)",
                                "sequential_order": 5.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Render story map with acceptance criteria",
                        "acceptance_criteria": [
                          {
                            "name": "When user requests exploration diagram then system renders epics sub-epics and stories with same layout as outline (epic spans sub-epics; sub-epic spans stories; stories left-to-right); story cells use distinct styles per story_type (user yellow system dark-blue technical black) as in outline; acceptance criteria boxes below each story with AC; AC text formatted When/Then in boxes",
                            "text": "When user requests exploration diagram then system renders epics sub-epics and stories with same layout as outline (epic spans sub-epics; sub-epic spans stories; stories left-to-right); story cells use distinct styles per story_type (user yellow system dark-blue technical black) as in outline; acceptance criteria boxes below each story with AC; AC text formatted When/Then in boxes",
                            "sequential_order": 1.0
                          },
                          {
                            "name": "When story has acceptance criteria then system creates wider AC boxes below story; AC boxes use rectangular shape fill (#fff2cc) stroke (#d6b656) left-aligned 8px text; extracts step text from AC; actors remain above stories as in outline mode",
                            "text": "When story has acceptance criteria then system creates wider AC boxes below story; AC boxes use rectangular shape fill (#fff2cc) stroke (#d6b656) left-aligned 8px text; extracts step text from AC; actors remain above stories as in outline mode",
                            "sequential_order": 2.0
                          },
                          {
                            "name": "When layout data exists then system preserves positions of story and AC boxes",
                            "text": "When layout data exists then system preserves positions of story and AC boxes",
                            "sequential_order": 3.0
                          },
                          {
                            "name": "When render completes then output DrawIO contains both story cells and AC cells with correct containment",
                            "text": "When render completes then output DrawIO contains both story cells and AC cells with correct containment",
                            "sequential_order": 4.0
                          }
                        ],
                        "scenarios": [
                          {
                            "name": "Render exploration diagram with AC boxes below stories",
                            "background": [],
                            "steps": [
                              {
                                "text": "When {DrawIOStoryMap} renders exploration from {StoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} contains {DrawIOEpic} spanning {DrawIOSubEpic} spanning {DrawIOStory} with same layout as outline",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "And {DrawIOStory} cells styled per story_type as in outline",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And acceptance criteria {DrawIOElement} boxes rendered below each {DrawIOStory}",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And AC text formatted as When/Then in boxes",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And actor labels positioned above {DrawIOStory} as in outline",
                                "sequential_order": 6.0
                              }
                            ]
                          },
                          {
                            "name": "AC boxes styled and positioned below story with extracted step text",
                            "background": [],
                            "steps": [
                              {
                                "text": "When {DrawIOStoryMap} renders exploration from {StoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "Then AC {DrawIOElement} boxes created wider than {DrawIOStory} cell",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "And AC boxes use rectangular shape with fill #fff2cc and stroke #d6b656 and left-aligned 8px text",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And step text extracted from each acceptance_criteria entry",
                                "sequential_order": 4.0
                              }
                            ]
                          },
                          {
                            "name": "Re-render exploration with LayoutData preserves story and AC box positions",
                            "background": [],
                            "steps": [
                              {
                                "text": "And {LayoutData} exists with saved positions for {DrawIOStory} and AC boxes",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} renders exploration from {StoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} applies {LayoutData} saved positions for {DrawIOStory} and AC {DrawIOElement} boxes",
                                "sequential_order": 3.0
                              }
                            ]
                          },
                          {
                            "name": "Exploration render output contains story and AC cells with correct containment",
                            "background": [],
                            "steps": [
                              {
                                "text": "When {DrawIOStoryMap} renders exploration from {StoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "Then output {DrawIOStoryMap} contains both {DrawIOStory} cells and AC {DrawIOElement} cells",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "And AC cells are contained within their parent {DrawIOStory} sub-tree in DrawIO XML",
                                "sequential_order": 3.0
                              }
                            ]
                          },
                          {
                            "name": "Story with no acceptance criteria renders without AC boxes",
                            "background": [],
                            "steps": [
                              {
                                "text": "And {StoryMap} also has a {DrawIOStory} with no acceptance_criteria",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} renders exploration from {StoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {DrawIOStory} without acceptance_criteria has no AC {DrawIOElement} boxes below it",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And {DrawIOStory} with acceptance_criteria still has AC boxes rendered",
                                "sequential_order": 4.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Update graph from story map",
                        "acceptance_criteria": [
                          {
                            "name": "When user synchronizes from DrawIO outline file then system extracts epics sub-epics and stories from DrawIO and writes extracted JSON and assigns stories to sub-epics by containment (story center inside sub-epic box) and each sub-epic has one story group with all its stories and assigns sequential order from top-to-bottom then left-to-right",
                            "text": "When user synchronizes from DrawIO outline file then system extracts epics sub-epics and stories from DrawIO and writes extracted JSON and assigns stories to sub-epics by containment (story center inside sub-epic box) and each sub-epic has one story group with all its stories and assigns sequential order from top-to-bottom then left-to-right",
                            "sequential_order": 1.0
                          },
                          {
                            "name": "When the diagram update report is run for a story graph then system generates report comparing extracted diagram to original story graph and report lists exact matches fuzzy matches new stories and removed stories",
                            "text": "When the diagram update report is run for a story graph then system generates report comparing extracted diagram to original story graph and report lists exact matches fuzzy matches new stories and removed stories",
                            "sequential_order": 2.0
                          },
                          {
                            "name": "When the story graph is updated from the DrawIO diagram (outline) then system applies report changes to the story graph",
                            "text": "When the story graph is updated from the DrawIO diagram (outline) then system applies report changes to the story graph",
                            "sequential_order": 3.0
                          },
                          {
                            "name": "When user renames or reorders epics sub-epics or stories in DrawIO then extracted graph reflects new names and order and diagram update report flags renames as fuzzy matches when names differ",
                            "text": "When user renames or reorders epics sub-epics or stories in DrawIO then extracted graph reflects new names and order and diagram update report flags renames as fuzzy matches when names differ",
                            "sequential_order": 4.0
                          },
                          {
                            "name": "When user deletes nodes in DrawIO then extracted graph omits those nodes and diagram update report lists them as removed and large deletion detection flags entire missing epics or sub-epics",
                            "text": "When user deletes nodes in DrawIO then extracted graph omits those nodes and diagram update report lists them as removed and large deletion detection flags entire missing epics or sub-epics",
                            "sequential_order": 5.0
                          },
                          {
                            "name": "When sync runs then system persists layout data to a JSON file alongside the diagram and layout stores position and size for each epic sub-epic and story for use on next render",
                            "text": "When sync runs then system persists layout data to a JSON file alongside the diagram and layout stores position and size for each epic sub-epic and story for use on next render",
                            "sequential_order": 6.0
                          },
                          {
                            "name": "When user moves a story in DrawIO and saves then sync extracts new position and recomputes sequential order from left-to-right and vertical position and merge updates the matched story with new order",
                            "text": "When user moves a story in DrawIO and saves then sync extracts new position and recomputes sequential order from left-to-right and vertical position and merge updates the matched story with new order",
                            "sequential_order": 7.0
                          },
                          {
                            "name": "When user deletes one story cell then extracted graph omits that story and diagram update report lists it as removed and merged output keeps original structure with only matched stories updated and if many stories from one epic are missing the report flags that epic",
                            "text": "When user deletes one story cell then extracted graph omits that story and diagram update report lists it as removed and merged output keeps original structure with only matched stories updated and if many stories from one epic are missing the report flags that epic",
                            "sequential_order": 8.0
                          },
                          {
                            "name": "When user deletes a sub-epic box then extracted graph omits that sub-epic and stories under it are reassigned by where they sit (inside another sub-epic box or at epic level) and diagram update report flags the missing sub-epic in large_deletions",
                            "text": "When user deletes a sub-epic box then extracted graph omits that sub-epic and stories under it are reassigned by where they sit (inside another sub-epic box or at epic level) and diagram update report flags the missing sub-epic in large_deletions",
                            "sequential_order": 9.0
                          },
                          {
                            "name": "When user deletes an epic box then extracted graph omits that epic and all its sub-epics and stories and diagram update report lists those stories as removed and large_deletions includes missing_epics",
                            "text": "When user deletes an epic box then extracted graph omits that epic and all its sub-epics and stories and diagram update report lists those stories as removed and large_deletions includes missing_epics",
                            "sequential_order": 10.0
                          }
                        ],
                        "scenarios": [
                          {
                            "name": "Extract outline assigns stories to sub-epics by containment and sequential order",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {DrawIOStoryMap} outline file contains {DrawIOEpic} and {DrawIOSubEpic} and {DrawIOStory} cells",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} extracts outline from {DrawIOStoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} assigns each {DrawIOStory} to a {DrawIOSubEpic} by containment (story center inside sub-epic box)",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And each {DrawIOSubEpic} has one story group with all its {DrawIOStory} nodes",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And {DrawIOStoryMap} assigns {DrawIOStoryNode.sequential_order} from top-to-bottom then left-to-right",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And extracted JSON is written to file",
                                "sequential_order": 6.0
                              }
                            ]
                          },
                          {
                            "name": "UpdateReport lists exact fuzzy new and removed stories",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {DrawIOStoryMap} has been extracted from diagram",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And original {StoryMap} exists",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When {DrawIOStoryMap}.generateUpdateReport({StoryMap}) runs",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then {UpdateReport} lists exact matches where {DrawIOStoryNode} name equals {StoryMap} node name",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And {UpdateReport} lists fuzzy matches where names differ but match with confidence",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And {UpdateReport} lists new stories present in {DrawIOStoryMap} but not in {StoryMap}",
                                "sequential_order": 6.0
                              },
                              {
                                "text": "And {UpdateReport} lists removed stories present in {StoryMap} but not in {DrawIOStoryMap}",
                                "sequential_order": 7.0
                              }
                            ]
                          },
                          {
                            "name": "StoryMap updated from outline diagram applies report changes",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {UpdateReport} has been generated from {DrawIOStoryMap} vs {StoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {StoryMap}.update({DrawIOStoryMap}, {UpdateReport}) runs",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {StoryMap} applies exact match updates from {UpdateReport}",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And {StoryMap} applies fuzzy match renames from {UpdateReport}",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And new stories added to {StoryMap}",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And removed stories flagged in {StoryMap}",
                                "sequential_order": 6.0
                              }
                            ]
                          },
                          {
                            "name": "Renamed or reordered nodes flagged as fuzzy matches in UpdateReport",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {DrawIOStoryMap} has a {DrawIOStoryNode} with name changed from original",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And {StoryMap} has the original {DrawIOStoryNode} name",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When {DrawIOStoryMap}.generateUpdateReport({StoryMap}) runs",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then {UpdateReport} flags the renamed node as a fuzzy match",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And {UpdateReport} records both old and new name",
                                "sequential_order": 5.0
                              }
                            ]
                          },
                          {
                            "name": "Deleted nodes listed as removed and large deletions flagged",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {DrawIOStoryMap} has nodes removed by user",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And {StoryMap} has the original nodes",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When {DrawIOStoryMap}.generateUpdateReport({StoryMap}) runs",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then {UpdateReport} lists deleted nodes as removed",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And {UpdateReport}.large_deletions flags entire missing {DrawIOEpic} or {DrawIOSubEpic}",
                                "sequential_order": 5.0
                              }
                            ]
                          },
                          {
                            "name": "Sync persists LayoutData alongside diagram",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {DrawIOStoryMap} has been extracted from diagram",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When sync completes",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {LayoutData} persisted to JSON file alongside the diagram",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And {LayoutData} stores position and size for each {DrawIOEpic} and {DrawIOSubEpic} and {DrawIOStory}",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And {LayoutData} available for next render",
                                "sequential_order": 5.0
                              }
                            ]
                          },
                          {
                            "name": "Moved story gets recomputed sequential order from new position",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {DrawIOStory} has been moved to a new position in {DrawIOStoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} extracts from {DrawIOStoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} recomputes {DrawIOStoryNode.sequential_order} from left-to-right and vertical position",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And {UpdateReport} matches the moved {DrawIOStory} to original",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And merged output updates the matched {DrawIOStory} with new order",
                                "sequential_order": 5.0
                              }
                            ]
                          },
                          {
                            "name": "Single story deleted keeps original structure and flags if many missing",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given one {DrawIOStory} cell has been removed from {DrawIOStoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} extracts from {DrawIOStoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then extracted graph omits that {DrawIOStory}",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And {UpdateReport} lists it as removed",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And merged output keeps original {StoryMap} structure with only matched stories updated",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And if many {DrawIOStory} from one {DrawIOEpic} are missing the {UpdateReport} flags that {DrawIOEpic}",
                                "sequential_order": 6.0
                              }
                            ]
                          },
                          {
                            "name": "Deleted sub-epic reassigns its stories by position",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given a {DrawIOSubEpic} box has been removed from {DrawIOStoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} extracts from {DrawIOStoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then extracted graph omits that {DrawIOSubEpic}",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And {DrawIOStory} nodes under it are reassigned by where they sit (inside another {DrawIOSubEpic} box or at {DrawIOEpic} level)",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And {UpdateReport} flags the missing {DrawIOSubEpic} in large_deletions",
                                "sequential_order": 5.0
                              }
                            ]
                          },
                          {
                            "name": "Deleted epic removes all children and flags large deletions",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given a {DrawIOEpic} box has been removed from {DrawIOStoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} extracts from {DrawIOStoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then extracted graph omits that {DrawIOEpic} and all its {DrawIOSubEpic} and {DrawIOStory}",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And {UpdateReport} lists those stories as removed",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And {UpdateReport}.large_deletions includes missing_epics",
                                "sequential_order": 5.0
                              }
                            ]
                          },
                          {
                            "name": "Extract from empty or malformed DrawIO file produces error",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {DrawIOStoryMap} file contains no valid {DrawIOEpic} or {DrawIOSubEpic} cells",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} extracts outline from {DrawIOStoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} reports extraction error with zero nodes found",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And no extracted JSON is written",
                                "sequential_order": 4.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Update graph from map increments",
                        "acceptance_criteria": [
                          {
                            "name": "When user synchronizes from DrawIO increments file then system extracts increment lanes from the left side of the diagram (by style) sorted top to bottom and assigns stories to increments by vertical position (story assigned to nearest lane within 100px) and each lane gets position-based priority and its name from the cell label and writes extracted JSON; optionally generates diagram update report when original story graph provided",
                            "text": "When user synchronizes from DrawIO increments file then system extracts increment lanes from the left side of the diagram (by style) sorted top to bottom and assigns stories to increments by vertical position (story assigned to nearest lane within 100px) and each lane gets position-based priority and its name from the cell label and writes extracted JSON; optionally generates diagram update report when original story graph provided",
                            "sequential_order": 1.0
                          },
                          {
                            "name": "When the diagram update report is run for a story graph (increments view) then system generates report (story-level: exact matches fuzzy matches new stories removed stories); increment membership in extracted reflects DrawIO lane positions",
                            "text": "When the diagram update report is run for a story graph (increments view) then system generates report (story-level: exact matches fuzzy matches new stories removed stories); increment membership in extracted reflects DrawIO lane positions",
                            "sequential_order": 2.0
                          },
                          {
                            "name": "When user moves stories between increments in DrawIO then extracted graph reflects new increment membership (by Y position)",
                            "text": "When user moves stories between increments in DrawIO then extracted graph reflects new increment membership (by Y position)",
                            "sequential_order": 3.0
                          },
                          {
                            "name": "When the story graph is updated from the DrawIO diagram (increments view) then system preserves original acceptance criteria and steps and updates story fields (users sequential_order) from extracted within existing increments and matches increments by position (first extracted lane to first original lane etc); applies renames; appends extra lanes as new; does not remove increments or replace which stories belong to which increment",
                            "text": "When the story graph is updated from the DrawIO diagram (increments view) then system preserves original acceptance criteria and steps and updates story fields (users sequential_order) from extracted within existing increments and matches increments by position (first extracted lane to first original lane etc); applies renames; appends extra lanes as new; does not remove increments or replace which stories belong to which increment",
                            "sequential_order": 4.0
                          },
                          {
                            "name": "When user adds a new increment lane at the bottom in DrawIO then extracted graph has one more increment and merge appends it as new",
                            "text": "When user adds a new increment lane at the bottom in DrawIO then extracted graph has one more increment and merge appends it as new",
                            "sequential_order": 5.0
                          },
                          {
                            "name": "When user removes an increment lane then extracted has fewer lanes; merge does not remove increments so the removed lane stays in merged with its original stories; stories from the deleted lane are reassigned to the nearest remaining lane in the extracted diagram",
                            "text": "When user removes an increment lane then extracted has fewer lanes; merge does not remove increments so the removed lane stays in merged with its original stories; stories from the deleted lane are reassigned to the nearest remaining lane in the extracted diagram",
                            "sequential_order": 6.0
                          },
                          {
                            "name": "When user renames an increment lane then merge treats the lane at that position as the same increment and updates its name (position-based matching)",
                            "text": "When user renames an increment lane then merge treats the lane at that position as the same increment and updates its name (position-based matching)",
                            "sequential_order": 7.0
                          },
                          {
                            "name": "When extracted has more lanes than original then extra lanes are appended as new increments",
                            "text": "When extracted has more lanes than original then extra lanes are appended as new increments",
                            "sequential_order": 8.0
                          },
                          {
                            "name": "When extracted has fewer lanes than original then original lanes beyond that point remain unchanged (merge does not remove)",
                            "text": "When extracted has fewer lanes than original then original lanes beyond that point remain unchanged (merge does not remove)",
                            "sequential_order": 9.0
                          },
                          {
                            "name": "KNOWN: inserting a new lane between two existing lanes may be misinterpreted without stable IDs",
                            "text": "KNOWN: inserting a new lane between two existing lanes may be misinterpreted without stable IDs",
                            "sequential_order": 10.0
                          }
                        ],
                        "scenarios": [
                          {
                            "name": "Extract increments assigns stories to lanes by Y position with priority from order",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {DrawIOStoryMap} increments file contains increment lane cells and {DrawIOStory} cells",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} extracts increments from {DrawIOStoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} identifies increment lanes from left side of diagram by style sorted top to bottom",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And each {DrawIOStory} assigned to nearest lane within 100px by Y position",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And each lane gets position-based priority and name from cell label",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And extracted JSON written to file",
                                "sequential_order": 6.0
                              }
                            ]
                          },
                          {
                            "name": "UpdateReport generated for increments view with story-level matches",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {DrawIOStoryMap} increments have been extracted",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And original {StoryMap} provided",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When {DrawIOStoryMap}.generateUpdateReport({StoryMap}) runs for increments view",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then {UpdateReport} lists story-level exact matches and fuzzy matches and new stories and removed stories",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And increment membership in extracted reflects {DrawIOStoryMap} lane positions",
                                "sequential_order": 5.0
                              }
                            ]
                          },
                          {
                            "name": "Story moved between increments reflected in extracted graph",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {DrawIOStory} has been moved from one increment lane to another in {DrawIOStoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} extracts increments from {DrawIOStoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then extracted graph reflects new increment membership for that {DrawIOStory} based on Y position",
                                "sequential_order": 3.0
                              }
                            ]
                          },
                          {
                            "name": "Merge preserves original AC and updates story fields with position-based increment matching",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {UpdateReport} has been generated from {DrawIOStoryMap} increments vs {StoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {StoryMap}.update({DrawIOStoryMap}, {UpdateReport}) runs for increments view",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {StoryMap} preserves original acceptance_criteria and steps",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And {StoryMap} updates {DrawIOStory} fields (users, sequential_order) from extracted",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And increments matched by position (first extracted lane to first original lane)",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And renamed increments updated",
                                "sequential_order": 6.0
                              },
                              {
                                "text": "And extra lanes appended as new increments",
                                "sequential_order": 7.0
                              },
                              {
                                "text": "And merge does not remove increments or replace which stories belong to which increment",
                                "sequential_order": 8.0
                              }
                            ]
                          },
                          {
                            "name": "New increment lane at bottom appended as new increment",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given a new increment lane exists at the bottom of {DrawIOStoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} extracts increments from {DrawIOStoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "And {StoryMap}.update({DrawIOStoryMap}, {UpdateReport}) runs",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then extracted graph has one more increment",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And merge appends the new lane as a new increment in {StoryMap}",
                                "sequential_order": 5.0
                              }
                            ]
                          },
                          {
                            "name": "Removed increment lane stays in merged with its original stories",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given an increment lane has been removed from {DrawIOStoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} extracts increments from {DrawIOStoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then extracted has fewer lanes",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And {DrawIOStory} from deleted lane reassigned to nearest remaining lane in extracted",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "When {StoryMap}.update({DrawIOStoryMap}, {UpdateReport}) runs",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "Then merge does not remove the increment from {StoryMap}",
                                "sequential_order": 6.0
                              },
                              {
                                "text": "And removed lane stays in merged {StoryMap} with its original stories",
                                "sequential_order": 7.0
                              }
                            ]
                          },
                          {
                            "name": "Renamed increment lane updated by position-based matching",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given an increment lane has been renamed in {DrawIOStoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} extracts increments from {DrawIOStoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "And {StoryMap}.update({DrawIOStoryMap}, {UpdateReport}) runs",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then merge treats the lane at that position as the same increment",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And updates its name in {StoryMap}",
                                "sequential_order": 5.0
                              }
                            ]
                          },
                          {
                            "name": "Extra extracted lanes appended and fewer lanes leave originals unchanged",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given original {StoryMap} has {StoryMap.increment_count} increment lanes",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And extracted {DrawIOStoryMap} has {DrawIOStoryMap.increment_count} increment lanes",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When {StoryMap}.update({DrawIOStoryMap}, {UpdateReport}) runs",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then {UpdateReport.merge_result}",
                                "sequential_order": 4.0
                              }
                            ]
                          },
                          {
                            "name": "KNOWN: inserting lane between existing may misinterpret without stable IDs",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given original {StoryMap} has increment lanes [A, B, C]",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And a new lane has been inserted between A and B in {DrawIOStoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} extracts increments from {DrawIOStoryMap}",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then position-based matching maps extracted lane 1 to original A and lane 2 to original B",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And the inserted lane may be misinterpreted as a rename of B without stable IDs",
                                "sequential_order": 5.0
                              }
                            ]
                          },
                          {
                            "name": "Story not within 100px of any lane remains unassigned in extracted",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {DrawIOStoryMap} increments file has {DrawIOStory} positioned more than 100px from any increment lane",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} extracts increments from {DrawIOStoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then that {DrawIOStory} is not assigned to any increment lane in extracted graph",
                                "sequential_order": 3.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Update story graph from map acceptance criteria",
                        "acceptance_criteria": [
                          {
                            "name": "When user synchronizes from DrawIO exploration file then system extracts stories and acceptance criteria boxes and maps AC text back to story acceptance_criteria or steps",
                            "text": "When user synchronizes from DrawIO exploration file then system extracts stories and acceptance criteria boxes and maps AC text back to story acceptance_criteria or steps",
                            "sequential_order": 1.0
                          },
                          {
                            "name": "When AC box text is When/Then format then system extracts step description and associates with story",
                            "text": "When AC box text is When/Then format then system extracts step description and associates with story",
                            "sequential_order": 2.0
                          },
                          {
                            "name": "When the story graph is updated from the DrawIO diagram (exploration view) then system applies report changes and preserves acceptance criteria and steps from original for matched stories (does not overwrite AC from extracted)",
                            "text": "When the story graph is updated from the DrawIO diagram (exploration view) then system applies report changes and preserves acceptance criteria and steps from original for matched stories (does not overwrite AC from extracted)",
                            "sequential_order": 3.0
                          },
                          {
                            "name": "When user adds or removes AC boxes in DrawIO then extracted graph reflects new or removed AC and diagram update report reflects structural changes",
                            "text": "When user adds or removes AC boxes in DrawIO then extracted graph reflects new or removed AC and diagram update report reflects structural changes",
                            "sequential_order": 4.0
                          },
                          {
                            "name": "When sync runs then system assigns AC cells to stories by vertical position and containment below story cells",
                            "text": "When sync runs then system assigns AC cells to stories by vertical position and containment below story cells",
                            "sequential_order": 5.0
                          }
                        ],
                        "scenarios": [
                          {
                            "name": "Extract exploration maps AC boxes to stories by position and containment",
                            "background": [],
                            "steps": [
                              {
                                "text": "When {DrawIOStoryMap} extracts exploration from {DrawIOStoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} assigns AC cells to {DrawIOStory} by vertical position and containment below story cells",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "And AC text mapped back to story acceptance_criteria or steps",
                                "sequential_order": 3.0
                              }
                            ]
                          },
                          {
                            "name": "When/Then AC text extracted as step descriptions",
                            "background": [],
                            "steps": [
                              {
                                "text": "And AC {DrawIOElement} box has When/Then format text",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} extracts exploration from {DrawIOStoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} extracts step description from AC box text",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And associates extracted step with the containing {DrawIOStory}",
                                "sequential_order": 4.0
                              }
                            ]
                          },
                          {
                            "name": "Merge preserves original AC for matched stories from exploration view",
                            "background": [],
                            "steps": [
                              {
                                "text": "And {UpdateReport} has been generated from {DrawIOStoryMap} exploration vs {StoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {StoryMap}.update({DrawIOStoryMap}, {UpdateReport}) runs for exploration view",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {StoryMap} applies report changes for matched stories",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And {StoryMap} preserves original acceptance_criteria and steps for matched stories",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And extracted AC does not overwrite original AC in {StoryMap}",
                                "sequential_order": 5.0
                              }
                            ]
                          },
                          {
                            "name": "Added or removed AC boxes reflected in extracted graph and UpdateReport",
                            "background": [],
                            "steps": [
                              {
                                "text": "And new AC {DrawIOElement} boxes exist below a {DrawIOStory} in {DrawIOStoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And existing AC boxes have been removed from another {DrawIOStory}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} extracts exploration from {DrawIOStoryMap}",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then extracted graph reflects new AC for the first {DrawIOStory}",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And extracted graph omits removed AC for the second {DrawIOStory}",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And {UpdateReport} reflects these structural changes",
                                "sequential_order": 6.0
                              }
                            ]
                          },
                          {
                            "name": "AC cells assigned to stories by vertical position below story cells",
                            "background": [],
                            "steps": [
                              {
                                "text": "And multiple {DrawIOStory} cells have AC {DrawIOElement} boxes positioned below them",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} extracts exploration from {DrawIOStoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then each AC {DrawIOElement} assigned to the {DrawIOStory} it is contained below based on vertical position",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And no AC box left unassigned when positioned within a {DrawIOStory} column",
                                "sequential_order": 4.0
                              }
                            ]
                          },
                          {
                            "name": "AC box text not in When/Then format treated as plain acceptance_criteria",
                            "background": [],
                            "steps": [
                              {
                                "text": "And AC {DrawIOElement} box has text that is not in When/Then format",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} extracts exploration from {DrawIOStoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} treats AC text as plain acceptance_criteria description",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And associates it with the containing {DrawIOStory} without step extraction",
                                "sequential_order": 4.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Render action diagram section",
                        "acceptance_criteria": [
                          {
                            "name": "When user is on render action then render section shows all existing content but without DrawIO diagram config and output; a separate Diagram section is shown",
                            "text": "When user is on render action then render section shows all existing content but without DrawIO diagram config and output; a separate Diagram section is shown",
                            "sequential_order": 1.0
                          },
                          {
                            "name": "When Diagram section is shown then it links to the DrawIO diagram file and to the generated update report file when any",
                            "text": "When Diagram section is shown then it links to the DrawIO diagram file and to the generated update report file when any",
                            "sequential_order": 2.0
                          },
                          {
                            "name": "When a diagram has changed since last synchronized then system visually indicates diagram is stale and shows a Refresh button",
                            "text": "When a diagram has changed since last synchronized then system visually indicates diagram is stale and shows a Refresh button",
                            "sequential_order": 3.0
                          },
                          {
                            "name": "When diagram has newer save than last refresh then system stores refresh dates per diagram and indicates pending changes and shows a Generate report button",
                            "text": "When diagram has newer save than last refresh then system stores refresh dates per diagram and indicates pending changes and shows a Generate report button",
                            "sequential_order": 4.0
                          },
                          {
                            "name": "When a report has been generated for a diagram then user can click the report to open it in the editor like other files and a button to Update is shown; after update user can delete the report",
                            "text": "When a report has been generated for a diagram then user can click the report to open it in the editor like other files and a button to Update is shown; after update user can delete the report",
                            "sequential_order": 5.0
                          }
                        ],
                        "scenarios": [
                          {
                            "name": "Render action shows existing render section without DrawIO config and separate Diagram section",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given user is on the render action",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And {StoryMap} has been loaded from story graph",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When render action displays its sections",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then existing render section shows all current render content except DrawIO diagram config and output",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And a Diagram section is shown separately",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And Diagram section links to each {DrawIOStoryMap} diagram file",
                                "sequential_order": 6.0
                              },
                              {
                                "text": "And Diagram section links to generated {UpdateReport} file when one exists",
                                "sequential_order": 7.0
                              }
                            ]
                          },
                          {
                            "name": "Diagram stale when file changed since last sync shows indicator and Refresh",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {DrawIOStoryMap} exists at a file path",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And diagram file was last synchronized at {LayoutData} sync time",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "And diagram file has been modified after that sync time",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "When render action displays the Diagram section",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "Then system visually indicates that diagram is stale",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And a Refresh button is shown",
                                "sequential_order": 6.0
                              },
                              {
                                "text": "When user clicks Refresh",
                                "sequential_order": 7.0
                              },
                              {
                                "text": "Then system re-extracts from diagram and updates last-refresh time for that diagram",
                                "sequential_order": 8.0
                              }
                            ]
                          },
                          {
                            "name": "Diagram with newer save than last refresh shows pending and Generate report",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {DrawIOStoryMap} has a stored last-refresh date per diagram",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And diagram file save time is newer than last-refresh date",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When render action displays the Diagram section",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then system indicates pending changes for that diagram",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And a Generate report button is shown",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "When user clicks Generate report",
                                "sequential_order": 6.0
                              },
                              {
                                "text": "Then system calls {StoryMap}.generateUpdateReport({DrawIOStoryMap}) and writes {UpdateReport} to file",
                                "sequential_order": 7.0
                              },
                              {
                                "text": "And Diagram section shows link to the report file",
                                "sequential_order": 8.0
                              }
                            ]
                          },
                          {
                            "name": "User opens update report in editor and applies update then may delete report",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given an {UpdateReport} has been generated for a {DrawIOStoryMap} and {StoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And report file path is known",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When user clicks the report link in Diagram section",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then system opens the report file in the editor like other files",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "When user clicks Update",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "Then system calls {StoryMap}.update({DrawIOStoryMap}, {UpdateReport})",
                                "sequential_order": 6.0
                              },
                              {
                                "text": "And story graph is updated from diagram",
                                "sequential_order": 7.0
                              },
                              {
                                "text": "When update completes",
                                "sequential_order": 8.0
                              },
                              {
                                "text": "Then user may delete the report file",
                                "sequential_order": 9.0
                              }
                            ]
                          },
                          {
                            "name": "Update applies report so each StoryNode parent and sequential_order reflect diagram",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {UpdateReport} contains exact and fuzzy matches from {DrawIOStoryMap} vs {StoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And {StoryMap} has epics with parent and sequential_order and children",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When {StoryMap}.update({DrawIOStoryMap}, {UpdateReport}) runs",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then each updated {StoryNode} has parent from diagram containment",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And each updated {StoryNode} has sequential_order from diagram position",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And {LayoutData} is persisted for re-render",
                                "sequential_order": 6.0
                              }
                            ]
                          },
                          {
                            "name": "Diagram file does not exist shows missing indicator",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {DrawIOStoryMap} file path is configured but file does not exist",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When render action displays the Diagram section",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then Diagram section shows missing diagram indicator for that file",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And no Refresh or Generate report buttons are shown",
                                "sequential_order": 4.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Synchronize DIagram With Scoped Nodes",
                        "acceptance_criteria": [],
                        "scenarios": []
                      }
                    ]
                  }
                ],
                "domain_concepts": [
                  {
                    "name": "DrawIOElement (Base)",
                    "responsibilities": [
                      {
                        "name": "Get/Set position and size",
                        "collaborators": [
                          "Position",
                          "Boundary",
                          "DrawIO Cell"
                        ]
                      },
                      {
                        "name": "Read from DrawIO XML",
                        "collaborators": [
                          "File Path",
                          "mxCell Element",
                          "DrawIO Tree"
                        ]
                      },
                      {
                        "name": "Write to DrawIO XML",
                        "collaborators": [
                          "mxCell Element",
                          "DrawIO Tree"
                        ]
                      },
                      {
                        "name": "Cell style (fill, stroke, text)",
                        "collaborators": [
                          "Style String",
                          "DrawIO Cell"
                        ]
                      },
                      {
                        "name": "Identity for matching on re-extract",
                        "collaborators": [
                          "Cell Id",
                          "String"
                        ]
                      }
                    ],
                    "module": "synchronizers.story_io"
                  },
                  {
                    "name": "DrawIOStoryNode (Base)",
                    "responsibilities": [
                      {
                        "name": "Serializes (DrawIO)",
                        "collaborators": [
                          "DrawIOStoryNodeSerializer",
                          "DrawIO XML"
                        ]
                      },
                      {
                        "name": "Get/Update name",
                        "collaborators": [
                          "String",
                          "DrawIO Cell"
                        ]
                      },
                      {
                        "name": "Get node type",
                        "collaborators": [
                          "String"
                        ]
                      },
                      {
                        "name": "Get node ID",
                        "collaborators": [
                          "String",
                          "StoryNode",
                          "StoryNodeNavigator"
                        ]
                      },
                      {
                        "name": "Get parent",
                        "collaborators": [
                          "StoryNode"
                        ]
                      },
                      {
                        "name": "Get sequential order",
                        "collaborators": [
                          "StoryNodeNavigator",
                          "Float"
                        ]
                      },
                      {
                        "name": "Contains children",
                        "collaborators": [
                          "StoryNodeChildren"
                        ]
                      },
                      {
                        "name": "Delete self",
                        "collaborators": [
                          "DrawIOStoryNodeSerializer"
                        ]
                      },
                      {
                        "name": "Delete with children",
                        "collaborators": [
                          "DrawIOStoryNodeSerializer",
                          "StoryNodeChildren"
                        ]
                      },
                      {
                        "name": "Move, rename (emulate base StoryNode API)",
                        "collaborators": [
                          "New Parent",
                          "Position",
                          "DrawIO Tree"
                        ]
                      },
                      {
                        "name": "Generate own slice of update report",
                        "collaborators": [
                          "Other StoryNode",
                          "UpdateReport"
                        ]
                      },
                      {
                        "name": "Apply update from other node (recursive)",
                        "collaborators": [
                          "Other StoryNode",
                          "UpdateReport"
                        ]
                      },
                      {
                        "name": "Compute container dimensions from children",
                        "collaborators": [
                          "StoryNodeChildren",
                          "Spacing",
                          "Boundary"
                        ]
                      },
                      {
                        "name": "Render child nodes (recursive)",
                        "collaborators": [
                          "StoryNodeChildren",
                          "DrawIOStoryNodeSerializer",
                          "LayoutData"
                        ]
                      }
                    ],
                    "module": "synchronizers.story_io",
                    "inherits_from": "DrawIOElement, StoryNode (Base)"
                  },
                  {
                    "name": "DrawIOStoryNodeSerializer",
                    "responsibilities": [
                      {
                        "name": "Create node in DrawIO",
                        "collaborators": [
                          "File",
                          "DrawIOStoryNode",
                          "mxCell"
                        ]
                      },
                      {
                        "name": "Load node from DrawIO",
                        "collaborators": [
                          "File",
                          "DrawIOStoryNode",
                          "mxCell"
                        ]
                      },
                      {
                        "name": "Update node in DrawIO",
                        "collaborators": [
                          "File",
                          "DrawIOStoryNode"
                        ]
                      },
                      {
                        "name": "Delete node from DrawIO",
                        "collaborators": [
                          "File",
                          "DrawIOStoryNode"
                        ]
                      },
                      {
                        "name": "From DrawIO XML",
                        "collaborators": [
                          "DrawIO XML",
                          "DrawIOStoryNode"
                        ]
                      },
                      {
                        "name": "To DrawIO XML",
                        "collaborators": [
                          "DrawIOStoryNode",
                          "DrawIO XML"
                        ]
                      }
                    ],
                    "module": "synchronizers.story_io"
                  },
                  {
                    "name": "DrawIOEpic",
                    "responsibilities": [
                      {
                        "name": "Get all stories (via children)",
                        "collaborators": [
                          "List[DrawIOStory]",
                          "List[SubEpic]"
                        ]
                      },
                      {
                        "name": "Get sub-epics",
                        "collaborators": [
                          "List[DrawIOSubEpic]"
                        ]
                      },
                      {
                        "name": "Generate update report for this epic subtree",
                        "collaborators": [
                          "Other Epic",
                          "StoryMap",
                          "UpdateReport"
                        ]
                      },
                      {
                        "name": "Update from other epic (recursive)",
                        "collaborators": [
                          "Other Epic",
                          "UpdateReport"
                        ]
                      }
                    ],
                    "realization": [
                      {
                        "scope": "Invoke Bot.Perform Action.Synchronized Graph with Rendered Diagram Content.Update graph from story map.UpdateReport lists exact fuzzy new and removed stories",
                        "scenario": "Recursive report generation: DrawIOStoryMap delegates to DrawIOEpic which delegates to DrawIOSubEpic which delegates to DrawIOStory \u2014 each level matches its children against the original and contributes to the UpdateReport",
                        "walks": [
                          {
                            "covers": "Complete recursive delegation chain (Epic -> SubEpic -> Story report generation)",
                            "object_flow": [
                              "DrawIOEpic",
                              "    report_slice: UpdateReport = drawIOEpic.generate_update_report_for_epic_subtree(originalEpic: Epic('Invoke Bot'), report: report)",
                              "        -> drawIOSubEpics: [DrawIOSubEpic] = drawIOEpic.get_sub_epics()",
                              "            return [DrawIOSubEpic('Initialize Bot'), DrawIOSubEpic('Perform Action')]",
                              "        -> originalSubEpics: [SubEpic] = originalEpic.get_sub_epics()",
                              "            return [SubEpic('Initialize Bot'), SubEpic('Perform Action')]",
                              "        -> // Match sub-epics by name, delegate to each matched pair",
                              "        -> DrawIOSubEpic('Initialize Bot').generate_update_report_for_sub_epic_subtree(original: SubEpic('Initialize Bot'), report: report)",
                              "            -> drawIOStories: [DrawIOStory] = drawIOSubEpic.get_stories()",
                              "                return [DrawIOStory('Load Config'), DrawIOStory('Register Behaviors')]",
                              "            -> originalStories: [Story] = originalSubEpic.get_stories()",
                              "                return [Story('Load Config'), Story('Register Behaviors')]",
                              "            -> // Match each story \u2014 exact match first, then fuzzy, then new/removed",
                              "            -> DrawIOStory('Load Config').generate_update_report_for_story(original: Story('Load Config'))",
                              "                -> name_compare: exact = ('load config' == 'load config')",
                              "                -> report.add(match_type: 'exact', extracted: 'Load Config', original: 'Load Config', confidence: 1.0)",
                              "            -> DrawIOStory('Register Behaviors').generate_update_report_for_story(original: Story('Register Behaviors'))",
                              "                -> name_compare: exact = ('register behaviors' == 'register behaviors')",
                              "                -> report.add(match_type: 'exact', extracted: 'Register Behaviors', original: 'Register Behaviors', confidence: 1.0)",
                              "            return // all matched for Initialize Bot",
                              "        -> DrawIOSubEpic('Perform Action').generate_update_report_for_sub_epic_subtree(original: SubEpic('Perform Action'), report: report)",
                              "            -> // Same delegation pattern for stories in Perform Action",
                              "            -> DrawIOStory('Execute Action').generate_update_report_for_story(original: Story('Execute Action'))",
                              "                -> report.add(match_type: 'exact', extracted: 'Execute Action', original: 'Execute Action', confidence: 1.0)",
                              "        return report: {exact_matches: ['Load Config', 'Register Behaviors', 'Execute Action'], fuzzy_matches: [], new_stories: [], removed_stories: []}"
                            ]
                          }
                        ],
                        "model_updates": [
                          "Validated: Recursive delegation pattern (DrawIOEpic -> DrawIOSubEpic -> DrawIOStory) is viable for report generation \u2014 each level matches its direct children and delegates to the next",
                          "Validated: Sub-epic matching uses name comparison (same as story matching) before delegating to story-level",
                          "Note: When sub-epics don't match (e.g., deleted sub-epic), stories under it need reassignment by containment \u2014 this is handled by DrawIOStoryMap.assign_stories_to_sub_epics_by_containment on load, before report generation"
                        ]
                      }
                    ],
                    "module": "synchronizers.story_io",
                    "inherits_from": "DrawIOStoryNode (Base)"
                  },
                  {
                    "name": "DrawIOSubEpic",
                    "responsibilities": [
                      {
                        "name": "Get stories",
                        "collaborators": [
                          "List[DrawIOStory]"
                        ]
                      },
                      {
                        "name": "Generate update report for this sub-epic subtree",
                        "collaborators": [
                          "Other SubEpic",
                          "UpdateReport"
                        ]
                      },
                      {
                        "name": "Update from other sub-epic (recursive)",
                        "collaborators": [
                          "Other SubEpic",
                          "UpdateReport"
                        ]
                      }
                    ],
                    "module": "synchronizers.story_io",
                    "inherits_from": "DrawIOStoryNode (Base)"
                  },
                  {
                    "name": "DrawIOStory",
                    "responsibilities": [
                      {
                        "name": "Get story type (user/system/technical) from style",
                        "collaborators": [
                          "String",
                          "DrawIO Cell"
                        ]
                      },
                      {
                        "name": "Get users",
                        "collaborators": [
                          "List[StoryUser]"
                        ]
                      },
                      {
                        "name": "Get acceptance criteria",
                        "collaborators": [
                          "List[AcceptanceCriteria]",
                          "String"
                        ]
                      },
                      {
                        "name": "Generate update report for this story",
                        "collaborators": [
                          "Other Story",
                          "UpdateReport"
                        ]
                      },
                      {
                        "name": "Update from other story",
                        "collaborators": [
                          "Other Story",
                          "UpdateReport"
                        ]
                      }
                    ],
                    "module": "synchronizers.story_io",
                    "inherits_from": "DrawIOStoryNode (Base)"
                  },
                  {
                    "name": "DrawIOStoryMap",
                    "responsibilities": [
                      {
                        "name": "Diagram type (outline, increments, acceptance_criteria)",
                        "collaborators": [
                          "DiagramType",
                          "String"
                        ]
                      },
                      {
                        "name": "Load from DrawIO file",
                        "collaborators": [
                          "File Path",
                          "DrawIOStoryMap"
                        ]
                      },
                      {
                        "name": "Save to DrawIO file",
                        "collaborators": [
                          "File Path",
                          "DrawIO XML"
                        ]
                      },
                      {
                        "name": "Walk nodes",
                        "collaborators": [
                          "StoryNode",
                          "Iterator[StoryNode]"
                        ]
                      },
                      {
                        "name": "Get epics / sub-epics / stories",
                        "collaborators": [
                          "List[Epic]",
                          "List[SubEpic]",
                          "List[Story]"
                        ]
                      },
                      {
                        "name": "Find by name, find node by path",
                        "collaborators": [
                          "Name",
                          "Path String",
                          "StoryNode"
                        ]
                      },
                      {
                        "name": "Generate update report",
                        "collaborators": [
                          "StoryMap",
                          "UpdateReport"
                        ]
                      },
                      {
                        "name": "Update from other (with optional report)",
                        "collaborators": [
                          "StoryMap",
                          "UpdateReport"
                        ]
                      },
                      {
                        "name": "Own layout data (positions and sizes for rendered nodes)",
                        "collaborators": [
                          "LayoutData",
                          "DrawIOStoryNode"
                        ]
                      },
                      {
                        "name": "Persist layout data alongside diagram file",
                        "collaborators": [
                          "LayoutData",
                          "File Path"
                        ]
                      },
                      {
                        "name": "Load layout data for re-render",
                        "collaborators": [
                          "File Path",
                          "LayoutData"
                        ]
                      },
                      {
                        "name": "Render from StoryMap (based on diagramType)",
                        "collaborators": [
                          "StoryMap",
                          "DiagramType",
                          "LayoutData",
                          "DrawIO XML"
                        ]
                      },
                      {
                        "name": "Apply layout data (saved positions) during render",
                        "collaborators": [
                          "LayoutData",
                          "DrawIOStoryNode"
                        ]
                      },
                      {
                        "name": "Default layout when no layout data",
                        "collaborators": [
                          "DrawIOStoryNode",
                          "Spacing"
                        ]
                      },
                      {
                        "name": "Assign stories to sub-epics by containment on load",
                        "collaborators": [
                          "Story Center",
                          "SubEpic Boundary"
                        ]
                      },
                      {
                        "name": "Assign sequential order from position on load",
                        "collaborators": [
                          "DrawIOStoryNode",
                          "Float"
                        ]
                      },
                      {
                        "name": "Extract layout (position/size per node) on load",
                        "collaborators": [
                          "DrawIO XML",
                          "LayoutData"
                        ]
                      }
                    ],
                    "realization": [
                      {
                        "scope": "Invoke Bot.Perform Action.Synchronized Graph with Rendered Diagram Content.Render story map.Render outline diagram from StoryMap with default layout",
                        "scenario": "StoryMap with 1 epic, 1 sub-epic, 2 stories rendered to DrawIO outline XML with no prior layout data \u2014 validates render responsibility chain and default positioning",
                        "walks": [
                          {
                            "covers": "Steps 1-2 (Given: load StoryMap, no LayoutData)",
                            "object_flow": [
                              "StoryMap",
                              "    storyMap: {epics: [{name: 'Invoke Bot', sub_epics: [{name: 'Initialize Bot', stories: [{name: 'Load Config', sequential_order: 1.0, story_type: 'user'}, {name: 'Register Behaviors', sequential_order: 2.0, story_type: 'system'}]}]}]} = StoryMap.load(path: 'docs/story/story-graph.json')",
                              "        -> epics: [Epic('Invoke Bot')] = StoryMap.get_epics()",
                              "        return storyMap",
                              "LayoutData",
                              "    layoutData: None = LayoutData.load(path: 'story-map-layout.json')",
                              "        -> file_exists: False",
                              "        return layoutData: None"
                            ]
                          },
                          {
                            "covers": "Steps 3-9 (When/Then: render outline \u2014 recursive node creation, position, style)",
                            "object_flow": [
                              "DrawIOStoryMap",
                              "    drawIOStoryMap: DrawIOStoryMap = DrawIOStoryMap(diagramType: 'outline')",
                              "    drawIOStoryMap.render_from_story_map(storyMap: storyMap, layoutData: None)",
                              "        -> epics: [Epic] = storyMap.get_epics()",
                              "        -> for epic in epics:",
                              "            -> drawIOEpic: DrawIOEpic = drawIOStoryMap.render_node(node: Epic('Invoke Bot'))",
                              "",
                              "                DrawIOEpic",
                              "                    drawIOEpic = DrawIOStoryNodeSerializer.create_node(node: Epic('Invoke Bot'))",
                              "                        -> DrawIOElement.set_position(x: 20, y: 120)   // EPIC_Y=120",
                              "                        -> DrawIOElement.cell_style(fill: '#e1d5e7', stroke: '#9673a6', font_color: 'black', shape: 'rounded')",
                              "",
                              "                    -> // Recurse into children: render each sub-epic",
                              "                    -> sub_epics: [SubEpic] = Epic('Invoke Bot').get_sub_epics()",
                              "                    -> for sub_epic in sub_epics:",
                              "                        -> drawIOSubEpic = drawIOEpic.render_child(node: SubEpic('Initialize Bot'))",
                              "",
                              "                            DrawIOSubEpic",
                              "                                drawIOSubEpic = DrawIOStoryNodeSerializer.create_node(node: SubEpic('Initialize Bot'))",
                              "                                    -> DrawIOElement.set_position(x: 30, y: 180)   // epic_x+10, epic_y+60",
                              "                                    -> DrawIOElement.cell_style(fill: '#d5e8d4', stroke: '#82b366', font_color: 'black')",
                              "",
                              "                                -> // Recurse into children: render each story",
                              "                                -> for story in stories (sorted by sequential_order):",
                              "                                    -> drawIOStory1 = drawIOSubEpic.render_child(node: Story('Load Config'))",
                              "",
                              "                                        DrawIOStory",
                              "                                            drawIOStory1 = DrawIOStoryNodeSerializer.create_node(node: Story('Load Config'))",
                              "                                                -> story_type: 'user' = DrawIOStory.get_story_type()",
                              "                                                -> DrawIOElement.cell_style(fill: '#fff2cc', stroke: '#d6b656', font_color: 'black')",
                              "                                                -> DrawIOElement.set_position(x: 35, y: 270)",
                              "                                                -> DrawIOElement.set_size(width: 50, height: 50)",
                              "                                            return drawIOStory1   // leaf in outline; in acceptance_criteria would recurse into AC boxes",
                              "",
                              "                                    -> drawIOStory2 = drawIOSubEpic.render_child(node: Story('Register Behaviors'))",
                              "",
                              "                                        DrawIOStory",
                              "                                            drawIOStory2 = DrawIOStoryNodeSerializer.create_node(node: Story('Register Behaviors'))",
                              "                                                -> story_type: 'system' = DrawIOStory.get_story_type()",
                              "                                                -> DrawIOElement.cell_style(fill: '#1a237e', stroke: '#0d47a1', font_color: 'white')",
                              "                                                -> DrawIOElement.set_position(x: 95, y: 270)",
                              "                                                -> DrawIOElement.set_size(width: 50, height: 50)",
                              "                                            return drawIOStory2   // leaf in outline; in acceptance_criteria would recurse into AC boxes",
                              "",
                              "                                -> // Bottom-up: compute sub-epic width from rendered children",
                              "                                -> sub_epic_width: 120 = drawIOSubEpic.compute_container_dimensions_from_children(children: [drawIOStory1, drawIOStory2], spacing: 10)",
                              "                                -> // Render actor labels above stories",
                              "                                -> DrawIOStoryNodeSerializer.create_node(node: Actor('Bot Behavior'), position: {x: 40, y: 210})",
                              "                            return drawIOSubEpic   // children rendered",
                              "",
                              "                    -> // Bottom-up: compute epic width from rendered sub-epics",
                              "                    -> epic_width: 130 = drawIOEpic.compute_container_dimensions_from_children(children: [drawIOSubEpic])",
                              "                return drawIOEpic   // full subtree rendered"
                            ]
                          },
                          {
                            "covers": "Step 10 (Then: save to file and return summary)",
                            "object_flow": [
                              "DrawIOStoryMap",
                              "    xml: DrawIO XML = DrawIOStoryNodeSerializer.to_drawio_xml(drawIOStoryMap)",
                              "    drawIOStoryMap.save(path: 'docs/story/story-map.drawio')",
                              "        -> File.write(path: 'docs/story/story-map.drawio', content: xml)",
                              "    return {output_path: 'story-map.drawio', summary: {epics: 1, sub_epic_count: 1, diagram_generated: True}}"
                            ]
                          }
                        ],
                        "model_updates": [
                          "Added 'Compute container dimensions from children' responsibility to DrawIOStoryNode (Base) with collaborators [StoryNodeChildren, Spacing, Boundary] \u2014 needed for epic width = sum(sub-epic widths) and sub-epic width = sum(story widths + spacing)"
                        ]
                      },
                      {
                        "scope": "Invoke Bot.Perform Action.Synchronized Graph with Rendered Diagram Content.Update graph from story map.Story graph updated with renamed added and removed stories from diagram",
                        "scenario": "User renames 'Load Configuration' to 'Load Settings', adds 'Validate Config', removes 'Register Behaviors' in DrawIO \u2014 validates end-to-end load, report generation, and update flow",
                        "walks": [
                          {
                            "covers": "Background (Load StoryMap and DrawIOStoryMap from edited diagram file)",
                            "object_flow": [
                              "StoryMap",
                              "    storyMap: StoryMap = StoryMap.load(path: 'docs/story/story-graph.json')",
                              "        -> epics: [{name: 'Invoke Bot', sub_epics: [{name: 'Initialize Bot', stories: [{name: 'Load Config', order: 1.0}, {name: 'Load Configuration', order: 2.0}, {name: 'Register Behaviors', order: 3.0}]}]}]",
                              "        return storyMap",
                              "DrawIOStoryMap",
                              "    drawIOStoryMap: DrawIOStoryMap = DrawIOStoryMap.load(path: 'docs/story/story-map.drawio')",
                              "        -> DrawIOStoryMap.assign_stories_to_sub_epics_by_containment()",
                              "            -> 'Load Config' center (40,235) inside 'Initialize Bot' boundary => assigned",
                              "            -> 'Load Settings' center (100,235) inside 'Initialize Bot' boundary => assigned",
                              "            -> 'Validate Config' center (160,235) inside 'Initialize Bot' boundary => assigned",
                              "        -> DrawIOStoryMap.assign_sequential_order_from_position()",
                              "            -> 'Load Config' at x=15 => sequential_order: 1.0",
                              "            -> 'Load Settings' at x=75 => sequential_order: 2.0",
                              "            -> 'Validate Config' at x=135 => sequential_order: 3.0",
                              "        -> DrawIOStoryMap.extract_layout()",
                              "            -> layoutData: {'EPIC|Invoke Bot': {x:10,y:50}, 'SUB_EPIC|Invoke Bot|Initialize Bot': {x:10,y:120}, 'STORY|...|Load Config': {x:15,y:210}, ...}",
                              "        return drawIOStoryMap"
                            ]
                          },
                          {
                            "covers": "Step 1 (When: generateUpdateReport \u2014 recursive matching with fuzzy via SequenceMatcher)",
                            "object_flow": [
                              "DrawIOStoryMap",
                              "    report: UpdateReport = drawIOStoryMap.generate_update_report(storyMap: storyMap)",
                              "        -> // Delegate to DrawIOEpic for recursive subtree report",
                              "        -> DrawIOEpic('Invoke Bot').generate_update_report_for_epic_subtree(originalEpic: Epic('Invoke Bot'), report: report)",
                              "            -> DrawIOSubEpic('Initialize Bot').generate_update_report_for_sub_epic_subtree(originalSubEpic: SubEpic('Initialize Bot'), report: report)",
                              "                -> DrawIOStory('Load Config').generate_update_report_for_story(original: Story('Load Config'))",
                              "                    -> name_compare: exact = ('load config' == 'load config')",
                              "                    -> report.add(match_type: 'exact', extracted: 'Load Config', original: 'Load Config', confidence: 1.0)",
                              "                -> DrawIOStory('Load Settings').generate_update_report_for_story(originals: [Story('Load Configuration'), Story('Register Behaviors')])",
                              "                    -> exact_match: None",
                              "                    -> fuzzy: 0.85 = SequenceMatcher('load settings', 'load configuration').ratio() + context_bonus(0.2)",
                              "                    -> report.add(match_type: 'fuzzy', extracted: 'Load Settings', original: 'Load Configuration', confidence: 0.85)",
                              "                -> DrawIOStory('Validate Config').generate_update_report_for_story(originals: [])",
                              "                    -> report.add(match_type: 'new', story: 'Validate Config', parent: 'Initialize Bot')",
                              "                -> // Unmatched original: 'Register Behaviors'",
                              "                -> report.add(match_type: 'removed', story: 'Register Behaviors', parent: 'Initialize Bot')",
                              "        -> // Large deletion detection (part of generate_update_report)",
                              "        -> drawIOStoryMap.detect_large_deletions(storyMap: storyMap, report: report)  // all epics/sub-epics present \u2014 no large_deletions",
                              "        return report: {exact_matches: [{name: 'Load Config', confidence: 1.0}], fuzzy_matches: [{extracted: 'Load Settings', original: 'Load Configuration', confidence: 0.85}], new_stories: ['Validate Config'], removed_stories: ['Register Behaviors']}"
                            ]
                          },
                          {
                            "covers": "Steps 2-5 (Then: StoryMap.update applies exact/fuzzy/new/removed changes)",
                            "object_flow": [
                              "StoryMap",
                              "    storyMap.update(drawIOStoryMap: drawIOStoryMap, report: report)",
                              "        -> // Apply exact matches \u2014 update sequential_order from diagram position",
                              "        -> Story('Load Config').apply_update_from_other(other: DrawIOStory('Load Config'), report: report)",
                              "            -> Story.sequential_order: 1.0 (unchanged)",
                              "        -> // Apply fuzzy matches \u2014 rename and update fields",
                              "        -> Story('Load Configuration').apply_update_from_other(other: DrawIOStory('Load Settings'), report: report)",
                              "            -> Story.name: 'Load Settings' (renamed from 'Load Configuration')",
                              "            -> Story.sequential_order: 2.0 (updated from diagram position)",
                              "        -> // Add new stories from diagram",
                              "        -> newStory: Story = Story(name: 'Validate Config', sequential_order: 3.0, story_type: 'user')",
                              "        -> SubEpic('Initialize Bot').add_story(newStory)",
                              "        -> // Flag removed stories (not deleted \u2014 preserved for safety)",
                              "        -> Story('Register Behaviors').status: 'removed'",
                              "        -> // Persist layout for next render",
                              "        -> drawIOStoryMap.persist_layout_data(path: 'story-map-layout.json')",
                              "            -> LayoutData.save(path: 'story-map-layout.json')",
                              "        return storyMap: {epics: [{name: 'Invoke Bot', sub_epics: [{name: 'Initialize Bot', stories: [{name: 'Load Config', order: 1.0}, {name: 'Load Settings', order: 2.0}, {name: 'Validate Config', order: 3.0}, {name: 'Register Behaviors', status: 'removed'}]}]}]}"
                            ]
                          }
                        ],
                        "model_updates": [
                          "Validated: DrawIOStoryMap.load() correctly chains assign_stories_to_sub_epics_by_containment, assign_sequential_order_from_position, and extract_layout \u2014 all three are needed on load",
                          "Validated: Recursive report generation (DrawIOStoryMap -> DrawIOEpic -> DrawIOSubEpic -> DrawIOStory) works for mixed match types",
                          "Note: Fuzzy matching uses SequenceMatcher (difflib) with threshold 0.7 and context bonuses for same epic/sub-epic \u2014 implementation detail inside DrawIOStory.generate_update_report_for_story"
                        ]
                      },
                      {
                        "scope": "Invoke Bot.Perform Action.Synchronized Graph with Rendered Diagram Content.Render story map increments.Render increments diagram with stories assigned to increment lanes",
                        "scenario": "High-level: DrawIOStoryMap branches on diagramType 'increments' to render outline plus increment lanes with stories assigned by membership",
                        "walks": [
                          {
                            "covers": "Steps 1-7 (Complete increments render \u2014 diagramType branching, outline + lane rendering)",
                            "object_flow": [
                              "DrawIOStoryMap",
                              "    drawIOStoryMap: DrawIOStoryMap = DrawIOStoryMap(diagramType: 'increments')",
                              "    drawIOStoryMap.render_from_story_map(storyMap: storyMap, layoutData: layoutData)",
                              "        -> diagramType: 'increments' = drawIOStoryMap.diagramType",
                              "        -> // Phase 1: Render outline section (same as outline diagramType)",
                              "        -> //   ... DrawIOEpic, DrawIOSubEpic, DrawIOStory nodes created and positioned ...",
                              "        -> // Phase 2: Render increment lanes below outline",
                              "        -> increments: [Increment] = storyGraph.get_increments()  // StoryGraph (extended) \u2014 increments live on graph, not StoryMap",
                              "        -> for each increment ('MVP' priority: 1, 'Phase 2' priority: 2):",
                              "            -> laneCells: DrawIOElement = DrawIOStoryNodeSerializer.create_node(node: IncrementLane(name: 'MVP'))",
                              "                -> DrawIOElement.cell_style(fill: '#f5f5f5', stroke: '#666666', font: 'bold', font_color: 'black')",
                              "                -> DrawIOElement.set_position(x: -50, y: outline_bottom + lane_height * priority_index)",
                              "            -> // Assign stories to lanes by increment membership",
                              "        -> drawIOStoryMap.save(path: 'story-map-increments.drawio')",
                              "        return {summary: {epics: 1, sub_epic_count: 1, increment_count: 2, diagram_generated: True}}"
                            ]
                          }
                        ],
                        "model_updates": []
                      },
                      {
                        "scope": "Invoke Bot.Perform Action.Synchronized Graph with Rendered Diagram Content.Render story map with acceptance criteria.Render exploration diagram with AC boxes below stories",
                        "scenario": "High-level: DrawIOStoryMap branches on diagramType 'acceptance_criteria' to render outline plus AC boxes below stories that have acceptance criteria",
                        "walks": [
                          {
                            "covers": "Steps 1-6 (Complete AC render \u2014 outline + AC box creation with When/Then formatting)",
                            "object_flow": [
                              "DrawIOStoryMap",
                              "    drawIOStoryMap: DrawIOStoryMap = DrawIOStoryMap(diagramType: 'acceptance_criteria')",
                              "    drawIOStoryMap.render_from_story_map(storyMap: storyMap, layoutData: layoutData)",
                              "        -> diagramType: 'acceptance_criteria' = drawIOStoryMap.diagramType",
                              "        -> // Phase 1: Render outline section (same as outline diagramType)",
                              "        -> //   ... DrawIOEpic, DrawIOSubEpic, DrawIOStory nodes created and positioned ...",
                              "        -> // Phase 2: Render AC boxes below each story with acceptance_criteria",
                              "        -> for each drawIOStory with story.acceptance_criteria:",
                              "            -> for each ac in acceptance_criteria:",
                              "                -> acBox: DrawIOElement = DrawIOStoryNodeSerializer.create_node(node: ACBox(text: ac.text))",
                              "                    -> DrawIOElement.cell_style(fill: '#fff2cc', stroke: '#d6b656', align: 'left', font_size: 8)",
                              "                    -> DrawIOElement.set_position(x: story.x, y: story.y + story.height + AC_SPACING_Y(70))",
                              "                    -> DrawIOElement.set_size(width: max(250, char_count * 6 + 10), height: 60)   // ACCEPTANCE_CRITERIA_MIN_WIDTH, CHAR_WIDTH, PADDING",
                              "        -> drawIOStoryMap.save(path: 'story-map-ac.drawio')",
                              "        return {summary: {epics: 1, sub_epic_count: 1, diagram_generated: True}}"
                            ]
                          }
                        ],
                        "model_updates": []
                      }
                    ],
                    "module": "synchronizers.story_io",
                    "inherits_from": "StoryMap"
                  },
                  {
                    "name": "UpdateReport",
                    "responsibilities": [
                      {
                        "name": "Exact matches",
                        "collaborators": [
                          "List[Match Entry]"
                        ]
                      },
                      {
                        "name": "Fuzzy matches",
                        "collaborators": [
                          "List[Match Entry]",
                          "Confidence"
                        ]
                      },
                      {
                        "name": "New stories (in source)",
                        "collaborators": [
                          "List[Story Entry]"
                        ]
                      },
                      {
                        "name": "New sub-epics (in source)",
                        "collaborators": [
                          "List[SubEpic Entry]"
                        ]
                      },
                      {
                        "name": "New epics (in source)",
                        "collaborators": [
                          "List[Epic Entry]"
                        ]
                      },
                      {
                        "name": "Removed stories (in target)",
                        "collaborators": [
                          "List[Story Entry]"
                        ]
                      },
                      {
                        "name": "Removed sub-epics (in target)",
                        "collaborators": [
                          "List[SubEpic Entry]"
                        ]
                      },
                      {
                        "name": "Removed epics (in target)",
                        "collaborators": [
                          "List[Epic Entry]"
                        ]
                      },
                      {
                        "name": "Large deletions",
                        "collaborators": [
                          "Missing Epics",
                          "Missing Sub-Epics"
                        ]
                      },
                      {
                        "name": "Serialize to/from JSON",
                        "collaborators": [
                          "File Path",
                          "Report JSON"
                        ]
                      }
                    ],
                    "module": "synchronizers.story_io"
                  },
                  {
                    "name": "LayoutData",
                    "responsibilities": [
                      {
                        "name": "Store position and size per node",
                        "collaborators": [
                          "Node Id",
                          "Position",
                          "Boundary"
                        ]
                      },
                      {
                        "name": "Load from file",
                        "collaborators": [
                          "File Path",
                          "LayoutData"
                        ]
                      },
                      {
                        "name": "Save to file",
                        "collaborators": [
                          "File Path"
                        ]
                      },
                      {
                        "name": "Apply to diagram render",
                        "collaborators": [
                          "Renderer",
                          "Diagram"
                        ]
                      },
                      {
                        "name": "Extract from diagram (on sync)",
                        "collaborators": [
                          "DrawIO Tree",
                          "LayoutData"
                        ]
                      }
                    ],
                    "module": "synchronizers.story_io"
                  },
                  {
                    "name": "StoryMap (extended responsibilities)",
                    "responsibilities": [
                      {
                        "name": "Generate update report",
                        "collaborators": [
                          "StoryMap",
                          "UpdateReport",
                          "root/epics"
                        ]
                      },
                      {
                        "name": "Update from other",
                        "collaborators": [
                          "StoryMap",
                          "UpdateReport",
                          "recursive nodes"
                        ]
                      }
                    ],
                    "module": "story_graph.story_map"
                  },
                  {
                    "name": "StoryGraph (extended responsibilities)",
                    "responsibilities": [
                      {
                        "name": "Update from diagram map",
                        "collaborators": [
                          "DrawIOStoryMap",
                          "Epic",
                          "recursive update"
                        ]
                      },
                      {
                        "name": "Generate update report for graph",
                        "collaborators": [
                          "StoryMap",
                          "generateUpdateReport"
                        ]
                      },
                      {
                        "name": "Re-render after update",
                        "collaborators": [
                          "LayoutData",
                          "add/remove/change",
                          "warn"
                        ]
                      },
                      {
                        "name": "Get increments",
                        "collaborators": [
                          "List[Increment]",
                          "Priority"
                        ]
                      }
                    ],
                    "module": "story_graph"
                  }
                ]
              },
              {
                "name": "Validate With Rules",
                "sub_epics": [],
                "story_groups": [
                  {
                    "name": null,
                    "stories": [
                      {
                        "name": "Validate Rules",
                        "acceptance_criteria": [],
                        "scenarios": [
                          {
                            "name": "Story graph validation includes rule content in instructions",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Production story_bot with shape behavior (validates story graph)",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When Validate action executes",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then Instructions contain rule descriptions, DO/DON'T sections, and priorities from rule files",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then And Story graph file exists",
                                "sequential_order": 4.0
                              }
                            ]
                          },
                          {
                            "name": "File validation includes rule content in instructions",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Production story_bot with code behavior (validates files)",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When Validate action executes",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then Instructions contain rule descriptions, DO/DON'T sections, and priorities from rule files",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then And Story graph file exists",
                                "sequential_order": 4.0
                              }
                            ]
                          },
                          {
                            "name": "Story graph scanners receive scoped story_graph data",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Story graph with multiple epics (\"Build Knowledge\", \"Epic B\")",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When Validate action executes with scope",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then Scanner receives filtered story graph (only \"Build Knowledge\" epic)",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then And Scope filtered to \"Build Knowledge\" epic",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "Then And Production story_bot with shape behavior",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "Then And Scanner executes successfully",
                                "sequential_order": 6.0
                              },
                              {
                                "text": "Then And Instructions contain \"Build Knowledge\" in scope description",
                                "sequential_order": 7.0
                              }
                            ]
                          },
                          {
                            "name": "File scanners receive scoped file paths",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Multiple Python files (test_foo.py, test_bar.py, main.py)",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When Validate action executes with scope",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then Scanner receives filtered files (only test_foo.py, test_bar.py)",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then And Scope filtered to test files only (**/test*.py)",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "Then And Production story_bot with code behavior",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "Then And Scanner executes successfully",
                                "sequential_order": 6.0
                              },
                              {
                                "text": "Then And Instructions reference test file scope",
                                "sequential_order": 7.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Validate Rules Using CLI",
                        "acceptance_criteria": [],
                        "scenarios": [
                          {
                            "name": "Validate action shows rules in CLI output",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: CLI is at shape.validate",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "AND: Story graph exists",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "WHEN: user navigates to shape.validate",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "THEN: CLI output contains rule descriptions and DO/DON'T sections",
                                "sequential_order": 4.0
                              }
                            ]
                          },
                          {
                            "name": "Code validate action shows file rules in CLI output",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: CLI is at code.validate",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "AND: Story graph exists",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "WHEN: user navigates to code.validate",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "THEN: CLI output contains file validation rules",
                                "sequential_order": 4.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Display Validation Results Through CLI",
                        "acceptance_criteria": [],
                        "scenarios": [
                          {
                            "name": "Display validation violations",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: Validation has run",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: user views validate instructions",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: CLI displays violation report",
                                "sequential_order": 3.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Display Validation Scanners Through CLI",
                        "acceptance_criteria": [],
                        "scenarios": [
                          {
                            "name": "Display discovered scanners",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: Validation scanners exist",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: user views validate instructions",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: CLI displays list of available scanners",
                                "sequential_order": 3.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Display Validate Instructions Panel",
                        "acceptance_criteria": [
                          {
                            "name": "WHEN Current action is validate\nTHEN System displays rules list",
                            "text": "WHEN Current action is validate\nTHEN System displays rules list",
                            "sequential_order": 1.0
                          },
                          {
                            "name": "WHEN User clicks rule file link\nTHEN System opens rule file in editor",
                            "text": "WHEN User clicks rule file link\nTHEN System opens rule file in editor",
                            "sequential_order": 2.0
                          }
                        ],
                        "scenarios": [
                          {
                            "name": "",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Bot is at shape.validate",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When Panel displays instructions section",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then Panel displays validation rules list",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And Each rule has clickable file link",
                                "sequential_order": 4.0
                              }
                            ]
                          },
                          {
                            "name": "",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Panel displays validate instructions with rules",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When User clicks rule file link",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then VS Code opens validation rule file in editor",
                                "sequential_order": 3.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Get Validate Instructions Through CLI",
                        "acceptance_criteria": [],
                        "scenarios": [
                          {
                            "name": "Get validate instructions with rules",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: CLI is at shape.validate.instructions",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: user enters 'shape.validate.instructions'",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: CLI displays validation rules and scanners",
                                "sequential_order": 3.0
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                ],
                "domain_concepts": [
                  {
                    "name": "ValidateRulesAction",
                    "responsibilities": [
                      {
                        "name": "Inject common bot rules",
                        "collaborators": [
                          "Base Bot",
                          "Rules",
                          "Common Rules"
                        ]
                      },
                      {
                        "name": "Inject behavior specific rules",
                        "collaborators": [
                          "Behavior",
                          "Rules",
                          "Behavior Rules"
                        ]
                      },
                      {
                        "name": "Load + inject content for validation",
                        "collaborators": [
                          "Behavior",
                          "Content",
                          "Knowledge Graph",
                          "Rendered Outputs"
                        ]
                      }
                    ],
                    "module": "actions.validate",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "TTYValidateRules",
                    "responsibilities": [
                      {
                        "name": "Serialize validate action to TTY",
                        "collaborators": [
                          "ValidateRulesAction",
                          "TTY String"
                        ]
                      },
                      {
                        "name": "Format validation results",
                        "collaborators": [
                          "Violations",
                          "TTY String"
                        ]
                      },
                      {
                        "name": "Wraps domain action",
                        "collaborators": [
                          "ValidateRulesAction"
                        ]
                      }
                    ],
                    "module": "actions.validate",
                    "inherits_from": "TTYProgressAdapter",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "JSONValidateRules",
                    "responsibilities": [
                      {
                        "name": "Serialize validate action to JSON",
                        "collaborators": [
                          "ValidateRulesAction",
                          "JSON String"
                        ]
                      },
                      {
                        "name": "Include violations and fixes",
                        "collaborators": [
                          "Violations",
                          "Suggestions",
                          "JSON"
                        ]
                      },
                      {
                        "name": "Wraps domain action",
                        "collaborators": [
                          "ValidateRulesAction"
                        ]
                      }
                    ],
                    "module": "actions.validate",
                    "inherits_from": "JSONProgressAdapter",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "MarkdownValidateRules",
                    "responsibilities": [
                      {
                        "name": "Serialize validate action to Markdown",
                        "collaborators": [
                          "ValidateRulesAction",
                          "Markdown String"
                        ]
                      },
                      {
                        "name": "Format validation report",
                        "collaborators": [
                          "Violations",
                          "Suggestions",
                          "Markdown"
                        ]
                      },
                      {
                        "name": "Wraps domain action",
                        "collaborators": [
                          "ValidateRulesAction"
                        ]
                      }
                    ],
                    "module": "actions.validate",
                    "inherits_from": "MarkdownProgressAdapter",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "ValidateInstructionsSection",
                    "responsibilities": [
                      {
                        "name": "Wraps validate subsection",
                        "collaborators": [
                          "ValidateDataSubSection"
                        ]
                      }
                    ],
                    "module": "actions.validate",
                    "inherits_from": "InstructionsSection",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "ValidateDataSubSection",
                    "responsibilities": [
                      {
                        "name": "Wraps validate JSON",
                        "collaborators": [
                          "Validate JSON"
                        ]
                      },
                      {
                        "name": "Displays rules",
                        "collaborators": [
                          "List",
                          "Rule JSON"
                        ]
                      },
                      {
                        "name": "Displays rule descriptions",
                        "collaborators": [
                          "String",
                          "Rule JSON"
                        ]
                      },
                      {
                        "name": "Displays rule examples",
                        "collaborators": [
                          "List",
                          "Rule JSON"
                        ]
                      },
                      {
                        "name": "Opens rule file",
                        "collaborators": [
                          "CLI",
                          "Path JSON"
                        ]
                      }
                    ],
                    "module": "actions.validate",
                    "inherits_from": "SubSectionView",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  }
                ]
              },
              {
                "name": "Use Rules In Prompt",
                "sub_epics": [],
                "story_groups": [
                  {
                    "name": null,
                    "stories": [
                      {
                        "name": "Display Rules",
                        "acceptance_criteria": [],
                        "scenarios": [
                          {
                            "name": "Action loads and formats rules digest",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Production story_bot with tests behavior (has rules)",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When Rules action executes",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then Instructions contain formatted rules digest with descriptions, priorities, DO/DON'T sections",
                                "sequential_order": 3.0
                              }
                            ]
                          },
                          {
                            "name": "Rules list includes file paths for each rule",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Production story_bot with tests behavior (has rules)",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When Rules action executes",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then Display includes rule names with their file paths",
                                "sequential_order": 3.0
                              }
                            ]
                          },
                          {
                            "name": "All behavior rules are included in the digest",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Production story_bot with tests behavior (has multiple rules)",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When Rules action executes",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then All rules from behavior are included in digest",
                                "sequential_order": 3.0
                              }
                            ]
                          },
                          {
                            "name": "User message is included in instructions when provided",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Production story_bot with tests behavior",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When Rules action executes with message",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then Instructions include user message",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then And User message requesting specific rule information",
                                "sequential_order": 4.0
                              }
                            ]
                          },
                          {
                            "name": "No user message section when message is empty",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Production story_bot with tests behavior",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When Rules action executes without message",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then Instructions do not include user message section",
                                "sequential_order": 3.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Display Rules Using CLI",
                        "acceptance_criteria": [
                          {
                            "name": "hello",
                            "text": "hello",
                            "sequential_order": 1.0
                          }
                        ],
                        "scenarios": [
                          {
                            "name": "Rules action shows rules digest in CLI output",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: CLI is at shape.validate (which shows rules)",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: user navigates to shape.validate",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: CLI output contains formatted rules digest",
                                "sequential_order": 3.0
                              }
                            ]
                          },
                          {
                            "name": "Validation output includes rules content",
                            "background": [],
                            "steps": [
                              {
                                "text": "GIVEN: CLI is at shape.validate",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "WHEN: user navigates to shape.validate",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "THEN: CLI output contains validation rules",
                                "sequential_order": 3.0
                              }
                            ]
                          },
                          {
                            "name": "User gets rules instructions for behavior",
                            "background": [],
                            "steps": []
                          },
                          {
                            "name": "User gets rules with message parameter",
                            "background": [],
                            "steps": []
                          },
                          {
                            "name": "User gets rules without message parameter",
                            "background": [],
                            "steps": []
                          }
                        ]
                      },
                      {
                        "name": "Submit Behavior Rules Through Panel",
                        "acceptance_criteria": [
                          {
                            "name": "WHEN User clicks Get Rules button for a behavior\nTHEN System executes behavior.rules command AND System submits rules digest to AI chat AND Rules include formatted descriptions with DO/DON'T sections AND Rules include file paths for each rule AND All behavior rules are included in digest",
                            "text": "WHEN User clicks Get Rules button for a behavior\nTHEN System executes behavior.rules command AND System submits rules digest to AI chat AND Rules include formatted descriptions with DO/DON'T sections AND Rules include file paths for each rule AND All behavior rules are included in digest",
                            "sequential_order": 1.0
                          }
                        ],
                        "scenarios": [
                          {
                            "name": "",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Panel displays behavior hierarchy",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And Behavior has rules defined",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When User clicks Get Rules button for behavior",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then System executes behavior.rules command via CLI",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And System submits formatted rules digest to AI chat",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And Rules digest includes descriptions, priorities, DO/DON'T sections",
                                "sequential_order": 6.0
                              },
                              {
                                "text": "And Rules digest includes file paths for each rule",
                                "sequential_order": 7.0
                              }
                            ]
                          },
                          {
                            "name": "",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Panel displays behavior hierarchy",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And Behavior has rules defined",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When User views behavior in hierarchy",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then Get Rules button is visible next to behavior name",
                                "sequential_order": 4.0
                              }
                            ]
                          },
                          {
                            "name": "",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Panel displays behavior hierarchy",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When User clicks Get Rules button",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "And Rules are successfully submitted to chat",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then System displays success confirmation message",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And Message indicates rules were submitted to chat",
                                "sequential_order": 5.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "Get Rules Instructions Through CLI",
                        "acceptance_criteria": [
                          {
                            "name": "WHEN User navigates to behavior.rules\nTHEN CLI displays formatted rules digest with descriptions and DO/DON'T sections AND CLI includes rule names with their file paths AND CLI includes all rules from the behavior",
                            "text": "WHEN User navigates to behavior.rules\nTHEN CLI displays formatted rules digest with descriptions and DO/DON'T sections AND CLI includes rule names with their file paths AND CLI includes all rules from the behavior",
                            "sequential_order": 1.0
                          }
                        ],
                        "scenarios": [
                          {
                            "name": "User gets rules instructions for behavior",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Production story_bot with tests behavior (has rules)",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When User enters 'tests.rules' in CLI",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then CLI displays formatted rules digest with descriptions, priorities, DO/DON'T sections",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And Display includes rule names with their file paths",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And All rules from behavior are included in digest",
                                "sequential_order": 5.0
                              }
                            ]
                          },
                          {
                            "name": "User gets rules with message parameter",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Production story_bot with tests behavior",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When User enters 'tests.rules \"explain parameterized tests\"' in CLI",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then CLI displays rules digest",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And Instructions include user message requesting specific rule information",
                                "sequential_order": 4.0
                              }
                            ]
                          },
                          {
                            "name": "User gets rules without message parameter",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given Production story_bot with tests behavior",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When User enters 'tests.rules' without message",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then CLI displays rules digest",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And Instructions do not include user message section",
                                "sequential_order": 4.0
                              }
                            ]
                          }
                        ]
                      },
                      {
                        "name": "YAYAYAYAYA",
                        "acceptance_criteria": [],
                        "scenarios": []
                      }
                    ]
                  }
                ],
                "domain_concepts": [
                  {
                    "name": "Rule",
                    "responsibilities": [
                      {
                        "name": "Validate content",
                        "collaborators": [
                          "Knowledge Graph",
                          "Violations"
                        ]
                      },
                      {
                        "name": "Find behavior specific rules from context",
                        "collaborators": [
                          "Behavior"
                        ]
                      },
                      {
                        "name": "Find common bot rules from context",
                        "collaborators": [
                          "Base Bot"
                        ]
                      },
                      {
                        "name": "Load + inject diagnostics results",
                        "collaborators": [
                          "AI Chat",
                          "Violations",
                          "Corrections"
                        ]
                      },
                      {
                        "name": "Suggest corrections",
                        "collaborators": [
                          "Violations",
                          "Suggestions",
                          "Fixes"
                        ]
                      },
                      {
                        "name": "Provide examples - Do",
                        "collaborators": [
                          "Example",
                          "Description"
                        ]
                      },
                      {
                        "name": "Provide examples - Dont",
                        "collaborators": [
                          "Example",
                          "Description"
                        ]
                      },
                      {
                        "name": "Specialized examples",
                        "collaborators": [
                          "Language",
                          "Framework",
                          "Pattern"
                        ]
                      }
                    ],
                    "module": "behaviors",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  },
                  {
                    "name": "Guardrails",
                    "responsibilities": [
                      {
                        "name": "Provide required context",
                        "collaborators": [
                          "Key Questions",
                          "Evidence"
                        ]
                      },
                      {
                        "name": "Guide Strategy decisions",
                        "collaborators": [
                          "Decision Criteria",
                          "Assumptions"
                        ]
                      },
                      {
                        "name": "Define recommended human activity",
                        "collaborators": [
                          "Human",
                          "Instructions"
                        ]
                      }
                    ],
                    "module": "behaviors",
                    "_source_path": "Invoke Bot.Invoke Bot Directly"
                  }
                ]
              },
              {
                "name": "Synchronize Diagram by Domain",
                "sub_epics": [
                  {
                    "name": "Synchronize Epics and Sub-Epics",
                    "sub_epics": [],
                    "story_groups": [
                      {
                        "name": null,
                        "stories": [
                          {
                            "name": "Render epic and sub-epic hierarchy",
                            "acceptance_criteria": [
                              {
                                "name": "When story graph has nested sub-epics then system renders each depth level with increasing Y positions and parent width encompasses all children",
                                "text": "When story graph has nested sub-epics then system renders each depth level with increasing Y positions and parent width encompasses all children",
                                "sequential_order": 1.0
                              },
                              {
                                "name": "When epic is rendered then epic horizontal span covers all its sub-epics",
                                "text": "When epic is rendered then epic horizontal span covers all its sub-epics",
                                "sequential_order": 2.0
                              },
                              {
                                "name": "When sibling sub-epics are rendered then no two sub-epics overlap horizontally",
                                "text": "When sibling sub-epics are rendered then no two sub-epics overlap horizontally",
                                "sequential_order": 3.0
                              },
                              {
                                "name": "When epic and sub-epic cells are rendered then all cells have whiteSpace wrap and html enabled and explicit fontSize",
                                "text": "When epic and sub-epic cells are rendered then all cells have whiteSpace wrap and html enabled and explicit fontSize",
                                "sequential_order": 4.0
                              }
                            ],
                            "scenarios": [
                              {
                                "name": "Render epic and sub-epic hierarchy with default layout positions epics at fixed Y and sub-epics below",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given no {LayoutData} exists for this diagram",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} renders outline from {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {DrawIOStoryMap} contains {DrawIOEpic}",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {DrawIOEpic} contains {DrawIOSubEpic}",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  },
                                  {
                                    "text": {
                                      "text": "And each {DrawIOSubEpic} contains its {DrawIOStory}",
                                      "sequential_order": 5.0
                                    },
                                    "sequential_order": 5.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {DrawIOStoryMap.output} is valid DrawIO XML",
                                      "sequential_order": 6.0
                                    },
                                    "sequential_order": 6.0
                                  }
                                ]
                              },
                              {
                                "name": "Parent epic spans all child sub-epics horizontally",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOSubEpic} is rendered with {DrawIOSubEpic.x} and {DrawIOSubEpic.width}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} renders outline from {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {DrawIOEpic.x} is at or before the leftmost {DrawIOSubEpic.x}",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {DrawIOEpic.width} encompasses all {DrawIOSubEpic}",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              },
                              {
                                "name": "Sibling sub-epics do not overlap horizontally",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOSubEpic} is rendered with {DrawIOSubEpic.x} and {DrawIOSubEpic.width}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} renders outline from {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then for each adjacent pair of {DrawIOSubEpic}: left x + width <= right x",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "Re-render with saved layout data preserves epic and sub-epic positions",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {LayoutData} exists with saved positions for {DrawIOSubEpic}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} renders outline from {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {DrawIOSubEpic} is rendered at {LayoutData.saved_x} {LayoutData.saved_y} with {LayoutData.saved_w}",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "Render completes and writes valid DrawIO file for epic hierarchy",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given no {LayoutData} exists for this diagram",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} renders outline from {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {DrawIOStoryMap} is written to {DrawIOStoryMap.output_file}",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {DrawIOStoryMap.output} is valid DrawIO XML",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {DrawIOStoryMap.summary} reports correct counts",
                                      "sequential_order": 5.0
                                    },
                                    "sequential_order": 5.0
                                  }
                                ]
                              },
                              {
                                "name": "Nested sub-epics render recursively to 4 levels of depth",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {StoryMap} has {DrawIOSubEpic} nested 4 levels deep",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "And each {DrawIOSubEpic} has a parent {DrawIOSubEpic}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} renders outline from {StoryMap}",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {DrawIOStoryMap} contains all {DrawIOSubEpic} at every depth",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  },
                                  {
                                    "text": {
                                      "text": "And each {DrawIOSubEpic} is rendered inside its parent",
                                      "sequential_order": 5.0
                                    },
                                    "sequential_order": 5.0
                                  }
                                ]
                              },
                              {
                                "name": "Both parent and leaf sub-epics rendered in hierarchy",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {StoryMap} has {DrawIOSubEpic} with {DrawIOSubEpic.role} of parent and leaf",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "And leaf {DrawIOSubEpic} contain {DrawIOStory}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} renders outline from {StoryMap}",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then parent {DrawIOSubEpic} is rendered as a container",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  },
                                  {
                                    "text": {
                                      "text": "And leaf {DrawIOSubEpic} is rendered with its {DrawIOStory} inside",
                                      "sequential_order": 5.0
                                    },
                                    "sequential_order": 5.0
                                  }
                                ]
                              },
                              {
                                "name": "Nested sub-epic Y positions increase with each depth level",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {StoryMap} has {DrawIOSubEpic} nested multiple levels deep",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} renders outline from {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {DrawIOSubEpic.expected_y} increases with each {DrawIOSubEpic.depth}",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And deeper {DrawIOSubEpic} has larger Y than shallower",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              },
                              {
                                "name": "Single-level sub-epic renders at standard Y position",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {StoryMap} has {DrawIOEpic} with {DrawIOEpic.y} position",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {DrawIOEpic} has a single {DrawIOSubEpic} with no nesting",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} renders outline from {StoryMap}",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {DrawIOSubEpic.expected_y} equals {DrawIOEpic.y} plus {DrawIOSubEpic.standard_offset}",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              },
                              {
                                "name": "Nested container spans children at every depth level",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {StoryMap} has {DrawIOSubEpic} nested multiple levels deep",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "And each {DrawIOSubEpic} is rendered with {DrawIOSubEpic.x} and {DrawIOSubEpic.width}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} renders outline from {StoryMap}",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then for each parent {DrawIOSubEpic}: parent.x <= child.x",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  },
                                  {
                                    "text": {
                                      "text": "And for each parent {DrawIOSubEpic}: child.x + child.width <= parent.x + parent.width",
                                      "sequential_order": 5.0
                                    },
                                    "sequential_order": 5.0
                                  }
                                ]
                              }
                            ]
                          },
                          {
                            "name": "Report epic and sub-epic changes",
                            "acceptance_criteria": [
                              {
                                "name": "When user creates a sub-epic manually in DrawIO with simple cell ID then report treats it as new not rename",
                                "text": "When user creates a sub-epic manually in DrawIO with simple cell ID then report treats it as new not rename",
                                "sequential_order": 1.0
                              },
                              {
                                "name": "When tool-generated sub-epic with hierarchical cell ID is unmatched then report pairs it as rename candidate",
                                "text": "When tool-generated sub-epic with hierarchical cell ID is unmatched then report pairs it as rename candidate",
                                "sequential_order": 2.0
                              },
                              {
                                "name": "When rename report is serialized to JSON and restored then all fields survive roundtrip",
                                "text": "When rename report is serialized to JSON and restored then all fields survive roundtrip",
                                "sequential_order": 3.0
                              }
                            ],
                            "scenarios": [
                              {
                                "name": "No changes reported when diagram matches original for epics and sub-epics",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStoryMap} has same sub-epic structure as {StoryMap}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap}.generateUpdateReport({StoryMap}) is executed",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {UpdateReport} has {UpdateReport.renames_count} of zero",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {UpdateReport} has {UpdateReport.new_count} of zero",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {UpdateReport} has {UpdateReport.removed_count} of zero",
                                      "sequential_order": 5.0
                                    },
                                    "sequential_order": 5.0
                                  }
                                ]
                              },
                              {
                                "name": "Sub-epic added in diagram detected as new in report",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStoryMap} has {DrawIOSubEpic} not present in {StoryMap}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap}.generateUpdateReport({StoryMap}) is executed",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {UpdateReport} lists {DrawIOSubEpic} as new",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "Sub-epic renamed in diagram detected as rename in report",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOSubEpic} in {DrawIOStoryMap} has different name than {StoryMap}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {StoryMap} has the original name",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap}.generateUpdateReport({StoryMap}) is executed",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {UpdateReport} pairs the {DrawIOSubEpic} as a rename match",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              },
                              {
                                "name": "Report roundtrips through JSON for epic and sub-epic hierarchy structure",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {UpdateReport} has sub-epic changes",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {UpdateReport}.to_dict() serializes to JSON",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {UpdateReport}.from_dict() restores from JSON",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then all {UpdateReport} fields survive the roundtrip",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              },
                              {
                                "name": "Report lists exact fuzzy new and removed entities for epics",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStoryMap} exists with content extracted from diagram",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {StoryMap} exists with known {DrawIOSubEpic} names",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap}.generateUpdateReport({StoryMap}) is executed",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {UpdateReport} lists exact matches and fuzzy matches and new and removed {DrawIOSubEpic}",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              },
                              {
                                "name": "Only hierarchical cell ID sub-epics participate in rename pairing",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStoryMap} has unmatched {DrawIOSubEpic} with both simple and hierarchical {DrawIOElement.cell_id}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap}.generateUpdateReport({StoryMap}) is executed",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then only {DrawIOSubEpic} with hierarchical {DrawIOElement.cell_id} participate in rename pairing",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {DrawIOSubEpic} with simple {DrawIOElement.cell_id} are treated as new",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              },
                              {
                                "name": "All simple cell ID sub-epics treated as new when no hierarchical candidates",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStoryMap} has unmatched {DrawIOSubEpic} all with simple {DrawIOElement.cell_id}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap}.generateUpdateReport({StoryMap}) is executed",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then no {DrawIOSubEpic} participate in rename pairing",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And all unmatched {DrawIOSubEpic} are listed as new in {UpdateReport}",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              },
                              {
                                "name": "Story rename works regardless of cell ID format",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStoryMap} has {DrawIOStory} with name different from {StoryMap} and any {DrawIOElement.cell_id} format",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap}.generateUpdateReport({StoryMap}) is executed",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {UpdateReport} detects {DrawIOStory} rename regardless of {DrawIOElement.cell_id} format",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {DrawIOElement.cell_id} type filtering only applies to {DrawIOSubEpic} and {DrawIOEpic}",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              },
                              {
                                "name": "Removed epics and sub-epics flagged as large deletions in report",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStoryMap} has fewer nodes than {StoryMap}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap}.generateUpdateReport({StoryMap}) is executed",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {UpdateReport} lists deleted nodes as removed",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {UpdateReport.large_deletions} flags entire missing {DrawIOEpic} or {DrawIOSubEpic}",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              }
                            ]
                          },
                          {
                            "name": "Update epics and sub-epics from diagram",
                            "acceptance_criteria": [
                              {
                                "name": "When new sub-epic appears in diagram then story graph adds it",
                                "text": "When new sub-epic appears in diagram then story graph adds it",
                                "sequential_order": 1.0
                              },
                              {
                                "name": "When sub-epic is renamed in diagram then story graph updates name",
                                "text": "When sub-epic is renamed in diagram then story graph updates name",
                                "sequential_order": 2.0
                              },
                              {
                                "name": "When sub-epic is removed from diagram then story graph removes it",
                                "text": "When sub-epic is removed from diagram then story graph removes it",
                                "sequential_order": 3.0
                              },
                              {
                                "name": "When nested sub-epic structure changes in diagram then story graph preserves new structure",
                                "text": "When nested sub-epic structure changes in diagram then story graph preserves new structure",
                                "sequential_order": 4.0
                              }
                            ],
                            "scenarios": [
                              {
                                "name": "Apply epic and sub-epic changes from report updates story graph",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {UpdateReport} has sub-epic changes",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {UpdateReport} is applied to {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {StoryMap} reflects the sub-epic additions and removals from {UpdateReport}",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "Removed sub-epic reassigns its stories by position",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOSubEpic} has been removed from {DrawIOStoryMap}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} extracts outline from diagram",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then extracted graph omits that {DrawIOSubEpic}",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {DrawIOStory} under it are reassigned by position (inside another {DrawIOSubEpic} or at {DrawIOEpic} level)",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {UpdateReport.large_deletions} flags the missing {DrawIOSubEpic}",
                                      "sequential_order": 5.0
                                    },
                                    "sequential_order": 5.0
                                  }
                                ]
                              },
                              {
                                "name": "Removed epic removes all children from story graph",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOEpic} has been removed from {DrawIOStoryMap}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} extracts outline from diagram",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then extracted graph omits that {DrawIOEpic} and all its {DrawIOSubEpic} and {DrawIOStory}",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {UpdateReport} lists those as removed",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {UpdateReport.large_deletions} includes missing_epics",
                                      "sequential_order": 5.0
                                    },
                                    "sequential_order": 5.0
                                  }
                                ]
                              },
                              {
                                "name": "Renamed sub-epic in diagram updates name in story graph",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOSubEpic} in {DrawIOStoryMap} has different name than in {StoryMap}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {UpdateReport} is applied to {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {StoryMap} updates the sub-epic name to match {DrawIOSubEpic}",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "New sub-epic in diagram creates it in story graph",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStoryMap} has {DrawIOSubEpic} not present in {StoryMap}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {UpdateReport} is applied to {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {StoryMap} creates the new {DrawIOSubEpic}",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "End-to-end render then report then update for epic hierarchy",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {StoryMap} has {DrawIOSubEpic}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} renders from {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "And user modifies {DrawIOSubEpic} in diagram",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {DrawIOStoryMap}.generateUpdateReport({StoryMap}) is executed",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {UpdateReport} is applied to {StoryMap}",
                                      "sequential_order": 5.0
                                    },
                                    "sequential_order": 5.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {StoryMap} reflects all sub-epic changes from diagram",
                                      "sequential_order": 6.0
                                    },
                                    "sequential_order": 6.0
                                  }
                                ]
                              },
                              {
                                "name": "Extract assigns entities to parent sub-epics by containment and sequential order",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStoryMap} outline file contains {DrawIOEpic} and {DrawIOSubEpic} and {DrawIOStory} cells",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} extracts outline from diagram",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {DrawIOStoryMap} assigns each {DrawIOStory} to a {DrawIOSubEpic} by containment",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And each {DrawIOSubEpic} has one story group with all its {DrawIOStory}",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {DrawIOStory.sequential_order} is assigned from top-to-bottom then left-to-right",
                                      "sequential_order": 5.0
                                    },
                                    "sequential_order": 5.0
                                  },
                                  {
                                    "text": {
                                      "text": "And extracted JSON is written to file",
                                      "sequential_order": 6.0
                                    },
                                    "sequential_order": 6.0
                                  }
                                ]
                              },
                              {
                                "name": "Sync persists layout data alongside diagram",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStoryMap} exists with content extracted from diagram",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When sync completes",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {LayoutData} is persisted to JSON file alongside the diagram",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {LayoutData} stores position and size for each {DrawIOEpic} and {DrawIOSubEpic} and {DrawIOStory}",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {LayoutData} is available for next render",
                                      "sequential_order": 5.0
                                    },
                                    "sequential_order": 5.0
                                  }
                                ]
                              },
                              {
                                "name": "Extract from empty or malformed drawio file produces error",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStoryMap} file contains no valid {DrawIOEpic} or {DrawIOSubEpic} cells",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} extracts outline from diagram",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {DrawIOStoryMap} reports extraction error with zero nodes found",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And no extracted JSON is written",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "name": "Synchronize Stories and Actors",
                    "sub_epics": [],
                    "story_groups": [
                      {
                        "name": null,
                        "stories": [
                          {
                            "name": "Render stories and actors",
                            "acceptance_criteria": [
                              {
                                "name": "When stories are rendered then they are positioned below deepest sub-epic",
                                "text": "When stories are rendered then they are positioned below deepest sub-epic",
                                "sequential_order": 1.0
                              },
                              {
                                "name": "When stories have users then actor elements are rendered in actor row above stories",
                                "text": "When stories have users then actor elements are rendered in actor row above stories",
                                "sequential_order": 2.0
                              },
                              {
                                "name": "When sub-epic contains stories then sub-epic horizontal span covers all its stories",
                                "text": "When sub-epic contains stories then sub-epic horizontal span covers all its stories",
                                "sequential_order": 3.0
                              },
                              {
                                "name": "When sibling stories are rendered then no two stories overlap horizontally",
                                "text": "When sibling stories are rendered then no two stories overlap horizontally",
                                "sequential_order": 4.0
                              }
                            ],
                            "scenarios": [
                              {
                                "name": "Render stories and actors with default layout positions stories below deepest sub-epic",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given no {LayoutData} exists for this diagram",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} renders outline from {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {DrawIOStory} cells are positioned below deepest {DrawIOSubEpic}",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {DrawIOStoryMap.output} is valid DrawIO XML",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              },
                              {
                                "name": "Parent sub-epic spans all child stories horizontally",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStory} is rendered with {DrawIOStory.x} and {DrawIOStory.width}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} renders outline from {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {DrawIOSubEpic} horizontal boundary encompasses all its {DrawIOStory}",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "Sibling stories do not overlap horizontally",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStory} is rendered with {DrawIOStory.x} and {DrawIOStory.width}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} renders outline from {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then for each adjacent pair of sibling {DrawIOStory}: left x + width <= right x",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "Re-render with saved layout data preserves story and actor positions",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {LayoutData} exists with saved positions for {DrawIOStory}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} renders outline from {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {DrawIOStory} is rendered at {LayoutData.saved_x} {LayoutData.saved_y}",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              }
                            ]
                          },
                          {
                            "name": "Render acceptance criteria",
                            "acceptance_criteria": [
                              {
                                "name": "When story has acceptance criteria then system renders AC boxes below story in exploration diagram",
                                "text": "When story has acceptance criteria then system renders AC boxes below story in exploration diagram",
                                "sequential_order": 1.0
                              },
                              {
                                "name": "When AC boxes are rendered then they use correct fill stroke and left-aligned text style",
                                "text": "When AC boxes are rendered then they use correct fill stroke and left-aligned text style",
                                "sequential_order": 2.0
                              },
                              {
                                "name": "When layout data exists then system preserves positions of story and AC boxes on re-render",
                                "text": "When layout data exists then system preserves positions of story and AC boxes on re-render",
                                "sequential_order": 3.0
                              },
                              {
                                "name": "When story has no acceptance criteria then no AC boxes rendered below it",
                                "text": "When story has no acceptance criteria then no AC boxes rendered below it",
                                "sequential_order": 4.0
                              }
                            ],
                            "scenarios": [
                              {
                                "name": "Render acceptance criteria with default layout positions AC boxes below stories",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given no {LayoutData} exists for this diagram",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} renders exploration from {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {DrawIOElement} AC boxes are positioned below each {DrawIOStory}",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {DrawIOStoryMap.output} is valid DrawIO XML",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              },
                              {
                                "name": "Re-render with saved layout data preserves story and AC box positions",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {LayoutData} exists with saved positions for {DrawIOStory} and {DrawIOElement}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} renders exploration from {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {DrawIOStory} and {DrawIOElement} AC boxes are rendered at {LayoutData} saved positions",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "Render with no acceptance criteria produces story without AC boxes",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {Story} has no {AcceptanceCriteria} defined",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} renders exploration from {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {DrawIOStoryMap} renders {DrawIOStory} without {DrawIOElement} AC boxes",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "Render acceptance criteria boxes below stories in exploration diagram",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given no {LayoutData} exists for this diagram",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} renders exploration from {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {DrawIOStoryMap} contains {DrawIOEpic} spanning {DrawIOSubEpic} spanning {DrawIOStory}",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {DrawIOElement} AC boxes are rendered below each {DrawIOStory}",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  },
                                  {
                                    "text": {
                                      "text": "And AC text is formatted as When/Then in {DrawIOElement} boxes",
                                      "sequential_order": 5.0
                                    },
                                    "sequential_order": 5.0
                                  },
                                  {
                                    "text": {
                                      "text": "And actor labels are positioned above {DrawIOStory}",
                                      "sequential_order": 6.0
                                    },
                                    "sequential_order": 6.0
                                  }
                                ]
                              },
                              {
                                "name": "AC boxes styled with correct fill stroke and positioned below story",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given no {LayoutData} exists for this diagram",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} renders exploration from {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {DrawIOElement} AC boxes are wider than {DrawIOStory} cell",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {DrawIOElement} uses {DrawIOElement.fill} of #fff2cc and {DrawIOElement.stroke} of #d6b656",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {DrawIOElement} has left-aligned 8px text",
                                      "sequential_order": 5.0
                                    },
                                    "sequential_order": 5.0
                                  }
                                ]
                              },
                              {
                                "name": "Rendered output contains story and AC cells with correct containment",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given no {LayoutData} exists for this diagram",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} renders exploration from {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then output {DrawIOStoryMap} contains both {DrawIOStory} cells and {DrawIOElement} AC cells",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {DrawIOElement} AC cells are contained within their parent {DrawIOStory} sub-tree in DrawIO XML",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              }
                            ]
                          },
                          {
                            "name": "Report story moves between parents",
                            "acceptance_criteria": [
                              {
                                "name": "When story position changes between sub-epics in diagram then report detects it as a move not new plus removed",
                                "text": "When story position changes between sub-epics in diagram then report detects it as a move not new plus removed",
                                "sequential_order": 1.0
                              },
                              {
                                "name": "When story moves across epics in diagram then report detects it as a cross-epic move",
                                "text": "When story moves across epics in diagram then report detects it as a cross-epic move",
                                "sequential_order": 2.0
                              },
                              {
                                "name": "When move report is serialized to JSON and restored then all fields survive roundtrip",
                                "text": "When move report is serialized to JSON and restored then all fields survive roundtrip",
                                "sequential_order": 3.0
                              }
                            ],
                            "scenarios": [
                              {
                                "name": "No changes reported when diagram matches original for story positions",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStoryMap} has same story structure as {StoryMap}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap}.generateUpdateReport({StoryMap}) is executed",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {UpdateReport} has {UpdateReport.moved_count} of zero",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {UpdateReport} has {UpdateReport.renames_count} of zero",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              },
                              {
                                "name": "Story moved between sub-epics detected as move not new plus removed",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStory} in {DrawIOStoryMap} has different parent than in {StoryMap}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap}.generateUpdateReport({StoryMap}) is executed",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {UpdateReport} detects the {DrawIOStory} as moved not new plus removed",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "Story moved across epics detected as move not new plus removed",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStory} in {DrawIOStoryMap} has parent in different {Epic} than in {StoryMap}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap}.generateUpdateReport({StoryMap}) is executed",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {UpdateReport} detects the {DrawIOStory} as moved not new plus removed",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "Report roundtrips through JSON for story move changes",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {UpdateReport} has story move changes",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {UpdateReport}.to_dict() serializes to JSON",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {UpdateReport}.from_dict() restores from JSON",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then all {UpdateReport} fields survive the roundtrip",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              },
                              {
                                "name": "Stories from removed sub-epic detected as moves to parent",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {SubEpic} has been removed from {DrawIOStoryMap}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {DrawIOStory} previously under that {SubEpic} now sits at {Epic} level",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap}.generateUpdateReport({StoryMap}) is executed",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {UpdateReport} detects the {DrawIOStory} as moved to parent {Epic}",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              }
                            ]
                          },
                          {
                            "name": "Report acceptance criteria changes",
                            "acceptance_criteria": [
                              {
                                "name": "When AC box is added in diagram then report lists it as new acceptance criteria",
                                "text": "When AC box is added in diagram then report lists it as new acceptance criteria",
                                "sequential_order": 1.0
                              },
                              {
                                "name": "When AC box is removed from diagram then report lists it as removed",
                                "text": "When AC box is removed from diagram then report lists it as removed",
                                "sequential_order": 2.0
                              },
                              {
                                "name": "When AC box moves between stories in diagram then report detects it as a move not new plus removed",
                                "text": "When AC box moves between stories in diagram then report detects it as a move not new plus removed",
                                "sequential_order": 3.0
                              },
                              {
                                "name": "When AC box has When/Then format text then extractor parses it as step description",
                                "text": "When AC box has When/Then format text then extractor parses it as step description",
                                "sequential_order": 4.0
                              }
                            ],
                            "scenarios": [
                              {
                                "name": "No changes reported when diagram matches original for acceptance criteria",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStoryMap} has same {AcceptanceCriteria} structure as {StoryMap}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap}.generateUpdateReport({StoryMap}) is executed",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {UpdateReport} has {UpdateReport.ac_added_count} of zero",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {UpdateReport} has {UpdateReport.ac_removed_count} of zero",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              },
                              {
                                "name": "AC box added in diagram detected as new in report",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStoryMap} has {DrawIOElement} AC box not present in {StoryMap}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap}.generateUpdateReport({StoryMap}) is executed",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {UpdateReport} lists the {AcceptanceCriteria} as new",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "AC box removed from diagram detected as removed in report",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStoryMap} lacks {DrawIOElement} AC box that {StoryMap} has",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap}.generateUpdateReport({StoryMap}) is executed",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {UpdateReport} lists the {AcceptanceCriteria} as removed",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "AC moved between stories detected as move not new plus removed",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOElement} AC box has moved from one {DrawIOStory} to another",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap}.generateUpdateReport({StoryMap}) is executed",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {UpdateReport} detects the {AcceptanceCriteria} as moved not new plus removed",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "AC boxes assigned to stories by vertical position below story cells",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStoryMap} has AC {DrawIOElement} positioned below {DrawIOStory}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} extracts from diagram",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then each AC {DrawIOElement} is assigned to its {DrawIOStory} by vertical position",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "Extract assigns AC boxes to stories by vertical position and containment",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStoryMap} has AC {DrawIOElement} positioned below {DrawIOStory}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} extracts exploration from diagram",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {DrawIOStoryMap} assigns AC cells to {DrawIOStory} by vertical position and containment",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And AC text mapped back to {AcceptanceCriteria}",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              },
                              {
                                "name": "Report roundtrips through JSON for acceptance criteria changes",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {UpdateReport} has acceptance criteria changes",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {UpdateReport}.to_dict() serializes to JSON",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {UpdateReport}.from_dict() restores from JSON",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then all {UpdateReport} fields survive the roundtrip",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              },
                              {
                                "name": "AC box with When/Then format text extracted as step description",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given AC {DrawIOElement} has {DrawIOElement.text} with When/Then format",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} extracts exploration from diagram",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {DrawIOStoryMap} extracts step description from {DrawIOElement.text}",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And associates extracted step with the containing {DrawIOStory}",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              },
                              {
                                "name": "AC box with plain text format treated as acceptance criteria without step extraction",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given AC {DrawIOElement} has {DrawIOElement.text} with plain format",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} extracts exploration from diagram",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {DrawIOStoryMap} treats {DrawIOElement.text} as plain {AcceptanceCriteria} description",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And associates it with the containing {DrawIOStory} without step extraction",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              }
                            ]
                          },
                          {
                            "name": "Update stories from diagram",
                            "acceptance_criteria": [
                              {
                                "name": "When story is moved between sub-epics in diagram then story graph transfers it preserving all fields",
                                "text": "When story is moved between sub-epics in diagram then story graph transfers it preserving all fields",
                                "sequential_order": 1.0
                              },
                              {
                                "name": "When story is removed from diagram then story graph removes it and flags if many missing from epic",
                                "text": "When story is removed from diagram then story graph removes it and flags if many missing from epic",
                                "sequential_order": 2.0
                              },
                              {
                                "name": "When sub-epic is removed from diagram then moved stories survive and unmoved stories are removed with it",
                                "text": "When sub-epic is removed from diagram then moved stories survive and unmoved stories are removed with it",
                                "sequential_order": 3.0
                              },
                              {
                                "name": "When new story appears in diagram then story graph creates it",
                                "text": "When new story appears in diagram then story graph creates it",
                                "sequential_order": 4.0
                              }
                            ],
                            "scenarios": [
                              {
                                "name": "Apply story move transfers between sub-epics preserving data",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStory} has been moved to a new position in {DrawIOStoryMap}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} extracts and generates {UpdateReport}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {DrawIOStory.sequential_order} is recomputed from new left-to-right position",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {UpdateReport} matches the moved {DrawIOStory} to original",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              },
                              {
                                "name": "Apply story move preserves all story fields",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {UpdateReport} contains a {StoryMove} for {DrawIOStory}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {StoryMove} is applied to {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {Story.acceptance_criteria} are preserved after move",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {Story.scenarios} are preserved after move",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {Story.users} and {Story.story_type} are preserved after move",
                                      "sequential_order": 5.0
                                    },
                                    "sequential_order": 5.0
                                  }
                                ]
                              },
                              {
                                "name": "Apply cross-epic story move preserves acceptance criteria and scenarios",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStory} has been moved from {SubEpic} under one {Epic} to {SubEpic} under a different {Epic}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When cross-epic {StoryMove} is applied to {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {Story.acceptance_criteria} survive the cross-epic move",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {Story.scenarios} survive the cross-epic move",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              },
                              {
                                "name": "Removed story keeps original structure and flags if many missing from epic",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given one {DrawIOStory} cell has been removed from {DrawIOStoryMap}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} extracts from diagram",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then extracted graph omits that {DrawIOStory}",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {UpdateReport} lists it as removed",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  },
                                  {
                                    "text": {
                                      "text": "And if many {DrawIOStory} from one {Epic} are missing the {UpdateReport} flags that {Epic}",
                                      "sequential_order": 5.0
                                    },
                                    "sequential_order": 5.0
                                  }
                                ]
                              },
                              {
                                "name": "Moved stories preserved when sub-epic removed from diagram",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStory} has been moved to another {SubEpic} in {DrawIOStoryMap}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "And the original {SubEpic} is being removed",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {UpdateReport} is applied (moves before removes)",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then moved {Story} survives the {SubEpic} removal",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              },
                              {
                                "name": "Unmoved stories removed with sub-epic when sub-epic removed from diagram",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStory} was NOT moved to another {SubEpic}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "And the {SubEpic} is being removed",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {UpdateReport} is applied",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then unmoved {Story} is removed along with its {SubEpic}",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              },
                              {
                                "name": "Move to renamed sub-epic updates correctly in story graph",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStory} has been renamed in {DrawIOStoryMap}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {UpdateReport} is applied to {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {StoryMap} updates the story name to match {DrawIOStory}",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "Move to new sub-epic creates it and transfers story",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStoryMap} has a new {DrawIOStory} not in original {StoryMap}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {UpdateReport} is applied to {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {StoryMap} creates the new {Story}",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "End-to-end render then report then update for story moves",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {StoryMap} has {Story}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} renders from {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "And user modifies stories in diagram",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {DrawIOStoryMap}.generateUpdateReport({StoryMap}) is executed",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {UpdateReport} is applied to {StoryMap}",
                                      "sequential_order": 5.0
                                    },
                                    "sequential_order": 5.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {StoryMap} reflects all story changes from diagram",
                                      "sequential_order": 6.0
                                    },
                                    "sequential_order": 6.0
                                  }
                                ]
                              }
                            ]
                          },
                          {
                            "name": "Update acceptance criteria from diagram",
                            "acceptance_criteria": [
                              {
                                "name": "When AC changes are applied from report then story graph reflects additions and removals",
                                "text": "When AC changes are applied from report then story graph reflects additions and removals",
                                "sequential_order": 1.0
                              },
                              {
                                "name": "When AC is moved between stories in diagram then it is transferred preserving all fields",
                                "text": "When AC is moved between stories in diagram then it is transferred preserving all fields",
                                "sequential_order": 2.0
                              },
                              {
                                "name": "When story is split with AC distributed then no acceptance criteria is lost",
                                "text": "When story is split with AC distributed then no acceptance criteria is lost",
                                "sequential_order": 3.0
                              },
                              {
                                "name": "When matched AC exists between diagram and story graph then original text and scenarios are preserved",
                                "text": "When matched AC exists between diagram and story graph then original text and scenarios are preserved",
                                "sequential_order": 4.0
                              }
                            ],
                            "scenarios": [
                              {
                                "name": "Apply acceptance criteria changes from report updates story graph",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {UpdateReport} has acceptance criteria changes",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {UpdateReport} is applied to {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {StoryMap} reflects the {AcceptanceCriteria} additions and removals from {UpdateReport}",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "Apply AC move transfers between stories preserving data",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {UpdateReport} contains an {AcceptanceCriteria} move from one {Story} to another",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When move is applied to {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {AcceptanceCriteria} is removed from source {Story} and added to target {Story}",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And all {AcceptanceCriteria} fields are preserved",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              },
                              {
                                "name": "Story split distributes AC correctly to new and original stories",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {Story} has been split in diagram with some {AcceptanceCriteria} moved to a new {DrawIOStory}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {UpdateReport} is applied to {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {AcceptanceCriteria} is distributed correctly between original and new {Story}",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And no {AcceptanceCriteria} is lost in the split",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              },
                              {
                                "name": "Update preserves original acceptance criteria for matched stories",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {UpdateReport} has matched {AcceptanceCriteria} between diagram and {StoryMap}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {UpdateReport} is applied to {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then original {AcceptanceCriteria.text} and scenarios are preserved for matched {AcceptanceCriteria}",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "End-to-end render then report then update for acceptance criteria",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {StoryMap} has {AcceptanceCriteria}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} renders from {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "And user modifies acceptance criteria in diagram",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {DrawIOStoryMap}.generateUpdateReport({StoryMap}) is executed",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {UpdateReport} is applied to {StoryMap}",
                                      "sequential_order": 5.0
                                    },
                                    "sequential_order": 5.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {StoryMap} reflects all acceptance criteria changes from diagram",
                                      "sequential_order": 6.0
                                    },
                                    "sequential_order": 6.0
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "name": "Synchronize Increments",
                    "sub_epics": [],
                    "story_groups": [
                      {
                        "name": null,
                        "stories": [
                          {
                            "name": "Render increment lanes",
                            "acceptance_criteria": [
                              {
                                "name": "When increment lanes are rendered then stories are positioned within lanes ordered by priority",
                                "text": "When increment lanes are rendered then stories are positioned within lanes ordered by priority",
                                "sequential_order": 1.0
                              },
                              {
                                "name": "When layout data exists then positions are preserved on re-render",
                                "text": "When layout data exists then positions are preserved on re-render",
                                "sequential_order": 2.0
                              },
                              {
                                "name": "When no increments defined then outline-only diagram is rendered",
                                "text": "When no increments defined then outline-only diagram is rendered",
                                "sequential_order": 3.0
                              },
                              {
                                "name": "When stories have users then actor labels are deduplicated per lane",
                                "text": "When stories have users then actor labels are deduplicated per lane",
                                "sequential_order": 4.0
                              }
                            ],
                            "scenarios": [
                              {
                                "name": "Render increment lanes with default layout positions lanes below outline by priority",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given no {LayoutData} exists for this diagram",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} renders increments from {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {DrawIOStory} cells are positioned within {Increment} lanes",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {DrawIOStoryMap.output} is valid DrawIO XML",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              },
                              {
                                "name": "Re-render with saved layout data preserves epic and sub-epic positions and recomputes lane positions",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {LayoutData} exists with saved positions from previous render",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} renders increments from {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {DrawIOStoryMap} applies {LayoutData} saved positions for {DrawIOStory} cells",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "Render completes and writes DrawIO file with correct summary for increment lanes",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given no {LayoutData} exists for this diagram",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} renders increments from {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {DrawIOStoryMap} is written to {DrawIOStoryMap.output_file}",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {DrawIOStoryMap.output} is valid DrawIO XML",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {DrawIOStoryMap.summary} reports correct counts",
                                      "sequential_order": 5.0
                                    },
                                    "sequential_order": 5.0
                                  }
                                ]
                              },
                              {
                                "name": "All increment lane cells have required styles for extractor detection",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given no {LayoutData} exists for this diagram",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} renders increments from {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then all increment lane cells have whiteSpace wrap and html enabled and explicit fontSize",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "Render with no increments defined produces outline-only diagram",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {StoryMap} has no {Increment} defined",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} renders increments from {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {DrawIOStoryMap} renders without increment lane elements",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "Increment lanes ordered by priority with Y positions from outline bottom",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {StoryMap} has {Increment} with {Increment.priority} values",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} renders increments from {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then lane order equals {Increment.priority} order",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And lane Y positions derived from outline bottom and lane height",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              },
                              {
                                "name": "Actor labels rendered above stories within each increment lane deduplicated per lane",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {StoryMap} has {Increment} with {Story} that have {StoryUser} assigned",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} renders increments from {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then actor labels appear above {DrawIOStory} within each increment lane",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And actor labels are deduplicated per lane",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  },
                                  {
                                    "text": {
                                      "text": "And each lane has its own deduplication scope",
                                      "sequential_order": 5.0
                                    },
                                    "sequential_order": 5.0
                                  }
                                ]
                              }
                            ]
                          },
                          {
                            "name": "Report increment changes",
                            "acceptance_criteria": [
                              {
                                "name": "When increment lane is added in diagram then report lists it as new",
                                "text": "When increment lane is added in diagram then report lists it as new",
                                "sequential_order": 1.0
                              },
                              {
                                "name": "When story moves between increment lanes then report detects it as a move not new plus removed",
                                "text": "When story moves between increment lanes then report detects it as a move not new plus removed",
                                "sequential_order": 2.0
                              },
                              {
                                "name": "When increment lane is renamed in diagram then report pairs it as a rename match",
                                "text": "When increment lane is renamed in diagram then report pairs it as a rename match",
                                "sequential_order": 3.0
                              },
                              {
                                "name": "When user-created lane has simple cell ID and rectangle geometry then it is detected as a new increment",
                                "text": "When user-created lane has simple cell ID and rectangle geometry then it is detected as a new increment",
                                "sequential_order": 4.0
                              }
                            ],
                            "scenarios": [
                              {
                                "name": "No changes reported when diagram matches original for increments",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStoryMap} has same {Increment} structure as {StoryMap}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap}.generateUpdateReport({StoryMap}) is executed",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {UpdateReport} reports zero increment changes",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "Increment lane added in diagram detected as new in report",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStoryMap} has a new {Increment} lane added by user",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "And original {StoryMap} does not have this {Increment}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap}.generateUpdateReport({StoryMap}) is executed",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {UpdateReport} lists the {Increment} as new",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              },
                              {
                                "name": "Story moved between increment lanes detected as move in report",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {IncrementStory} has been moved from one {Increment} to another in {DrawIOStoryMap}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap}.generateUpdateReport({StoryMap}) is executed",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {UpdateReport} detects the {IncrementChange} as moved not new plus removed",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "Increment lane renamed in diagram detected as rename in report",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {Increment} lane has been renamed in {DrawIOStoryMap}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "And original {StoryMap} has the original name",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap}.generateUpdateReport({StoryMap}) is executed",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {UpdateReport} pairs the renamed {Increment} as a rename match",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              },
                              {
                                "name": "Stories assigned to increment lanes by Y position",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStoryMap} has {DrawIOStory} cells positioned below {Increment} lane elements",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} extracts from diagram",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then each {DrawIOStory} is assigned to its {Increment} by vertical position",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "Extract assigns stories to increment lanes by Y position with priority from order",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStoryMap} increments file contains {Increment} lane cells and {DrawIOStory} cells",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} extracts increments from diagram",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {DrawIOStoryMap} identifies {Increment} lanes from left side of diagram by style sorted top to bottom",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And each {DrawIOStory} assigned to nearest lane within 100px by Y position",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  },
                                  {
                                    "text": {
                                      "text": "And each lane gets position-based {Increment.priority} and name from cell label",
                                      "sequential_order": 5.0
                                    },
                                    "sequential_order": 5.0
                                  },
                                  {
                                    "text": {
                                      "text": "And extracted JSON written to file",
                                      "sequential_order": 6.0
                                    },
                                    "sequential_order": 6.0
                                  }
                                ]
                              },
                              {
                                "name": "Report roundtrips through JSON for increment changes",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {UpdateReport} has increment changes",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {UpdateReport}.to_dict() serializes to JSON",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {UpdateReport}.from_dict() restores from JSON",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then all increment change fields survive the roundtrip",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              },
                              {
                                "name": "Report lists exact fuzzy new and removed stories for increments view",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStoryMap} has been extracted from diagram",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "And original {StoryMap} exists with known {Increment} names",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap}.generateUpdateReport({StoryMap}) is executed",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {UpdateReport} lists exact matches and fuzzy matches and new and removed increments",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              },
                              {
                                "name": "Report includes removed increments and new order",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStoryMap} has fewer {Increment} than original {StoryMap}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap}.generateUpdateReport({StoryMap}) is executed",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {UpdateReport} includes removed {Increment} and updated order",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "User-created lane detected by geometry in diagram",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStoryMap} has a user-created lane with simple {DrawIOElement.cell_id} and large rectangle geometry",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} extracts increments from diagram",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then the user-created lane is detected as a new {Increment} by its geometry",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "Orphan story dragged into lane reported as added to increment",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStory} is unassigned in {DrawIOStoryMap} increments diagram",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "And user drags {DrawIOStory} into an {Increment} lane",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap}.generateUpdateReport({StoryMap}) is executed",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {UpdateReport} reports {DrawIOStory} as added to that {Increment}",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              },
                              {
                                "name": "Story in multiple lanes produces no false duplicate reports",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStory} appears in multiple {Increment} lanes in {DrawIOStoryMap}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap}.generateUpdateReport({StoryMap}) is executed",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {UpdateReport} does not produce false duplicate or new entries",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "Known limitation inserting between existing lanes uses position-based matching",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given original {StoryMap} has {Increment} lanes [A, B, C]",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "And a new lane has been inserted between A and B in {DrawIOStoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} extracts increments from diagram",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then position-based matching maps extracted lane 1 to original A and lane 2 to original B",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  },
                                  {
                                    "text": {
                                      "text": "And the inserted lane may be misinterpreted as a rename of B without stable IDs",
                                      "sequential_order": 5.0
                                    },
                                    "sequential_order": 5.0
                                  }
                                ]
                              },
                              {
                                "name": "Story not within threshold of any lane remains unassigned",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStoryMap} has {DrawIOStory} positioned more than 100px from any {Increment} lane",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} extracts increments from diagram",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then that {DrawIOStory} is not assigned to any {Increment} lane",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              }
                            ]
                          },
                          {
                            "name": "Update increments from diagram",
                            "acceptance_criteria": [
                              {
                                "name": "When increment move is applied from report then story transfers between increments preserving data",
                                "text": "When increment move is applied from report then story transfers between increments preserving data",
                                "sequential_order": 1.0
                              },
                              {
                                "name": "When increment is removed from diagram then entire increment and assignments are deleted",
                                "text": "When increment is removed from diagram then entire increment and assignments are deleted",
                                "sequential_order": 2.0
                              },
                              {
                                "name": "When increment is renamed in diagram then story graph updates name",
                                "text": "When increment is renamed in diagram then story graph updates name",
                                "sequential_order": 3.0
                              },
                              {
                                "name": "When increment order changes in diagram then priorities are updated to match",
                                "text": "When increment order changes in diagram then priorities are updated to match",
                                "sequential_order": 4.0
                              }
                            ],
                            "scenarios": [
                              {
                                "name": "Apply increment move transfers story between increments preserving data",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {UpdateReport} contains an {IncrementChange} move from one {Increment} to another",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When move is applied to {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {IncrementStory} is removed from source {Increment} and added to target {Increment}",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And all increment fields are preserved",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  }
                                ]
                              },
                              {
                                "name": "Removed increment deletes entire increment from story graph",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {UpdateReport} contains a removed {Increment}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When removal is applied to {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then the entire {Increment} and its {IncrementStory} assignments are deleted from {StoryMap}",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "Renamed increment lane in diagram updates name in story graph",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {Increment} lane has been renamed in {DrawIOStoryMap}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {UpdateReport} is applied to {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {StoryMap} updates the {Increment.name} to match diagram",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "New increment lane in diagram creates it in story graph",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStoryMap} has a new {Increment} not in original {StoryMap}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {UpdateReport} is applied to {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {StoryMap} creates the new {Increment}",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "Update preserves original acceptance criteria for matched increment stories",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {UpdateReport} has matched {Increment} between diagram and {StoryMap}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {UpdateReport} is applied to {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then original {AcceptanceCriteria} and scenarios are preserved for matched {IncrementStory}",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "End-to-end render then report then update for increment lanes",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {StoryMap} has {Increment}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {DrawIOStoryMap} renders from {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "And user modifies increments in diagram",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {DrawIOStoryMap}.generateUpdateReport({StoryMap}) is executed",
                                      "sequential_order": 4.0
                                    },
                                    "sequential_order": 4.0
                                  },
                                  {
                                    "text": {
                                      "text": "And {UpdateReport} is applied to {StoryMap}",
                                      "sequential_order": 5.0
                                    },
                                    "sequential_order": 5.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {StoryMap} reflects all increment changes from diagram",
                                      "sequential_order": 6.0
                                    },
                                    "sequential_order": 6.0
                                  }
                                ]
                              },
                              {
                                "name": "Removing non-existent increment returns false",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {UpdateReport} references an {Increment} that does not exist in {StoryMap}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When removal is applied to {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then removal returns false and {StoryMap} is unchanged",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "Update increment order from diagram updates priorities in story graph",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {DrawIOStoryMap} has {Increment} lanes in a new order different from {StoryMap}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {UpdateReport} is applied to {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then {Increment.priority} in {StoryMap} are updated to match diagram order",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "No changes when increment priorities already match diagram order",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given {Increment.priority} in {StoryMap} already match {DrawIOStoryMap} diagram order",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {UpdateReport} is applied to {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then no {Increment.priority} changes are made",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              },
                              {
                                "name": "Extra lanes appended and fewer lanes leave original increments unchanged",
                                "background": [],
                                "steps": [
                                  {
                                    "text": {
                                      "text": "Given original {StoryMap} has fewer {Increment} lanes than {DrawIOStoryMap}",
                                      "sequential_order": 1.0
                                    },
                                    "sequential_order": 1.0
                                  },
                                  {
                                    "text": {
                                      "text": "When {UpdateReport} is applied to {StoryMap}",
                                      "sequential_order": 2.0
                                    },
                                    "sequential_order": 2.0
                                  },
                                  {
                                    "text": {
                                      "text": "Then extra {Increment} lanes are appended and original {Increment} unchanged",
                                      "sequential_order": 3.0
                                    },
                                    "sequential_order": 3.0
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                ],
                "story_groups": []
              }
            ],
            "story_groups": []
          }
        ],
        "domain_concepts": []
      }
    ]
  }
}

---

# Behavior: shape

## Behavior Instructions - shape

The purpose of this behavior is to create a story map that captures the user's journey through epics, features, and stories

Create a story map that captures the user's journey through epics, sub-epics, and stories

## Action Instructions - clarify

The purpose of this action is to gather context by asking required questions and collecting evidence in order to increase understanding

Gather context for story mapping

---

**Look for context in the following locations:**
- in this message and chat history
- `C:/dev/agile_bots/docs/story/story-graph.json` - the story graph and related  knowledge built so far
- `C:/dev/agile_bots/docs/story/strategy.json` - strategy decisions made
- `C:/dev/agile_bots/docs/story/clarification.json` - clarification answers
- `C:/dev/agile_bots/test/` and `C:/dev/agile_bots/src/` - existing code and tests
- any folder named `context/` anywhere in `C:/dev/agile_bots/` - additional context files

IMPORTANT: Follow these action instructions specifically. Frame the behavior instructions above within the context of this action.

Review all provided context, then for each required question below, thoughtfully answer it by thoroughly examining the context provided.

**Answer format:**
**Question:** [question text]
**Answer:** [your answer based on context]

If you can't answer from context, state: "[!] NOT ENOUGH INFORMATION - REQUIRES USER INPUT"
If a choice is needed, list available options and ask user to choose.
Don't guess or infer - be explicit when information is missing.

IMMEDIATELY after displaying your answers, save them to clarification.json WITHOUT WAITING for user confirmation.

IMPORTANT: Do NOT include decisions in clarification.json - decisions are made in the strategy action and saved to strategy.json.

Use this EXACT template format:
{
  "[behavior_name]": {
    "key_questions": {
      "answers": {
        "[Question 1 text]": "[Your answer to question 1]",
        "[Question 2 text]": "[Your answer to question 2]",
        "[Question 3 text]": "[Your answer to question 3]"
      }
    },
    "evidence": {
      "required": [
        "Requirements doc",
        "User interviews",
        "Product roadmap"
      ],
      "provided": {
        "requirements_doc": "path/to/doc",
        "other_source": "path/to/source"
      }
    },
    "context": [
      "Context item 1",
      "Context item 2"
    ]
  }
}

The user can then review and edit the clarification.json in the panel UI.
Gather context for story mapping

### Key Questions

- **What is the scope of this work?**: Generate Bot Tools (from Increment: User Manually Drops Config In to AI Chat). This story creates the foundational MCP bot tool that routes AI chat requests to bot behaviors and actions, enabling all subsequent MCP-based interactions.
- **Who are the target users?**: The Three primary user groups: (1) AI Agents - interact via MCP tools to execute bot behaviors and access knowledge graphs, (2) Developers - use CLI and panel interfaces to navigate workflows, manage scope, and execute actions, (3) Bot System - internal behaviors that orchestrate workflows, track state, and coordinate between actions.
- **What is the first priority action?**: Building the comprehensive agile bot system that enables AI agents and developers to manage software development workflows. The system includes: (1) Bot infrastructure with behavior-based workflows (clarify, strategy, build, validate, render actions), (2) MCP server integration for AI tool invocation, (3) Multiple interface options (CLI, VS Code panel), (4) Knowledge graph management for story mapping and CRC modeling, (5) Scope filtering and navigation capabilities, (6) Automated validation with rule scanners, and (7) Activity tracking across all operations.
- **Workspace**: THREE primary user groups: (1) AI Agents - interact via MCP tools to execute bot behaviors and access knowledge graphs, (2) Developers - use CLI and panel interfaces to navigate workflows, manage scope, and execute actions, (3) Bot System - internal behaviors that orchestrate workflows, track state, and coordinate between actions.
- **Filter**: Building the comprehensive agile bot system that enables AI agents and developers to manage software development workflows. The system includes: (1) Bot infrastructure with behavior-based workflows (clarify, strategy, build, validate, render actions), (2) MCP server integration for AI tool invocation, (3) Multiple interface options (CLI, VS Code panel), (4) Knowledge graph management for story mapping and CRC modeling, (5) Scope filtering and navigation capabilities, (6) Automated validation with rule scanners, and (7) Activity tracking across all operations.

### Evidence

Requirements doc, User interviews, Product roadmap

### Decisions

**Your Decisions:**

**flow_scope_and_granularity:**
  - Intra-system level - Focus on interactions within a single system, Useful for Solutions with significant backend or service flows. sho## Scope

**Story Scope:** Synchronized Graph with Rendered Diagram Content

Please only work on the following scope.

Scope Filter: "Synchronized Graph with Rendered Diagram Content"

Scope:

{
  "path": "C:\\dev\\agile_bots\\docs\\story\\story-graph.json",
  "has_epics": true,
  "has_increments": false,
  "has_domain_concepts": true,
  "epic_count": 1,
  "content": {
    "epics": [
      {
        "name": "Invoke Bot",
        "sub_epics": [
          {
            "name": "Perform Action",
            "sub_epics": [
              {
                "name": "Synchronized Graph with Rendered Diagram Content",
                "sub_epics": [],
                "story_groups": [
                  {
                    "name": null,
                    "stories": [
                      {
                        "name": "Render story map",
                        "acceptance_criteria": [
                          {
                            "name": "When user requests outline diagram from story graph then system renders epics sub-epics and stories to DrawIO file and each node has position and size and output is valid DrawIO XML",
                            "text": "When user requests outline diagram from story graph then system renders epics sub-epics and stories to DrawIO file and each node has position and size and output is valid DrawIO XML",
                            "sequential_order": 1.0
                          },
                          {
                            "name": "When diagram is first rendered (no layout data) then epics at top at fixed Y; epic width equals combined width of sub-epics; sub-epics below epic; sub-epic width equals combined width of stories; stories left-to-right with spacing; actors above stories; epic-level and sub-epic-level actors above containers",
                            "text": "When diagram is first rendered (no layout data) then epics at top at fixed Y; epic width equals combined width of sub-epics; sub-epics below epic; sub-epic width equals combined width of stories; stories left-to-right with spacing; actors above stories; epic-level and sub-epic-level actors above containers",
                            "sequential_order": 2.0
                          },
                          {
                            "name": "When layout data from previous render exists then system applies saved positions for epics and sub-epics; story positions from sequential order (left-to-right preserved); new stories that would overlap go below them for manual positioning; other new nodes get default spacing",
                            "text": "When layout data from previous render exists then system applies saved positions for epics and sub-epics; story positions from sequential order (left-to-right preserved); new stories that would overlap go below them for manual positioning; other new nodes get default spacing",
                            "sequential_order": 3.0
                          },
                          {
                            "name": "When render completes then system writes DrawIO file to specified path and summary reports epics count and sub_epic_count and diagram_generated",
                            "text": "When render completes then system writes DrawIO file to specified path and summary reports epics count and sub_epic_count and diagram_generated",
                            "sequential_order": 4.0
                          },
                          {
                            "name": "When story graph has E epics S sub-epics and N stories then diagram contains exactly E epic cells S sub-epic cells N story cells and summary reports epics E and sub_epic_count S",
                            "text": "When story graph has E epics S sub-epics and N stories then diagram contains exactly E epic cells S sub-epic cells N story cells and summary reports epics E and sub_epic_count S",
                            "sequential_order": 5.0
                          },
                          {
                            "name": "When stories and sub-epics have sequential_order then diagram orders sub-epics left-to-right and stories within each sub-epic by sequential_order",
                            "text": "When stories and sub-epics have sequential_order then diagram orders sub-epics left-to-right and stories within each sub-epic by sequential_order",
                            "sequential_order": 6.0
                          },
                          {
                            "name": "When story has story_type user (or none) then system renders story cell with yellow fill (#fff2cc) stroke (#d6b656) and black text",
                            "text": "When story has story_type user (or none) then system renders story cell with yellow fill (#fff2cc) stroke (#d6b656) and black text",
                            "sequential_order": 7.0
                          },
                          {
                            "name": "When story has story_type system then system renders story cell with dark blue fill (#1a237e) stroke (#0d47a1) and white text",
                            "text": "When story has story_type system then system renders story cell with dark blue fill (#1a237e) stroke (#0d47a1) and white text",
                            "sequential_order": 8.0
                          },
                          {
                            "name": "When story has story_type technical then system renders story cell with black fill (#000000) stroke (#333333) and white text",
                            "text": "When story has story_type technical then system renders story cell with black fill (#000000) stroke (#333333) and white text",
                            "sequential_order": 9.0
                          },
                          {
                            "name": "When epic cells are rendered then system uses rounded shape fill (#e1d5e7) stroke (#9673a6) and black text",
                            "text": "When epic cells are rendered then system uses rounded shape fill (#e1d5e7) stroke (#9673a6) and black text",
                            "sequential_order": 10.0
                          },
                          {
                            "name": "When sub-epic cells are rendered then system uses rounded shape fill (#d5e8d4) stroke (#82b366) and black text",
                            "text": "When sub-epic cells are rendered then system uses rounded shape fill (#d5e8d4) stroke (#82b366) and black text",
                            "sequential_order": 11.0
                          },
                          {
                            "name": "When actor (user) labels are rendered then system uses fixed-aspect cell fill (#dae8fc) stroke (#6c8ebf) and black text (8px)",
                            "text": "When actor (user) labels are rendered then system uses fixed-aspect cell fill (#dae8fc) stroke (#6c8ebf) and black text (8px)",
                            "sequential_order": 12.0
                          }
                        ],
                        "scenarios": [
                          {
                            "name": "Render outline diagram from StoryMap with default layout",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {StoryMap} has {StoryMap.epics} with {DrawIOStoryNode.sequential_order} and nested {DrawIOSubEpic} and {DrawIOStory} nodes",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And no {LayoutData} exists for this diagram",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} renders outline from {StoryMap}",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} positions {DrawIOEpic} at top at fixed Y",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And {DrawIOEpic} width equals combined width of its {DrawIOSubEpic} children",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And {DrawIOSubEpic} positioned below {DrawIOEpic}",
                                "sequential_order": 6.0
                              },
                              {
                                "text": "And {DrawIOSubEpic} width equals combined width of its {DrawIOStory} children",
                                "sequential_order": 7.0
                              },
                              {
                                "text": "And {DrawIOStory} cells arranged left-to-right by {DrawIOStoryNode.sequential_order} with spacing",
                                "sequential_order": 8.0
                              },
                              {
                                "text": "And actor labels positioned above {DrawIOStory} cells",
                                "sequential_order": 9.0
                              },
                              {
                                "text": "And output is valid DrawIO XML written to {DrawIOStoryMap} file path",
                                "sequential_order": 10.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "Render outline diagram from StoryMap with saved LayoutData",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {StoryMap} has {StoryMap.epics} with {DrawIOEpic} and {DrawIOSubEpic} and {DrawIOStory} nodes",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And {LayoutData} exists with saved positions for each {DrawIOStoryNode}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} renders outline from {StoryMap}",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} applies {LayoutData} saved positions for {DrawIOEpic} and {DrawIOSubEpic}",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And {DrawIOStory} positions derived from {DrawIOStoryNode.sequential_order} left-to-right",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And new {DrawIOStory} that would overlap existing nodes positioned below for manual placement",
                                "sequential_order": 6.0
                              },
                              {
                                "text": "And other new {DrawIOStoryNode} get default spacing",
                                "sequential_order": 7.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "Diagram contains correct count of cells matching StoryMap structure",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {StoryMap} has {StoryMap.epics} E epics and S {DrawIOSubEpic} and N {DrawIOStory}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} renders outline from {StoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} contains exactly E {DrawIOEpic} cells and S {DrawIOSubEpic} cells and N {DrawIOStory} cells",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And summary reports epics E and sub_epic_count S and diagram_generated true",
                                "sequential_order": 4.0
                              }
                            ],
                            "examples": [
                              {
                                "name": "DrawIOStoryMap (rendered cells)",
                                "columns": [
                                  "cell_type",
                                  "name"
                                ],
                                "rows": [
                                  [
                                    "epic",
                                    "Fleet Management"
                                  ],
                                  [
                                    "sub_epic",
                                    "Track Vehicles"
                                  ],
                                  [
                                    "sub_epic",
                                    "Manage Maintenance"
                                  ],
                                  [
                                    "story",
                                    "View location"
                                  ],
                                  [
                                    "story",
                                    "Schedule service"
                                  ]
                                ]
                              }
                            ],
                            "trace": []
                          },
                          {
                            "name": "Sub-epics and stories ordered by sequential_order",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {StoryMap} has {DrawIOSubEpic} with {DrawIOStoryNode.sequential_order} values",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And each {DrawIOSubEpic} has {DrawIOStory} with {DrawIOStoryNode.sequential_order} values",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} renders outline from {StoryMap}",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then {DrawIOSubEpic} cells ordered left-to-right by {DrawIOStoryNode.sequential_order}",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And {DrawIOStory} cells within each {DrawIOSubEpic} ordered left-to-right by {DrawIOStoryNode.sequential_order}",
                                "sequential_order": 5.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "DrawIOStoryMap styles story cells by story_type",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {StoryMap} has a {DrawIOStory} with {DrawIOStory.story_type}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} renders outline from {StoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {DrawIOStory} cell has fill {DrawIOElement.fill} and stroke {DrawIOElement.stroke} and font color {DrawIOElement.font_color}",
                                "sequential_order": 3.0
                              }
                            ],
                            "examples": [
                              {
                                "name": "DrawIOStory",
                                "collaboration": "Get story type (user/system/technical) from style",
                                "columns": [
                                  "DrawIOStory.story_type",
                                  "DrawIOElement.fill",
                                  "DrawIOElement.stroke",
                                  "DrawIOElement.font_color"
                                ],
                                "rows": [
                                  [
                                    "user",
                                    "#fff2cc",
                                    "#d6b656",
                                    "black"
                                  ],
                                  [
                                    "(none)",
                                    "#fff2cc",
                                    "#d6b656",
                                    "black"
                                  ],
                                  [
                                    "system",
                                    "#1a237e",
                                    "#0d47a1",
                                    "white"
                                  ],
                                  [
                                    "technical",
                                    "#000000",
                                    "#333333",
                                    "white"
                                  ]
                                ]
                              }
                            ],
                            "trace": []
                          },
                          {
                            "name": "DrawIOStoryMap styles container and label cells by node type",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {StoryMap} has a {DrawIOStoryNode} of type {DrawIOStoryNode.node_type}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} renders outline from {StoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {DrawIOElement} cell has shape {DrawIOElement.shape} and fill {DrawIOElement.fill} and stroke {DrawIOElement.stroke} and font color {DrawIOElement.font_color}",
                                "sequential_order": 3.0
                              }
                            ],
                            "examples": [
                              {
                                "name": "DrawIOElement",
                                "collaboration": "Cell style (fill, stroke, text)",
                                "columns": [
                                  "DrawIOStoryNode.node_type",
                                  "DrawIOElement.shape",
                                  "DrawIOElement.fill",
                                  "DrawIOElement.stroke",
                                  "DrawIOElement.font_color"
                                ],
                                "rows": [
                                  [
                                    "epic",
                                    "rounded",
                                    "#e1d5e7",
                                    "#9673a6",
                                    "black"
                                  ],
                                  [
                                    "sub_epic",
                                    "rounded",
                                    "#d5e8d4",
                                    "#82b366",
                                    "black"
                                  ],
                                  [
                                    "actor",
                                    "fixed-aspect",
                                    "#dae8fc",
                                    "#6c8ebf",
                                    "black (8px)"
                                  ]
                                ]
                              }
                            ],
                            "trace": []
                          },
                          {
                            "name": "Render completes and writes DrawIO file to specified path",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {StoryMap} has been loaded from story graph",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And output file path is specified for {DrawIOStoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} renders outline from {StoryMap}",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} is written to the specified file path",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And summary reports epics count and sub_epic_count and diagram_generated",
                                "sequential_order": 5.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "Render outline from empty StoryMap produces empty diagram",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {StoryMap} has no {StoryMap.epics}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} renders outline from {StoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} contains zero {DrawIOEpic} cells",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And summary reports epics 0 and sub_epic_count 0 and diagram_generated true",
                                "sequential_order": 4.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          }
                        ]
                      },
                      {
                        "name": "Render story map increments",
                        "acceptance_criteria": [
                          {
                            "name": "When user requests increments diagram then system renders outline with epics and sub-epics but WITHOUT story cells in the outline; stories appear ONLY in increment lanes (no duplication); story cells styled per story_type as in outline",
                            "text": "When user requests increments diagram then system renders outline with epics and sub-epics but WITHOUT story cells in the outline; stories appear ONLY in increment lanes (no duplication); story cells styled per story_type as in outline",
                            "sequential_order": 1.0
                          },
                          {
                            "name": "When story graph has increments with priority then system preserves priority order in diagram (lane order equals increment order) and lane Y positions derived from outline bottom and lane height",
                            "text": "When story graph has increments with priority then system preserves priority order in diagram (lane order equals increment order) and lane Y positions derived from outline bottom and lane height",
                            "sequential_order": 2.0
                          },
                          {
                            "name": "When layout data exists for increments view then system applies saved positions for epics and sub-epics and increment lane Y positions computed from outline bottom and lane height (saved layout for increment lanes not applied on re-render)",
                            "text": "When layout data exists for increments view then system applies saved positions for epics and sub-epics and increment lane Y positions computed from outline bottom and lane height (saved layout for increment lanes not applied on re-render)",
                            "sequential_order": 3.0
                          },
                          {
                            "name": "When render completes then system writes DrawIO file and summary includes increment count",
                            "text": "When render completes then system writes DrawIO file and summary includes increment count",
                            "sequential_order": 4.0
                          },
                          {
                            "name": "All increment lanes use uniform neutral style: fill #f5f5f5 stroke #666666 (no priority-based colors); both lane backgrounds and labels use this style",
                            "text": "All increment lanes use uniform neutral style: fill #f5f5f5 stroke #666666 (no priority-based colors); both lane backgrounds and labels use this style",
                            "sequential_order": 5.0
                          },
                          {
                            "name": "Actor labels rendered above stories within each increment lane; deduplicated per lane (same user not repeated within one lane); each lane has its own deduplication scope",
                            "text": "Actor labels rendered above stories within each increment lane; deduplicated per lane (same user not repeated within one lane); each lane has its own deduplication scope",
                            "sequential_order": 6.0
                          }
                        ],
                        "scenarios": [
                          {
                            "name": "Render increments diagram with stories assigned to increment lanes",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {StoryMap} has {StoryMap.epics} with {DrawIOSubEpic} and {DrawIOStory} nodes",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And {StoryMap} has increments with stories assigned to each increment",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} renders increments from {StoryMap}",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} outline contains {DrawIOEpic} and {DrawIOSubEpic} but no {DrawIOStory} cells",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And {DrawIOStory} cells appear only in increment lanes (not duplicated in outline)",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And increment lanes rendered with {DrawIOStory} cells assigned to lanes from story graph increments",
                                "sequential_order": 6.0
                              },
                              {
                                "text": "And {DrawIOStory} cells styled per story_type as in outline",
                                "sequential_order": 7.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "Increment lanes ordered by priority with Y positions from outline bottom",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {StoryMap} has increments with priority values",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} renders increments from {StoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then lane order equals increment priority order",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And lane Y positions derived from outline bottom and lane height",
                                "sequential_order": 4.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "Re-render increments with existing LayoutData recomputes lane positions",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {StoryMap} has increments with {DrawIOStory} assigned",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And {LayoutData} exists with saved positions for {DrawIOEpic} and {DrawIOSubEpic}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} renders increments from {StoryMap}",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} applies {LayoutData} saved positions for {DrawIOEpic} and {DrawIOSubEpic}",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And increment lane Y positions computed from outline bottom and lane height",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And saved layout for increment lanes not applied on re-render",
                                "sequential_order": 6.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "Render increments completes and summary includes increment count",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {StoryMap} has increments",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} renders increments from {StoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} is written to file",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And summary includes increment count",
                                "sequential_order": 4.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "Increment lane cells styled for extractor detection",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {StoryMap} has increments",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} renders increments from {StoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then all increment lane {DrawIOElement} backgrounds use uniform fill #f5f5f5 and stroke #666666 (no priority-based colors)",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And lane labels use fill #f5f5f5 and stroke #666666 and bold text and black font",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And lane cell style has strokeColor consistent with {DrawIOStoryMap}.get_increments_and_boundaries",
                                "sequential_order": 5.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "Render increments with no increments defined produces outline-only diagram",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {StoryMap} has {StoryMap.epics} but no increments defined",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} renders increments from {StoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} contains {DrawIOEpic} and {DrawIOSubEpic} without increment lanes",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And summary reports increment count 0",
                                "sequential_order": 4.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "Actor labels rendered above stories in increment lanes",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {StoryMap} has increments with {DrawIOStory} that have users assigned",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} renders increments from {StoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then actor labels appear above {DrawIOStory} within each increment lane",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And actor labels are deduplicated per lane (same user not repeated within one lane)",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And each lane has its own deduplication scope (same user can appear in multiple lanes)",
                                "sequential_order": 5.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          }
                        ]
                      },
                      {
                        "name": "Render story map with acceptance criteria",
                        "acceptance_criteria": [
                          {
                            "name": "When user requests exploration diagram then system renders epics sub-epics and stories with same layout as outline (epic spans sub-epics; sub-epic spans stories; stories left-to-right); story cells use distinct styles per story_type (user yellow system dark-blue technical black) as in outline; acceptance criteria boxes below each story with AC; AC text formatted When/Then in boxes",
                            "text": "When user requests exploration diagram then system renders epics sub-epics and stories with same layout as outline (epic spans sub-epics; sub-epic spans stories; stories left-to-right); story cells use distinct styles per story_type (user yellow system dark-blue technical black) as in outline; acceptance criteria boxes below each story with AC; AC text formatted When/Then in boxes",
                            "sequential_order": 1.0
                          },
                          {
                            "name": "When story has acceptance criteria then system creates wider AC boxes below story; AC boxes use rectangular shape fill (#fff2cc) stroke (#d6b656) left-aligned 8px text; extracts step text from AC; actors remain above stories as in outline mode",
                            "text": "When story has acceptance criteria then system creates wider AC boxes below story; AC boxes use rectangular shape fill (#fff2cc) stroke (#d6b656) left-aligned 8px text; extracts step text from AC; actors remain above stories as in outline mode",
                            "sequential_order": 2.0
                          },
                          {
                            "name": "When layout data exists then system preserves positions of story and AC boxes",
                            "text": "When layout data exists then system preserves positions of story and AC boxes",
                            "sequential_order": 3.0
                          },
                          {
                            "name": "When render completes then output DrawIO contains both story cells and AC cells with correct containment",
                            "text": "When render completes then output DrawIO contains both story cells and AC cells with correct containment",
                            "sequential_order": 4.0
                          }
                        ],
                        "scenarios": [
                          {
                            "name": "Render exploration diagram with AC boxes below stories",
                            "background": [],
                            "steps": [
                              {
                                "text": "When {DrawIOStoryMap} renders exploration from {StoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} contains {DrawIOEpic} spanning {DrawIOSubEpic} spanning {DrawIOStory} with same layout as outline",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "And {DrawIOStory} cells styled per story_type as in outline",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And acceptance criteria {DrawIOElement} boxes rendered below each {DrawIOStory}",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And AC text formatted as When/Then in boxes",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And actor labels positioned above {DrawIOStory} as in outline",
                                "sequential_order": 6.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "AC boxes styled and positioned below story with extracted step text",
                            "background": [],
                            "steps": [
                              {
                                "text": "When {DrawIOStoryMap} renders exploration from {StoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "Then AC {DrawIOElement} boxes created wider than {DrawIOStory} cell",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "And AC boxes use rectangular shape with fill #fff2cc and stroke #d6b656 and left-aligned 8px text",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And step text extracted from each acceptance_criteria entry",
                                "sequential_order": 4.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "Re-render exploration with LayoutData preserves story and AC box positions",
                            "background": [],
                            "steps": [
                              {
                                "text": "And {LayoutData} exists with saved positions for {DrawIOStory} and AC boxes",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} renders exploration from {StoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} applies {LayoutData} saved positions for {DrawIOStory} and AC {DrawIOElement} boxes",
                                "sequential_order": 3.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "Exploration render output contains story and AC cells with correct containment",
                            "background": [],
                            "steps": [
                              {
                                "text": "When {DrawIOStoryMap} renders exploration from {StoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "Then output {DrawIOStoryMap} contains both {DrawIOStory} cells and AC {DrawIOElement} cells",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "And AC cells are contained within their parent {DrawIOStory} sub-tree in DrawIO XML",
                                "sequential_order": 3.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "Story with no acceptance criteria renders without AC boxes",
                            "background": [],
                            "steps": [
                              {
                                "text": "And {StoryMap} also has a {DrawIOStory} with no acceptance_criteria",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} renders exploration from {StoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {DrawIOStory} without acceptance_criteria has no AC {DrawIOElement} boxes below it",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And {DrawIOStory} with acceptance_criteria still has AC boxes rendered",
                                "sequential_order": 4.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          }
                        ]
                      },
                      {
                        "name": "Update graph from story map",
                        "acceptance_criteria": [
                          {
                            "name": "When user synchronizes from DrawIO outline file then system extracts epics sub-epics and stories from DrawIO and writes extracted JSON and assigns stories to sub-epics by containment (story center inside sub-epic box) and each sub-epic has one story group with all its stories and assigns sequential order from top-to-bottom then left-to-right",
                            "text": "When user synchronizes from DrawIO outline file then system extracts epics sub-epics and stories from DrawIO and writes extracted JSON and assigns stories to sub-epics by containment (story center inside sub-epic box) and each sub-epic has one story group with all its stories and assigns sequential order from top-to-bottom then left-to-right",
                            "sequential_order": 1.0
                          },
                          {
                            "name": "When the diagram update report is run for a story graph then system generates report comparing extracted diagram to original story graph and report lists exact matches fuzzy matches new stories and removed stories",
                            "text": "When the diagram update report is run for a story graph then system generates report comparing extracted diagram to original story graph and report lists exact matches fuzzy matches new stories and removed stories",
                            "sequential_order": 2.0
                          },
                          {
                            "name": "When the story graph is updated from the DrawIO diagram (outline) then system applies report changes to the story graph",
                            "text": "When the story graph is updated from the DrawIO diagram (outline) then system applies report changes to the story graph",
                            "sequential_order": 3.0
                          },
                          {
                            "name": "When user renames or reorders epics sub-epics or stories in DrawIO then extracted graph reflects new names and order and diagram update report flags renames as fuzzy matches when names differ",
                            "text": "When user renames or reorders epics sub-epics or stories in DrawIO then extracted graph reflects new names and order and diagram update report flags renames as fuzzy matches when names differ",
                            "sequential_order": 4.0
                          },
                          {
                            "name": "When user deletes nodes in DrawIO then extracted graph omits those nodes and diagram update report lists them as removed and large deletion detection flags entire missing epics or sub-epics",
                            "text": "When user deletes nodes in DrawIO then extracted graph omits those nodes and diagram update report lists them as removed and large deletion detection flags entire missing epics or sub-epics",
                            "sequential_order": 5.0
                          },
                          {
                            "name": "When sync runs then system persists layout data to a JSON file alongside the diagram and layout stores position and size for each epic sub-epic and story for use on next render",
                            "text": "When sync runs then system persists layout data to a JSON file alongside the diagram and layout stores position and size for each epic sub-epic and story for use on next render",
                            "sequential_order": 6.0
                          },
                          {
                            "name": "When user moves a story in DrawIO and saves then sync extracts new position and recomputes sequential order from left-to-right and vertical position and merge updates the matched story with new order",
                            "text": "When user moves a story in DrawIO and saves then sync extracts new position and recomputes sequential order from left-to-right and vertical position and merge updates the matched story with new order",
                            "sequential_order": 7.0
                          },
                          {
                            "name": "When user deletes one story cell then extracted graph omits that story and diagram update report lists it as removed and merged output keeps original structure with only matched stories updated and if many stories from one epic are missing the report flags that epic",
                            "text": "When user deletes one story cell then extracted graph omits that story and diagram update report lists it as removed and merged output keeps original structure with only matched stories updated and if many stories from one epic are missing the report flags that epic",
                            "sequential_order": 8.0
                          },
                          {
                            "name": "When user deletes a sub-epic box then extracted graph omits that sub-epic and stories under it are reassigned by where they sit (inside another sub-epic box or at epic level) and diagram update report flags the missing sub-epic in large_deletions",
                            "text": "When user deletes a sub-epic box then extracted graph omits that sub-epic and stories under it are reassigned by where they sit (inside another sub-epic box or at epic level) and diagram update report flags the missing sub-epic in large_deletions",
                            "sequential_order": 9.0
                          },
                          {
                            "name": "When user deletes an epic box then extracted graph omits that epic and all its sub-epics and stories and diagram update report lists those stories as removed and large_deletions includes missing_epics",
                            "text": "When user deletes an epic box then extracted graph omits that epic and all its sub-epics and stories and diagram update report lists those stories as removed and large_deletions includes missing_epics",
                            "sequential_order": 10.0
                          }
                        ],
                        "scenarios": [
                          {
                            "name": "Extract outline assigns stories to sub-epics by containment and sequential order",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {DrawIOStoryMap} outline file contains {DrawIOEpic} and {DrawIOSubEpic} and {DrawIOStory} cells",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} extracts outline from {DrawIOStoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} assigns each {DrawIOStory} to a {DrawIOSubEpic} by containment (story center inside sub-epic box)",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And each {DrawIOSubEpic} has one story group with all its {DrawIOStory} nodes",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And {DrawIOStoryMap} assigns {DrawIOStoryNode.sequential_order} from top-to-bottom then left-to-right",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And extracted JSON is written to file",
                                "sequential_order": 6.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "UpdateReport lists exact fuzzy new and removed stories",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {DrawIOStoryMap} has been extracted from diagram",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And original {StoryMap} exists",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When {DrawIOStoryMap}.generateUpdateReport({StoryMap}) runs",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then {UpdateReport} lists exact matches where {DrawIOStoryNode} name equals {StoryMap} node name",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And {UpdateReport} lists fuzzy matches where names differ but match with confidence",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And {UpdateReport} lists new stories present in {DrawIOStoryMap} but not in {StoryMap}",
                                "sequential_order": 6.0
                              },
                              {
                                "text": "And {UpdateReport} lists removed stories present in {StoryMap} but not in {DrawIOStoryMap}",
                                "sequential_order": 7.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "StoryMap updated from outline diagram applies report changes",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {UpdateReport} has been generated from {DrawIOStoryMap} vs {StoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {StoryMap}.update({DrawIOStoryMap}, {UpdateReport}) runs",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {StoryMap} applies exact match updates from {UpdateReport}",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And {StoryMap} applies fuzzy match renames from {UpdateReport}",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And new stories added to {StoryMap}",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And removed stories flagged in {StoryMap}",
                                "sequential_order": 6.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "Renamed or reordered nodes flagged as fuzzy matches in UpdateReport",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {DrawIOStoryMap} has a {DrawIOStoryNode} with name changed from original",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And {StoryMap} has the original {DrawIOStoryNode} name",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When {DrawIOStoryMap}.generateUpdateReport({StoryMap}) runs",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then {UpdateReport} flags the renamed node as a fuzzy match",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And {UpdateReport} records both old and new name",
                                "sequential_order": 5.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "Deleted nodes listed as removed and large deletions flagged",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {DrawIOStoryMap} has nodes removed by user",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And {StoryMap} has the original nodes",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When {DrawIOStoryMap}.generateUpdateReport({StoryMap}) runs",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then {UpdateReport} lists deleted nodes as removed",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And {UpdateReport}.large_deletions flags entire missing {DrawIOEpic} or {DrawIOSubEpic}",
                                "sequential_order": 5.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "Sync persists LayoutData alongside diagram",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {DrawIOStoryMap} has been extracted from diagram",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When sync completes",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {LayoutData} persisted to JSON file alongside the diagram",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And {LayoutData} stores position and size for each {DrawIOEpic} and {DrawIOSubEpic} and {DrawIOStory}",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And {LayoutData} available for next render",
                                "sequential_order": 5.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "Moved story gets recomputed sequential order from new position",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {DrawIOStory} has been moved to a new position in {DrawIOStoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} extracts from {DrawIOStoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} recomputes {DrawIOStoryNode.sequential_order} from left-to-right and vertical position",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And {UpdateReport} matches the moved {DrawIOStory} to original",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And merged output updates the matched {DrawIOStory} with new order",
                                "sequential_order": 5.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "Single story deleted keeps original structure and flags if many missing",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given one {DrawIOStory} cell has been removed from {DrawIOStoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} extracts from {DrawIOStoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then extracted graph omits that {DrawIOStory}",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And {UpdateReport} lists it as removed",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And merged output keeps original {StoryMap} structure with only matched stories updated",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And if many {DrawIOStory} from one {DrawIOEpic} are missing the {UpdateReport} flags that {DrawIOEpic}",
                                "sequential_order": 6.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "Deleted sub-epic reassigns its stories by position",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given a {DrawIOSubEpic} box has been removed from {DrawIOStoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} extracts from {DrawIOStoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then extracted graph omits that {DrawIOSubEpic}",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And {DrawIOStory} nodes under it are reassigned by where they sit (inside another {DrawIOSubEpic} box or at {DrawIOEpic} level)",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And {UpdateReport} flags the missing {DrawIOSubEpic} in large_deletions",
                                "sequential_order": 5.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "Deleted epic removes all children and flags large deletions",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given a {DrawIOEpic} box has been removed from {DrawIOStoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} extracts from {DrawIOStoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then extracted graph omits that {DrawIOEpic} and all its {DrawIOSubEpic} and {DrawIOStory}",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And {UpdateReport} lists those stories as removed",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And {UpdateReport}.large_deletions includes missing_epics",
                                "sequential_order": 5.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "Extract from empty or malformed DrawIO file produces error",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {DrawIOStoryMap} file contains no valid {DrawIOEpic} or {DrawIOSubEpic} cells",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} extracts outline from {DrawIOStoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} reports extraction error with zero nodes found",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And no extracted JSON is written",
                                "sequential_order": 4.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          }
                        ]
                      },
                      {
                        "name": "Update graph from map increments",
                        "acceptance_criteria": [
                          {
                            "name": "When user synchronizes from DrawIO increments file then system extracts increment lanes from the left side of the diagram (by style) sorted top to bottom and assigns stories to increments by vertical position (story assigned to nearest lane within 100px) and each lane gets position-based priority and its name from the cell label and writes extracted JSON; optionally generates diagram update report when original story graph provided",
                            "text": "When user synchronizes from DrawIO increments file then system extracts increment lanes from the left side of the diagram (by style) sorted top to bottom and assigns stories to increments by vertical position (story assigned to nearest lane within 100px) and each lane gets position-based priority and its name from the cell label and writes extracted JSON; optionally generates diagram update report when original story graph provided",
                            "sequential_order": 1.0
                          },
                          {
                            "name": "When the diagram update report is run for a story graph (increments view) then system generates report (story-level: exact matches fuzzy matches new stories removed stories); increment membership in extracted reflects DrawIO lane positions",
                            "text": "When the diagram update report is run for a story graph (increments view) then system generates report (story-level: exact matches fuzzy matches new stories removed stories); increment membership in extracted reflects DrawIO lane positions",
                            "sequential_order": 2.0
                          },
                          {
                            "name": "When user moves stories between increments in DrawIO then extracted graph reflects new increment membership (by Y position)",
                            "text": "When user moves stories between increments in DrawIO then extracted graph reflects new increment membership (by Y position)",
                            "sequential_order": 3.0
                          },
                          {
                            "name": "When the story graph is updated from the DrawIO diagram (increments view) then system preserves original acceptance criteria and steps and updates story fields (users sequential_order) from extracted within existing increments and matches increments by position (first extracted lane to first original lane etc); applies renames; appends extra lanes as new; does not remove increments or replace which stories belong to which increment",
                            "text": "When the story graph is updated from the DrawIO diagram (increments view) then system preserves original acceptance criteria and steps and updates story fields (users sequential_order) from extracted within existing increments and matches increments by position (first extracted lane to first original lane etc); applies renames; appends extra lanes as new; does not remove increments or replace which stories belong to which increment",
                            "sequential_order": 4.0
                          },
                          {
                            "name": "When user adds a new increment lane at the bottom in DrawIO then extracted graph has one more increment and merge appends it as new",
                            "text": "When user adds a new increment lane at the bottom in DrawIO then extracted graph has one more increment and merge appends it as new",
                            "sequential_order": 5.0
                          },
                          {
                            "name": "When user removes an increment lane then extracted has fewer lanes; merge does not remove increments so the removed lane stays in merged with its original stories; stories from the deleted lane are reassigned to the nearest remaining lane in the extracted diagram",
                            "text": "When user removes an increment lane then extracted has fewer lanes; merge does not remove increments so the removed lane stays in merged with its original stories; stories from the deleted lane are reassigned to the nearest remaining lane in the extracted diagram",
                            "sequential_order": 6.0
                          },
                          {
                            "name": "When user renames an increment lane then merge treats the lane at that position as the same increment and updates its name (position-based matching)",
                            "text": "When user renames an increment lane then merge treats the lane at that position as the same increment and updates its name (position-based matching)",
                            "sequential_order": 7.0
                          },
                          {
                            "name": "When extracted has more lanes than original then extra lanes are appended as new increments",
                            "text": "When extracted has more lanes than original then extra lanes are appended as new increments",
                            "sequential_order": 8.0
                          },
                          {
                            "name": "When extracted has fewer lanes than original then original lanes beyond that point remain unchanged (merge does not remove)",
                            "text": "When extracted has fewer lanes than original then original lanes beyond that point remain unchanged (merge does not remove)",
                            "sequential_order": 9.0
                          },
                          {
                            "name": "KNOWN: inserting a new lane between two existing lanes may be misinterpreted without stable IDs",
                            "text": "KNOWN: inserting a new lane between two existing lanes may be misinterpreted without stable IDs",
                            "sequential_order": 10.0
                          }
                        ],
                        "scenarios": [
                          {
                            "name": "Extract increments assigns stories to lanes by Y position with priority from order",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {DrawIOStoryMap} increments file contains increment lane cells and {DrawIOStory} cells",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} extracts increments from {DrawIOStoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} identifies increment lanes from left side of diagram by style sorted top to bottom",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And each {DrawIOStory} assigned to nearest lane within 100px by Y position",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And each lane gets position-based priority and name from cell label",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And extracted JSON written to file",
                                "sequential_order": 6.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "UpdateReport generated for increments view with story-level matches",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {DrawIOStoryMap} increments have been extracted",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And original {StoryMap} provided",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When {DrawIOStoryMap}.generateUpdateReport({StoryMap}) runs for increments view",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then {UpdateReport} lists story-level exact matches and fuzzy matches and new stories and removed stories",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And increment membership in extracted reflects {DrawIOStoryMap} lane positions",
                                "sequential_order": 5.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "Story moved between increments reflected in extracted graph",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {DrawIOStory} has been moved from one increment lane to another in {DrawIOStoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} extracts increments from {DrawIOStoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then extracted graph reflects new increment membership for that {DrawIOStory} based on Y position",
                                "sequential_order": 3.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "Merge preserves original AC and updates story fields with position-based increment matching",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {UpdateReport} has been generated from {DrawIOStoryMap} increments vs {StoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {StoryMap}.update({DrawIOStoryMap}, {UpdateReport}) runs for increments view",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {StoryMap} preserves original acceptance_criteria and steps",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And {StoryMap} updates {DrawIOStory} fields (users, sequential_order) from extracted",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And increments matched by position (first extracted lane to first original lane)",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And renamed increments updated",
                                "sequential_order": 6.0
                              },
                              {
                                "text": "And extra lanes appended as new increments",
                                "sequential_order": 7.0
                              },
                              {
                                "text": "And merge does not remove increments or replace which stories belong to which increment",
                                "sequential_order": 8.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "New increment lane at bottom appended as new increment",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given a new increment lane exists at the bottom of {DrawIOStoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} extracts increments from {DrawIOStoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "And {StoryMap}.update({DrawIOStoryMap}, {UpdateReport}) runs",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then extracted graph has one more increment",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And merge appends the new lane as a new increment in {StoryMap}",
                                "sequential_order": 5.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "Removed increment lane stays in merged with its original stories",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given an increment lane has been removed from {DrawIOStoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} extracts increments from {DrawIOStoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then extracted has fewer lanes",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And {DrawIOStory} from deleted lane reassigned to nearest remaining lane in extracted",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "When {StoryMap}.update({DrawIOStoryMap}, {UpdateReport}) runs",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "Then merge does not remove the increment from {StoryMap}",
                                "sequential_order": 6.0
                              },
                              {
                                "text": "And removed lane stays in merged {StoryMap} with its original stories",
                                "sequential_order": 7.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "Renamed increment lane updated by position-based matching",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given an increment lane has been renamed in {DrawIOStoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} extracts increments from {DrawIOStoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "And {StoryMap}.update({DrawIOStoryMap}, {UpdateReport}) runs",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then merge treats the lane at that position as the same increment",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And updates its name in {StoryMap}",
                                "sequential_order": 5.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "Extra extracted lanes appended and fewer lanes leave originals unchanged",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given original {StoryMap} has {StoryMap.increment_count} increment lanes",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And extracted {DrawIOStoryMap} has {DrawIOStoryMap.increment_count} increment lanes",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When {StoryMap}.update({DrawIOStoryMap}, {UpdateReport}) runs",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then {UpdateReport.merge_result}",
                                "sequential_order": 4.0
                              }
                            ],
                            "examples": [
                              {
                                "name": "StoryMap",
                                "collaboration": "Update from other",
                                "columns": [
                                  "StoryMap.increment_count",
                                  "DrawIOStoryMap.increment_count",
                                  "UpdateReport.merge_result"
                                ],
                                "rows": [
                                  [
                                    "3",
                                    "5",
                                    "extra 2 lanes appended as new increments"
                                  ],
                                  [
                                    "5",
                                    "3",
                                    "original lanes 4 and 5 remain unchanged (merge does not remove)"
                                  ]
                                ]
                              }
                            ],
                            "trace": []
                          },
                          {
                            "name": "KNOWN: inserting lane between existing may misinterpret without stable IDs",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given original {StoryMap} has increment lanes [A, B, C]",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And a new lane has been inserted between A and B in {DrawIOStoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} extracts increments from {DrawIOStoryMap}",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then position-based matching maps extracted lane 1 to original A and lane 2 to original B",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And the inserted lane may be misinterpreted as a rename of B without stable IDs",
                                "sequential_order": 5.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "Story not within 100px of any lane remains unassigned in extracted",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {DrawIOStoryMap} increments file has {DrawIOStory} positioned more than 100px from any increment lane",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} extracts increments from {DrawIOStoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then that {DrawIOStory} is not assigned to any increment lane in extracted graph",
                                "sequential_order": 3.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          }
                        ]
                      },
                      {
                        "name": "Update story graph from map acceptance criteria",
                        "acceptance_criteria": [
                          {
                            "name": "When user synchronizes from DrawIO exploration file then system extracts stories and acceptance criteria boxes and maps AC text back to story acceptance_criteria or steps",
                            "text": "When user synchronizes from DrawIO exploration file then system extracts stories and acceptance criteria boxes and maps AC text back to story acceptance_criteria or steps",
                            "sequential_order": 1.0
                          },
                          {
                            "name": "When AC box text is When/Then format then system extracts step description and associates with story",
                            "text": "When AC box text is When/Then format then system extracts step description and associates with story",
                            "sequential_order": 2.0
                          },
                          {
                            "name": "When the story graph is updated from the DrawIO diagram (exploration view) then system applies report changes and preserves acceptance criteria and steps from original for matched stories (does not overwrite AC from extracted)",
                            "text": "When the story graph is updated from the DrawIO diagram (exploration view) then system applies report changes and preserves acceptance criteria and steps from original for matched stories (does not overwrite AC from extracted)",
                            "sequential_order": 3.0
                          },
                          {
                            "name": "When user adds or removes AC boxes in DrawIO then extracted graph reflects new or removed AC and diagram update report reflects structural changes",
                            "text": "When user adds or removes AC boxes in DrawIO then extracted graph reflects new or removed AC and diagram update report reflects structural changes",
                            "sequential_order": 4.0
                          },
                          {
                            "name": "When sync runs then system assigns AC cells to stories by vertical position and containment below story cells",
                            "text": "When sync runs then system assigns AC cells to stories by vertical position and containment below story cells",
                            "sequential_order": 5.0
                          }
                        ],
                        "scenarios": [
                          {
                            "name": "Extract exploration maps AC boxes to stories by position and containment",
                            "background": [],
                            "steps": [
                              {
                                "text": "When {DrawIOStoryMap} extracts exploration from {DrawIOStoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} assigns AC cells to {DrawIOStory} by vertical position and containment below story cells",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "And AC text mapped back to story acceptance_criteria or steps",
                                "sequential_order": 3.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "When/Then AC text extracted as step descriptions",
                            "background": [],
                            "steps": [
                              {
                                "text": "And AC {DrawIOElement} box has When/Then format text",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} extracts exploration from {DrawIOStoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} extracts step description from AC box text",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And associates extracted step with the containing {DrawIOStory}",
                                "sequential_order": 4.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "Merge preserves original AC for matched stories from exploration view",
                            "background": [],
                            "steps": [
                              {
                                "text": "And {UpdateReport} has been generated from {DrawIOStoryMap} exploration vs {StoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {StoryMap}.update({DrawIOStoryMap}, {UpdateReport}) runs for exploration view",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {StoryMap} applies report changes for matched stories",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And {StoryMap} preserves original acceptance_criteria and steps for matched stories",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And extracted AC does not overwrite original AC in {StoryMap}",
                                "sequential_order": 5.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "Added or removed AC boxes reflected in extracted graph and UpdateReport",
                            "background": [],
                            "steps": [
                              {
                                "text": "And new AC {DrawIOElement} boxes exist below a {DrawIOStory} in {DrawIOStoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And existing AC boxes have been removed from another {DrawIOStory}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} extracts exploration from {DrawIOStoryMap}",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then extracted graph reflects new AC for the first {DrawIOStory}",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And extracted graph omits removed AC for the second {DrawIOStory}",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And {UpdateReport} reflects these structural changes",
                                "sequential_order": 6.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "AC cells assigned to stories by vertical position below story cells",
                            "background": [],
                            "steps": [
                              {
                                "text": "And multiple {DrawIOStory} cells have AC {DrawIOElement} boxes positioned below them",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} extracts exploration from {DrawIOStoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then each AC {DrawIOElement} assigned to the {DrawIOStory} it is contained below based on vertical position",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And no AC box left unassigned when positioned within a {DrawIOStory} column",
                                "sequential_order": 4.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "AC box text not in When/Then format treated as plain acceptance_criteria",
                            "background": [],
                            "steps": [
                              {
                                "text": "And AC {DrawIOElement} box has text that is not in When/Then format",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When {DrawIOStoryMap} extracts exploration from {DrawIOStoryMap}",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then {DrawIOStoryMap} treats AC text as plain acceptance_criteria description",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And associates it with the containing {DrawIOStory} without step extraction",
                                "sequential_order": 4.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          }
                        ]
                      },
                      {
                        "name": "Render action diagram section",
                        "acceptance_criteria": [
                          {
                            "name": "When user is on render action then render section shows all existing content but without DrawIO diagram config and output; a separate Diagram section is shown",
                            "text": "When user is on render action then render section shows all existing content but without DrawIO diagram config and output; a separate Diagram section is shown",
                            "sequential_order": 1.0
                          },
                          {
                            "name": "When Diagram section is shown then it links to the DrawIO diagram file and to the generated update report file when any",
                            "text": "When Diagram section is shown then it links to the DrawIO diagram file and to the generated update report file when any",
                            "sequential_order": 2.0
                          },
                          {
                            "name": "When a diagram has changed since last synchronized then system visually indicates diagram is stale and shows a Refresh button",
                            "text": "When a diagram has changed since last synchronized then system visually indicates diagram is stale and shows a Refresh button",
                            "sequential_order": 3.0
                          },
                          {
                            "name": "When diagram has newer save than last refresh then system stores refresh dates per diagram and indicates pending changes and shows a Generate report button",
                            "text": "When diagram has newer save than last refresh then system stores refresh dates per diagram and indicates pending changes and shows a Generate report button",
                            "sequential_order": 4.0
                          },
                          {
                            "name": "When a report has been generated for a diagram then user can click the report to open it in the editor like other files and a button to Update is shown; after update user can delete the report",
                            "text": "When a report has been generated for a diagram then user can click the report to open it in the editor like other files and a button to Update is shown; after update user can delete the report",
                            "sequential_order": 5.0
                          }
                        ],
                        "scenarios": [
                          {
                            "name": "Render action shows existing render section without DrawIO config and separate Diagram section",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given user is on the render action",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And {StoryMap} has been loaded from story graph",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When render action displays its sections",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then existing render section shows all current render content except DrawIO diagram config and output",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And a Diagram section is shown separately",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And Diagram section links to each {DrawIOStoryMap} diagram file",
                                "sequential_order": 6.0
                              },
                              {
                                "text": "And Diagram section links to generated {UpdateReport} file when one exists",
                                "sequential_order": 7.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "Diagram stale when file changed since last sync shows indicator and Refresh",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {DrawIOStoryMap} exists at a file path",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And diagram file was last synchronized at {LayoutData} sync time",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "And diagram file has been modified after that sync time",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "When render action displays the Diagram section",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "Then system visually indicates that diagram is stale",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And a Refresh button is shown",
                                "sequential_order": 6.0
                              },
                              {
                                "text": "When user clicks Refresh",
                                "sequential_order": 7.0
                              },
                              {
                                "text": "Then system re-extracts from diagram and updates last-refresh time for that diagram",
                                "sequential_order": 8.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "Diagram with newer save than last refresh shows pending and Generate report",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {DrawIOStoryMap} has a stored last-refresh date per diagram",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And diagram file save time is newer than last-refresh date",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When render action displays the Diagram section",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then system indicates pending changes for that diagram",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And a Generate report button is shown",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "When user clicks Generate report",
                                "sequential_order": 6.0
                              },
                              {
                                "text": "Then system calls {StoryMap}.generateUpdateReport({DrawIOStoryMap}) and writes {UpdateReport} to file",
                                "sequential_order": 7.0
                              },
                              {
                                "text": "And Diagram section shows link to the report file",
                                "sequential_order": 8.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "User opens update report in editor and applies update then may delete report",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given an {UpdateReport} has been generated for a {DrawIOStoryMap} and {StoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And report file path is known",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When user clicks the report link in Diagram section",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then system opens the report file in the editor like other files",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "When user clicks Update",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "Then system calls {StoryMap}.update({DrawIOStoryMap}, {UpdateReport})",
                                "sequential_order": 6.0
                              },
                              {
                                "text": "And story graph is updated from diagram",
                                "sequential_order": 7.0
                              },
                              {
                                "text": "When update completes",
                                "sequential_order": 8.0
                              },
                              {
                                "text": "Then user may delete the report file",
                                "sequential_order": 9.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "Update applies report so each StoryNode parent and sequential_order reflect diagram",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {UpdateReport} contains exact and fuzzy matches from {DrawIOStoryMap} vs {StoryMap}",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "And {StoryMap} has epics with parent and sequential_order and children",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "When {StoryMap}.update({DrawIOStoryMap}, {UpdateReport}) runs",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "Then each updated {StoryNode} has parent from diagram containment",
                                "sequential_order": 4.0
                              },
                              {
                                "text": "And each updated {StoryNode} has sequential_order from diagram position",
                                "sequential_order": 5.0
                              },
                              {
                                "text": "And {LayoutData} is persisted for re-render",
                                "sequential_order": 6.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          },
                          {
                            "name": "Diagram file does not exist shows missing indicator",
                            "background": [],
                            "steps": [
                              {
                                "text": "Given {DrawIOStoryMap} file path is configured but file does not exist",
                                "sequential_order": 1.0
                              },
                              {
                                "text": "When render action displays the Diagram section",
                                "sequential_order": 2.0
                              },
                              {
                                "text": "Then Diagram section shows missing diagram indicator for that file",
                                "sequential_order": 3.0
                              },
                              {
                                "text": "And no Refresh or Generate report buttons are shown",
                                "sequential_order": 4.0
                              }
                            ],
                            "examples": null,
                            "trace": []
                          }
                        ]
                      },
                      {
                        "name": "Synchronize DIagram With Scoped Nodes",
                        "acceptance_criteria": [],
                        "scenarios": []
                      }
                    ]
                  }
                ],
                "domain_concepts": [
                  {
                    "name": "DrawIOElement (Base)",
                    "responsibilities": [
                      {
                        "name": "Get/Set position and size",
                        "collaborators": [
                          "Position",
                          "Boundary",
                          "DrawIO Cell"
                        ]
                      },
                      {
                        "name": "Read from DrawIO XML",
                        "collaborators": [
                          "File Path",
                          "mxCell Element",
                          "DrawIO Tree"
                        ]
                      },
                      {
                        "name": "Write to DrawIO XML",
                        "collaborators": [
                          "mxCell Element",
                          "DrawIO Tree"
                        ]
                      },
                      {
                        "name": "Cell style (fill, stroke, text)",
                        "collaborators": [
                          "Style String",
                          "DrawIO Cell"
                        ]
                      },
                      {
                        "name": "Identity for matching on re-extract",
                        "collaborators": [
                          "Cell Id",
                          "String"
                        ]
                      }
                    ],
                    "module": "synchronizers.story_io"
                  },
                  {
                    "name": "DrawIOStoryNode (Base)",
                    "responsibilities": [
                      {
                        "name": "Serializes (DrawIO)",
                        "collaborators": [
                          "DrawIOStoryNodeSerializer",
                          "DrawIO XML"
                        ]
                      },
                      {
                        "name": "Get/Update name",
                        "collaborators": [
                          "String",
                          "DrawIO Cell"
                        ]
                      },
                      {
                        "name": "Get node type",
                        "collaborators": [
                          "String"
                        ]
                      },
                      {
                        "name": "Get node ID",
                        "collaborators": [
                          "String",
                          "StoryNode",
                          "StoryNodeNavigator"
                        ]
                      },
                      {
                        "name": "Get parent",
                        "collaborators": [
                          "StoryNode"
                        ]
                      },
                      {
                        "name": "Get sequential order",
                        "collaborators": [
                          "StoryNodeNavigator",
                          "Float"
                        ]
                      },
                      {
                        "name": "Contains children",
                        "collaborators": [
                          "StoryNodeChildren"
                        ]
                      },
                      {
                        "name": "Delete self",
                        "collaborators": [
                          "DrawIOStoryNodeSerializer"
                        ]
                      },
                      {
                        "name": "Delete with children",
                        "collaborators": [
                          "DrawIOStoryNodeSerializer",
                          "StoryNodeChildren"
                        ]
                      },
                      {
                        "name": "Move, rename (emulate base StoryNode API)",
                        "collaborators": [
                          "New Parent",
                          "Position",
                          "DrawIO Tree"
                        ]
                      },
                      {
                        "name": "Generate own slice of update report",
                        "collaborators": [
                          "Other StoryNode",
                          "UpdateReport"
                        ]
                      },
                      {
                        "name": "Apply update from other node (recursive)",
                        "collaborators": [
                          "Other StoryNode",
                          "UpdateReport"
                        ]
                      },
                      {
                        "name": "Compute container dimensions from children",
                        "collaborators": [
                          "StoryNodeChildren",
                          "Spacing",
                          "Boundary"
                        ]
                      },
                      {
                        "name": "Render child nodes (recursive)",
                        "collaborators": [
                          "StoryNodeChildren",
                          "DrawIOStoryNodeSerializer",
                          "LayoutData"
                        ]
                      }
                    ],
                    "module": "synchronizers.story_io",
                    "inherits_from": "DrawIOElement, StoryNode (Base)"
                  },
                  {
                    "name": "DrawIOStoryNodeSerializer",
                    "responsibilities": [
                      {
                        "name": "Create node in DrawIO",
                        "collaborators": [
                          "File",
                          "DrawIOStoryNode",
                          "mxCell"
                        ]
                      },
                      {
                        "name": "Load node from DrawIO",
                        "collaborators": [
                          "File",
                          "DrawIOStoryNode",
                          "mxCell"
                        ]
                      },
                      {
                        "name": "Update node in DrawIO",
                        "collaborators": [
                          "File",
                          "DrawIOStoryNode"
                        ]
                      },
                      {
                        "name": "Delete node from DrawIO",
                        "collaborators": [
                          "File",
                          "DrawIOStoryNode"
                        ]
                      },
                      {
                        "name": "From DrawIO XML",
                        "collaborators": [
                          "DrawIO XML",
                          "DrawIOStoryNode"
                        ]
                      },
                      {
                        "name": "To DrawIO XML",
                        "collaborators": [
                          "DrawIOStoryNode",
                          "DrawIO XML"
                        ]
                      }
                    ],
                    "module": "synchronizers.story_io"
                  },
                  {
                    "name": "DrawIOEpic",
                    "responsibilities": [
                      {
                        "name": "Get all stories (via children)",
                        "collaborators": [
                          "List[DrawIOStory]",
                          "List[SubEpic]"
                        ]
                      },
                      {
                        "name": "Get sub-epics",
                        "collaborators": [
                          "List[DrawIOSubEpic]"
                        ]
                      },
                      {
                        "name": "Generate update report for this epic subtree",
                        "collaborators": [
                          "Other Epic",
                          "StoryMap",
                          "UpdateReport"
                        ]
                      },
                      {
                        "name": "Update from other epic (recursive)",
                        "collaborators": [
                          "Other Epic",
                          "UpdateReport"
                        ]
                      }
                    ],
                    "realization": [
                      {
                        "scope": "Invoke Bot.Perform Action.Synchronized Graph with Rendered Diagram Content.Update graph from story map.UpdateReport lists exact fuzzy new and removed stories",
                        "scenario": "Recursive report generation: DrawIOStoryMap delegates to DrawIOEpic which delegates to DrawIOSubEpic which delegates to DrawIOStory \u2014 each level matches its children against the original and contributes to the UpdateReport",
                        "walks": [
                          {
                            "covers": "Complete recursive delegation chain (Epic -> SubEpic -> Story report generation)",
                            "object_flow": [
                              "DrawIOEpic",
                              "    report_slice: UpdateReport = drawIOEpic.generate_update_report_for_epic_subtree(originalEpic: Epic('Invoke Bot'), report: report)",
                              "        -> drawIOSubEpics: [DrawIOSubEpic] = drawIOEpic.get_sub_epics()",
                              "            return [DrawIOSubEpic('Initialize Bot'), DrawIOSubEpic('Perform Action')]",
                              "        -> originalSubEpics: [SubEpic] = originalEpic.get_sub_epics()",
                              "            return [SubEpic('Initialize Bot'), SubEpic('Perform Action')]",
                              "        -> // Match sub-epics by name, delegate to each matched pair",
                              "        -> DrawIOSubEpic('Initialize Bot').generate_update_report_for_sub_epic_subtree(original: SubEpic('Initialize Bot'), report: report)",
                              "            -> drawIOStories: [DrawIOStory] = drawIOSubEpic.get_stories()",
                              "                return [DrawIOStory('Load Config'), DrawIOStory('Register Behaviors')]",
                              "            -> originalStories: [Story] = originalSubEpic.get_stories()",
                              "                return [Story('Load Config'), Story('Register Behaviors')]",
                              "            -> // Match each story \u2014 exact match first, then fuzzy, then new/removed",
                              "            -> DrawIOStory('Load Config').generate_update_report_for_story(original: Story('Load Config'))",
                              "                -> name_compare: exact = ('load config' == 'load config')",
                              "                -> report.add(match_type: 'exact', extracted: 'Load Config', original: 'Load Config', confidence: 1.0)",
                              "            -> DrawIOStory('Register Behaviors').generate_update_report_for_story(original: Story('Register Behaviors'))",
                              "                -> name_compare: exact = ('register behaviors' == 'register behaviors')",
                              "                -> report.add(match_type: 'exact', extracted: 'Register Behaviors', original: 'Register Behaviors', confidence: 1.0)",
                              "            return // all matched for Initialize Bot",
                              "        -> DrawIOSubEpic('Perform Action').generate_update_report_for_sub_epic_subtree(original: SubEpic('Perform Action'), report: report)",
                              "            -> // Same delegation pattern for stories in Perform Action",
                              "            -> DrawIOStory('Execute Action').generate_update_report_for_story(original: Story('Execute Action'))",
                              "                -> report.add(match_type: 'exact', extracted: 'Execute Action', original: 'Execute Action', confidence: 1.0)",
                              "        return report: {exact_matches: ['Load Config', 'Register Behaviors', 'Execute Action'], fuzzy_matches: [], new_stories: [], removed_stories: []}"
                            ]
                          }
                        ],
                        "model_updates": [
                          "Validated: Recursive delegation pattern (DrawIOEpic -> DrawIOSubEpic -> DrawIOStory) is viable for report generation \u2014 each level matches its direct children and delegates to the next",
                          "Validated: Sub-epic matching uses name comparison (same as story matching) before delegating to story-level",
                          "Note: When sub-epics don't match (e.g., deleted sub-epic), stories under it need reassignment by containment \u2014 this is handled by DrawIOStoryMap.assign_stories_to_sub_epics_by_containment on load, before report generation"
                        ]
                      }
                    ],
                    "module": "synchronizers.story_io",
                    "inherits_from": "DrawIOStoryNode (Base)"
                  },
                  {
                    "name": "DrawIOSubEpic",
                    "responsibilities": [
                      {
                        "name": "Get stories",
                        "collaborators": [
                          "List[DrawIOStory]"
                        ]
                      },
                      {
                        "name": "Generate update report for this sub-epic subtree",
                        "collaborators": [
                          "Other SubEpic",
                          "UpdateReport"
                        ]
                      },
                      {
                        "name": "Update from other sub-epic (recursive)",
                        "collaborators": [
                          "Other SubEpic",
                          "UpdateReport"
                        ]
                      }
                    ],
                    "module": "synchronizers.story_io",
                    "inherits_from": "DrawIOStoryNode (Base)"
                  },
                  {
                    "name": "DrawIOStory",
                    "responsibilities": [
                      {
                        "name": "Get story type (user/system/technical) from style",
                        "collaborators": [
                          "String",
                          "DrawIO Cell"
                        ]
                      },
                      {
                        "name": "Get users",
                        "collaborators": [
                          "List[StoryUser]"
                        ]
                      },
                      {
                        "name": "Get acceptance criteria",
                        "collaborators": [
                          "List[AcceptanceCriteria]",
                          "String"
                        ]
                      },
                      {
                        "name": "Generate update report for this story",
                        "collaborators": [
                          "Other Story",
                          "UpdateReport"
                        ]
                      },
                      {
                        "name": "Update from other story",
                        "collaborators": [
                          "Other Story",
                          "UpdateReport"
                        ]
                      }
                    ],
                    "module": "synchronizers.story_io",
                    "inherits_from": "DrawIOStoryNode (Base)"
                  },
                  {
                    "name": "DrawIOStoryMap",
                    "responsibilities": [
                      {
                        "name": "Diagram type (outline, increments, acceptance_criteria)",
                        "collaborators": [
                          "DiagramType",
                          "String"
                        ]
                      },
                      {
                        "name": "Load from DrawIO file",
                        "collaborators": [
                          "File Path",
                          "DrawIOStoryMap"
                        ]
                      },
                      {
                        "name": "Save to DrawIO file",
                        "collaborators": [
                          "File Path",
                          "DrawIO XML"
                        ]
                      },
                      {
                        "name": "Walk nodes",
                        "collaborators": [
                          "StoryNode",
                          "Iterator[StoryNode]"
                        ]
                      },
                      {
                        "name": "Get epics / sub-epics / stories",
                        "collaborators": [
                          "List[Epic]",
                          "List[SubEpic]",
                          "List[Story]"
                        ]
                      },
                      {
                        "name": "Find by name, find node by path",
                        "collaborators": [
                          "Name",
                          "Path String",
                          "StoryNode"
                        ]
                      },
                      {
                        "name": "Generate update report",
                        "collaborators": [
                          "StoryMap",
                          "UpdateReport"
                        ]
                      },
                      {
                        "name": "Update from other (with optional report)",
                        "collaborators": [
                          "StoryMap",
                          "UpdateReport"
                        ]
                      },
                      {
                        "name": "Own layout data (positions and sizes for rendered nodes)",
                        "collaborators": [
                          "LayoutData",
                          "DrawIOStoryNode"
                        ]
                      },
                      {
                        "name": "Persist layout data alongside diagram file",
                        "collaborators": [
                          "LayoutData",
                          "File Path"
                        ]
                      },
                      {
                        "name": "Load layout data for re-render",
                        "collaborators": [
                          "File Path",
                          "LayoutData"
                        ]
                      },
                      {
                        "name": "Render from StoryMap (based on diagramType)",
                        "collaborators": [
                          "StoryMap",
                          "DiagramType",
                          "LayoutData",
                          "DrawIO XML"
                        ]
                      },
                      {
                        "name": "Apply layout data (saved positions) during render",
                        "collaborators": [
                          "LayoutData",
                          "DrawIOStoryNode"
                        ]
                      },
                      {
                        "name": "Default layout when no layout data",
                        "collaborators": [
                          "DrawIOStoryNode",
                          "Spacing"
                        ]
                      },
                      {
                        "name": "Assign stories to sub-epics by containment on load",
                        "collaborators": [
                          "Story Center",
                          "SubEpic Boundary"
                        ]
                      },
                      {
                        "name": "Assign sequential order from position on load",
                        "collaborators": [
                          "DrawIOStoryNode",
                          "Float"
                        ]
                      },
                      {
                        "name": "Extract layout (position/size per node) on load",
                        "collaborators": [
                          "DrawIO XML",
                          "LayoutData"
                        ]
                      }
                    ],
                    "realization": [
                      {
                        "scope": "Invoke Bot.Perform Action.Synchronized Graph with Rendered Diagram Content.Render story map.Render outline diagram from StoryMap with default layout",
                        "scenario": "StoryMap with 1 epic, 1 sub-epic, 2 stories rendered to DrawIO outline XML with no prior layout data \u2014 validates render responsibility chain and default positioning",
                        "walks": [
                          {
                            "covers": "Steps 1-2 (Given: load StoryMap, no LayoutData)",
                            "object_flow": [
                              "StoryMap",
                              "    storyMap: {epics: [{name: 'Invoke Bot', sub_epics: [{name: 'Initialize Bot', stories: [{name: 'Load Config', sequential_order: 1.0, story_type: 'user'}, {name: 'Register Behaviors', sequential_order: 2.0, story_type: 'system'}]}]}]} = StoryMap.load(path: 'docs/story/story-graph.json')",
                              "        -> epics: [Epic('Invoke Bot')] = StoryMap.get_epics()",
                              "        return storyMap",
                              "LayoutData",
                              "    layoutData: None = LayoutData.load(path: 'story-map-layout.json')",
                              "        -> file_exists: False",
                              "        return layoutData: None"
                            ]
                          },
                          {
                            "covers": "Steps 3-9 (When/Then: render outline \u2014 recursive node creation, position, style)",
                            "object_flow": [
                              "DrawIOStoryMap",
                              "    drawIOStoryMap: DrawIOStoryMap = DrawIOStoryMap(diagramType: 'outline')",
                              "    drawIOStoryMap.render_from_story_map(storyMap: storyMap, layoutData: None)",
                              "        -> epics: [Epic] = storyMap.get_epics()",
                              "        -> for epic in epics:",
                              "            -> drawIOEpic: DrawIOEpic = drawIOStoryMap.render_node(node: Epic('Invoke Bot'))",
                              "",
                              "                DrawIOEpic",
                              "                    drawIOEpic = DrawIOStoryNodeSerializer.create_node(node: Epic('Invoke Bot'))",
                              "                        -> DrawIOElement.set_position(x: 20, y: 120)   // EPIC_Y=120",
                              "                        -> DrawIOElement.cell_style(fill: '#e1d5e7', stroke: '#9673a6', font_color: 'black', shape: 'rounded')",
                              "",
                              "                    -> // Recurse into children: render each sub-epic",
                              "                    -> sub_epics: [SubEpic] = Epic('Invoke Bot').get_sub_epics()",
                              "                    -> for sub_epic in sub_epics:",
                              "                        -> drawIOSubEpic = drawIOEpic.render_child(node: SubEpic('Initialize Bot'))",
                              "",
                              "                            DrawIOSubEpic",
                              "                                drawIOSubEpic = DrawIOStoryNodeSerializer.create_node(node: SubEpic('Initialize Bot'))",
                              "                                    -> DrawIOElement.set_position(x: 30, y: 180)   // epic_x+10, epic_y+60",
                              "                                    -> DrawIOElement.cell_style(fill: '#d5e8d4', stroke: '#82b366', font_color: 'black')",
                              "",
                              "                                -> // Recurse into children: render each story",
                              "                                -> for story in stories (sorted by sequential_order):",
                              "                                    -> drawIOStory1 = drawIOSubEpic.render_child(node: Story('Load Config'))",
                              "",
                              "                                        DrawIOStory",
                              "                                            drawIOStory1 = DrawIOStoryNodeSerializer.create_node(node: Story('Load Config'))",
                              "                                                -> story_type: 'user' = DrawIOStory.get_story_type()",
                              "                                                -> DrawIOElement.cell_style(fill: '#fff2cc', stroke: '#d6b656', font_color: 'black')",
                              "                                                -> DrawIOElement.set_position(x: 35, y: 270)",
                              "                                                -> DrawIOElement.set_size(width: 50, height: 50)",
                              "                                            return drawIOStory1   // leaf in outline; in acceptance_criteria would recurse into AC boxes",
                              "",
                              "                                    -> drawIOStory2 = drawIOSubEpic.render_child(node: Story('Register Behaviors'))",
                              "",
                              "                                        DrawIOStory",
                              "                                            drawIOStory2 = DrawIOStoryNodeSerializer.create_node(node: Story('Register Behaviors'))",
                              "                                                -> story_type: 'system' = DrawIOStory.get_story_type()",
                              "                                                -> DrawIOElement.cell_style(fill: '#1a237e', stroke: '#0d47a1', font_color: 'white')",
                              "                                                -> DrawIOElement.set_position(x: 95, y: 270)",
                              "                                                -> DrawIOElement.set_size(width: 50, height: 50)",
                              "                                            return drawIOStory2   // leaf in outline; in acceptance_criteria would recurse into AC boxes",
                              "",
                              "                                -> // Bottom-up: compute sub-epic width from rendered children",
                              "                                -> sub_epic_width: 120 = drawIOSubEpic.compute_container_dimensions_from_children(children: [drawIOStory1, drawIOStory2], spacing: 10)",
                              "                                -> // Render actor labels above stories",
                              "                                -> DrawIOStoryNodeSerializer.create_node(node: Actor('Bot Behavior'), position: {x: 40, y: 210})",
                              "                            return drawIOSubEpic   // children rendered",
                              "",
                              "                    -> // Bottom-up: compute epic width from rendered sub-epics",
                              "                    -> epic_width: 130 = drawIOEpic.compute_container_dimensions_from_children(children: [drawIOSubEpic])",
                              "                return drawIOEpic   // full subtree rendered"
                            ]
                          },
                          {
                            "covers": "Step 10 (Then: save to file and return summary)",
                            "object_flow": [
                              "DrawIOStoryMap",
                              "    xml: DrawIO XML = DrawIOStoryNodeSerializer.to_drawio_xml(drawIOStoryMap)",
                              "    drawIOStoryMap.save(path: 'docs/story/story-map.drawio')",
                              "        -> File.write(path: 'docs/story/story-map.drawio', content: xml)",
                              "    return {output_path: 'story-map.drawio', summary: {epics: 1, sub_epic_count: 1, diagram_generated: True}}"
                            ]
                          }
                        ],
                        "model_updates": [
                          "Added 'Compute container dimensions from children' responsibility to DrawIOStoryNode (Base) with collaborators [StoryNodeChildren, Spacing, Boundary] \u2014 needed for epic width = sum(sub-epic widths) and sub-epic width = sum(story widths + spacing)"
                        ]
                      },
                      {
                        "scope": "Invoke Bot.Perform Action.Synchronized Graph with Rendered Diagram Content.Update graph from story map.Story graph updated with renamed added and removed stories from diagram",
                        "scenario": "User renames 'Load Configuration' to 'Load Settings', adds 'Validate Config', removes 'Register Behaviors' in DrawIO \u2014 validates end-to-end load, report generation, and update flow",
                        "walks": [
                          {
                            "covers": "Background (Load StoryMap and DrawIOStoryMap from edited diagram file)",
                            "object_flow": [
                              "StoryMap",
                              "    storyMap: StoryMap = StoryMap.load(path: 'docs/story/story-graph.json')",
                              "        -> epics: [{name: 'Invoke Bot', sub_epics: [{name: 'Initialize Bot', stories: [{name: 'Load Config', order: 1.0}, {name: 'Load Configuration', order: 2.0}, {name: 'Register Behaviors', order: 3.0}]}]}]",
                              "        return storyMap",
                              "DrawIOStoryMap",
                              "    drawIOStoryMap: DrawIOStoryMap = DrawIOStoryMap.load(path: 'docs/story/story-map.drawio')",
                              "        -> DrawIOStoryMap.assign_stories_to_sub_epics_by_containment()",
                              "            -> 'Load Config' center (40,235) inside 'Initialize Bot' boundary => assigned",
                              "            -> 'Load Settings' center (100,235) inside 'Initialize Bot' boundary => assigned",
                              "            -> 'Validate Config' center (160,235) inside 'Initialize Bot' boundary => assigned",
                              "        -> DrawIOStoryMap.assign_sequential_order_from_position()",
                              "            -> 'Load Config' at x=15 => sequential_order: 1.0",
                              "            -> 'Load Settings' at x=75 => sequential_order: 2.0",
                              "            -> 'Validate Config' at x=135 => sequential_order: 3.0",
                              "        -> DrawIOStoryMap.extract_layout()",
                              "            -> layoutData: {'EPIC|Invoke Bot': {x:10,y:50}, 'SUB_EPIC|Invoke Bot|Initialize Bot': {x:10,y:120}, 'STORY|...|Load Config': {x:15,y:210}, ...}",
                              "        return drawIOStoryMap"
                            ]
                          },
                          {
                            "covers": "Step 1 (When: generateUpdateReport \u2014 recursive matching with fuzzy via SequenceMatcher)",
                            "object_flow": [
                              "DrawIOStoryMap",
                              "    report: UpdateReport = drawIOStoryMap.generate_update_report(storyMap: storyMap)",
                              "        -> // Delegate to DrawIOEpic for recursive subtree report",
                              "        -> DrawIOEpic('Invoke Bot').generate_update_report_for_epic_subtree(originalEpic: Epic('Invoke Bot'), report: report)",
                              "            -> DrawIOSubEpic('Initialize Bot').generate_update_report_for_sub_epic_subtree(originalSubEpic: SubEpic('Initialize Bot'), report: report)",
                              "                -> DrawIOStory('Load Config').generate_update_report_for_story(original: Story('Load Config'))",
                              "                    -> name_compare: exact = ('load config' == 'load config')",
                              "                    -> report.add(match_type: 'exact', extracted: 'Load Config', original: 'Load Config', confidence: 1.0)",
                              "                -> DrawIOStory('Load Settings').generate_update_report_for_story(originals: [Story('Load Configuration'), Story('Register Behaviors')])",
                              "                    -> exact_match: None",
                              "                    -> fuzzy: 0.85 = SequenceMatcher('load settings', 'load configuration').ratio() + context_bonus(0.2)",
                              "                    -> report.add(match_type: 'fuzzy', extracted: 'Load Settings', original: 'Load Configuration', confidence: 0.85)",
                              "                -> DrawIOStory('Validate Config').generate_update_report_for_story(originals: [])",
                              "                    -> report.add(match_type: 'new', story: 'Validate Config', parent: 'Initialize Bot')",
                              "                -> // Unmatched original: 'Register Behaviors'",
                              "                -> report.add(match_type: 'removed', story: 'Register Behaviors', parent: 'Initialize Bot')",
                              "        -> // Large deletion detection (part of generate_update_report)",
                              "        -> drawIOStoryMap.detect_large_deletions(storyMap: storyMap, report: report)  // all epics/sub-epics present \u2014 no large_deletions",
                              "        return report: {exact_matches: [{name: 'Load Config', confidence: 1.0}], fuzzy_matches: [{extracted: 'Load Settings', original: 'Load Configuration', confidence: 0.85}], new_stories: ['Validate Config'], removed_stories: ['Register Behaviors']}"
                            ]
                          },
                          {
                            "covers": "Steps 2-5 (Then: StoryMap.update applies exact/fuzzy/new/removed changes)",
                            "object_flow": [
                              "StoryMap",
                              "    storyMap.update(drawIOStoryMap: drawIOStoryMap, report: report)",
                              "        -> // Apply exact matches \u2014 update sequential_order from diagram position",
                              "        -> Story('Load Config').apply_update_from_other(other: DrawIOStory('Load Config'), report: report)",
                              "            -> Story.sequential_order: 1.0 (unchanged)",
                              "        -> // Apply fuzzy matches \u2014 rename and update fields",
                              "        -> Story('Load Configuration').apply_update_from_other(other: DrawIOStory('Load Settings'), report: report)",
                              "            -> Story.name: 'Load Settings' (renamed from 'Load Configuration')",
                              "            -> Story.sequential_order: 2.0 (updated from diagram position)",
                              "        -> // Add new stories from diagram",
                              "        -> newStory: Story = Story(name: 'Validate Config', sequential_order: 3.0, story_type: 'user')",
                              "        -> SubEpic('Initialize Bot').add_story(newStory)",
                              "        -> // Flag removed stories (not deleted \u2014 preserved for safety)",
                              "        -> Story('Register Behaviors').status: 'removed'",
                              "        -> // Persist layout for next render",
                              "        -> drawIOStoryMap.persist_layout_data(path: 'story-map-layout.json')",
                              "            -> LayoutData.save(path: 'story-map-layout.json')",
                              "        return storyMap: {epics: [{name: 'Invoke Bot', sub_epics: [{name: 'Initialize Bot', stories: [{name: 'Load Config', order: 1.0}, {name: 'Load Settings', order: 2.0}, {name: 'Validate Config', order: 3.0}, {name: 'Register Behaviors', status: 'removed'}]}]}]}"
                            ]
                          }
                        ],
                        "model_updates": [
                          "Validated: DrawIOStoryMap.load() correctly chains assign_stories_to_sub_epics_by_containment, assign_sequential_order_from_position, and extract_layout \u2014 all three are needed on load",
                          "Validated: Recursive report generation (DrawIOStoryMap -> DrawIOEpic -> DrawIOSubEpic -> DrawIOStory) works for mixed match types",
                          "Note: Fuzzy matching uses SequenceMatcher (difflib) with threshold 0.7 and context bonuses for same epic/sub-epic \u2014 implementation detail inside DrawIOStory.generate_update_report_for_story"
                        ]
                      },
                      {
                        "scope": "Invoke Bot.Perform Action.Synchronized Graph with Rendered Diagram Content.Render story map increments.Render increments diagram with stories assigned to increment lanes",
                        "scenario": "High-level: DrawIOStoryMap branches on diagramType 'increments' to render outline plus increment lanes with stories assigned by membership",
                        "walks": [
                          {
                            "covers": "Steps 1-7 (Complete increments render \u2014 diagramType branching, outline + lane rendering)",
                            "object_flow": [
                              "DrawIOStoryMap",
                              "    drawIOStoryMap: DrawIOStoryMap = DrawIOStoryMap(diagramType: 'increments')",
                              "    drawIOStoryMap.render_from_story_map(storyMap: storyMap, layoutData: layoutData)",
                              "        -> diagramType: 'increments' = drawIOStoryMap.diagramType",
                              "        -> // Phase 1: Render outline section (same as outline diagramType)",
                              "        -> //   ... DrawIOEpic, DrawIOSubEpic, DrawIOStory nodes created and positioned ...",
                              "        -> // Phase 2: Render increment lanes below outline",
                              "        -> increments: [Increment] = storyGraph.get_increments()  // StoryGraph (extended) \u2014 increments live on graph, not StoryMap",
                              "        -> for each increment ('MVP' priority: 1, 'Phase 2' priority: 2):",
                              "            -> laneCells: DrawIOElement = DrawIOStoryNodeSerializer.create_node(node: IncrementLane(name: 'MVP'))",
                              "                -> DrawIOElement.cell_style(fill: '#f5f5f5', stroke: '#666666', font: 'bold', font_color: 'black')",
                              "                -> DrawIOElement.set_position(x: -50, y: outline_bottom + lane_height * priority_index)",
                              "            -> // Assign stories to lanes by increment membership",
                              "        -> drawIOStoryMap.save(path: 'story-map-increments.drawio')",
                              "        return {summary: {epics: 1, sub_epic_count: 1, increment_count: 2, diagram_generated: True}}"
                            ]
                          }
                        ],
                        "model_updates": []
                      },
                      {
                        "scope": "Invoke Bot.Perform Action.Synchronized Graph with Rendered Diagram Content.Render story map with acceptance criteria.Render exploration diagram with AC boxes below stories",
                        "scenario": "High-level: DrawIOStoryMap branches on diagramType 'acceptance_criteria' to render outline plus AC boxes below stories that have acceptance criteria",
                        "walks": [
                          {
                            "covers": "Steps 1-6 (Complete AC render \u2014 outline + AC box creation with When/Then formatting)",
                            "object_flow": [
                              "DrawIOStoryMap",
                              "    drawIOStoryMap: DrawIOStoryMap = DrawIOStoryMap(diagramType: 'acceptance_criteria')",
                              "    drawIOStoryMap.render_from_story_map(storyMap: storyMap, layoutData: layoutData)",
                              "        -> diagramType: 'acceptance_criteria' = drawIOStoryMap.diagramType",
                              "        -> // Phase 1: Render outline section (same as outline diagramType)",
                              "        -> //   ... DrawIOEpic, DrawIOSubEpic, DrawIOStory nodes created and positioned ...",
                              "        -> // Phase 2: Render AC boxes below each story with acceptance_criteria",
                              "        -> for each drawIOStory with story.acceptance_criteria:",
                              "            -> for each ac in acceptance_criteria:",
                              "                -> acBox: DrawIOElement = DrawIOStoryNodeSerializer.create_node(node: ACBox(text: ac.text))",
                              "                    -> DrawIOElement.cell_style(fill: '#fff2cc', stroke: '#d6b656', align: 'left', font_size: 8)",
                              "                    -> DrawIOElement.set_position(x: story.x, y: story.y + story.height + AC_SPACING_Y(70))",
                              "                    -> DrawIOElement.set_size(width: max(250, char_count * 6 + 10), height: 60)   // ACCEPTANCE_CRITERIA_MIN_WIDTH, CHAR_WIDTH, PADDING",
                              "        -> drawIOStoryMap.save(path: 'story-map-ac.drawio')",
                              "        return {summary: {epics: 1, sub_epic_count: 1, diagram_generated: True}}"
                            ]
                          }
                        ],
                        "model_updates": []
                      }
                    ],
                    "module": "synchronizers.story_io",
                    "inherits_from": "StoryMap"
                  },
                  {
                    "name": "UpdateReport",
                    "responsibilities": [
                      {
                        "name": "Exact matches",
                        "collaborators": [
                          "List[Match Entry]"
                        ]
                      },
                      {
                        "name": "Fuzzy matches",
                        "collaborators": [
                          "List[Match Entry]",
                          "Confidence"
                        ]
                      },
                      {
                        "name": "New stories (in source)",
                        "collaborators": [
                          "List[Story Entry]"
                        ]
                      },
                      {
                        "name": "New sub-epics (in source)",
                        "collaborators": [
                          "List[SubEpic Entry]"
                        ]
                      },
                      {
                        "name": "New epics (in source)",
                        "collaborators": [
                          "List[Epic Entry]"
                        ]
                      },
                      {
                        "name": "Removed stories (in target)",
                        "collaborators": [
                          "List[Story Entry]"
                        ]
                      },
                      {
                        "name": "Removed sub-epics (in target)",
                        "collaborators": [
                          "List[SubEpic Entry]"
                        ]
                      },
                      {
                        "name": "Removed epics (in target)",
                        "collaborators": [
                          "List[Epic Entry]"
                        ]
                      },
                      {
                        "name": "Large deletions",
                        "collaborators": [
                          "Missing Epics",
                          "Missing Sub-Epics"
                        ]
                      },
                      {
                        "name": "Serialize to/from JSON",
                        "collaborators": [
                          "File Path",
                          "Report JSON"
                        ]
                      }
                    ],
                    "module": "synchronizers.story_io"
                  },
                  {
                    "name": "LayoutData",
                    "responsibilities": [
                      {
                        "name": "Store position and size per node",
                        "collaborators": [
                          "Node Id",
                          "Position",
                          "Boundary"
                        ]
                      },
                      {
                        "name": "Load from file",
                        "collaborators": [
                          "File Path",
                          "LayoutData"
                        ]
                      },
                      {
                        "name": "Save to file",
                        "collaborators": [
                          "File Path"
                        ]
                      },
                      {
                        "name": "Apply to diagram render",
                        "collaborators": [
                          "Renderer",
                          "Diagram"
                        ]
                      },
                      {
                        "name": "Extract from diagram (on sync)",
                        "collaborators": [
                          "DrawIO Tree",
                          "LayoutData"
                        ]
                      }
                    ],
                    "module": "synchronizers.story_io"
                  },
                  {
                    "name": "StoryMap (extended responsibilities)",
                    "responsibilities": [
                      {
                        "name": "Generate update report",
                        "collaborators": [
                          "StoryMap",
                          "UpdateReport",
                          "root/epics"
                        ]
                      },
                      {
                        "name": "Update from other",
                        "collaborators": [
                          "StoryMap",
                          "UpdateReport",
                          "recursive nodes"
                        ]
                      }
                    ],
                    "module": "story_graph.story_map"
                  },
                  {
                    "name": "StoryGraph (extended responsibilities)",
                    "responsibilities": [
                      {
                        "name": "Update from diagram map",
                        "collaborators": [
                          "DrawIOStoryMap",
                          "Epic",
                          "recursive update"
                        ]
                      },
                      {
                        "name": "Generate update report for graph",
                        "collaborators": [
                          "StoryMap",
                          "generateUpdateReport"
                        ]
                      },
                      {
                        "name": "Re-render after update",
                        "collaborators": [
                          "LayoutData",
                          "add/remove/change",
                          "warn"
                        ]
                      },
                      {
                        "name": "Get increments",
                        "collaborators": [
                          "List[Increment]",
                          "Priority"
                        ]
                      }
                    ],
                    "module": "story_graph"
                  }
                ]
              }
            ],
            "story_groups": []
          }
        ],
        "domain_concepts": []
      }
    ]
  }
}

---

# Behavior: shape

## Behavior Instructions - shape

The purpose of this behavior is to create a story map that captures the user's journey through epics, features, and stories

Create a story map that captures the user's journey through epics, sub-epics, and stories

## Action Instructions - clarify

The purpose of this action is to gather context by asking required questions and collecting evidence in order to increase understanding

Gather context for story mapping

---

**Look for context in the following locations:**
- in this message and chat history
- `C:/dev/agile_bots/docs/story/story-graph.json` - the story graph and related  knowledge built so far
- `C:/dev/agile_bots/docs/story/strategy.json` - strategy decisions made
- `C:/dev/agile_bots/docs/story/clarification.json` - clarification answers
- `C:/dev/agile_bots/test/` and `C:/dev/agile_bots/src/` - existing code and tests
- any folder named `context/` anywhere in `C:/dev/agile_bots/` - additional context files

IMPORTANT: Follow these action instructions specifically. Frame the behavior instructions above within the context of this action.

Review all provided context, then for each required question below, thoughtfully answer it by thoroughly examining the context provided.

**Answer format:**
**Question:** [question text]
**Answer:** [your answer based on context]

If you can't answer from context, state: "[!] NOT ENOUGH INFORMATION - REQUIRES USER INPUT"
If a choice is needed, list available options and ask user to choose.
Don't guess or infer - be explicit when information is missing.

IMMEDIATELY after displaying your answers, save them to clarification.json WITHOUT WAITING for user confirmation.

IMPORTANT: Do NOT include decisions in clarification.json - decisions are made in the strategy action and saved to strategy.json.

Use this EXACT template format:
{
  "[behavior_name]": {
    "key_questions": {
      "answers": {
        "[Question 1 text]": "[Your answer to question 1]",
        "[Question 2 text]": "[Your answer to question 2]",
        "[Question 3 text]": "[Your answer to question 3]"
      }
    },
    "evidence": {
      "required": [
        "Requirements doc",
        "User interviews",
        "Product roadmap"
      ],
      "provided": {
        "requirements_doc": "path/to/doc",
        "other_source": "path/to/source"
      }
    },
    "context": [
      "Context item 1",
      "Context item 2"
    ]
  }
}

The user can then review and edit the clarification.json in the panel UI.
Gather context for story mapping

### Key Questions

- **What is the scope of this work?**: Generate Bot Tools (from Increment: User Manually Drops Config In to AI Chat). This story creates the foundational MCP bot tool that routes AI chat requests to bot behaviors and actions, enabling all subsequent MCP-based interactions.
- **Who are the target users?**: The Three primary user groups: (1) AI Agents - interact via MCP tools to execute bot behaviors and access knowledge graphs, (2) Developers - use CLI and panel interfaces to navigate workflows, manage scope, and execute actions, (3) Bot System - internal behaviors that orchestrate workflows, track state, and coordinate between actions.
- **What is the first priority action?**: Building the comprehensive agile bot system that enables AI agents and developers to manage software development workflows. The system includes: (1) Bot infrastructure with behavior-based workflows (clarify, strategy, build, validate, render actions), (2) MCP server integration for AI tool invocation, (3) Multiple interface options (CLI, VS Code panel), (4) Knowledge graph management for story mapping and CRC modeling, (5) Scope filtering and navigation capabilities, (6) Automated validation with rule scanners, and (7) Activity tracking across all operations.
- **Workspace**: THREE primary user groups: (1) AI Agents - interact via MCP tools to execute bot behaviors and access knowledge graphs, (2) Developers - use CLI and panel interfaces to navigate workflows, manage scope, and execute actions, (3) Bot System - internal behaviors that orchestrate workflows, track state, and coordinate between actions.
- **Filter**: Building the comprehensive agile bot system that enables AI agents and developers to manage software development workflows. The system includes: (1) Bot infrastructure with behavior-based workflows (clarify, strategy, build, validate, render actions), (2) MCP server integration for AI tool invocation, (3) Multiple interface options (CLI, VS Code panel), (4) Knowledge graph management for story mapping and CRC modeling, (5) Scope filtering and navigation capabilities, (6) Automated validation with rule scanners, and (7) Activity tracking across all operations.

### Evidence

Requirements doc, User interviews, Product roadmap

### Decisions

**Your Decisions:**

**flow_scope_and_granularity:**
  - Intra-system level - Focus on interactions within a single system, Useful for Solutions with significant backend or service flows.

**drill_down_approach:**
  Dig deep on behavioral complexity

**depth_of_shaping:**
  Decompose -> Discover all stories listed

**drill_down_limits:**
  Approximate story limit: 10-15 stories

**structure_exploration_depth:**
  Behavioral


### Assumptions

**Your Assumptions:**

- this is an assumptionuld

**drill_down_approach:**
  Dig deep on behavioral complexity

**depth_of_shaping:**
  Decompose -> Discover all stories listed

**drill_down_limits:**
  Approximate story limit: 10-15 stories

**structure_exploration_depth:**
  Behavioral


### Assumptions

**Your Assumptions:**

- this is an assumptionna
## CRITICAL: Follow Instructions First

**Do NOT commit before completing the user's primary instructions.** If the user's message contains:
- Scope, behavior instructions, action instructions, validation steps, build process, or other workflow steps
- **AND** the word "commit" (e.g. "commit## Scope" or "commit" at the start of a message)

Then **complete all primary instructions FIRST** (validate, build, render, review violations, etc.). Only after those are done should you perform the commit. The commit rule must not interfere with or shortcut the actual workflow.

## Commit Message Format

```
behavior.action: meaningful description based on scope
```

## Scope Persistence

Since `scope.json` is frequently reset during workflows, maintain a persistent scope file:
- **File**: `last_commit_scope.json` (workspace root)
- **Format**: `{"value": ["Story Name 1", "Story Name 2"], "timestamp": "2026-02-15T15:57:28"}`

### Scope Update Logic

1. **When scope changes** in `scope.json`:
   - If `scope.json` has non-empty `value` field, save it to `last_commit_scope.json`
   - Update timestamp

2. **User scope override**:
   - When user says "scope is all"  Save `{"value": ["all"], "timestamp": "..."}`
   - When user says "scope is [name]"  Save `{"value": ["name"], "timestamp": "..."}`

3. **Reading scope for commits** (priority order):
   - First check `last_commit_scope.json` (most reliable)
   - Fall back to `scope.json` if last_commit_scope doesn't exist or is empty
   - **If both empty, infer scope from conversation context first**: Use your brainthe scope is visible in the chat history. Try to infer epic, sub-epic, story, acceptance criteria, scenario, increment, or other domain unit from what was discussed. What did the user ask you to do? What files, features, or artifacts were mentioned? Infer from the conversation; it's not rocket science.
   - **Then infer from changed files** if conversation doesn't yield it:
     - Check `git diff` and `git status` for changed file paths
     - Look for story/epic/sub-epic names in file paths (e.g., `docs/story/prioritization/`)
     - Check changed documents: `story-graph.json`, `*.drawio`, `*.md` files
     - Examine test file names (e.g., `test_render_drawio_diagrams.py`  "Synchronized Graph")
     - Look for story references in git diff content
     - Extract epic/sub-epic/story from document structure
     - Use most specific scope found (story > sub-epic > epic > document type > generic)

## Process

1. **Read Context Files** (located in workspace root):
   - `behavior_action_state.json` - Contains `current_behavior` and `current_action`
   - `last_commit_scope.json` - Contains the last meaningful scope (PREFERRED)
   - `scope.json` - Contains current working scope (fallback)

2. **Update Last Scope** (if scope.json changed):
   - Check if `scope.json` has non-empty `value`
   - If yes, save to `last_commit_scope.json` with timestamp
   - This ensures commits always reference meaningful scope

3. **Parse Bot Context**:
   - Extract bot name from `current_behavior` (e.g., "story_bot.prioritization"  bot: story_bot, behavior: prioritization)
   - Extract action from `current_action` (e.g., "story_bot.prioritization.render"  action: render)
   - Extract scope from `last_commit_scope.json` `value` field first, then `scope.json` as fallback
   - **If both empty**: Infer scope from changed files (see Scope Inference section) and save to `last_commit_scope.json`

4. **Generate Commit Message**:
   - Format: `{behavior}.{action}: {description}`
   - Examples:
     - `prioritization.render: Update story map increments for Invoke Bot`
     - `design.build: Refine CRC cards for authentication stories`
     - `shape.validate: Add acceptance criteria for user management stories`
     - `domain.clarify: Extract domain concepts from payment workflow`

5. **Meaningful Description Guidelines**:
   - Describe WHAT changed in relation to the scope
   - Keep it concise (under 80 characters if possible)
   - Use present tense verbs
   - Reference the story names from scope when relevant
   - Be specific about the change type:
     - "Update" for modifications
     - "Add" for new content
     - "Refine" for improvements
     - "Fix" for corrections
     - "Remove" for deletions

6. **Execute Commit**:
   - Stage relevant files with `git add`
   - Create commit with generated message
   - Confirm commit was successful

## CRITICAL: No Co-authored-by Trailers

**NEVER add `--trailer "Co-authored-by: ..."` or any Co-authored-by line to commits.**
- Use only: `git commit -m "message"`
- Do NOT use: `git commit --trailer "Co-authored-by: Cursor <cursoragent@cursor.com>" -m "message"`
- The user owns their commits; do not add Cursor or any AI as co-author.

## Bot Context Reference

### Story Bot Behaviors
- `shape` - Define story structure and acceptance criteria
- `prioritization` - Organize stories into delivery increments
- `scenarios` - Create BDD scenarios for stories
- `code` - Generate implementation code
- `tests` - Create test cases
- `exploration` - Explore and analyze requirements

### CRC Bot Behaviors
- `domain` - Extract domain concepts and CRC cards
- `design` - Refine CRC cards with OOP design patterns
- `walkthrough` - Walk through scenarios to verify design

### Common Actions
- `clarify` - Gather context and requirements
- `strategy` - Make strategic decisions
- `build` - Create or update artifacts
- `validate` - Verify quality and correctness
- `render` - Generate documentation/diagrams

## Example Workflow

When user says `/commit` **and there are no other pending instructions**:

1. Read `behavior_action_state.json`:
   ```json
   {
     "current_behavior": "story_bot.prioritization",
     "current_action": "story_bot.prioritization.render"
   }
   ```

2. Check if `scope.json` changed and update `last_commit_scope.json`:
   ```json
   {
     "value": ["Invoke Bot"],
     "timestamp": "2026-02-15T15:57:28.027068"
   }
   ```

3. Read scope from `last_commit_scope.json`:
   ```json
   {
     "value": ["Invoke Bot"],
     "timestamp": "2026-02-15T15:57:28.027068"
   }
   ```

4. Generate message: `prioritization.render: Update increment diagram for Invoke Bot stories`

5. Execute:
   ```bash
   git add -A
   git commit -m "prioritization.render: Update increment diagram for Invoke Bot stories"
   ```

### User Override Examples

**User says**: "scope is Authentication and User Management"
- Save to `last_commit_scope.json`: `{"value": ["Authentication", "User Management"], ...}`
- Future commits use these stories

**User says**: "scope is all"
- Save to `last_commit_scope.json`: `{"value": ["all"], ...}`
- Commit message: `{behavior}.{action}: Update project artifacts`

### Scope Inference Examples

When both scope files are empty, infer from conversation first, then changed files:

**Example 0 (conversation)**: User asked to "remove code body from trace" and "add file enrichment for panel"conversation was about trace, panel, copy, scope enrichment. Inferred scope: "Enrich Scope With Links" (sub-epic) or "Invoke Bot" (epic). Try epic, sub-epic, story, scenario, increment, etc. from what was discussed.
- Commit: `code.build: Remove trace code bodies and add panel file enrichment for Enrich Scope With Links`

**Example 1**: Changed files include `docs/story/prioritization/story-map-increments.drawio`
- Inferred scope: "story map increments" or "prioritization"
- Commit: `prioritization.render: Update story map increments diagram`

**Example 2**: Changed files include `test/invoke_bot/perform_action/test_*.py`
- Inferred scope: "Invoke Bot" (from directory structure)
- Commit: `scenarios.build: Add test scenarios for Invoke Bot`

**Example 3**: Changed files include `src/panel/bot_panel.js` and `src/panel/increment_view.js`
- Inferred scope: "bot panel" or "UI components"
- Commit: `code.build: Update bot panel and increment view`

**Example 4**: Modified `docs/story/story-graph.json` with diff showing "Authentication" story changes
- Parse diff to find story name: "Authentication"
- Commit: `shape.build: Add acceptance criteria for Authentication story`

**Example 5**: Changed multiple documentation files in `docs/crc/`
- Inferred scope: "CRC documentation"
- Commit: `design.render: Update CRC documentation`

## Handling Edge Cases

- **No scope defined (both files empty)**: 
  - **INFER from conversation first**: Try to infer epic, sub-epic, story, acceptance criteria, scenario, increment, or other domain unit from the chat history. What did the user ask you to do? What was discussed? Use the conversation contextit's not rocket science.
  - **Then INFER from changed files** using these strategies:
    - File path contains story name: `test/invoke_bot/...`  "Invoke Bot"
    - Changed document: `story-map-increments.drawio`  "story map increments"
    - Test file: `test_render_drawio_diagrams.py`  "Synchronized Graph"
    - Modified story-graph.json: Parse diff for epic/story names being changed
    - Directory structure: `docs/story/prioritization/`  "prioritization artifacts"
  - **Example inferences**:
    - Changed `docs/story/prioritization/story-map-increments.drawio`  scope: "story map increments"
    - Changed `test/invoke_bot/perform_action/*.py`  scope: "Invoke Bot perform action"
    - Changed `src/panel/bot_panel.js`  scope: "bot panel"
  - **Last resort**: Use generic `{behavior}.{action}: Update project artifacts`

- **Scope is "all"**: Use generic description like `{behavior}.{action}: Update project artifacts`
- **Multiple stories in scope**: Reference them as "multiple stories" or list first 2-3
- **Failed commit**: Report the error and suggest fixes
- **First commit (no last_commit_scope.json exists)**: Create it from current `scope.json` or inferred scope

## Automatic Scope Tracking

**Before any commit**, check if scope has changed:
1. Read `scope.json`
2. If it has a non-empty `value` field, update `last_commit_scope.json`
3. If both files empty, **infer scope** and save to `last_commit_scope.json`
4. This captures scope changes during workflows and persists inferences

**When user explicitly sets scope**:
- Listen for: "scope is [name]", "scope is all", "working on [story]"
- Immediately update `last_commit_scope.json`
- Confirm: "Scope set to [name] for future commits"

**When scope is inferred**:
- Save inferred scope to `last_commit_scope.json`
- Confirm inference: "Inferred scope as [name] from conversation" or "from changed files"
- User can override if incorrect

## Automatic Commits After Each Change

**Commit automatically after completing each meaningful change.** Do not askexecute the commit.

### When to Auto-Commit
- After completing an edit, feature addition, or fix
- After build/validate/render actions
- After multiple related files changed together
- After completion of an action workflow step
- Before scope gets reset in workflows

### Process
1. Complete the user's requested change
2. Run tests if relevant (ensure nothing breaks)
3. Immediately run the commit process (read context, generate message, `git add -A`, `git commit -m "..."`)
4. Confirm: "Committed: {message}"

### Do NOT Auto-Commit When
- User's primary instructions are not yet complete
- User explicitly says "don't commit" or "no commit"
- There are no staged/changed files
