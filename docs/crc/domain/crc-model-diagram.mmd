classDiagram
    namespace exit_result {
        class ExitResult {
            +get_exit_code()
            +get_exit_message()
            +get_should_cleanup()
        }
        class JSONExitResult {
            +serialize_exit_result_to_json()
            +include_exit_code()
            +include_exit_message()
            +wraps_domain_exit_result()
        }
        class MarkdownExitResult {
            +serialize_exit_result_to_markdown()
            +format_exit_documentation()
            +wraps_domain_exit_result()
        }
        class TTYExitResult {
            +serialize_exit_result_to_tty()
            +format_exit_message()
            +wraps_domain_exit_result()
        }
    }

    namespace help {
        class JSONHelp {
            +serialize_help_to_json()
            +include_help_sections()
            +wraps_domain_help()
        }
        class JSONStatus {
            +serialize_status_to_json()
            +include_progress_path()
            +include_stage_name()
            +include_current_behavior()
            +include_current_action()
            +wraps_domain_status()
        }
        class MarkdownHelp {
            +serialize_help_to_markdown()
            +format_help_sections()
            +wraps_domain_help()
        }
        class MarkdownStatus {
            +serialize_status_to_markdown()
            +format_progress_section()
            +format_workflow_state()
            +wraps_domain_status()
        }
        class Status {
            +get_progress_path()
            +get_stage_name()
            +get_current_behavior_name()
            +get_current_action_name()
            +get_has_current_behavior()
            +get_has_current_action()
        }
        class TTYHelp {
            +serialize_help_to_tty()
            +format_help_sections()
            +wraps_domain_help()
        }
        class TTYStatus {
            +serialize_status_to_tty()
            +format_progress_line()
            +format_hierarchical_status()
            +wraps_domain_status()
        }
    }

    namespace story_graph.acceptance_criteria {
        class AcceptanceCriteria {
            +get_steps()
        }
        class AcceptanceCriteriaView {
            +wraps_acceptance_criteria_json()
            +displays_criteria_name()
            +displays_criteria_icon()
            +displays_steps_as_checklist()
        }
        class JSONAcceptanceCriteria {
            +include_steps()
            +wraps_domain_acceptance_criteria()
        }
        class MarkdownAcceptanceCriteria {
            +format_criteria_as_checklist()
            +format_steps_list()
            +wraps_domain_acceptance_criteria()
        }
        class TTYAcceptanceCriteria {
            +format_steps()
            +format_criteria_list()
            +wraps_domain_acceptance_criteria()
        }
    }

    namespace story_graph.epic {
        class Epic {
            +test_file_property()
            +get_all_stories()
            +get_domain_concepts()
        }
        class EpicView {
            +wraps_epic_json()
            +displays_epic_name()
            +displays_epic_icon()
            +displays_sub_epics()
            +opens_epic_folder()
            +opens_epic_test_file()
        }
        class JSONEpic {
            +include_domain_concepts()
            +wraps_domain_epic()
        }
        class MarkdownEpic {
            +format_domain_concepts_table()
            +wraps_domain_epic()
        }
        class TTYEpic {
            +format_domain_concepts()
            +wraps_domain_epic()
        }
    }

    namespace story_graph.nodes {
        class InlineNameEditor {
            +enables_inline_editing_mode()
            +validates_name_in_real-time()
            +saves_name_on_blur_or_enter()
            +cancels_on_escape()
            +shows_validation_messages()
        }
        class JSONStoryNode {
            +serialize_node_to_json()
            +include_name()
            +include_sequential_order()
            +include_children()
            +add_child()
            +add_child_at_position()
            +delete_child()
            +delete_this_node()
            +delete_with_children()
            +update_name()
            +move_to_parent()
            +move_after_target()
            +move_before_target()
            +reorder_children()
            +automatically_refresh_story_graph()
            +wraps_domain_story_node()
        }
        class MarkdownStoryNode {
            +serialize_node_to_markdown()
            +format_node_header()
            +format_children_list()
            +wraps_domain_story_node()
        }
        class StoryNode (Base) {
            +serializes()
            +get/update_name()
            +get_node_type()
            +get_node_id()
            +get_parent()
            +get_sequential_order()
            +contains_children()
            +delete_self()
            +delete_with_children()
            +get/update_test()
        }
        class StoryNodeChildren {
            +get_children()
            +find_child_by_name()
            +delete_child()
        }
        class StoryNodeNavigator {
            +build_node_id_from_hierarchy_path()
            +get_parent()
            +move_to_parent()
            +move_after()
            +move_before()
            +determineorder()
        }
        class StoryNodeSerializer {
            +file()
            +create_node()
            +load_node()
            +update_node()
            +delete_node()
            +from_json()
            +to_json()
        }
        class StoryNodeView {
            +wraps_story_node_json()
            +toggles_collapsed()
            +add_child_node()
            +add_child_at_position()
            +delete_this_node()
            +delete_with_children()
            +update_node_name()
            +move_to_parent()
            +move_after_target()
            +move_before_target()
            +drag_and_drop()
            +reorder_children()
            +automatically_refresh_story_graph()
        }
        class TTYStoryNode {
            +serialize_node_to_tty()
            +format_name()
            +format_sequential_order()
            +format_children()
            +add_child()
            +add_child_at_position()
            +delete_child()
            +delete_this_node()
            +delete_with_children()
            +update_name()
            +move_to_parent()
            +move_after_target()
            +move_before_target()
            +reorder_children()
            +automatically_refresh_story_graph()
            +wraps_domain_story_node()
        }
    }

    namespace story_graph.scenario {
        class JSONScenario {
            +include_steps()
            +include_test_method()
            +wraps_domain_scenario()
        }
        class MarkdownScenario {
            +format_gherkin_scenario()
            +format_steps_as_given/when/then()
            +wraps_domain_scenario()
        }
        class Scenario {
            +test_method_property()
            +get_test_method()
            +get_default_test_method()
            +get_steps()
        }
        class ScenarioView {
            +wraps_scenario_json()
            +displays_scenario_name()
            +displays_scenario_icon()
            +opens_test_at_scenario()
        }
        class TTYScenario {
            +format_steps()
            +format_test_method()
            +wraps_domain_scenario()
        }
    }

    namespace story_graph.scenario_outline {
        class JSONScenarioOutline {
            +include_steps()
            +include_examples()
            +include_test_method()
            +wraps_domain_scenario_outline()
        }
        class MarkdownScenarioOutline {
            +format_gherkin_scenario_outline()
            +format_steps_as_given/when/then()
            +format_examples_table()
            +wraps_domain_scenario_outline()
        }
        class ScenarioOutline {
            +test_method_property()
            +get_test_method()
            +get_default_test_method()
            +get_examples()
            +get_steps()
        }
        class ScenarioOutlineView {
            +wraps_scenario_outline_json()
            +displays_scenario_outline_name()
            +displays_scenario_outline_icon()
            +displays_examples_table()
            +opens_test_at_scenario_outline()
        }
        class TTYScenarioOutline {
            +format_steps()
            +format_examples()
            +format_test_method()
            +wraps_domain_scenario_outline()
        }
    }

    namespace story_graph.step {
        class JSONStep {
            +include_step_text()
            +wraps_domain_step()
        }
        class MarkdownStep {
            +format_step_as_gherkin()
            +wraps_domain_step()
        }
        class Step {
            +get_text()
        }
        class StepView {
            +wraps_step_json()
            +displays_step_text()
            +displays_step_icon()
        }
        class TTYStep {
            +format_step_text()
            +format_step_keyword()
            +wraps_domain_step()
        }
    }

    namespace story_graph.story {
        class JSONStory {
            +include_users()
            +include_test_metadata()
            +wraps_domain_story()
        }
        class MarkdownStory {
            +format_story_card()
            +format_users_section()
            +wraps_domain_story()
        }
        class Story {
            +test_class_property()
            +get_test_class()
            +get_default_test_class()
            +get_story_type()
            +get_users()
            +get_scenarios()
            +get_scenario_outlines()
            +get_acceptance_criteria()
        }
        class StoryView {
            +wraps_story_json()
            +displays_story_name()
            +displays_story_icon()
            +displays_scenarios()
            +opens_test_at_class()
        }
        class TTYStory {
            +format_users()
            +format_test_metadata()
            +wraps_domain_story()
        }
    }

    namespace story_graph.story_group {
        class StoryGroup
    }

    namespace story_graph.story_map {
        class JSONStoryMap {
            +serialize_story_map_to_json()
            +include_story_graph()
            +include_all_epics()
            +wraps_domain_story_map()
        }
        class MarkdownStoryMap {
            +serialize_story_map_to_markdown()
            +format_epic_hierarchy()
            +format_story_index()
            +wraps_domain_story_map()
        }
        class StoryMap {
            +load_from_bot_directory()
            +load_from_story_graph()
            +walk_nodes()
            +get_all_stories()
            +get_all_scenarios()
            +get_all_domain_concepts()
            +find_by_name()
            +find_node_by_path()
            +get_story_graph_dict()
            +get_epics()
            +save_to_story_graph()
            +reload_from_story_graph()
            +validate_graph_structure()
        }
        class StoryMapView {
            +wraps_story_map_json()
            +renders_story_graph_as_tree_hierarchy()
            +displays_epic_hierarchy()
            +shows_context-appropriate_action_buttons()
            +refreshes_tree_display()
            +searches_stories()
            +opens_story_graph_file()
            +opens_story_map_file()
            +delegates_to_inlinenameeditor()
            +delegates_to_storynodedragdropmanager()
        }
        class StoryNodeDragDropManager {
            +shows_drag_cursor_with_icon()
            +validates_drop_target_compatibility_at_ui_level()
            +shows_no-drop_cursor_for_incompatible_targets()
            +highlights_valid_drop_target()
            +delegates_move_to_storynode_domain_operation()
            +returns_node_to_original_on_invalid_drop()
        }
        class TTYStoryMap {
            +serialize_story_map_to_tty()
            +format_epics_list()
            +format_story_hierarchy()
            +walk_and_format_nodes()
            +wraps_domain_story_map()
        }
    }

    namespace story_graph.story_user {
        class JSONStoryUser {
            +serialize_user_to_json()
            +include_user_name()
            +include_user_list()
            +wraps_domain_story_user()
        }
        class MarkdownStoryUser {
            +serialize_user_to_markdown()
            +format_user_badge()
            +format_user_list()
            +wraps_domain_story_user()
        }
        class StoryUser {
            +get_name()
            +from_string()
            +from_list()
            +to_string()
        }
        class StoryUserView {
            +wraps_story_user_json()
            +displays_user_name()
            +displays_user_icon()
            +filters_stories_by_user()
        }
        class TTYStoryUser {
            +serialize_user_to_tty()
            +format_user_name()
            +format_user_list()
            +wraps_domain_story_user()
        }
    }

    namespace story_graph.sub_epic {
        class SubEpic {
            +test_file_property()
        }
        class SubEpicView {
            +wraps_sub_epic_json()
            +displays_sub_epic_name()
            +displays_sub_epic_icon()
            +displays_nested_sub_epics()
            +displays_stories()
            +opens_sub_epic_folder()
            +opens_sub_epic_test_file()
        }
    }

    namespace story_graph.test {
        class JSONTest {
            +serialize_test_to_json()
            +include_test_file()
            +include_test_class()
            +include_test_method()
            +wraps_domain_test()
        }
        class MarkdownTest {
            +serialize_test_to_markdown()
            +format_test_link()
            +wraps_domain_test()
        }
        class TTYTest {
            +serialize_test_to_tty()
            +format_test_file()
            +format_test_class()
            +format_test_method()
            +wraps_domain_test()
        }
        class Test {
            +get_test_file()
            +get_test_class()
            +get_test_method()
            +get_default_test_class()
            +get_default_test_method()
            +build_from_story_node()
        }
        class TestView {
            +wraps_test_json()
            +displays_test_file()
            +displays_test_class()
            +displays_test_method()
            +opens_test_file()
            +opens_test_at_class()
            +opens_test_at_method()
        }
    }

    
    %% Associations
    StoryNode (Base) --> StoryNodeSerializer : uses
    StoryNode (Base) --> StoryNodeNavigator : uses
    StoryNode (Base) --> StoryNodeChildren : uses
    StoryNode (Base) --> Test : uses
    StoryMap --> StoryMap : uses
    TTYStoryMap --> StoryMap : uses
    JSONStoryMap --> StoryMap : uses
    MarkdownStoryMap --> StoryMap : uses
    StoryMapView --> EpicView : uses
    StoryMapView --> InlineNameEditor : uses
    StoryMapView --> StoryNodeDragDropManager : uses
    TTYEpic --> Epic : uses
    JSONEpic --> Epic : uses
    MarkdownEpic --> Epic : uses
    EpicView --> SubEpicView : uses
    SubEpicView --> SubEpicView : uses
    SubEpicView --> StoryView : uses
    TTYStory --> Story : uses
    JSONStory --> Story : uses
    MarkdownStory --> Story : uses
    StoryView --> ScenarioView : uses
    TTYScenario --> Scenario : uses
    JSONScenario --> Scenario : uses
    MarkdownScenario --> Scenario : uses
    TTYScenarioOutline --> ScenarioOutline : uses
    JSONScenarioOutline --> ScenarioOutline : uses
    MarkdownScenarioOutline --> ScenarioOutline : uses
    TTYAcceptanceCriteria --> AcceptanceCriteria : uses
    JSONAcceptanceCriteria --> AcceptanceCriteria : uses
    MarkdownAcceptanceCriteria --> AcceptanceCriteria : uses
    TTYStep --> Step : uses
    JSONStep --> Step : uses
    MarkdownStep --> Step : uses
    TTYTest --> Test : uses
    JSONTest --> Test : uses
    MarkdownTest --> Test : uses
    StoryUser --> StoryUser : uses
    TTYStoryUser --> StoryUser : uses
    JSONStoryUser --> StoryUser : uses
    MarkdownStoryUser --> StoryUser : uses
    StoryUserView --> StoryUser : uses
    TTYStatus --> Status : uses
    JSONStatus --> Status : uses
    MarkdownStatus --> Status : uses
    TTYExitResult --> ExitResult : uses
    JSONExitResult --> ExitResult : uses
    MarkdownExitResult --> ExitResult : uses