(E) Execute In Headless Mode
    (E) Document Headless Mode Requirements
            (S) REPL --> Add Headless Mode To Help
                (AC) WHEN AI executes echo 'help' | python repl_main.py
                (AC) THEN REPL adds headless mode section to main_help output
                (AC) AND REPL explains context file requirement (docs/context/headless-context.md)
                (AC) AND REPL lists required context content (user message, chat history, file references)
                (AC) AND REPL shows headless command format with --headless flag
                (AC) AND REPL documents CURSOR_API_KEY environment variable requirement
                (AC) AND REPL provides example: echo 'shape.build.instructions --headless' | python repl_main.py
        and
            (S) REPL --> Add Headless Mode To Status
                (AC) WHEN AI executes echo 'status' | python repl_main.py
                (AC) THEN REPL adds headless mode availability indicator to status output
                (AC) AND REPL shows context preparation reminder if headless-context.md missing
                (AC) AND REPL displays current headless session status if active
    (E) Execute In Headless Mode
            (S) Human --> Execute Direct Instructions
                (AC) WHEN Human executes CLI with --headless and --message parameters
                (AC) AND Context file exists at docs/context/headless-context.md
                (AC) THEN CLI enables headless execution mode
                (AC) AND CLI loads CURSOR_API_KEY from environment
                (AC) AND CLI validates API key is present
                (AC) AND CLI creates timestamped log file path
                (AC) AND CLI reads headless-context.md
                (AC) AND CLI uses provided message as instructions directly
                (AC) AND CLI prepends context to message
                (AC) AND CLI prepends "Keep doing this instruction until 100% done or blocked"
                (AC) AND CLI appends "If blocked, report the block reason"
                (AC) AND CLI sends request to Cursor Headless API
                (AC) AND CLI starts headless session execution
            (S) Human --> Execute Single Operation
                (AC) WHEN Human executes CLI with behavior.action.operation and --headless flag
                (AC) AND Context file exists at docs/context/headless-context.md
                (AC) THEN CLI enables headless execution mode
                (AC) AND CLI loads CURSOR_API_KEY from environment
                (AC) AND CLI validates API key is present
                (AC) AND CLI creates timestamped log file path
                (AC) AND CLI retrieves operation instructions
                (AC) AND CLI reads headless-context.md
                (AC) AND CLI prepends --message parameter to instructions if provided
                (AC) AND CLI prepends context to instructions
                (AC) AND CLI prepends "Keep doing this instruction until 100% done or blocked"
                (AC) AND CLI appends "If blocked, report the block reason"
                (AC) AND CLI sends request to Cursor Headless API
                (AC) AND CLI starts headless session execution
            (S) Human --> Execute Complete Action
                (AC) WHEN Human executes CLI with behavior.action and --headless flag
                (AC) AND Context file exists at docs/context/headless-context.md
                (AC) THEN CLI enables headless execution mode
                (AC) AND CLI reads headless-context.md
                (AC) AND CLI configures for action sequence (instructions, submit, confirm)
                (AC) AND CLI retrieves instructions for first operation
                (AC) AND CLI prepends --message parameter to instructions if provided
                (AC) AND CLI prepends context to instructions
                (AC) AND CLI sends to Cursor Headless with "complete all operations" directive
                (AC) AND CLI monitors execution through instructions → submit → confirm sequence
                (AC) AND CLI advances to next operation when current completes
                (AC) AND CLI completes when all action operations finish or block
            (S) Human --> Execute Complete Behavior
                (AC) WHEN Human executes CLI with behavior and --headless flag
                (AC) AND Context file exists at docs/context/headless-context.md
                (AC) THEN CLI enables headless execution mode
                (AC) AND CLI reads headless-context.md
                (AC) AND CLI configures for full workflow execution
                (AC) AND CLI retrieves first action in behavior workflow
                (AC) AND CLI prepends --message parameter to instructions if provided
                (AC) AND CLI prepends context to instructions
                (AC) AND CLI sends to Cursor Headless with "complete entire workflow" directive
                (AC) AND CLI monitors execution through all actions in sequence
                (AC) AND CLI advances through behavior workflow (action → action)
                (AC) AND CLI completes when entire behavior finishes or blocks
    (E) Monitor Session
            (S) CLI --> Monitor Execution
                (AC) WHEN Headless session is active
                (AC) THEN CLI streams responses to log file
                (AC) AND CLI maintains full execution transcript
                (AC) AND CLI polls session status periodically
                (AC) AND CLI checks for completion or block signals
                (AC) AND CLI detects block markers in output
                (AC) AND CLI captures block reason when detected
            (S) CLI --> Surface Block Reason
                (AC) WHEN Block condition is detected
                (AC) THEN CLI writes block reason to stdout
                (AC) AND CLI writes block reason to log file
        or
            (S) CLI --> Report Completion
                (AC) WHEN Session completes successfully
                (AC) THEN CLI writes completion status to stdout
                (AC) AND CLI writes log file path
        or
            (S) CLI --> Report Failure
                (AC) WHEN Session fails or times out
                (AC) THEN CLI writes failure reason to stdout
                (AC) AND CLI writes log file path for debugging

