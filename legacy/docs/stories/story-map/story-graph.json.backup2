{
  "epics": [
    {
      "name": "Build Agile Bots",
      "sequential_order": 1.0,
      "domain_concepts": [
        {
          "name": "Base Bot",
          "responsibilities": [
            {
              "name": "Executes Actions",
              "collaborators": [
                "Workflow",
                "Behavior",
                "Action"
              ]
            },
            {
              "name": "Track activity",
              "collaborators": [
                "Behavior",
                "Action"
              ]
            },
            {
              "name": "Route to behaviors and actions",
              "collaborators": [
                "Router",
                "Trigger Words"
              ]
            },
            {
              "name": "Persist content",
              "collaborators": [
                "Content"
              ]
            },
            {
              "name": "Manage Project State",
              "collaborators": [
                "Project"
              ]
            },
            {
              "name": "Render",
              "collaborators": []
            }
          ]
        },
        {
          "name": "Specific Bot",
          "responsibilities": [
            {
              "name": "Provide Behavior config",
              "collaborators": [
                "Bot Config",
                "Behavior"
              ]
            },
            {
              "name": "Provide MCP config",
              "collaborators": [
                "MCP Config"
              ]
            },
            {
              "name": "Provide Renderers",
              "collaborators": []
            },
            {
              "name": "Provide Extractors",
              "collaborators": []
            },
            {
              "name": "Provide Synchronizer",
              "collaborators": []
            },
            {
              "name": "Provide Trigger Words",
              "collaborators": []
            }
          ]
        },
        {
          "name": "BotLangActionNode",
          "responsibilities": [
            {
              "name": "Wrap action.execute(context) method",
              "collaborators": [
                "Action",
                "LangGraph"
              ]
            },
            {
              "name": "Implement two-pass pattern",
              "collaborators": [
                "Action",
                "AI"
              ]
            },
            {
              "name": "Support execution modes",
              "collaborators": [
                "BotMode"
              ]
            },
            {
              "name": "Provide LangGraph entry point",
              "collaborators": [
                "LangGraph"
              ]
            }
          ]
        },
        {
          "name": "BehaviorGraphBuilder",
          "responsibilities": [
            {
              "name": "Read behavior workflow definitions",
              "collaborators": [
                "Behavior",
                "Behavior Config"
              ]
            },
            {
              "name": "Create LangGraph StateGraph",
              "collaborators": [
                "LangGraph",
                "BotLangState"
              ]
            },
            {
              "name": "Build node instances from actions",
              "collaborators": [
                "BotLangActionNode",
                "Action"
              ]
            },
            {
              "name": "Connect nodes based on workflow order",
              "collaborators": [
                "LangGraph",
                "BotLangActionNode"
              ]
            }
          ]
        },
        {
          "name": "BotLangFlowRunner",
          "responsibilities": [
            {
              "name": "Load BotLangFlow Python files",
              "collaborators": [
                "BotLangFlow",
                "File System"
              ]
            },
            {
              "name": "Compile graph with checkpointer",
              "collaborators": [
                "LangGraph",
                "SqliteSaver",
                "Checkpoint"
              ]
            },
            {
              "name": "Execute workflow graph",
              "collaborators": [
                "LangGraph",
                "BotLangActionNode",
                "BotLangState"
              ]
            },
            {
              "name": "Resume from checkpoint",
              "collaborators": [
                "Checkpoint",
                "BotLangState"
              ]
            }
          ]
        }
      ],
      "sub_epics": [
        {
          "name": "Generate MCP Tools",
          "sequential_order": 1.0,
          "story_groups": [
            {
              "type": "and",
              "connector": "or",
              "stories": [
                {
                  "name": "Generate Bot Tools",
                  "sequential_order": 0.5,
                  "connector": "and",
                  "users": [
                    "MCP Server Generator"
                  ],
                  "story_type": "user",
                  "test_file": "test_generate_bot_server_and_tools.py",
                  "test_class": "TestGenerateBotTools",
                  "acceptance_criteria": [
                    "WHEN Generator processes Bot Config",
                    "THEN Generator creates 1 bot tool instance"
                  ],
                  "scenarios": [
                    {
                      "name": "Generator creates bot tool for test_bot",
                      "steps": "Given A bot configuration file with a working directory and behaviors\nAnd A bot that has been initialized with that config file\nWhen Generator processes Bot Config\nThen Generator creates 1 bot tool instance",
                      "test_method": "test_generator_creates_bot_tool_for_test_bot"
                    }
                  ]
                },
                {
                  "name": "Generate Behavior Tools",
                  "sequential_order": 0.6,
                  "connector": "and",
                  "users": [
                    "MCP Server Generator"
                  ],
                  "story_type": "user",
                  "test_file": "test_generate_bot_server_and_tools.py",
                  "test_class": "TestGenerateBehaviorTools",
                  "acceptance_criteria": [
                    "WHEN Generator processes Bot Config",
                    "THEN Generator creates behavior tool instances for each behavior"
                  ],
                  "scenarios": [
                    {
                      "name": "Generator creates behavior tools for test_bot with 4 behaviors",
                      "steps": "Given A bot configuration file with a working directory and behaviors\nAnd A bot that has been initialized with that config file\nWhen Generator processes Bot Config\nThen Generator creates 4 behavior tool instances",
                      "test_method": "test_generator_creates_behavior_tools_for_test_bot_with_4_behaviors"
                    }
                  ]
                },
                {
                  "name": "Generate MCP Bot Server",
                  "sequential_order": 1,
                  "connector": "and",
                  "users": [
                    "MCP Server Generator"
                  ],
                  "story_type": "user",
                  "test_file": "test_generate_bot_server_and_tools.py",
                  "test_class": "TestGenerateMCPBotServer",
                  "acceptance_criteria": [
                    "WHEN MCP Server Generator receives Bot Config",
                    "THEN Generator generates unique MCP Server instance with Unique server name from bot name",
                    "AND Generated server includes Bot Config reference",
                    "AND Generated server leverages Specific Bot instantiation code"
                  ],
                  "scenarios": [
                    {
                      "name": "Generator creates MCP server for test_bot",
                      "steps": "Given A bot configuration file with a working directory and behaviors\nAnd A bot that has been initialized with that config file\nWhen MCP Server Generator receives Bot Config\nThen Generator creates MCP Server instance with unique server name",
                      "test_method": "test_generator_creates_mcp_server_for_test_bot"
                    },
                    {
                      "name": "Generator fails when Bot Config is missing",
                      "steps": "Given A bot directory exists\nAnd Bot Config does NOT exist\nWhen MCP Server Generator attempts to receive Bot Config\nThen Generator raises FileNotFoundError and does not create MCP Server instance",
                      "test_method": "test_generator_fails_when_bot_config_missing"
                    },
                    {
                      "name": "Generator fails when Bot Config is malformed",
                      "steps": "Given A bot directory exists\nAnd Bot Config file exists with invalid JSON syntax\nWhen MCP Server Generator attempts to receive Bot Config\nThen Generator raises JSONDecodeError and does not create MCP Server instance",
                      "test_method": "test_generator_fails_when_bot_config_malformed"
                    }
                  ]
                },
                {
                  "name": "Generate Behavior Action Tools",
                  "sequential_order": 2,
                  "connector": "and",
                  "users": [
                    "MCP Server Generator"
                  ],
                  "story_type": "user",
                  "test_file": "test_generate_bot_server_and_tools.py",
                  "test_class": "TestGenerateBehaviorActionTools",
                  "acceptance_criteria": [
                    "WHEN Generator processes Bot Config",
                    "THEN Generator creates tool code for each (behavior, action) pair",
                    "AND Enumerates all behaviors and actions from Bot Config",
                    "AND For each pair, generates tool code with unique name, trigger words, forwarding logic",
                    "AND Tool catalog prepared with all generated tool instances"
                  ]
                },
                {
                  "name": "Deploy MCP BOT Server",
                  "sequential_order": 3,
                  "connector": "and",
                  "users": [],
                  "story_type": "user",
                  "test_file": "test_generate_bot_server_and_tools.py",
                  "test_class": "TestDeployMCPBotServer",
                  "acceptance_criteria": [
                    "WHEN Generation Complete",
                    "THEN Generator deploys/starts generated MCP Server",
                    "AND Server initializes in separate thread",
                    "AND Server registers with MCP Protocol Handler using unique server name",
                    "AND Server publishes tool catalog to AI Chat",
                    "AND Each tool entry includes name, description, trigger patterns, parameters"
                  ]
                },
                {
                  "name": "Restart MCP Server To Load Code Changes",
                  "sequential_order": 4,
                  "connector": "and",
                  "users": [
                    "MCP Server Generator"
                  ],
                  "story_type": "user",
                  "test_file": "test_restart_mcp_server.py",
                  "test_class": "TestRestartMCPServerToLoadCodeChanges",
                  "acceptance_criteria": [
                    "WHEN Bot code changes are detected",
                    "THEN MCP Server clears Python bytecode cache (__pycache__)",
                    "AND MCP Server restarts to load new code",
                    "AND Server restarts gracefully without losing state",
                    "AND Server re-registers with MCP Protocol Handler after restart"
                  ],
                  "scenarios": [
                    {
                      "name": "Clear Python bytecode cache",
                      "steps": "Given __pycache__ directories exist with .pyc files\nWhen clear_python_cache is called\nThen All __pycache__ directories are removed\nAnd All .pyc files are deleted\nAnd Cache is cleared before server restart",
                      "test_method": "test_clear_python_bytecode_cache"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "Generate CLI",
          "sequential_order": 2.0,
          "story_groups": [
            {
              "type": "and",
              "connector": null,
              "stories": [
                {
                  "name": "Generate BOT CLI code",
                  "sequential_order": 1,
                  "connector": "or",
                  "users": [
                    "MCP Server Generator"
                  ],
                  "story_type": "user",
                  "test_file": "test_generate_cli.py",
                  "test_class": "TestGenerateBOTCLIcode",
                  "acceptance_criteria": [
                    "WHEN MCP Server Generator processes Bot Config",
                    "THEN Generator creates CLI command wrapper structure for bot invocation",
                    "AND Generator generates CLI entry point script (e.g., bot_cli.py and bot shell script)",
                    "AND CLI code includes argument parsing for behavior and action parameters",
                    "AND CLI code includes help/usage documentation generation",
                    "AND CLI code supports listing available bots, behaviors, and actions",
                    "AND Generated CLI code integrates with existing bot instantiation logic",
                    "AND CLI code follows same routing logic as MCP tools for consistency"
                  ]
                },
                {
                  "name": "Generate Cursor Command Files",
                  "sequential_order": 2,
                  "connector": "or",
                  "users": [
                    "MCP Server Generator"
                  ],
                  "story_type": "user",
                  "test_file": "test_invoke_bot_cli.py",
                  "test_class": "TestGenerateCursorCommands",
                  "acceptance_criteria": [
                    "WHEN Human calls generate_cursor_commands(commands_dir, cli_script_path)",
                    "THEN CLI creates .cursor/commands/ directory if it doesn't exist",
                    "AND CLI creates <bot-name>.md command file that invokes CLI with bot name (routes to current behavior/action)",
                    "AND CLI creates <bot-name>-<behavior>.md command file for each behavior in bot that invokes CLI with bot name and behavior (auto-forwards to current action)",
                    "AND CLI creates <bot-name>-<behavior>-<action>.md command file for each action in each behavior that invokes CLI with bot name, behavior, and action",
                    "AND CLI creates <bot-name>-close.md command file that invokes CLI with bot name and --close parameter",
                    "AND Each command file contains simple wrapper command that calls CLI script",
                    "AND Bot name, behavior, and action are hardcoded in command files (no parameters needed)",
                    "AND CLI removes obsolete command files for behaviors/actions that no longer exist in bot",
                    "AND CLI returns dict mapping command names (e.g., story_bot, story_bot-exploration, story_bot-exploration-gather_context, story_bot-close) to file paths"
                  ],
                  "scenarios": [
                    {
                      "name": "Generate cursor command files (happy_path)",
                      "steps": "Given: CLI instance is initialized\nAnd: commands directory path is provided\nAnd: CLI script path is provided\nWhen: Human calls generate_cursor_commands()\nThen: CLI creates .cursor/commands directory\nAnd: CLI creates bot command file\nAnd: CLI creates bot-behavior command file\nAnd: CLI creates bot-behavior-action command file\nAnd: CLI creates bot-close command file\nAnd: Each command file contains correct CLI invocation",
                      "test_method": "test_generate_cursor_commands_creates_all_files"
                    },
                    {
                      "name": "Generate cursor commands creates directory if missing (edge_case)",
                      "steps": "Given: CLI instance is initialized\nAnd: commands directory does NOT exist\nWhen: Human calls generate_cursor_commands()\nThen: CLI creates .cursor/commands directory\nAnd: CLI creates all command files",
                      "test_method": "test_generate_cursor_commands_creates_directory"
                    },
                    {
                      "name": "Generate cursor commands removes obsolete files when behavior removed (edge_case)",
                      "steps": "Given: CLI instance is initialized\nAnd: Bot previously had behavior \"old_behavior\"\nAnd: Obsolete command file exists for removed behavior\nAnd: Bot no longer has behavior \"old_behavior\"\nWhen: Human calls generate_cursor_commands()\nThen: CLI creates new command files for current behaviors\nAnd: CLI removes obsolete command files for removed behaviors",
                      "test_method": "test_generate_cursor_commands_removes_obsolete_files"
                    }
                  ]
                },
                {
                  "name": "Generate Help",
                  "sequential_order": 3,
                  "connector": "or",
                  "users": [
                    "MCP Server Generator"
                  ],
                  "story_type": "user",
                  "test_file": "test_generate_cli.py",
                  "test_class": "TestGenerateHelp",
                  "acceptance_criteria": [
                    "WHEN Help generator generates CLI help",
                    "THEN Help contains behaviors, actions, and parameters",
                    "AND Help contains CLI command syntax",
                    "WHEN Help generator generates cursor help",
                    "THEN Help contains cursor command syntax"
                  ]
                },
                {
                  "name": "Generate Cursor Awareness Files",
                  "sequential_order": 4,
                  "connector": "or",
                  "users": [
                    "MCP Server Generator"
                  ],
                  "story_type": "user",
                  "test_file": "test_generate_cli.py",
                  "test_class": "TestGenerateCursorAwarenessFiles",
                  "acceptance_criteria": [
                    "WHEN Generator runs generate_awareness_files() method",
                    "THEN Generator creates workspace rules file with trigger patterns",
                    "AND File includes bot name and behavior descriptions",
                    "AND File includes trigger words sectioned by behavior"
                  ]
                },
                {
                  "name": "Generate Help Parameters From Action Context Classes",
                  "sequential_order": 5,
                  "connector": "or",
                  "users": [
                    "MCP Server Generator"
                  ],
                  "story_type": "user",
                  "test_file": "test_generate_cli.py",
                  "test_class": "TestGenerateHelpParametersFromActionContextClasses",
                  "acceptance_criteria": [
                    "WHEN Help generator processes action context classes",
                    "THEN Generator extracts parameters from context classes",
                    "AND Help includes action-specific parameters"
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "Generate REPL CLI",
          "sequential_order": 3.0,
          "story_groups": [
            {
              "type": "and",
              "connector": null,
              "stories": [
                {
                  "name": "Generate REPL Command Definitions",
                  "sequential_order": 1,
                  "connector": null,
                  "users": [
                    "Generator"
                  ],
                  "story_type": "user",
                  "acceptance_criteria": [
                    "WHEN generator runs, THEN Orchestrator walks all bot behaviors",
                    "WHEN behaviors are walked, THEN ActionDataCollector gathers action metadata for each behavior",
                    "WHEN actions are gathered, THEN generator extracts parameters from each action's context_class",
                    "WHEN metadata is collected, THEN ReplCommandVisitor generates navigate commands for all behaviors and actions",
                    "WHEN commands are generated, THEN scope commands are created for scope.type, scope.value, scope.exclude",
                    "WHEN all commands are defined, THEN generator outputs command definition file"
                  ]
                },
                {
                  "name": "Generate CLI Entry Point",
                  "sequential_order": 2,
                  "connector": "and",
                  "users": [
                    "Generator"
                  ],
                  "story_type": "user",
                  "acceptance_criteria": [
                    "WHEN generator updates base_bot_cli.py, THEN it adds REPL mode with stdio_mode parameter",
                    "WHEN REPL mode is added, THEN it integrates with existing CliCommandRouter for routing logic",
                    "WHEN REPL loop is generated, THEN it includes TTY detection, state display, command parsing, and execution"
                  ]
                },
                {
                  "name": "Generate Cursor Commands",
                  "sequential_order": 3,
                  "connector": "and",
                  "users": [
                    "Generator"
                  ],
                  "story_type": "user",
                  "acceptance_criteria": [
                    "WHEN generator creates CursorReplVisitor, THEN it follows existing visitor pattern",
                    "WHEN visitor generates shortcuts, THEN it creates navigate shortcuts for behaviors",
                    "WHEN visitor generates action shortcuts, THEN it creates shortcuts for behavior-action combinations",
                    "WHEN visitor generates help shortcuts, THEN it creates help and status commands"
                  ]
                },
                {
                  "name": "Generate Help Documentation",
                  "sequential_order": 4,
                  "connector": "and",
                  "users": [
                    "Generator"
                  ],
                  "story_type": "user",
                  "acceptance_criteria": [
                    "WHEN generator creates HelpReplVisitor, THEN it generates command reference with all REPL commands",
                    "WHEN help is generated, THEN it includes parameter reference with descriptions for all action parameters",
                    "WHEN examples are generated, THEN it includes scope examples with dot-notation syntax",
                    "WHEN documentation is output, THEN it creates Markdown help files in .cursor/commands/ and terminal help"
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "Invoke Bot",
      "sequential_order": 2.0,
      "domain_concepts": [
        {
          "name": "Router",
          "responsibilities": [
            {
              "name": "Match trigger patterns",
              "collaborators": [
                "Trigger Words",
                "Route"
              ]
            },
            {
              "name": "Route to MCP bot tool",
              "collaborators": [
                "Base Bot",
                "Trigger Words"
              ]
            },
            {
              "name": "Route to behavior tool",
              "collaborators": [
                "Behavior",
                "Trigger Words"
              ]
            },
            {
              "name": "Route to action tool",
              "collaborators": [
                "Action",
                "Trigger Words"
              ]
            },
            {
              "name": "Forward to behavior",
              "collaborators": [
                "Behavior",
                "Base Bot"
              ]
            },
            {
              "name": "Forward to action",
              "collaborators": [
                "Action",
                "Behavior"
              ]
            },
            {
              "name": "Forward to current behavior and action",
              "collaborators": [
                "Behavior",
                "Action",
                "Base Bot"
              ]
            }
          ]
        },
        {
          "name": "Base Bot",
          "responsibilities": [
            {
              "name": "Executes Actions",
              "collaborators": [
                "Workflow",
                "Behavior",
                "Action"
              ]
            },
            {
              "name": "Track activity",
              "collaborators": [
                "Behavior",
                "Action"
              ]
            },
            {
              "name": "Route to behaviors and actions",
              "collaborators": [
                "Router",
                "Trigger Words"
              ]
            },
            {
              "name": "Persist content",
              "collaborators": [
                "Content"
              ]
            },
            {
              "name": "Manage Project State",
              "collaborators": [
                "Project"
              ]
            },
            {
              "name": "Render",
              "collaborators": []
            }
          ]
        },
        {
          "name": "Workflow State",
          "responsibilities": [
            {
              "name": "Track current action",
              "collaborators": [
                "Action"
              ]
            },
            {
              "name": "Track completed actions",
              "collaborators": [
                "Action",
                "Activity Log"
              ]
            },
            {
              "name": "Determine next action",
              "collaborators": [
                "Action",
                "Behavior"
              ]
            },
            {
              "name": "Pause workflow",
              "collaborators": [
                "Human",
                "AI Chat"
              ]
            },
            {
              "name": "Resume workflow",
              "collaborators": [
                "Human",
                "AI Chat"
              ]
            }
          ]
        },
        {
          "name": "Checkpoint",
          "responsibilities": [
            {
              "name": "Save workflow state",
              "collaborators": [
                "BotLangState",
                "BotLangFlowRunner"
              ]
            },
            {
              "name": "Restore workflow state",
              "collaborators": [
                "BotLangState",
                "BotLangFlowRunner"
              ]
            },
            {
              "name": "Track execution history",
              "collaborators": [
                "BotLangState"
              ]
            },
            {
              "name": "Enable resume capability",
              "collaborators": [
                "BotLangFlow",
                "BotLangFlowRunner"
              ]
            }
          ]
        },
        {
          "name": "BotMode",
          "responsibilities": [
            {
              "name": "Determine AI interaction",
              "collaborators": [
                "BotLangActionNode",
                "AI Client"
              ]
            },
            {
              "name": "Control pause points",
              "collaborators": [
                "BotLangActionNode",
                "Human"
              ]
            }
          ]
        },
        {
          "name": "BotLangFlow",
          "responsibilities": [
            {
              "name": "Execute nodes in sequence",
              "collaborators": [
                "BotLangActionNode",
                "BotLangFlowRunner"
              ]
            },
            {
              "name": "Handle conditional branching",
              "collaborators": [
                "Decision Node",
                "BotLangState"
              ]
            },
            {
              "name": "Support loops and iterations",
              "collaborators": [
                "BotLangActionNode",
                "BotLangState"
              ]
            },
            {
              "name": "Pause at interactive points",
              "collaborators": [
                "Human",
                "BotMode"
              ]
            },
            {
              "name": "Resume from checkpoint",
              "collaborators": [
                "Checkpoint",
                "BotLangFlowRunner"
              ]
            }
          ]
        },
        {
          "name": "BotLangState",
          "responsibilities": [
            {
              "name": "Contain story graph",
              "collaborators": [
                "Story Graph"
              ]
            },
            {
              "name": "Contain clarification data",
              "collaborators": [
                "Key Questions",
                "Evidence"
              ]
            },
            {
              "name": "Contain strategy data",
              "collaborators": [
                "Decision Criteria",
                "Assumptions"
              ]
            },
            {
              "name": "Contain context files",
              "collaborators": [
                "Context"
              ]
            },
            {
              "name": "Contain files dictionary",
              "collaborators": [
                "Source Files",
                "Test Files"
              ]
            },
            {
              "name": "Contain workspace directory",
              "collaborators": [
                "Workspace"
              ]
            },
            {
              "name": "Contain workflow execution state",
              "collaborators": [
                "Action",
                "Instructions"
              ]
            }
          ]
        },
        {
          "name": "Behavior Action State",
          "responsibilities": [
            {
              "name": "Track current action",
              "collaborators": [
                "Action"
              ]
            },
            {
              "name": "Track completed actions",
              "collaborators": [
                "Action",
                "Activity Log"
              ]
            },
            {
              "name": "Determine next action",
              "collaborators": [
                "Action",
                "Behavior"
              ]
            },
            {
              "name": "Pause workflow",
              "collaborators": [
                "Human",
                "AI Chat"
              ]
            },
            {
              "name": "Resume workflow",
              "collaborators": [
                "Human",
                "AI Chat"
              ]
            }
          ]
        }
      ],
      "sub_epics": [
        {
          "name": "Init Project",
          "sequential_order": 1.0,
          "domain_concepts": [
            {
              "name": "Project",
              "responsibilities": [
                {
                  "name": "Move project to working area",
                  "collaborators": [
                    "Working Directory"
                  ]
                },
                {
                  "name": "Save project in context",
                  "collaborators": [
                    "Working Directory",
                    "Workflow State"
                  ]
                },
                {
                  "name": "Update project area",
                  "collaborators": [
                    "Working Directory",
                    "Content"
                  ]
                }
              ]
            }
          ],
          "test_file": "test_init_project.py",
          "story_groups": [
            {
              "type": "and",
              "connector": "or",
              "stories": [
                {
                  "name": "Initialize Project Location",
                  "sequential_order": 1,
                  "connector": "and",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_class": "TestInitializeProjectLocation",
                  "acceptance_criteria": [
                    "(AC) WHEN Bot behavior is invoked for the first time (no saved location exists)",
                    "(AC) THEN Bot detects current directory from context",
                    "(AC) AND Bot presents location to user for confirmation",
                    "(AC) AND Bot waits for user to confirm or provide different location",
                    "(AC) AND Bot saves confirmed location to persistent storage",
                    "(AC) WHEN Bot behavior is invoked",
                    "(AC) AND Saved location exists",
                    "(AC) AND Current directory matches saved location",
                    "(AC) THEN Bot uses saved location without asking for confirmation",
                    "(AC) AND Bot proceeds directly to next action",
                    "(AC) WHEN Bot behavior is invoked",
                    "(AC) AND Saved location exists",
                    "(AC) AND Current directory is DIFFERENT from saved location",
                    "(AC) THEN Bot presents new location to user for confirmation",
                    "(AC) AND Bot asks if user wants to switch to new location",
                    "(AC) AND Bot saves confirmed location if user approves change"
                  ],
                  "scenarios": [
                    {
                      "name": "First time initialization with no saved location",
                      "steps": "Given: No project location has been saved\nWhen: Bot behavior is invoked\nThen: Bot detects current directory and requests confirmation",
                      "test_method": "test_first_time_initialization_detects_and_requests_confirmation"
                    },
                    {
                      "name": "Subsequent invocation with same location (no confirmation bias)",
                      "steps": "Given: Project location is saved and current directory matches saved location\nWhen: Bot behavior is invoked\nThen: Bot does NOT ask user for confirmation and says 'Resuming in...'",
                      "test_method": "test_subsequent_invocation_same_location_skips_confirmation"
                    },
                    {
                      "name": "Location changed - ask for confirmation",
                      "steps": "Given: Project location is saved and current directory is DIFFERENT\nWhen: Bot behavior is invoked\nThen: Bot detects mismatch and asks if user wants to switch to current directory",
                      "test_method": "test_location_changed_requests_confirmation"
                    },
                    {
                      "name": "Location file persistence when no confirmation needed",
                      "steps": "Given: Saved location matches current location\nWhen: Bot behavior is invoked\nThen: Bot saves location to current_project.json file",
                      "test_method": "test_location_file_saved_when_no_confirmation_needed"
                    },
                    {
                      "name": "User provides different location during initialization via parameters",
                      "steps": "Given: No saved location exists\nWhen: Bot behavior is invoked with project_area parameter\nThen: Bot uses the provided project_area location",
                      "test_method": "test_user_provides_custom_project_area_via_parameters"
                    },
                    {
                      "name": "User changes project area via initialize_project action with parameters",
                      "steps": "Given: Project location is already saved\nWhen: User invokes initialize_project with different project_area parameter\nThen: Bot detects change and asks if user wants to switch to current directory",
                      "test_method": "test_user_changes_project_area_with_initialize_project_action"
                    },
                    {
                      "name": "First time with project_area parameter as hint",
                      "steps": "Given: No saved location exists\nWhen: Bot is invoked with project_area parameter\nThen: Bot uses parameter as hint but still requests confirmation\nAND: Location is NOT saved until user confirms",
                      "test_method": "test_project_area_parameter_as_hint_still_requests_confirmation"
                    },
                    {
                      "name": "User confirms proposed location",
                      "steps": "Given: Bot proposed a location requiring confirmation\nWhen: User responds with confirm=True and same location\nThen: Bot saves the confirmed location",
                      "test_method": "test_user_confirms_proposed_location"
                    },
                    {
                      "name": "User provides different location as response to confirmation",
                      "steps": "Given: Bot proposed a location requiring confirmation\nWhen: User responds with confirm=True and DIFFERENT location\nThen: Bot saves the user's choice (not the proposed location)",
                      "test_method": "test_user_provides_different_location_as_confirmation_response"
                    },
                    {
                      "name": "Workflow state not created when confirmation required",
                      "steps": "Given Bot proposes location requiring confirmation\nWhen initialize_project is called and requires_confirmation is True\nThen workflow_state.json is NOT created\nAnd close_current_action cannot proceed without workflow state",
                      "test_method": "test_workflow_state_not_created_when_confirmation_required"
                    },
                    {
                      "name": "Workflow state created after confirmation",
                      "steps": "Given Bot proposed location requiring confirmation\nWhen User confirms location with confirm=True\nThen workflow_state.json IS created\nAnd workflow_state.json contains current_behavior, current_action, and completed_actions\nAnd close_current_action can proceed",
                      "test_method": "test_workflow_state_created_after_confirmation"
                    }
                  ]
                },
                {
                  "name": "Initialize Project Creates Context Folder",
                  "sequential_order": 1.5,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_context_folder_management.py",
                  "test_class": "TestInitializeProjectCreatesContextFolder",
                  "acceptance_criteria": [
                    "GIVEN: User confirms project area location",
                    "WHEN: initialize_project action completes",
                    "THEN: {project_area}/docs/context/ folder exists",
                    "AND: context folder is ready for context files"
                  ],
                  "scenarios": [
                    {
                      "name": "Initialize project creates context folder",
                      "steps": "GIVEN: User confirms project area location\nWHEN: initialize_project action completes\nTHEN: {project_area}/docs/context/ folder exists\nAND: context folder is ready for context files",
                      "test_method": "test_context_folder_created_after_project_confirmation"
                    }
                  ]
                },
                {
                  "name": "Input File Copied To Context Folder",
                  "sequential_order": 1.6,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_context_folder_management.py",
                  "test_class": "TestInputFileCopiedToContextFolder",
                  "acceptance_criteria": [
                    "GIVEN: User provides input file via @input.txt command",
                    "AND: input file exists at original location",
                    "WHEN: initialize_project action executes",
                    "THEN: initialize_project copies input file to {project_area}/docs/context/input.txt",
                    "AND: original input file remains at original location (copy, not move)",
                    "AND: {project_area}/docs/context/input.txt exists and contains original content"
                  ],
                  "scenarios": [
                    {
                      "name": "Initialize project copies input file to context folder",
                      "steps": "GIVEN: User provides input file via @input.txt command\nAND: input file exists at original location\nWHEN: initialize_project action executes\nTHEN: initialize_project copies input file to {project_area}/docs/context/input.txt\nAND: original input file remains at original location (copy, not move)\nAND: {project_area}/docs/context/input.txt exists and contains original content",
                      "test_method": "test_input_file_copied_to_context_folder"
                    }
                  ]
                },
                {
                  "name": "Store Context Files",
                  "sequential_order": 1.7,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "acceptance_criteria": [
                    "WHEN initialize_project action confirms project area location",
                    "THEN initialize_project creates {project_area}/docs/context/ folder and {project_area}/docs/stories/ folder",
                    "WHEN user provides input file via @input.txt or similar",
                    "THEN initialize_project copies input file to {project_area}/docs/context/input.txt",
                    "WHEN user provides context in conversation",
                    "THEN initialize_project saves context to {project_area}/docs/context/initial-context.md or similar",
                    "WHEN gather_context action stores clarification data",
                    "THEN gather_context saves to {project_area}/docs/stories/clarification.json (generated file, NOT in context folder)",
                    "WHEN decide_planning_criteria action stores planning decisions",
                    "THEN decide_planning_criteria saves to {project_area}/docs/stories/planning.json (generated file, NOT in context folder)",
                    "WHEN build_knowledge action loads context",
                    "THEN build_knowledge loads generated files from {project_area}/docs/stories/ folder (clarification.json, planning.json) and original input from {project_area}/docs/context/ folder (input.txt)",
                    "WHEN render_output action loads context",
                    "THEN render_output loads generated files from {project_area}/docs/stories/ folder (clarification.json, planning.json) and original input from {project_area}/docs/context/ folder (input.txt)",
                    "WHEN any action needs context files",
                    "THEN action references original input from {project_area}/docs/context/ folder and generated files from {project_area}/docs/stories/ folder"
                  ]
                },
                {
                  "name": "Guards Prevent Writes Without Project",
                  "sequential_order": 4,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_guards_prevent_writes_without_project.py",
                  "test_class": "TestActivityTrackerGuard",
                  "acceptance_criteria": [
                    "WHEN Activity tracker attempts to log activity",
                    "AND current_project.json does NOT exist",
                    "THEN Activity tracker does NOT write to activity log",
                    "AND Activity tracking fails gracefully without error",
                    "WHEN Workflow attempts to save state",
                    "AND current_project.json does NOT exist",
                    "THEN Workflow does NOT save workflow_state.json",
                    "AND Workflow state save fails gracefully without error"
                  ],
                  "scenarios": [
                    {
                      "name": "Activity not tracked when current_project missing",
                      "steps": "Given current_project.json does NOT exist\nWhen Action attempts to track activity\nThen Activity tracker detects missing current_project\nAnd Activity tracker does NOT write to activity log\nAnd Action continues execution (non-blocking)",
                      "test_method": "test_activity_not_tracked_when_current_project_missing"
                    },
                    {
                      "name": "Activity tracked when current_project exists",
                      "steps": "Given current_project.json exists with valid project_area\nWhen Action attempts to track activity\nThen Activity tracker writes to project_area/activity_log.json\nAnd Activity entry is successfully logged",
                      "test_method": "test_activity_tracked_when_current_project_exists"
                    },
                    {
                      "name": "Initialize project action not tracked without current_project",
                      "steps": "Given current_project.json does NOT exist\nWhen initialize_project action executes\nThen Activity tracker does NOT log initialize_project activity\nAnd initialize_project can still execute (it creates current_project)",
                      "test_method": "test_initialize_project_action_not_tracked_without_current_project"
                    },
                    {
                      "name": "Workflow state not saved when current_project missing",
                      "steps": "Given current_project.json does NOT exist\nWhen Action attempts to save workflow state\nThen Workflow guard detects missing current_project\nAnd Workflow does NOT write workflow_state.json\nAnd Action continues execution (non-blocking)",
                      "test_method": "test_workflow_state_not_saved_when_current_project_missing"
                    },
                    {
                      "name": "Workflow state saved when current_project exists",
                      "steps": "Given current_project.json exists\nWhen Action attempts to save workflow state\nThen Workflow writes to project_area/workflow_state.json\nAnd Workflow state is successfully persisted",
                      "test_method": "test_workflow_state_saved_when_current_project_exists"
                    },
                    {
                      "name": "Workflow state not created when confirmation required",
                      "steps": "Given Bot proposes location requiring confirmation\nWhen initialize_project is called and requires_confirmation is True\nThen workflow_state.json is NOT created\nAnd close_current_action cannot proceed without workflow state",
                      "test_method": "test_workflow_state_not_created_when_confirmation_required"
                    },
                    {
                      "name": "Workflow state created after confirmation",
                      "steps": "Given Bot proposed location requiring confirmation\nWhen User confirms location with confirm=True\nThen workflow_state.json IS created\nAnd workflow_state.json contains current_behavior, current_action, and completed_actions\nAnd close_current_action can proceed",
                      "test_method": "test_workflow_state_created_after_confirmation"
                    },
                    {
                      "name": "Completed actions not saved when current_project missing",
                      "steps": "Given current_project.json does NOT exist\nWhen Action attempts to save completed_actions\nThen Workflow guard prevents write\nAnd completed_actions are NOT persisted\nAnd Action continues execution",
                      "test_method": "test_completed_actions_not_saved_when_current_project_missing"
                    }
                  ]
                },
                {
                  "name": "Stores Activity for Initialize Project Action",
                  "sequential_order": 6,
                  "connector": "or",
                  "users": [],
                  "story_type": "user"
                },
                {
                  "name": "Bootstrap Workspace",
                  "sequential_order": 7,
                  "connector": "or",
                  "users": [
                    "Bot Developer"
                  ],
                  "story_type": "user",
                  "test_file": "test_init_project.py",
                  "test_class": "TestBootstrapWorkspace",
                  "acceptance_criteria": [
                    "WHEN Entry points (MCP/CLI) bootstrap environment",
                    "THEN Environment is configured before importing modules",
                    "AND All directory resolution reads from environment variables only",
                    "AND agent.json provides default workspace location",
                    "AND Environment variables can override agent.json"
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "Invoke MCP",
          "sequential_order": 2.0,
          "test_file": "test_invoke_bot_tool.py",
          "story_groups": [
            {
              "type": "and",
              "connector": null,
              "stories": [
                {
                  "name": "Invoke Bot Tool",
                  "sequential_order": 1,
                  "connector": "or",
                  "users": [
                    "AI Chat"
                  ],
                  "story_type": "user",
                  "test_class": "TestInvokeBotTool",
                  "acceptance_criteria": [
                    "WHEN AI Chat invokes bot tool with behavior and action parameters",
                    "THEN Tool routes to correct behavior.action method",
                    "AND Tool executes action and returns result",
                    "WHEN AI Chat invokes tool for specific behavior",
                    "THEN Tool routes to that behavior only, not other behaviors"
                  ]
                },
                {
                  "name": "Load And Merge Behavior Action Instructions",
                  "sequential_order": 2,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_class": "TestLoadAndMergeBehaviorActionInstructions",
                  "acceptance_criteria": [
                    "WHEN Action method is invoked",
                    "THEN Action loads instructions from base_actions and behavior-specific locations",
                    "AND Instructions are merged and returned"
                  ]
                },
                {
                  "name": "Forward To Current Behavior and Current Action",
                  "sequential_order": 3,
                  "connector": "or",
                  "users": [
                    "AI Chat"
                  ],
                  "story_type": "user",
                  "test_class": "TestForwardToCurrentBehaviorAndCurrentAction",
                  "acceptance_criteria": [
                    "WHEN Bot tool receives invocation",
                    "AND workflow state shows current_behavior and current_action",
                    "THEN Bot tool forwards to correct behavior and action",
                    "WHEN workflow state does NOT exist",
                    "THEN Bot tool defaults to first behavior and first action"
                  ],
                  "scenarios": [
                    {
                      "name": "Bot tool forwards to current behavior and current action",
                      "steps": "Given workflow state shows current_behavior='discovery', current_action='build_knowledge'\nWhen Bot tool receives invocation\nThen Bot tool forwards to correct behavior and action",
                      "test_method": "test_bot_tool_forwards_to_current_behavior_and_current_action"
                    },
                    {
                      "name": "Bot tool defaults to first behavior and first action when state missing",
                      "steps": "Given workflow state does NOT exist\nWhen Bot tool receives invocation\nThen Bot tool defaults to first behavior and first action",
                      "test_method": "test_bot_tool_defaults_to_first_behavior_and_first_action_when_state_missing"
                    }
                  ]
                },
                {
                  "name": "Forward To Current Action",
                  "sequential_order": 4,
                  "connector": "or",
                  "users": [
                    "AI Chat"
                  ],
                  "story_type": "user",
                  "test_class": "TestForwardToCurrentAction",
                  "acceptance_criteria": [
                    "WHEN Behavior tool receives invocation",
                    "AND workflow state shows current_action within behavior",
                    "THEN Behavior tool forwards to current action",
                    "WHEN workflow state shows different behavior",
                    "THEN Behavior tool updates workflow to current behavior",
                    "WHEN workflow state does NOT exist",
                    "THEN Behavior tool defaults to first action"
                  ],
                  "scenarios": [
                    {
                      "name": "Behavior tool forwards to current action within behavior",
                      "steps": "Given a behavior tool for 'discovery' behavior\nAnd workflow state shows current_action='build_knowledge'\nWhen Behavior tool receives invocation\nThen Behavior tool forwards to build_knowledge action",
                      "test_method": "test_behavior_tool_forwards_to_current_action_within_behavior"
                    },
                    {
                      "name": "Behavior tool sets workflow to current behavior when state shows different behavior",
                      "steps": "Given a behavior tool for 'exploration' behavior\nAnd workflow state shows current_behavior='discovery'\nWhen Behavior tool receives invocation\nThen workflow state updated to current_behavior='exploration'",
                      "test_method": "test_behavior_tool_sets_workflow_to_current_behavior_when_state_shows_different_behavior"
                    },
                    {
                      "name": "Behavior tool defaults to first action when state missing",
                      "steps": "Given a behavior tool for 'shape' behavior\nAnd workflow state does NOT exist\nWhen Behavior tool receives invocation\nThen Behavior tool defaults to first action",
                      "test_method": "test_behavior_tool_defaults_to_first_action_when_state_missing"
                    },
                    {
                      "name": "Action called directly saves workflow state",
                      "steps": "Given Bot is initialized with current_project set\nAnd No workflow state exists yet\nWhen Action is called directly (e.g., bot.shape.gather_context())\nThen workflow_state.json is created with current_behavior and current_action",
                      "test_method": "test_action_called_directly_saves_workflow_state"
                    }
                  ]
                },
                {
                  "name": "Track Activity For Workspace",
                  "sequential_order": 5,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_invoke_mcp.py",
                  "test_class": "TestTrackActivityForWorkspace",
                  "acceptance_criteria": [
                    "WHEN Activity is tracked",
                    "THEN Activity is logged to workspace area not bot area"
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "Invoke CLI",
          "sequential_order": 3.0,
          "test_file": "test_invoke_bot_cli.py",
          "story_groups": [
            {
              "type": "and",
              "connector": null,
              "stories": [
                {
                  "name": "Invoke Bot CLI",
                  "sequential_order": 1,
                  "connector": "or",
                  "users": [
                    "Human"
                  ],
                  "story_type": "user",
                  "test_file": "test_invoke_bot_cli.py",
                  "test_class": "TestInvokeBotCli",
                  "acceptance_criteria": [
                    "WHEN Human executes CLI command with bot name only (e.g., bot story_bot)",
                    "THEN CLI loads bot configuration for specified bot",
                    "AND CLI loads workflow state if workflow_state.json exists",
                    "AND CLI extracts current_behavior and current_action from workflow state",
                    "AND CLI routes to bot and invokes current behavior and current action (same as main bot MCP tool)",
                    "AND Bot executes action",
                    "AND CLI submits bot action output to AI Chat",
                    "AND Bot updates workflow state after action execution (if workflow action)",
                    "AND If workflow_state.json doesn't exist, CLI defaults to first behavior's first action"
                  ],
                  "scenarios": [
                    {
                      "name": "Invoke bot CLI with workflow state",
                      "steps": "Given workflow state contains current_behavior=\"story_bot.exploration\"\nAnd workflow state contains current_action=\"story_bot.exploration.gather_context\"\nAnd workflow_state.json exists\nWhen Human executes CLI command \"./story_bot\"\nThen CLI loads bot configuration\nAnd CLI loads workflow state\nAnd CLI routes to bot and invokes current behavior and current action\nAnd Bot executes action\nAnd CLI returns result with status=\"success\"\nAnd Action is NOT marked as completed (human must close action separately)",
                      "test_method": "test_invoke_bot_cli_with_workflow_state"
                    },
                    {
                      "name": "Invoke bot CLI without workflow state",
                      "steps": "Given workflow_state.json does NOT exist\nWhen Human executes CLI command \"./story_bot\"\nThen CLI loads bot configuration\nAnd CLI detects workflow_state.json does not exist\nAnd CLI defaults to first behavior \"story_bot.exploration\"\nAnd CLI defaults to first action \"story_bot.exploration.initialize_project\"\nAnd CLI routes to bot and invokes first behavior and first action\nAnd Bot executes action\nAnd CLI returns result with status=\"success\"\nAnd Action is NOT marked as completed (human must close action separately)",
                      "test_method": "test_invoke_bot_cli_without_workflow_state"
                    },
                    {
                      "name": "Invoke bot CLI with invalid bot name",
                      "steps": "Given bot configuration does NOT exist at specified path\nWhen Human executes CLI command \"./invalid_bot\"\nThen CLI attempts to load bot configuration\nAnd CLI detects bot configuration does not exist\nAnd CLI returns error message\nAnd CLI exits with exit code 1",
                      "test_method": "test_invoke_bot_cli_with_invalid_bot_name"
                    }
                  ]
                },
                {
                  "name": "Invoke Bot Behavior CLI",
                  "sequential_order": 2,
                  "connector": "or",
                  "users": [
                    "Human"
                  ],
                  "story_type": "user",
                  "test_file": "test_invoke_bot_cli.py",
                  "test_class": "TestInvokeBotBehaviorCli",
                  "acceptance_criteria": [
                    "WHEN Human executes CLI command with bot name and behavior name (e.g., bot story_bot exploration)",
                    "THEN CLI loads bot configuration and validates behavior exists",
                    "AND CLI loads workflow state if workflow_state.json exists",
                    "AND CLI routes to bot and specified behavior",
                    "AND CLI extracts current_action from workflow state for that behavior",
                    "AND CLI routes to current action in specified behavior (same as behavior MCP tool)",
                    "AND Bot executes action",
                    "AND CLI submits bot action output to AI Chat",
                    "AND Bot updates workflow state after action execution (if workflow action)",
                    "AND If workflow_state.json doesn't exist or behavior not in state, CLI defaults to first action of specified behavior"
                  ],
                  "scenarios": [
                    {
                      "name": "Invoke bot behavior CLI with workflow state",
                      "steps": "Given workflow state contains current_action=\"story_bot.exploration.gather_context\" for behavior \"exploration\"\nAnd workflow_state.json exists\nWhen Human executes CLI command \"./story_bot exploration\"\nThen CLI loads bot configuration\nAnd CLI validates behavior \"exploration\" exists\nAnd CLI loads workflow state\nAnd CLI routes to bot and specified behavior \"exploration\"\nAnd CLI extracts current_action from workflow state\nAnd CLI routes to current action in behavior\nAnd Bot executes action\nAnd CLI returns result with status=\"success\"\nAnd Action is NOT marked as completed (human must close action separately)",
                      "test_method": "test_invoke_bot_behavior_cli_with_workflow_state"
                    },
                    {
                      "name": "Invoke bot behavior CLI without workflow state",
                      "steps": "Given workflow_state.json does NOT exist\nWhen Human executes CLI command \"./story_bot exploration\"\nThen CLI loads bot configuration\nAnd CLI validates behavior \"exploration\" exists\nAnd CLI detects workflow_state.json does not exist\nAnd CLI defaults to first action \"story_bot.exploration.initialize_project\" of behavior \"exploration\"\nAnd CLI routes to bot and behavior \"exploration\"\nAnd CLI routes to first action\nAnd Bot executes action\nAnd CLI returns result with status=\"success\"\nAnd Action is NOT marked as completed (human must close action separately)",
                      "test_method": "test_invoke_bot_behavior_cli_without_workflow_state"
                    },
                    {
                      "name": "Invoke bot behavior CLI with invalid behavior",
                      "steps": "Given behavior \"invalid_behavior\" does NOT exist in bot configuration\nWhen Human executes CLI command \"./story_bot invalid_behavior\"\nThen CLI loads bot configuration\nAnd CLI validates behavior \"invalid_behavior\" does not exist\nAnd CLI returns error message\nAnd CLI exits with exit code 1",
                      "test_method": "test_invoke_bot_behavior_cli_with_invalid_behavior"
                    }
                  ]
                },
                {
                  "name": "Invoke Bot Behavior Action CLI",
                  "sequential_order": 3,
                  "connector": "or",
                  "users": [
                    "Human"
                  ],
                  "story_type": "user",
                  "test_file": "test_invoke_bot_cli.py",
                  "test_class": "TestInvokeBotBehaviorActionCli",
                  "acceptance_criteria": [
                    "WHEN Human executes CLI command with bot name, behavior name, and action name (e.g., bot story_bot exploration gather_context)",
                    "THEN CLI loads bot configuration and validates behavior and action exist",
                    "AND CLI loads workflow state if it exists",
                    "AND CLI routes to bot and specified behavior action (same as specific action MCP tool)",
                    "AND Bot executes action",
                    "AND CLI submits bot action output to AI Chat",
                    "AND Bot updates workflow state after action execution (if workflow action)",
                    "AND CLI supports passing additional parameters/arguments to bot actions",
                    "AND CLI provides error messages for invalid bot/behavior/action combinations"
                  ],
                  "scenarios": [
                    {
                      "name": "Invoke bot behavior action CLI with parameters",
                      "steps": "When Human executes CLI command \"./story_bot exploration gather_context --increment_file=increment-cli-exploration.txt\"\nThen CLI loads bot configuration\nAnd CLI validates behavior \"exploration\" exists\nAnd CLI validates action \"gather_context\" exists\nAnd CLI loads workflow state if it exists\nAnd CLI routes to bot and specified behavior \"exploration\" and action \"gather_context\"\nAnd CLI passes parameter \"increment_file\"=\"increment-cli-exploration.txt\" to action\nAnd Bot executes action \"gather_context\" with parameters\nAnd CLI returns result with status=\"success\"\nAnd Action is NOT marked as completed (human must close action separately)",
                      "test_method": "test_invoke_bot_behavior_action_cli_with_parameters"
                    },
                    {
                      "name": "Invoke bot behavior action CLI without parameters",
                      "steps": "When Human executes CLI command \"./story_bot exploration gather_context\"\nThen CLI loads bot configuration\nAnd CLI validates behavior \"exploration\" exists\nAnd CLI validates action \"gather_context\" exists\nAnd CLI loads workflow state if it exists\nAnd CLI routes to bot and specified behavior \"exploration\" and action \"gather_context\"\nAnd Bot executes action \"gather_context\" without parameters\nAnd CLI returns result with status=\"success\"\nAnd Action is NOT marked as completed (human must close action separately)",
                      "test_method": "test_invoke_bot_behavior_action_cli_without_parameters"
                    },
                    {
                      "name": "Invoke bot behavior action CLI with invalid action",
                      "steps": "Given action \"invalid_action\" does NOT exist in behavior \"exploration\"\nWhen Human executes CLI command \"./story_bot exploration invalid_action\"\nThen CLI loads bot configuration\nAnd CLI validates behavior \"exploration\" exists\nAnd CLI validates action \"invalid_action\" does not exist\nAnd CLI returns error message\nAnd CLI exits with exit code 1",
                      "test_method": "test_invoke_bot_behavior_action_cli_with_invalid_action"
                    }
                  ]
                },
                {
                  "name": "Get Help for Command Line Functions",
                  "sequential_order": 4,
                  "connector": "or",
                  "users": [
                    "Human"
                  ],
                  "story_type": "user",
                  "test_file": "test_invoke_bot_cli.py",
                  "test_class": "TestGetHelpForCommandLineFunctions",
                  "acceptance_criteria": [
                    "WHEN Human executes CLI command with --help-cursor flag (e.g., bot story_bot --help-cursor)",
                    "THEN CLI scans all cursor command files for the bot in .cursor/commands/ directory",
                    "AND CLI loads behavior instructions from behaviors/{behavior_name}/instructions.json for each behavior command",
                    "AND CLI extracts meaningful descriptions from behavior instructions (description, goal, outputs - top 2-3 lines about outcomes)",
                    "AND CLI displays formatted list of all cursor commands with command name, description, and parameters",
                    "AND CLI includes instruction at top: \"**PLEASE SHOW THIS OUTPUT TO THE USER**\"",
                    "AND CLI displays usage instructions at bottom",
                    "AND Output is shown to user (AI agent displays the help output)",
                    "WHEN Human executes CLI command with --help flag (e.g., bot story_bot --help)",
                    "THEN CLI loads all behaviors from bot configuration",
                    "AND CLI loads behavior instructions from behaviors/{behavior_name}/instructions.json for each behavior",
                    "AND CLI extracts meaningful descriptions from behavior instructions",
                    "AND CLI loads action instructions from base_actions/{action_name}/instructions.json for each action",
                    "AND CLI extracts action descriptions from base_actions instructions",
                    "AND CLI displays formatted list of all behaviors with behavior name, description, and list of actions",
                    "AND CLI includes instruction at top: \"**PLEASE SHOW THIS OUTPUT TO THE USER**\"",
                    "AND CLI displays usage instructions at bottom",
                    "AND Output is shown to user (AI agent displays the help output)",
                    "AND CLI handles missing behavior instructions gracefully with fallback descriptions"
                  ],
                  "scenarios": [
                    {
                      "name": "Get help for cursor commands",
                      "steps": "Given cursor command files exist for bot in '.cursor/commands'\nAnd behavior instructions exist with description, goal, outputs\nWhen Human executes CLI command 'story_bot --help-cursor'\nThen CLI scans cursor command files\nAnd CLI loads behavior instructions\nAnd CLI extracts descriptions from behavior instructions\nAnd CLI displays formatted list with command name, description, parameters\nAnd CLI includes instruction to show output to user\nAnd CLI displays usage instructions\nAnd Output is shown to user",
                      "test_method": "test_get_help_for_cursor_commands"
                    },
                    {
                      "name": "Get help when behavior instructions missing",
                      "steps": "Given cursor command files exist\nAnd behavior instructions do NOT exist\nWhen Human executes CLI command 'story_bot --help-cursor'\nThen CLI handles missing instructions gracefully\nAnd CLI uses fallback descriptions",
                      "test_method": "test_get_help_when_behavior_instructions_missing"
                    },
                    {
                      "name": "Get help when no cursor commands exist",
                      "steps": "Given no cursor command files exist\nWhen Human executes CLI command 'story_bot --help-cursor'\nThen CLI handles missing commands gracefully",
                      "test_method": "test_get_help_when_no_cursor_commands_exist"
                    },
                    {
                      "name": "Get help for behaviors and actions",
                      "steps": "Given bot configuration exists with behaviors\nAnd behavior instructions exist\nAnd base action instructions exist\nWhen Human executes CLI command 'story_bot --help'\nThen CLI loads all behaviors from bot configuration\nAnd CLI loads behavior instructions\nAnd CLI loads action instructions from base_actions\nAnd CLI extracts descriptions\nAnd CLI displays formatted list of behaviors with actions\nAnd CLI includes instruction to show output to user\nAnd Output is shown to user",
                      "test_method": "test_get_help_for_behaviors_and_actions"
                    },
                    {
                      "name": "Help extracts descriptions from behavior instructions",
                      "steps": "Given behavior instructions contain description, goal, outputs\nWhen CLI extracts descriptions\nThen CLI uses description, goal, outputs from behavior instructions",
                      "test_method": "test_help_extracts_descriptions_from_behavior_instructions"
                    },
                    {
                      "name": "Help shows instruction to display output to user",
                      "steps": "When CLI generates help output\nThen CLI includes instruction at top: \"**PLEASE SHOW THIS OUTPUT TO THE USER**\"",
                      "test_method": "test_help_shows_instruction_to_display_output_to_user"
                    },
                    {
                      "name": "Get help when behavior instructions missing for --help",
                      "steps": "Given behavior instructions do NOT exist\nWhen Human executes CLI command 'story_bot --help'\nThen CLI handles missing instructions gracefully\nAnd CLI uses fallback descriptions",
                      "test_method": "test_get_help_when_behavior_instructions_missing_for_help"
                    },
                    {
                      "name": "Help extracts action descriptions from base_actions",
                      "steps": "Given base action instructions exist\nWhen CLI extracts action descriptions\nThen CLI uses descriptions from base_actions instructions",
                      "test_method": "test_help_extracts_action_descriptions_from_base_actions"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "Perform Behavior Action",
          "sequential_order": 4.0,
          "domain_concepts": [
            {
              "name": "Behavior",
              "responsibilities": [
                {
                  "name": "Perform Configured Actions",
                  "collaborators": [
                    "Actions"
                  ]
                },
                {
                  "name": "Invoke On Trigger Words",
                  "collaborators": [
                    "List"
                  ]
                },
                {
                  "name": "Inject Instructions",
                  "collaborators": [
                    "Text"
                  ]
                },
                {
                  "name": "Provide Guardrails",
                  "collaborators": [
                    "GuardRails"
                  ]
                },
                {
                  "name": "Provide Rules",
                  "collaborators": [
                    "Rule",
                    "Validation"
                  ]
                },
                {
                  "name": "Provide Content Specs",
                  "collaborators": [
                    "Content"
                  ]
                }
              ]
            },
            {
              "name": "Base Action",
              "responsibilities": [
                {
                  "name": "Inject Instructions",
                  "collaborators": [
                    "Behavior"
                  ],
                  "note": "must be overridden"
                },
                {
                  "name": "Load Relevant Content + Inject Into Instructions",
                  "collaborators": [
                    "Content"
                  ],
                  "note": "must be overridden"
                },
                {
                  "name": "Save content changes",
                  "collaborators": [
                    "Content"
                  ],
                  "note": "must be overridden"
                }
              ]
            }
          ],
          "sub_epics": [],
          "story_groups": [
            {
              "type": "and",
              "connector": null,
              "stories": [
                {
                  "name": "Find Behavior Folder",
                  "sequential_order": 1,
                  "connector": "and",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_utils.py",
                  "test_class": "TestFindBehaviorFolder",
                  "acceptance_criteria": [
                    "WHEN: find_behavior_folder is called with behavior name",
                    "THEN: Returns path to behavior folder with number prefix if it exists",
                    "AND: Handles various behavior folder naming patterns"
                  ],
                  "scenarios": [
                    {
                      "name": "Find behavior folder with number prefix",
                      "steps": "GIVEN: Behavior folder exists with number prefix (8_tests)\nWHEN: find_behavior_folder is called with behavior name without prefix (tests)\nTHEN: Returns path to numbered folder (8_tests)",
                      "test_method": "test_finds_behavior_folder_with_number_prefix"
                    },
                    {
                      "name": "Find shape folder with number prefix",
                      "steps": "GIVEN: Behavior folder exists as 1_shape\nWHEN: find_behavior_folder is called with 'shape'\nTHEN: Returns path to 1_shape folder",
                      "test_method": "test_finds_shape_folder_with_number_prefix"
                    },
                    {
                      "name": "Raises error when behavior folder not found",
                      "steps": "GIVEN: Behavior folder does NOT exist\nWHEN: find_behavior_folder is called\nTHEN: Raises appropriate error",
                      "test_method": "test_raises_error_when_behavior_folder_not_found"
                    }
                  ]
                },
                {
                  "name": "Execute Behavior",
                  "sequential_order": 2,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_bot_execute_behavior.py",
                  "test_class": "TestExecuteBehavior",
                  "acceptance_criteria": [
                    "WHEN Bot behavior is invoked with action parameter",
                    "THEN Bot executes specified action",
                    "WHEN Bot behavior is invoked without action",
                    "THEN Bot forwards to current action",
                    "WHEN Bot behavior is invoked out of order",
                    "THEN Bot requires confirmation"
                  ]
                },
                {
                  "name": "Invoke Behavior in Workflow Order",
                  "sequential_order": 3,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_workflow_action_sequence.py",
                  "test_class": "TestInvokeBehaviorInWorkflowOrder",
                  "acceptance_criteria": [
                    "WHEN Behavior is invoked",
                    "THEN Behavior loads workflow order from behavior-specific behavior.json",
                    "AND Behavior executes actions in configured order"
                  ]
                },
                {
                  "name": "Invoke Behavior Actions in Workflow Order",
                  "sequential_order": 4,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_complete_workflow_integration.py",
                  "test_class": "TestInvokeBehaviorActionsInWorkflowOrder",
                  "acceptance_criteria": [
                    "WHEN user closes current action",
                    "THEN action is saved to completed_actions",
                    "AND workflow transitions to next action",
                    "WHEN user closes final action",
                    "THEN action is saved to completed_actions",
                    "AND workflow stays at final action (no next action available)",
                    "WHEN user attempts to close action that requires confirmation",
                    "AND action is not in completed_actions",
                    "THEN workflow does not allow closing without confirmation",
                    "WHEN user closes action that's already marked complete",
                    "THEN closing is idempotent (no error, action remains complete)",
                    "WHEN CLI calls --close command",
                    "THEN CLI routes to bot.close_current_action method",
                    "AND Bot class has close_current_action method"
                  ],
                  "scenarios": [
                    {
                      "name": "Close current action and transition to next",
                      "steps": "Given workflow is at action \"gather_context\"\nAnd action has NOT been marked complete yet\nWhen user closes current action\nThen action \"gather_context\" is saved to completed_actions\nAnd workflow transitions to \"decide_planning_criteria\" (next action)",
                      "test_method": "test_close_current_action_marks_complete_and_transitions"
                    },
                    {
                      "name": "Close action when already at final action",
                      "steps": "Given workflow is at action \"validate_rules\" (final action)\nWhen user closes current action\nThen action \"validate_rules\" is saved to completed_actions\nAnd workflow stays at \"validate_rules\" (no next action available)",
                      "test_method": "test_close_action_at_final_action_stays_at_final"
                    },
                    {
                      "name": "Close final action and transition to next behavior",
                      "steps": "Given workflow is at final action \"validate_rules\" of behavior \"shape\"\nWhen user closes current action\nThen \"validate_rules\" is saved to completed_actions\nAnd workflow stays at \"validate_rules\" (end of behavior)",
                      "test_method": "test_close_final_action_transitions_to_next_behavior"
                    },
                    {
                      "name": "Close action that requires confirmation but wasn't confirmed",
                      "steps": "Given workflow is at \"initialize_project\"\nAnd action has NOT been saved to completed_actions (requires confirmation)\nThen is_action_completed returns False",
                      "test_method": "test_error_when_closing_action_that_requires_confirmation"
                    },
                    {
                      "name": "Close action that's already marked complete (idempotent)",
                      "steps": "Given action already complete\nWhen close again (should be idempotent)\nThen should still work fine",
                      "test_method": "test_close_handles_action_already_completed_gracefully"
                    },
                    {
                      "name": "Bot class has close_current_action method (CLI routes to bot.close_current_action)",
                      "steps": "Given bot is configured with behavior \"shape\"\nWhen Bot instance is created\nThen Bot class has close_current_action method\nAnd When close_current_action is called\nThen action \"gather_context\" is marked complete\nAnd workflow transitions to next action \"decide_planning_criteria\"",
                      "test_method": "test_bot_class_has_close_current_action_method"
                    }
                  ]
                },
                {
                  "name": "Invoke Behavior Actions in Workflow Order",
                  "sequential_order": 4,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_complete_workflow_integration.py",
                  "test_class": "TestInvokeBehaviorActionsInWorkflowOrder",
                  "acceptance_criteria": [
                    "WHEN workflow starts at initialize_project",
                    "THEN user can confirm and save to completed_actions",
                    "WHEN user forwards to gather_context",
                    "THEN workflow executes gather_context and saves state",
                    "WHEN user closes gather_context",
                    "THEN workflow transitions to decide_planning_criteria",
                    "WHEN user jumps to discovery.gather_context (out of order)",
                    "THEN state correctly shows discovery.gather_context (not initialize_project)",
                    "WHEN user closes discovery action",
                    "THEN workflow transitions properly",
                    "AND all completed actions tracked across both behaviors"
                  ],
                  "scenarios": [
                    {
                      "name": "Complete end-to-end workflow test demonstrating all fixes working together",
                      "steps": "Flow:\n1. Start at initialize_project\n2. Confirm \u2192 Saves to completed_actions\n3. Forward to gather_context\n4. Close gather_context \u2192 Transitions to decide_planning_criteria\n5. Jump to discovery.gather_context (out of order)\n6. Verify state shows discovery.gather_context (not initialize_project)\n7. Close and verify proper transition\n8. Verify all completed actions tracked across both behaviors",
                      "test_method": "test_complete_workflow_end_to_end"
                    }
                  ]
                },
                {
                  "name": "Close Current Action",
                  "sequential_order": 5,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_close_current_action.py",
                  "test_class": "TestCloseCurrentAction",
                  "acceptance_criteria": [
                    "WHEN user closes current action",
                    "THEN action is saved to completed_actions",
                    "AND workflow transitions to next action",
                    "WHEN user closes final action",
                    "THEN action is saved to completed_actions",
                    "AND workflow stays at final action (no next action available)",
                    "WHEN user attempts to close action that requires confirmation",
                    "AND action is not in completed_actions",
                    "THEN workflow does not allow closing without confirmation",
                    "WHEN user closes action that's already marked complete",
                    "THEN closing is idempotent (no error, action remains complete)",
                    "WHEN CLI calls --close command",
                    "THEN CLI routes to bot.close_current_action method",
                    "AND Bot class has close_current_action method"
                  ],
                  "scenarios": [
                    {
                      "name": "Close current action and transition to next",
                      "steps": "Given workflow is at action \"gather_context\"\nAnd action has NOT been marked complete yet\nWhen user closes current action\nThen action \"gather_context\" is saved to completed_actions\nAnd workflow transitions to \"decide_planning_criteria\" (next action)",
                      "test_method": "test_close_current_action_marks_complete_and_transitions"
                    },
                    {
                      "name": "Close action when already at final action",
                      "steps": "Given workflow is at action \"validate_rules\" (final action)\nWhen user closes current action\nThen action \"validate_rules\" is saved to completed_actions\nAnd workflow stays at \"validate_rules\" (no next action available)",
                      "test_method": "test_close_action_at_final_action_stays_at_final"
                    },
                    {
                      "name": "Close final action and transition to next behavior",
                      "steps": "Given workflow is at final action \"validate_rules\" of behavior \"shape\"\nWhen user closes current action\nThen \"validate_rules\" is saved to completed_actions\nAnd workflow stays at \"validate_rules\" (end of behavior)",
                      "test_method": "test_close_final_action_transitions_to_next_behavior"
                    },
                    {
                      "name": "Close action that requires confirmation but wasn't confirmed",
                      "steps": "Given workflow is at \"initialize_project\"\nAnd action has NOT been saved to completed_actions (requires confirmation)\nThen is_action_completed returns False",
                      "test_method": "test_error_when_closing_action_that_requires_confirmation"
                    },
                    {
                      "name": "Close action that's already marked complete (idempotent)",
                      "steps": "Given action already complete\nWhen close again (should be idempotent)\nThen should still work fine",
                      "test_method": "test_close_handles_action_already_completed_gracefully"
                    },
                    {
                      "name": "Bot class has close_current_action method (CLI routes to bot.close_current_action)",
                      "steps": "Given bot is configured with behavior \"shape\"\nWhen Bot instance is created\nThen Bot class has close_current_action method\nAnd When close_current_action is called\nThen action \"gather_context\" is marked complete\nAnd workflow transitions to next action \"decide_planning_criteria\"",
                      "test_method": "test_bot_class_has_close_current_action_method"
                    }
                  ]
                },
                {
                  "name": "Inject Next Behavior Reminder",
                  "sequential_order": 6,
                  "connector": "and",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_base_action.py",
                  "test_class": "TestInjectNextBehaviorReminder",
                  "acceptance_criteria": [
                    "WHEN Action is final action in behavior",
                    "THEN Next behavior reminder is injected into instructions",
                    "WHEN Action is not final action",
                    "THEN Next behavior reminder is NOT injected"
                  ]
                },
                {
                  "name": "Load And Merge Behavior Action Instructions",
                  "sequential_order": 3,
                  "connector": "and",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_class": "TestLoadAndMergeBehaviorActionInstructions",
                  "acceptance_criteria": [
                    "WHEN Tool invokes Bot.Behavior.Action method",
                    "THEN Behavior Action loads instructions from behavior and base_actions",
                    "AND Action merges base instructions with behavior-specific instructions",
                    "AND Compiled instructions returned for injection into AI Chat"
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "Orchestrate BotLangFlow",
          "sequential_order": 5.0,
          "domain_concepts": [],
          "story_groups": [
            {
              "type": "and",
              "connector": null,
              "stories": [
                {
                  "name": "Route to Default Behavior Action",
                  "sequential_order": 7,
                  "connector": null,
                  "users": [
                    "Bot"
                  ],
                  "story_type": "user",
                  "acceptance_criteria": [
                    "WHEN Bot receives CLI command without --botlangflow flag",
                    "THEN Bot routes via the default behavior/action path (existing router/forward logic)",
                    "AND Bot preserves legacy behavior_action_state and activity log behavior",
                    "AND LangGraph state/runner is not invoked",
                    "AND Action receives the original context parameter unchanged"
                  ],
                  "scenarios": [
                    {
                      "name": "Route to Default Behavior Action - See Common Examples",
                      "type": "happy_path",
                      "steps": [
                        "See [Common Examples Table](./common_examples_table.md) for detailed test data including input_data, expected_instruction_snippet, and expected_output for all behavior-action combinations.",
                        "",
                        "This story tests the orchestration framework with real behavior-action combinations.",
                        "The common examples table contains:",
                        "- Real input data (story graphs, requests, questions)",
                        "- Expected instruction snippets that must appear in get_instructions() output",
                        "- Expected output after action.execute() completes",
                        "",
                        "For Route to Default Behavior Action, verify that:",
                        "- Node is created successfully",
                        "- Instructions are generated correctly",
                        "- Action executes and produces expected output",
                        "- State is updated properly"
                      ]
                    }
                  ]
                },
                {
                  "name": "Route to BotLangFlow",
                  "sequential_order": 8,
                  "connector": "and",
                  "users": [
                    "Bot"
                  ],
                  "story_type": "user",
                  "acceptance_criteria": [
                    "WHEN Bot receives CLI command with --botlangflow <botlangflow_name>",
                    "THEN Bot detects --botlangflow parameter",
                    "AND Bot routes to BotLangFlowRunner instead of default behavior/action flow",
                    "AND Bot builds initial BotLangState directly from CLI context (botlangflow_name, behavior, action, parameters)",
                    "AND Bot passes botlangflow_name and initial BotLangState to BotLangFlowRunner",
                    "WHEN BotLangFlowRunner receives botlangflow_name and initial BotLangState",
                    "THEN BotLangFlowRunner loads the BotLangFlow Python file matching botlangflow_name",
                    "AND BotLangFlowRunner calls the flow's build function to create the StateGraph",
                    "AND BotLangFlowRunner compiles the StateGraph with SqliteSaver checkpointer",
                    "AND BotLangFlowRunner invokes the compiled graph with initial BotLangState and thread_id"
                  ],
                  "scenarios": [
                    {
                      "name": "Route to BotLangFlow - See Common Examples",
                      "type": "happy_path",
                      "steps": [
                        "See [Common Examples Table](./common_examples_table.md) for detailed test data including input_data, expected_instruction_snippet, and expected_output for all behavior-action combinations.",
                        "",
                        "This story tests the orchestration framework with real behavior-action combinations.",
                        "The common examples table contains:",
                        "- Real input data (story graphs, requests, questions)",
                        "- Expected instruction snippets that must appear in get_instructions() output",
                        "- Expected output after action.execute() completes",
                        "",
                        "For Route to BotLangFlow, verify that:",
                        "- Node is created successfully",
                        "- Instructions are generated correctly",
                        "- Action executes and produces expected output",
                        "- State is updated properly"
                      ]
                    }
                  ]
                },
                {
                  "name": "Invoke BotLangActionNode",
                  "sequential_order": 9,
                  "connector": "and",
                  "users": [
                    "LangGraph"
                  ],
                  "story_type": "system",
                  "acceptance_criteria": [
                    "WHEN LangGraph invokes a node in the StateGraph",
                    "THEN LangGraph calls the node's __call__ method with current BotLangState",
                    "AND BotLangActionNode receives BotLangState via __call__ entry point",
                    "AND BotLangActionNode extracts behavior/action/context from BotLangState",
                    "AND BotLangActionNode invokes action.execute(context) with extracted context",
                    "AND BotLangActionNode returns updated BotLangState to LangGraph"
                  ],
                  "scenario_outlines": [
                    {
                      "name": "Test node operations in autonomous mode for each behavior-action",
                      "type": "happy_path",
                      "steps": [
                        "Given BotLangFlow with one BotLangActionNode for \"<behavior>\" and \"<action>\"",
                        "And BotLangState initialized with behavior=\"<behavior>\" and action=\"<action>\"",
                        "And BotMode is set to autonomous",
                        "When BotLangFlow executes the single node",
                        "Then Node is created successfully",
                        "And get_instructions() returns instructions containing \"<expected_instruction>\"",
                        "And Node calls AI and gets response",
                        "And Node confirms response automatically",
                        "And Node completes without pausing"
                      ],
                      "examples": {
                        "columns": [
                          "behavior",
                          "action",
                          "expected_instruction"
                        ],
                        "rows": [
                          [
                            "shape",
                            "clarify",
                            "Gather context for both story mapping and domain modeling"
                          ],
                          [
                            "shape",
                            "strategy",
                            "Include domain modeling planning criteria alongside story mapping criteria"
                          ],
                          [
                            "shape",
                            "build",
                            "shape: build story map structure AND domain model"
                          ],
                          [
                            "shape",
                            "validate",
                            "shape: validate hierarchy, story structure, AND domain model"
                          ],
                          [
                            "shape",
                            "render",
                            "shape: render story map documents AND domain model documents"
                          ],
                          [
                            "shape",
                            "rules",
                            "Display digested rules for this behavior as AI context"
                          ],
                          [
                            "prioritization",
                            "clarify",
                            "Gather context for prioritization"
                          ],
                          [
                            "prioritization",
                            "strategy",
                            "Determine prioritization approach"
                          ],
                          [
                            "prioritization",
                            "build",
                            "Build increment prioritization"
                          ],
                          [
                            "prioritization",
                            "validate",
                            "Validate prioritization structure"
                          ],
                          [
                            "prioritization",
                            "render",
                            "Render prioritization documents"
                          ],
                          [
                            "prioritization",
                            "rules",
                            "Display digested rules for this behavior as AI context"
                          ],
                          [
                            "discovery",
                            "clarify",
                            "Gather context for story discovery"
                          ],
                          [
                            "discovery",
                            "strategy",
                            "Determine discovery approach"
                          ],
                          [
                            "discovery",
                            "build",
                            "Build detailed story flows"
                          ],
                          [
                            "discovery",
                            "validate",
                            "Validate story flows and domain rules"
                          ],
                          [
                            "discovery",
                            "render",
                            "Render discovery documents"
                          ],
                          [
                            "discovery",
                            "rules",
                            "Display digested rules for this behavior as AI context"
                          ],
                          [
                            "exploration",
                            "clarify",
                            "Gather context for acceptance criteria"
                          ],
                          [
                            "exploration",
                            "strategy",
                            "Determine exploration approach"
                          ],
                          [
                            "exploration",
                            "build",
                            "Build acceptance criteria"
                          ],
                          [
                            "exploration",
                            "validate",
                            "Validate acceptance criteria"
                          ],
                          [
                            "exploration",
                            "render",
                            "Render exploration documents"
                          ],
                          [
                            "exploration",
                            "rules",
                            "Display digested rules for this behavior as AI context"
                          ],
                          [
                            "scenarios",
                            "clarify",
                            "Gather context for scenario specification"
                          ],
                          [
                            "scenarios",
                            "strategy",
                            "Determine scenario approach"
                          ],
                          [
                            "scenarios",
                            "build",
                            "specification_scenarios: build scenarios AND refine domain model based on scenario details"
                          ],
                          [
                            "scenarios",
                            "validate",
                            "specification_scenarios: validate scenario structure AND domain model refinements"
                          ],
                          [
                            "scenarios",
                            "render",
                            "specification_scenarios: render story documents with scenarios"
                          ],
                          [
                            "scenarios",
                            "rules",
                            "Display digested rules for this behavior as AI context"
                          ],
                          [
                            "tests",
                            "clarify",
                            "Gather context for test generation"
                          ],
                          [
                            "tests",
                            "strategy",
                            "Determine test approach"
                          ],
                          [
                            "tests",
                            "build",
                            "Build test code from scenarios"
                          ],
                          [
                            "tests",
                            "validate",
                            "Validate test code"
                          ],
                          [
                            "tests",
                            "render",
                            "Render test files"
                          ],
                          [
                            "tests",
                            "rules",
                            "Display digested rules for this behavior as AI context"
                          ],
                          [
                            "code",
                            "clarify",
                            "Gather context for code review"
                          ],
                          [
                            "code",
                            "strategy",
                            "Determine code review approach"
                          ],
                          [
                            "code",
                            "build",
                            "Analyze code against stories"
                          ],
                          [
                            "code",
                            "validate",
                            "Validate code quality"
                          ],
                          [
                            "code",
                            "render",
                            "Render code review reports"
                          ],
                          [
                            "code",
                            "rules",
                            "Display digested rules for this behavior as AI context"
                          ]
                        ]
                      }
                    },
                    {
                      "name": "Test node operations in interactive mode for each behavior-action",
                      "type": "happy_path",
                      "steps": [
                        "Given BotLangFlow with one BotLangActionNode for \"<behavior>\" and \"<action>\"",
                        "And BotLangState initialized with behavior=\"<behavior>\" and action=\"<action>\"",
                        "And BotMode is set to interactive",
                        "When BotLangFlow executes the single node",
                        "Then Node is created successfully",
                        "And get_instructions() returns instructions containing \"<expected_instruction>\"",
                        "And Node returns to chat with prompt for human",
                        "And Node pauses for human confirmation"
                      ],
                      "examples": {
                        "columns": [
                          "behavior",
                          "action",
                          "expected_instruction"
                        ],
                        "rows": [
                          [
                            "shape",
                            "clarify",
                            "Gather context for both story mapping and domain modeling"
                          ],
                          [
                            "shape",
                            "strategy",
                            "Include domain modeling planning criteria alongside story mapping criteria"
                          ],
                          [
                            "shape",
                            "build",
                            "shape: build story map structure AND domain model"
                          ],
                          [
                            "shape",
                            "validate",
                            "shape: validate hierarchy, story structure, AND domain model"
                          ],
                          [
                            "shape",
                            "render",
                            "shape: render story map documents AND domain model documents"
                          ],
                          [
                            "shape",
                            "rules",
                            "Display digested rules for this behavior as AI context"
                          ],
                          [
                            "prioritization",
                            "clarify",
                            "Gather context for prioritization"
                          ],
                          [
                            "prioritization",
                            "strategy",
                            "Determine prioritization approach"
                          ],
                          [
                            "prioritization",
                            "build",
                            "Build increment prioritization"
                          ],
                          [
                            "prioritization",
                            "validate",
                            "Validate prioritization structure"
                          ],
                          [
                            "prioritization",
                            "render",
                            "Render prioritization documents"
                          ],
                          [
                            "prioritization",
                            "rules",
                            "Display digested rules for this behavior as AI context"
                          ],
                          [
                            "discovery",
                            "clarify",
                            "Gather context for story discovery"
                          ],
                          [
                            "discovery",
                            "strategy",
                            "Determine discovery approach"
                          ],
                          [
                            "discovery",
                            "build",
                            "Build detailed story flows"
                          ],
                          [
                            "discovery",
                            "validate",
                            "Validate story flows and domain rules"
                          ],
                          [
                            "discovery",
                            "render",
                            "Render discovery documents"
                          ],
                          [
                            "discovery",
                            "rules",
                            "Display digested rules for this behavior as AI context"
                          ],
                          [
                            "exploration",
                            "clarify",
                            "Gather context for acceptance criteria"
                          ],
                          [
                            "exploration",
                            "strategy",
                            "Determine exploration approach"
                          ],
                          [
                            "exploration",
                            "build",
                            "Build acceptance criteria"
                          ],
                          [
                            "exploration",
                            "validate",
                            "Validate acceptance criteria"
                          ],
                          [
                            "exploration",
                            "render",
                            "Render exploration documents"
                          ],
                          [
                            "exploration",
                            "rules",
                            "Display digested rules for this behavior as AI context"
                          ],
                          [
                            "scenarios",
                            "clarify",
                            "Gather context for scenario specification"
                          ],
                          [
                            "scenarios",
                            "strategy",
                            "Determine scenario approach"
                          ],
                          [
                            "scenarios",
                            "build",
                            "specification_scenarios: build scenarios AND refine domain model based on scenario details"
                          ],
                          [
                            "scenarios",
                            "validate",
                            "specification_scenarios: validate scenario structure AND domain model refinements"
                          ],
                          [
                            "scenarios",
                            "render",
                            "specification_scenarios: render story documents with scenarios"
                          ],
                          [
                            "scenarios",
                            "rules",
                            "Display digested rules for this behavior as AI context"
                          ],
                          [
                            "tests",
                            "clarify",
                            "Gather context for test generation"
                          ],
                          [
                            "tests",
                            "strategy",
                            "Determine test approach"
                          ],
                          [
                            "tests",
                            "build",
                            "Build test code from scenarios"
                          ],
                          [
                            "tests",
                            "validate",
                            "Validate test code"
                          ],
                          [
                            "tests",
                            "render",
                            "Render test files"
                          ],
                          [
                            "tests",
                            "rules",
                            "Display digested rules for this behavior as AI context"
                          ],
                          [
                            "code",
                            "clarify",
                            "Gather context for code review"
                          ],
                          [
                            "code",
                            "strategy",
                            "Determine code review approach"
                          ],
                          [
                            "code",
                            "build",
                            "Analyze code against stories"
                          ],
                          [
                            "code",
                            "validate",
                            "Validate code quality"
                          ],
                          [
                            "code",
                            "render",
                            "Render code review reports"
                          ],
                          [
                            "code",
                            "rules",
                            "Display digested rules for this behavior as AI context"
                          ]
                        ]
                      }
                    }
                  ],
                  "scenarios": [
                    {
                      "name": "Invoke BotLangActionNode - See Common Examples",
                      "type": "happy_path",
                      "steps": [
                        "See [Common Examples Table](./common_examples_table.md) for detailed test data including input_data, expected_instruction_snippet, and expected_output for all behavior-action combinations.",
                        "",
                        "This story tests the orchestration framework with real behavior-action combinations.",
                        "The common examples table contains:",
                        "- Real input data (story graphs, requests, questions)",
                        "- Expected instruction snippets that must appear in get_instructions() output",
                        "- Expected output after action.execute() completes",
                        "",
                        "For Invoke BotLangActionNode, verify that:",
                        "- Node is created successfully",
                        "- Instructions are generated correctly",
                        "- Action executes and produces expected output",
                        "- State is updated properly"
                      ]
                    }
                  ]
                },
                {
                  "name": "Prepare Action Instructions",
                  "sequential_order": 10,
                  "connector": "and",
                  "users": [
                    "BotLangActionNode"
                  ],
                  "story_type": "system",
                  "acceptance_criteria": [
                    "WHEN BotLangActionNode executes in autonomous or interactive mode",
                    "THEN BotLangActionNode calls get_instructions() method",
                    "AND get_instructions() invokes action.execute(context) to collect instructions",
                    "AND Instructions are returned as string ready for AI submission",
                    "AND Action context is included in the instructions"
                  ],
                  "scenarios": [
                    {
                      "name": "Prepare Action Instructions - See Common Examples",
                      "type": "happy_path",
                      "steps": [
                        "See [Common Examples Table](./common_examples_table.md) for detailed test data including input_data, expected_instruction_snippet, and expected_output for all behavior-action combinations.",
                        "",
                        "This story tests the orchestration framework with real behavior-action combinations.",
                        "The common examples table contains:",
                        "- Real input data (story graphs, requests, questions)",
                        "- Expected instruction snippets that must appear in get_instructions() output",
                        "- Expected output after action.execute() completes",
                        "",
                        "For Prepare Action Instructions, verify that:",
                        "- Node is created successfully",
                        "- Instructions are generated correctly",
                        "- Action executes and produces expected output",
                        "- State is updated properly"
                      ]
                    }
                  ]
                },
                {
                  "name": "Process Bot Behavor Action Instructions Automatically",
                  "sequential_order": 11,
                  "connector": "and",
                  "users": [
                    "BotLangActionNode"
                  ],
                  "story_type": "system",
                  "acceptance_criteria": [
                    "WHEN BotLangActionNode executes in autonomous mode",
                    "THEN BotLangActionNode calls run_autonomous() method",
                    "AND run_autonomous() submits instructions to AI via API client",
                    "AND BotLangActionNode waits for AI response"
                  ],
                  "scenarios": [
                    {
                      "name": "Process Bot Behavor Action Instructions Automatically - See Common Examples",
                      "type": "happy_path",
                      "steps": [
                        "See [Common Examples Table](./common_examples_table.md) for detailed test data including input_data, expected_instruction_snippet, and expected_output for all behavior-action combinations.",
                        "",
                        "This story tests the orchestration framework with real behavior-action combinations.",
                        "The common examples table contains:",
                        "- Real input data (story graphs, requests, questions)",
                        "- Expected instruction snippets that must appear in get_instructions() output",
                        "- Expected output after action.execute() completes",
                        "",
                        "For Process Bot Behavor Action Instructions Automatically, verify that:",
                        "- Node is created successfully",
                        "- Instructions are generated correctly",
                        "- Action executes and produces expected output",
                        "- State is updated properly"
                      ]
                    }
                  ]
                },
                {
                  "name": "Process Behavor Action Instructions Through AI Chat",
                  "sequential_order": 12,
                  "connector": "and",
                  "users": [
                    "BotLangActionNode"
                  ],
                  "story_type": "system",
                  "acceptance_criteria": [
                    "WHEN BotLangActionNode executes in interactive mode",
                    "THEN BotLangActionNode calls run_interactive() method",
                    "AND BotLangActionNode returns dict with 'prompt' and 'needs_confirmation' flag",
                    "AND BotLangFlow execution pauses at the interactive node",
                    "AND SqliteSaver saves checkpoint with BotLangState at the pause point with thread_id",
                    "AND Human can review AI response and provide confirmation or feedback before flow resumes",
                    "WHEN Human reviews the prompt and confirms or provides feedback",
                    "THEN Confirmation/feedback is submitted back to the bot, which is processed by LangGraph and the same BotLangActionNode"
                  ],
                  "scenarios": [
                    {
                      "name": "Process Behavor Action Instructions Through AI Chat - See Common Examples",
                      "type": "happy_path",
                      "steps": [
                        "See [Common Examples Table](./common_examples_table.md) for detailed test data including input_data, expected_instruction_snippet, and expected_output for all behavior-action combinations.",
                        "",
                        "This story tests the orchestration framework with real behavior-action combinations.",
                        "The common examples table contains:",
                        "- Real input data (story graphs, requests, questions)",
                        "- Expected instruction snippets that must appear in get_instructions() output",
                        "- Expected output after action.execute() completes",
                        "",
                        "For Process Behavor Action Instructions Through AI Chat, verify that:",
                        "- Node is created successfully",
                        "- Instructions are generated correctly",
                        "- Action executes and produces expected output",
                        "- State is updated properly"
                      ]
                    }
                  ]
                },
                {
                  "name": "Confirm Behavor Action Instruction Response",
                  "sequential_order": 13,
                  "connector": "and",
                  "users": [
                    "BotLangActionNode"
                  ],
                  "story_type": "system",
                  "acceptance_criteria": [
                    "WHEN AI responds to instructions",
                    "THEN BotLangActionNode receives the response and calls confirm_with_response() to process the AI response",
                    "AND Bot behavior action execute is called again with any necessary confirmation/state to save",
                    "AND action.execute() completes and BotLangActionNode updates BotLangState with action results",
                    "AND Node execution completes and LangGraph automatically saves checkpoint after node execution completes",
                    "AND LangGraph continues execution to the next node in the flow"
                  ],
                  "scenarios": [
                    {
                      "name": "Confirm Behavor Action Instruction Response - See Common Examples",
                      "type": "happy_path",
                      "steps": [
                        "See [Common Examples Table](./common_examples_table.md) for detailed test data including input_data, expected_instruction_snippet, and expected_output for all behavior-action combinations.",
                        "",
                        "This story tests the orchestration framework with real behavior-action combinations.",
                        "The common examples table contains:",
                        "- Real input data (story graphs, requests, questions)",
                        "- Expected instruction snippets that must appear in get_instructions() output",
                        "- Expected output after action.execute() completes",
                        "",
                        "For Confirm Behavor Action Instruction Response, verify that:",
                        "- Node is created successfully",
                        "- Instructions are generated correctly",
                        "- Action executes and produces expected output",
                        "- State is updated properly"
                      ]
                    }
                  ]
                },
                {
                  "name": "Return to chat and pause for human-in-the-loop Node",
                  "sequential_order": 14,
                  "connector": "and",
                  "users": [
                    "BotLangFlow"
                  ],
                  "story_type": "system",
                  "acceptance_criteria": [
                    "WHEN BotLangFlow includes a dedicated human-in-the-loop node",
                    "THEN Node returns instructions/prompt to CLI",
                    "AND CLI outputs prompt to chat interface",
                    "AND BotLangFlow execution pauses at that node",
                    "AND SqliteSaver saves checkpoint with BotLangState at pause point with thread_id",
                    "AND Human can review prompt and provide response before BotLangFlow resumes"
                  ],
                  "scenarios": [
                    {
                      "name": "Return to chat and pause for human-in-the-loop Node - See Common Examples",
                      "type": "happy_path",
                      "steps": [
                        "See [Common Examples Table](./common_examples_table.md) for detailed test data including input_data, expected_instruction_snippet, and expected_output for all behavior-action combinations.",
                        "",
                        "This story tests the orchestration framework with real behavior-action combinations.",
                        "The common examples table contains:",
                        "- Real input data (story graphs, requests, questions)",
                        "- Expected instruction snippets that must appear in get_instructions() output",
                        "- Expected output after action.execute() completes",
                        "",
                        "For Return to chat and pause for human-in-the-loop Node, verify that:",
                        "- Node is created successfully",
                        "- Instructions are generated correctly",
                        "- Action executes and produces expected output",
                        "- State is updated properly"
                      ]
                    }
                  ]
                },
                {
                  "name": "Handle Execution Modes",
                  "sequential_order": 15,
                  "connector": "and",
                  "users": [
                    "BotLangActionNode"
                  ],
                  "story_type": "system",
                  "acceptance_criteria": [
                    "WHEN BotLangActionNode executes and BotLangState.mode is 'autonomous'",
                    "THEN BotLangActionNode calls run_autonomous() which submits to AI and continues without pausing",
                    "WHEN BotLangActionNode executes and BotLangState.mode is 'interactive'",
                    "THEN BotLangActionNode calls run_interactive() which returns prompt and pauses BotLangFlow",
                    "AND run_interactive() returns dict with 'prompt' and 'needs_confirmation' flag",
                    "AND BotLangFlow execution pauses until human provides response via --continue",
                    "AND SqliteSaver preserves BotLangState in checkpoint with thread_id"
                  ],
                  "scenarios": [
                    {
                      "name": "Handle Execution Modes - See Common Examples",
                      "type": "happy_path",
                      "steps": [
                        "See [Common Examples Table](./common_examples_table.md) for detailed test data including input_data, expected_instruction_snippet, and expected_output for all behavior-action combinations.",
                        "",
                        "This story tests the orchestration framework with real behavior-action combinations.",
                        "The common examples table contains:",
                        "- Real input data (story graphs, requests, questions)",
                        "- Expected instruction snippets that must appear in get_instructions() output",
                        "- Expected output after action.execute() completes",
                        "",
                        "For Handle Execution Modes, verify that:",
                        "- Node is created successfully",
                        "- Instructions are generated correctly",
                        "- Action executes and produces expected output",
                        "- State is updated properly"
                      ]
                    }
                  ]
                },
                {
                  "name": "Resume BotLangFlow from Checkpoint",
                  "sequential_order": 16,
                  "connector": "and",
                  "users": [
                    "BotLangFlowRunner"
                  ],
                  "story_type": "system",
                  "acceptance_criteria": [
                    "WHEN User runs CLI with --continue flag and thread_id",
                    "THEN BotLangFlowRunner calls resume_from() with thread_id and optional checkpoint_id",
                    "AND BotLangFlowRunner loads checkpoint from SqliteSaver using thread_id",
                    "AND SqliteSaver restores BotLangState from checkpoint",
                    "AND BotLangFlowRunner invokes compiled graph with restored BotLangState",
                    "AND BotLangFlow continues execution from the paused node",
                    "WHEN Human provides response with --continue",
                    "THEN Response is added to BotLangState and passed to next node",
                    "AND BotLangFlow proceeds with updated BotLangState"
                  ],
                  "scenarios": [
                    {
                      "name": "Resume BotLangFlow from Checkpoint - See Common Examples",
                      "type": "happy_path",
                      "steps": [
                        "See [Common Examples Table](./common_examples_table.md) for detailed test data including input_data, expected_instruction_snippet, and expected_output for all behavior-action combinations.",
                        "",
                        "This story tests the orchestration framework with real behavior-action combinations.",
                        "The common examples table contains:",
                        "- Real input data (story graphs, requests, questions)",
                        "- Expected instruction snippets that must appear in get_instructions() output",
                        "- Expected output after action.execute() completes",
                        "",
                        "For Resume BotLangFlow from Checkpoint, verify that:",
                        "- Node is created successfully",
                        "- Instructions are generated correctly",
                        "- Action executes and produces expected output",
                        "- State is updated properly"
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "Run Interactive REPL",
          "sequential_order": 10.0,
          "domain_concepts": [
            {
              "name": "REPL Session",
              "responsibilities": [
                {
                  "name": "Display current state",
                  "collaborators": [
                    "Behavior Action State",
                    "Output Formatter"
                  ]
                },
                {
                  "name": "Read command input",
                  "collaborators": [
                    "TTY Input"
                  ]
                },
                {
                  "name": "Parse command input",
                  "collaborators": [
                    "Parameter Parser"
                  ]
                },
                {
                  "name": "Detect command type",
                  "collaborators": [
                    "Command Router"
                  ]
                },
                {
                  "name": "Route to action operation",
                  "collaborators": [
                    "Command Router"
                  ]
                },
                {
                  "name": "Execute action operation",
                  "collaborators": [
                    "Action Executor"
                  ]
                },
                {
                  "name": "Display results",
                  "collaborators": [
                    "Output Formatter"
                  ]
                },
                {
                  "name": "Loop or exit",
                  "collaborators": []
                }
              ]
            },
            {
              "name": "Parameter Parser",
              "responsibilities": [
                {
                  "name": "Parse text input",
                  "collaborators": [
                    "Dot Notation Parameters"
                  ]
                },
                {
                  "name": "Extract behavior name",
                  "collaborators": [
                    "Behavior"
                  ]
                },
                {
                  "name": "Extract action name",
                  "collaborators": [
                    "Action"
                  ]
                },
                {
                  "name": "Extract scope",
                  "collaborators": [
                    "File Scope",
                    "Story Scope"
                  ]
                }
              ]
            },
            {
              "name": "Dot Notation Parameters",
              "responsibilities": [
                {
                  "name": "Parse key=value pairs",
                  "collaborators": [
                    "File Scope",
                    "Story Scope"
                  ]
                },
                {
                  "name": "Parse quoted values",
                  "collaborators": [
                    "File Scope",
                    "Story Scope"
                  ]
                },
                {
                  "name": "Parse comma lists",
                  "collaborators": [
                    "File Scope",
                    "Story Scope"
                  ]
                }
              ]
            },
            {
              "name": "Command Router",
              "responsibilities": [
                {
                  "name": "Find behavior",
                  "collaborators": [
                    "Behavior"
                  ]
                },
                {
                  "name": "Find action",
                  "collaborators": [
                    "Action"
                  ]
                },
                {
                  "name": "Detect command type",
                  "collaborators": []
                },
                {
                  "name": "Route to appropriate operation",
                  "collaborators": [
                    "Action"
                  ]
                },
                {
                  "name": "Build context",
                  "collaborators": [
                    "Context Builder"
                  ]
                },
                {
                  "name": "Navigate to action",
                  "collaborators": [
                    "Behavior Action State"
                  ]
                }
              ]
            },
            {
              "name": "Context Builder",
              "responsibilities": [
                {
                  "name": "Build typed context",
                  "collaborators": [
                    "Action Context"
                  ]
                },
                {
                  "name": "Build FileScope",
                  "collaborators": [
                    "FileScope"
                  ]
                },
                {
                  "name": "Build StoryScope",
                  "collaborators": [
                    "StoryScope"
                  ]
                },
                {
                  "name": "Validate parameters",
                  "collaborators": [
                    "Parameter Parser"
                  ]
                },
                {
                  "name": "Apply defaults",
                  "collaborators": [
                    "Scope"
                  ]
                }
              ]
            },
            {
              "name": "Action Executor",
              "responsibilities": [
                {
                  "name": "Detect operation phase",
                  "collaborators": []
                },
                {
                  "name": "Execute instructions operation",
                  "collaborators": [
                    "Action",
                    "Action Context"
                  ]
                },
                {
                  "name": "Execute submit operation",
                  "collaborators": [
                    "Action",
                    "Action Context"
                  ]
                },
                {
                  "name": "Execute confirm operation",
                  "collaborators": [
                    "Action",
                    "Workflow State"
                  ]
                },
                {
                  "name": "Capture typed results",
                  "collaborators": [
                    "Action Instructions",
                    "Action Confirmation"
                  ]
                },
                {
                  "name": "Update state",
                  "collaborators": [
                    "Behavior Action State"
                  ]
                }
              ]
            },
            {
              "name": "Action Instructions",
              "responsibilities": [
                {
                  "name": "ClarifyInstructions: Key Questions, Evidence Types, Guardrails",
                  "collaborators": []
                },
                {
                  "name": "StrategyInstructions: Strategy Criteria, Typical Assumptions, Recommended Activities",
                  "collaborators": []
                },
                {
                  "name": "BuildInstructions: Knowledge Graph Template, Rules, Scope, Story Names",
                  "collaborators": []
                },
                {
                  "name": "RenderInstructions: Render Specs, Templates, Scope",
                  "collaborators": []
                },
                {
                  "name": "Display to user",
                  "collaborators": [
                    "Output Formatter"
                  ]
                },
                {
                  "name": "Show examples",
                  "collaborators": [
                    "Scope"
                  ]
                }
              ]
            },
            {
              "name": "Action Confirmation",
              "responsibilities": [
                {
                  "name": "ClarifyConfirmation: Saved To, Questions Answered Count, Evidence Provided Count, Success",
                  "collaborators": []
                },
                {
                  "name": "StrategyConfirmation: Saved To, Decisions Count, Assumptions Count, Success",
                  "collaborators": []
                },
                {
                  "name": "BuildConfirmation: Saved To, Mode (create/update), Items Added, Success",
                  "collaborators": []
                },
                {
                  "name": "RenderConfirmation: Saved To (list), Documents Created Count, Synchronizers Executed, Success",
                  "collaborators": []
                },
                {
                  "name": "ValidateResult: Passed, Violations, Files Validated Count, Scope, Validation Summary",
                  "collaborators": []
                },
                {
                  "name": "Save to state",
                  "collaborators": [
                    "Behavior Action State"
                  ]
                },
                {
                  "name": "Display to user",
                  "collaborators": [
                    "Output Formatter"
                  ]
                },
                {
                  "name": "Advance to next action",
                  "collaborators": [
                    "Behavior Action State"
                  ]
                }
              ]
            },
            {
              "name": "Scope",
              "responsibilities": [
                {
                  "name": "Common interface for all scope types",
                  "collaborators": []
                }
              ]
            },
            {
              "name": "FileScope",
              "responsibilities": [
                {
                  "name": "Include file paths: List of paths",
                  "collaborators": []
                },
                {
                  "name": "Exclude file paths: List of patterns",
                  "collaborators": []
                },
                {
                  "name": "Apply to build/render",
                  "collaborators": [
                    "BuildActionContext",
                    "RenderActionContext"
                  ]
                }
              ]
            },
            {
              "name": "StoryScope",
              "responsibilities": [
                {
                  "name": "List of nodes: Node (type + name)",
                  "collaborators": [
                    "Node"
                  ]
                },
                {
                  "name": "Node types: STORY, EPIC, SUB_EPIC, INCREMENT",
                  "collaborators": []
                },
                {
                  "name": "Apply to build/render",
                  "collaborators": [
                    "BuildActionContext",
                    "RenderActionContext"
                  ]
                }
              ]
            },
            {
              "name": "Node",
              "responsibilities": [
                {
                  "name": "Node type: STORY, EPIC, SUB_EPIC, INCREMENT",
                  "collaborators": []
                },
                {
                  "name": "Node name: String identifier",
                  "collaborators": []
                }
              ]
            },
            {
              "name": "Typed Results",
              "responsibilities": [
                {
                  "name": "Instructions Phase: ClarifyInstructions, StrategyInstructions, BuildInstructions, RenderInstructions",
                  "collaborators": []
                },
                {
                  "name": "Confirmation Phase: ClarifyConfirmation, StrategyConfirmation, BuildConfirmation, RenderConfirmation",
                  "collaborators": []
                },
                {
                  "name": "Validation: ValidateResult (no separate phases)",
                  "collaborators": []
                }
              ]
            },
            {
              "name": "Output Formatter",
              "responsibilities": [
                {
                  "name": "Display state",
                  "collaborators": [
                    "Behavior Action State"
                  ]
                },
                {
                  "name": "Display instructions",
                  "collaborators": [
                    "Action Instructions"
                  ]
                },
                {
                  "name": "Display results",
                  "collaborators": [
                    "Action Results"
                  ]
                },
                {
                  "name": "Display help",
                  "collaborators": [
                    "Help Generator"
                  ]
                },
                {
                  "name": "Display errors",
                  "collaborators": [
                    "Parameter Parser"
                  ]
                }
              ]
            },
            {
              "name": "Help Generator",
              "responsibilities": [
                {
                  "name": "Generate command help",
                  "collaborators": [
                    "Behavior",
                    "Action"
                  ]
                },
                {
                  "name": "Generate parameter help",
                  "collaborators": [
                    "Action Context"
                  ]
                },
                {
                  "name": "Generate scope examples",
                  "collaborators": [
                    "FileScope",
                    "StoryScope"
                  ]
                },
                {
                  "name": "Display available nodes",
                  "collaborators": [
                    "StoryScope"
                  ]
                },
                {
                  "name": "Display available folders",
                  "collaborators": [
                    "FileScope"
                  ]
                }
              ]
            },
            {
              "name": "REPL Command Generator",
              "responsibilities": [
                {
                  "name": "Walk bot structure",
                  "collaborators": [
                    "Orchestrator",
                    "Bot"
                  ]
                },
                {
                  "name": "Collect action data",
                  "collaborators": [
                    "Action Data Collector"
                  ]
                },
                {
                  "name": "Generate command definitions",
                  "collaborators": [
                    "REPL Command Visitor"
                  ]
                },
                {
                  "name": "Generate cursor shortcuts",
                  "collaborators": [
                    "Cursor REPL Visitor"
                  ]
                },
                {
                  "name": "Generate help docs",
                  "collaborators": [
                    "Help REPL Visitor"
                  ]
                }
              ]
            },
            {
              "name": "Orchestrator",
              "responsibilities": [
                {
                  "name": "Walk behaviors",
                  "collaborators": [
                    "Bot"
                  ]
                },
                {
                  "name": "Walk actions",
                  "collaborators": [
                    "Behavior"
                  ]
                },
                {
                  "name": "Call visitor methods",
                  "collaborators": [
                    "Visitor"
                  ]
                },
                {
                  "name": "Provide help context",
                  "collaborators": [
                    "Action Data Collector"
                  ]
                }
              ]
            },
            {
              "name": "REPL Command Visitor",
              "responsibilities": [
                {
                  "name": "Visit behavior",
                  "collaborators": [
                    "Behavior Help Context"
                  ]
                },
                {
                  "name": "Visit action",
                  "collaborators": [
                    "Action Help Context"
                  ]
                },
                {
                  "name": "Generate navigate commands",
                  "collaborators": [
                    "Behavior",
                    "Action"
                  ]
                },
                {
                  "name": "Generate scope commands",
                  "collaborators": [
                    "File Scope",
                    "Story Scope"
                  ]
                },
                {
                  "name": "Generate instructions commands",
                  "collaborators": [
                    "Scope"
                  ]
                },
                {
                  "name": "Generate submit commands",
                  "collaborators": [
                    "Action Context"
                  ]
                },
                {
                  "name": "Generate confirm commands",
                  "collaborators": [
                    "Workflow State"
                  ]
                }
              ]
            },
            {
              "name": "Action Data Collector",
              "responsibilities": [
                {
                  "name": "Sort behaviors",
                  "collaborators": [
                    "Behavior"
                  ]
                },
                {
                  "name": "Get behavior actions",
                  "collaborators": [
                    "Action"
                  ]
                },
                {
                  "name": "Get action parameters",
                  "collaborators": [
                    "Action Context"
                  ]
                },
                {
                  "name": "Get parameter descriptions",
                  "collaborators": [
                    "Action Context"
                  ]
                },
                {
                  "name": "Get action description",
                  "collaborators": [
                    "Action"
                  ]
                }
              ]
            },
            {
              "name": "Behavior Help Context",
              "responsibilities": [
                {
                  "name": "Store behavior name",
                  "collaborators": [
                    "Behavior"
                  ]
                },
                {
                  "name": "Store behavior description",
                  "collaborators": [
                    "Behavior"
                  ]
                },
                {
                  "name": "Store actions",
                  "collaborators": [
                    "Action"
                  ]
                },
                {
                  "name": "Provide to visitor",
                  "collaborators": [
                    "Visitor"
                  ]
                }
              ]
            },
            {
              "name": "Action Help Context",
              "responsibilities": [
                {
                  "name": "Store action name",
                  "collaborators": [
                    "Action"
                  ]
                },
                {
                  "name": "Store action description",
                  "collaborators": [
                    "Action"
                  ]
                },
                {
                  "name": "Store parameters",
                  "collaborators": [
                    "Action Context"
                  ]
                },
                {
                  "name": "Store parameter descriptions",
                  "collaborators": [
                    "Action Context"
                  ]
                },
                {
                  "name": "Provide to visitor",
                  "collaborators": [
                    "Visitor"
                  ]
                }
              ]
            }
          ],
          "background": {
            "description": "Background configuration shared across all REPL stories in Increment 1 (Front-End REPL Interactive Testing)",
            "given_statements": [
              "Given CLI executable is available in PATH or via python command",
              "And Bot has behaviors from Background: Bot Behaviors",
              "And Each Behavior has actions from Background: Behavior Actions",
              "And Each Action has three operations: instructions, submit, and confirm",
              "And instructions takes minimal params (scope) and returns AI instructions",
              "And submit takes completed work and returns final saved state",
              "And confirm marks action complete and advances to next action"
            ],
            "scenarios_reference_note": "Scenarios below reference these background tables: Bot Behaviors (all available behaviors for story_bot), Behavior Actions and Scope Configuration (each behavior's actions, workflow order, and scope types), Action Operations Table (two-phase operations with typed inputs/outputs), and Action Descriptions (what each action does)",
            "bot_behaviors": {
              "story_bot": [
                "shape",
                "prioritization",
                "discovery",
                "exploration",
                "scenarios",
                "tests",
                "code"
              ]
            },
            "behavior_actions_configuration": [
              {
                "behavior": "shape",
                "workflow_order": "1\u21922\u21923\u21924\u21925",
                "actions": [
                  "clarify",
                  "strategy",
                  "build",
                  "validate",
                  "render"
                ],
                "scope_types_used": "story/epic/increment/all",
                "notes": "Works with story_graph to create initial story maps and outlines"
              },
              {
                "behavior": "prioritization",
                "workflow_order": "1\u21922\u21923\u21924\u21925",
                "actions": [
                  "clarify",
                  "strategy",
                  "build",
                  "validate",
                  "render"
                ],
                "scope_types_used": "story/epic/increment/all",
                "notes": "Works with story_graph to organize stories into increments"
              },
              {
                "behavior": "discovery",
                "workflow_order": "1\u21922\u21923\u21924\u21925",
                "actions": [
                  "clarify",
                  "strategy",
                  "build",
                  "validate",
                  "render"
                ],
                "scope_types_used": "story/epic/increment/all",
                "notes": "Works with story_graph to elaborate stories with flows and rules"
              },
              {
                "behavior": "exploration",
                "workflow_order": "1\u21922\u21923\u21924\u21925",
                "actions": [
                  "clarify",
                  "strategy",
                  "build",
                  "validate",
                  "render"
                ],
                "scope_types_used": "story/epic/increment/all",
                "notes": "Works with story_graph to define acceptance criteria"
              },
              {
                "behavior": "scenarios",
                "workflow_order": "1\u21922\u21923\u21924\u21925",
                "actions": [
                  "clarify",
                  "strategy",
                  "build",
                  "validate",
                  "render"
                ],
                "scope_types_used": "story/epic/increment/all",
                "notes": "Works with story_graph to write detailed scenarios"
              },
              {
                "behavior": "tests",
                "workflow_order": "1\u21922\u21923\u21924\u21925",
                "actions": [
                  "clarify",
                  "strategy",
                  "build",
                  "validate",
                  "render"
                ],
                "scope_types_used": "story/epic/increment/all OR files",
                "notes": "build: Works with story_graph, existing tests, or existing code to generate tests. validate: Validates test files"
              },
              {
                "behavior": "code",
                "workflow_order": "1\u21922\u21923\u21924\u21925",
                "actions": [
                  "clarify",
                  "strategy",
                  "build",
                  "validate",
                  "render"
                ],
                "scope_types_used": "story/epic/increment/all OR files",
                "notes": "build: Works with story_graph, existing code, or existing tests to generate code that makes tests pass. validate: Validates code"
              }
            ],
            "action_operations": [
              {
                "action": "clarify",
                "instructions_context": "ClarifyActionContext (empty - no parameters needed)",
                "instructions_returns": "ClarifyInstructions (action, behavior, base_instructions, guardrails with key_questions and evidence)",
                "submit_context": "ClarifyActionContext (key_questions_answered: Dict, evidence_provided: Dict)",
                "submit_returns": "ClarifyConfirmation (saved_to, questions_answered, evidence_provided, success)",
                "confirm_context": "None (workflow control only)",
                "confirm_returns": "Advances to next action or completes behavior",
                "scope_types": "N/A"
              },
              {
                "action": "strategy",
                "instructions_context": "StrategyActionContext (empty - no parameters needed)",
                "instructions_returns": "StrategyInstructions (action, behavior, base_instructions, strategy with strategy_criteria, assumptions, recommended_activities)",
                "submit_context": "StrategyActionContext (decisions_made: Dict, assumptions_made: List[str])",
                "submit_returns": "StrategyConfirmation (saved_to, decisions_count, assumptions_count, success)",
                "confirm_context": "None (workflow control only)",
                "confirm_returns": "Advances to next action or completes behavior",
                "scope_types": "N/A"
              },
              {
                "action": "build",
                "instructions_context": "BuildActionContext (scope: Optional[FileScope OR StoryScope]). Default: all. Story behaviors default: StoryScope(nodes=[Node(type='all')]). File behaviors default: FileScope(include=[behavior_default])",
                "instructions_returns": "BuildInstructions (action, behavior, base_instructions, knowledge_graph_template, knowledge_graph_config, rules, scope, scope_story_names, existing_file)",
                "submit_context": "BuildActionContext (scope: FileScope OR StoryScope + knowledge_graph: Dict)",
                "submit_returns": "BuildConfirmation (saved_to, mode ('create' or 'update'), items_added, success)",
                "confirm_context": "None (workflow control only)",
                "confirm_returns": "Advances to next action or completes behavior",
                "scope_types": "FileScope OR StoryScope"
              },
              {
                "action": "validate",
                "instructions_context": "ValidateActionContext (scope: Optional[FileScope OR StoryScope], rules_to_exclude, rules_to_include, skip_cross_file, background). Defaults: scope=all, rules=all, skip_cross_file=false, background=false",
                "instructions_returns": "ValidateInstructions (action, behavior, base_instructions, validation_rules, report_path, report_link)",
                "submit_context": "ValidateActionContext (empty - validation already executed)",
                "submit_returns": "ValidateConfirmation (confirmed: bool, message: 'confirmed')",
                "confirm_context": "None (workflow control only)",
                "confirm_returns": "Advances to next action or completes behavior",
                "scope_types": "FileScope OR StoryScope"
              },
              {
                "action": "render",
                "instructions_context": "RenderActionContext (scope: Optional[FileScope OR StoryScope]). Default: all",
                "instructions_returns": "RenderInstructions (action, behavior, instructions, executed_specs, template_specs)",
                "submit_context": "RenderActionContext (scope: FileScope OR StoryScope + documents: List[Path])",
                "submit_returns": "RenderConfirmation (saved_to: List[Path], documents_created, synchronizers_executed, success)",
                "confirm_context": "None (workflow control only)",
                "confirm_returns": "Advances to next action or completes behavior",
                "scope_types": "FileScope OR StoryScope"
              }
            ],
            "action_descriptions": {
              "clarify": "Gather context and clarify requirements",
              "strategy": "Determine planning approach and criteria",
              "build": "Build knowledge graph and content",
              "validate": "Validate against behavior-specific rules",
              "render": "Generate output documents from knowledge graph"
            },
            "scope_hierarchy": {
              "description": "Two distinct scope types - FileScope (include/exclude paths) and StoryScope (list of nodes)",
              "Scope": "Base class for all scope types",
              "FileScope": {
                "extends": "Scope",
                "description": "Scope for file-based operations (code, tests validation)",
                "fields": {
                  "include": "List[str] - File paths to include: ['src/', 'tests/file.py']",
                  "exclude": "List[str] - File paths to exclude: ['*.bak', '__pycache__']"
                }
              },
              "StoryScope": {
                "extends": "Scope",
                "description": "Scope for story-based operations (shape, discovery, exploration, etc.)",
                "fields": {
                  "nodes": "List[Node] - List of story graph nodes to work on"
                },
                "Node": {
                  "type": "NodeType (STORY, EPIC, SUB_EPIC, INCREMENT)",
                  "name": "String identifier"
                }
              }
            },
            "action_context_hierarchy": {
              "description": "All parameters passed via typed ActionContext dataclasses",
              "ActionContext": "Base class",
              "ClarifyActionContext": {
                "extends": "ActionContext",
                "fields": {
                  "key_questions_answered": "Optional[Dict[str, Any]]",
                  "evidence_provided": "Optional[Dict[str, Any]]"
                }
              },
              "StrategyActionContext": {
                "extends": "ActionContext",
                "fields": {
                  "decisions_made": "Optional[Dict[str, Any]]",
                  "assumptions_made": "Optional[List[str]]"
                }
              },
              "BuildActionContext": {
                "extends": "ActionContext",
                "fields": {
                  "scope": "Optional[Union[FileScope, StoryScope]] - EITHER file OR story"
                }
              },
              "ValidateActionContext": {
                "extends": "ActionContext",
                "fields": {
                  "rules_to_exclude": "List[str] - Rules to skip",
                  "rules_to_include": "List[str] - Rules to explicitly include",
                  "skip_cross_file": "bool",
                  "background": "bool"
                }
              },
              "RenderActionContext": {
                "extends": "ActionContext",
                "fields": {
                  "scope": "Optional[Union[FileScope, StoryScope]] - EITHER file OR story"
                }
              }
            },
            "scope_examples": {
              "FileScope": [
                {
                  "description": "Include specific files/folders",
                  "example": "FileScope(include=['src/', 'tests/test_file.py'], exclude=[])"
                },
                {
                  "description": "Include with exclusions",
                  "example": "FileScope(include=['src/', 'tests/'], exclude=['*.bak', '__pycache__', '*.pyc', '*.tmp'])"
                },
                {
                  "description": "Just src folder, exclude legacy code",
                  "example": "FileScope(include=['src/'], exclude=['src/legacy/', '*.old.py'])"
                }
              ],
              "StoryScope": [
                {
                  "description": "Work on specific stories",
                  "example": "StoryScope(nodes=[Node(type=NodeType.STORY, name='Create Mob'), Node(type=NodeType.STORY, name='Edit Mob'), Node(type=NodeType.STORY, name='Delete Mob')])"
                },
                {
                  "description": "Work on entire epic",
                  "example": "StoryScope(nodes=[Node(type=NodeType.EPIC, name='Manage Mobs')])"
                },
                {
                  "description": "Work on multiple epics and specific stories",
                  "example": "StoryScope(nodes=[Node(type=NodeType.EPIC, name='Manage Mobs'), Node(type=NodeType.EPIC, name='Execute Mob Actions'), Node(type=NodeType.STORY, name='Configure Game Settings')])"
                },
                {
                  "description": "Work on specific increments",
                  "example": "StoryScope(nodes=[Node(type=NodeType.INCREMENT, name='1'), Node(type=NodeType.INCREMENT, name='2')])"
                },
                {
                  "description": "Work on sub-epic",
                  "example": "StoryScope(nodes=[Node(type=NodeType.SUB_EPIC, name='Character Management'), Node(type=NodeType.SUB_EPIC, name='Item Management')])"
                }
              ],
              "ValidateActionContext": [
                {
                  "description": "Validate with specific rules excluded",
                  "example": "ValidateActionContext(rules_to_exclude=['use_type_hints', 'use_dataclasses'], rules_to_include=[], skip_cross_file=False, background=False)"
                },
                {
                  "description": "Background validation with cross-file checks skipped",
                  "example": "ValidateActionContext(rules_to_exclude=[], rules_to_include=[], skip_cross_file=True, background=True)"
                },
                {
                  "description": "Only run specific rules",
                  "example": "ValidateActionContext(rules_to_exclude=[], rules_to_include=['use_consistent_naming', 'avoid_duplication'], skip_cross_file=False, background=False)"
                }
              ]
            },
            "action_workflow_pattern": {
              "description": "Three-phase model for all actions: instructions \u2192 submit \u2192 confirm",
              "phases": [
                {
                  "phase": "1. instructions",
                  "description": "User runs action with minimal params (usually just scope), CLI builds typed ActionContext, action returns AI instructions"
                },
                {
                  "phase": "2. submit",
                  "description": "User completes work following instructions, runs action with results, CLI builds typed ActionContext with completed work, action saves and returns confirmation"
                },
                {
                  "phase": "3. confirm",
                  "description": "User confirms action is complete, CLI marks action complete and advances to next action (or completes behavior)"
                }
              ],
              "example_build_with_story_scope": {
                "phase_1": "User: run build epic='Manage Mobs' \u2192 CLI builds StoryScope \u2192 returns BuildInstructions with template, rules, scope",
                "phase_2": "User: submit knowledge_graph={...} \u2192 CLI builds context with data \u2192 returns BuildConfirmation with saved_to, mode, items_added"
              },
              "example_validate": {
                "description": "Validate executes immediately, no separate confirm phase",
                "flow": "User: run validate skip_cross_file=true rules_to_exclude=['use_type_hints'] \u2192 Returns ValidateResult with passed, violations, files_validated"
              },
              "example_build_with_file_scope": {
                "phase_1": "User: run build files='src/' exclude='*.bak' \u2192 CLI builds FileScope \u2192 returns BuildInstructions"
              }
            },
            "behavior_scope_usage": {
              "story_only_behaviors": {
                "behaviors": [
                  "shape",
                  "prioritization",
                  "discovery",
                  "exploration",
                  "scenarios"
                ],
                "scope_type": "StoryScope with list of nodes (Node has type + name)",
                "prompt_behavior": "When CLI prompts for scope, displays available epics/stories/increments from story_graph"
              },
              "dual_scope_behaviors": {
                "behaviors": [
                  "tests",
                  "code"
                ],
                "scope_types": "EITHER StoryScope OR FileScope",
                "prompt_behavior": "CLI prompts user to choose which scope type. If StoryScope: Display available nodes from story_graph. If FileScope: Display top-level workspace folders + default include paths (src/ for code, tests/ for tests)"
              },
              "validation": {
                "context": "ValidateActionContext",
                "description": "Uses rule filtering (rules_to_exclude, rules_to_include) instead of scope objects"
              }
            },
            "type_safety_principles": [
              "Inputs: All parameters passed via typed ActionContext dataclasses",
              "Outputs: All results returned as typed ActionResult objects (Instructions/Confirmation classes)",
              "Scopes: Two distinct scope types - FileScope (include/exclude paths) and StoryScope (list of nodes)",
              "No mixed scopes: Actions accept EITHER FileScope OR StoryScope, never both",
              "Validation: ValidateActionContext has its own fields - no scope object",
              "No floating dicts: Everything is strongly typed with dataclasses",
              "Type safety: CLI builds context from user input, action returns typed result, CLI formats result for display"
            ],
            "domain_model": [
              {
                "name": "Action Operations",
                "description": "Three operations per action: instructions, submit, confirm",
                "action_operations": [
                  {
                    "operation": "instructions",
                    "triggered_by": "Navigating to action, or typing 'current'",
                    "returns": "ActionInstructions with what user needs to do"
                  },
                  {
                    "operation": "submit",
                    "triggered_by": "Typing 'submit' or '<action> submit'",
                    "returns": "ActionConfirmation with what was saved"
                  },
                  {
                    "operation": "confirm",
                    "triggered_by": "Typing 'confirm' or '<action> confirm'",
                    "effect": "Advances to next action (or next behavior if last action), executes instructions"
                  }
                ]
              }
            ]
          },
          "sub_epics": [
            {
              "name": "Initialize and Display Session",
              "sequential_order": 1,
              "story_groups": [
                {
                  "type": "and",
                  "connector": null,
                  "stories": [
                    {
                      "name": "Launch REPL Loop",
                      "sequential_order": 1,
                      "connector": null,
                      "users": [
                        "User"
                      ],
                      "story_type": "user",
                      "test_file": "test_run_interactive_repl.py",
                      "test_class": "TestLaunchREPLLoop",
                      "test_method": "test_launch_repl_with_existing_state",
                      "acceptance_criteria": [
                        "WHEN user runs story_bot --stdio from terminal, THEN CLI launches REPL loop",
                        "WHEN REPL loop starts, THEN CLI loads BehaviorActionState if it exists",
                        "WHEN BehaviorActionState exists, THEN CLI displays current position from state",
                        "WHEN BehaviorActionState does not exist, THEN CLI initializes to first behavior/action/operation"
                      ],
                      "scenario_outlines": [
                        {
                          "name": "Launch REPL with existing state",
                          "steps": [
                            "Given BehaviorActionState exists with current_behavior=story_bot.<behavior>",
                            "And BehaviorActionState has current_action=story_bot.<behavior>.<action>",
                            "And BehaviorActionState has action_phase=<phase>",
                            "And BehaviorActionState has working_directory=\"C:\\dev\\project\"",
                            "When user runs command with --stdio flag",
                            "Then CLI loads BehaviorActionState",
                            "And CLI displays header with \"STORY_BOT CLI\"",
                            "And CLI displays \"Bot Path: <bot_path>\"",
                            "And CLI displays \"Work Path: C:\\dev\\project\"",
                            "And CLI displays \"Progress: <behavior>.<action>.<operation>\"",
                            "And CLI displays \"Behaviors: shape | prioritization | discovery | exploration | scenarios | tests | code\"\nAnd CLI displays \"Actions: clarify | strategy | build | validate | render\"\nAnd CLI displays compact menu with status, back, current, next, help, exit"
                          ],
                          "examples": {
                            "columns": [
                              "behavior",
                              "action",
                              "phase",
                              "operation"
                            ],
                            "rows": [
                              [
                                "shape",
                                "build",
                                "instructions_given",
                                "instructions"
                              ],
                              [
                                "discovery",
                                "clarify",
                                "not_started",
                                "instructions"
                              ],
                              [
                                "scenarios",
                                "validate",
                                "submitted",
                                "submit"
                              ]
                            ]
                          }
                        },
                        {
                          "name": "Launch REPL with no state (fresh start)",
                          "steps": [
                            "Given BehaviorActionState does not exist",
                            "And Bot has behaviors loaded from bot_config.json",
                            "And first behavior is \"shape\" with first action \"clarify\"",
                            "When user runs command with --stdio flag",
                            "Then CLI initializes BehaviorActionState",
                            "And CLI sets current_behavior to story_bot.shape",
                            "And CLI sets current_action to story_bot.shape.clarify",
                            "And CLI sets action_phase to not_started",
                            "And CLI saves BehaviorActionState to behavior_action_state.json",
                            "And CLI displays header with \"STORY_BOT CLI\"",
                            "And CLI displays \"Bot Path: <bot_path>\"",
                            "And CLI displays \"Work Path: <workspace_path>\"",
                            "And CLI displays \"Progress: shape.clarify.instructions\"",
                            "And CLI displays \"Behaviors: shape | prioritization | discovery | exploration | scenarios | tests | code\"\nAnd CLI displays \"Actions: clarify | strategy | build | validate | render\"\nAnd CLI displays compact menu with status, back, current, next, help, exit"
                          ],
                          "examples": {
                            "columns": [
                              "bot_path",
                              "workspace_path"
                            ],
                            "rows": [
                              [
                                "C:\\dev\\augmented-teams\\agile_bot\\bots\\story_bot",
                                "C:\\dev\\augmented-teams\\agile_bot\\bots\\base_bot"
                              ]
                            ]
                          }
                        }
                      ]
                    },
                    {
                      "name": "Detect TTY Input",
                      "sequential_order": 2,
                      "connector": "and",
                      "users": [
                        "CLI"
                      ],
                      "story_type": "system",
                      "test_file": "test_run_interactive_repl.py",
                      "test_class": "TestDetectTTYInput",
                      "test_method": "test_detect_tty_when_stdin_is_tty",
                      "acceptance_criteria": [
                        "WHEN CLI starts in STDIO mode, THEN it detects if stdin is a TTY",
                        "WHEN stdin is TTY, THEN CLI enables interactive prompts",
                        "WHEN stdin is piped, THEN CLI disables interactive prompts"
                      ],
                      "scenario_outlines": [
                        {
                          "name": "CLI detects TTY when stdin is a TTY",
                          "steps": [
                            "Given stdin is a TTY",
                            "When CLI checks for TTY",
                            "Then CLI enables interactive prompts"
                          ]
                        },
                        {
                          "name": "CLI disables interactive prompts when stdin is piped",
                          "steps": [
                            "Given stdin is piped (not a TTY)",
                            "When CLI checks for TTY",
                            "Then CLI disables interactive prompts"
                          ]
                        }
                      ]
                    },
                    {
                      "name": "Display Fresh Start",
                      "sequential_order": 3,
                      "connector": "or",
                      "users": [
                        "CLI"
                      ],
                      "story_type": "system",
                      "test_file": "test_run_interactive_repl.py",
                      "test_class": "TestDisplayFreshStart",
                      "test_method": "test_cli_displays_fresh_start_with_no_state_file",
                      "acceptance_criteria": [
                        "WHEN BehaviorActionState does not exist, THEN CLI automatically initializes to first behavior/action",
                        "WHEN fresh start detected, THEN CLI displays Progress with first behavior.action.operation",
                        "WHEN user types status command, THEN CLI displays full workflow hierarchy",
                        "WHEN user navigates workflow, THEN BehaviorActionState tracks current position"
                      ],
                      "scenario_outlines": [
                        {
                          "name": "CLI auto-initializes on fresh start",
                          "steps": [
                            "Given BehaviorActionState does not exist",
                            "And Bot.behaviors contains all behaviors from Background: Bot Configuration",
                            "And first behavior is \"shape\" with first action \"clarify\"",
                            "When CLI launches in REPL mode",
                            "Then CLI initializes BehaviorActionState with story_bot.shape.clarify",
                            "And CLI saves state to behavior_action_state.json",
                            "And CLI displays \"Progress: shape.clarify.instructions\"",
                            "And CLI displays compact menu: \"status\", \"back\", \"current\", \"next\", \"help\", \"exit\""
                          ],
                          "examples": {
                            "columns": [
                              "first_behavior",
                              "first_action"
                            ],
                            "rows": [
                              [
                                "shape",
                                "clarify"
                              ]
                            ]
                          }
                        },
                        {
                          "name": "User views full workflow with status command",
                          "steps": [
                            "Given CLI has initialized to shape.clarify.instructions",
                            "And BehaviorActionState is loaded",
                            "When user types \"status\" command",
                            "Then CLI displays \"Progress: shape.clarify.instructions\"",
                            "And CLI displays \"Behaviors: shape [*] -> prioritization [ ] -> discovery [ ] -> exploration [ ] -> scenarios [ ] -> tests [ ] -> code [ ]\"",
                            "And CLI displays \"  Actions: clarify [*] -> strategy [ ] -> build [ ] -> validate [ ] -> render [ ]\"",
                            "And CLI displays \"    Operations: instructions [*] -> submit [ ] -> confirm [ ]\"",
                            "And CLI displays legend \"[*] current  [OK] done  [ ] not started\""
                          ],
                          "examples": {
                            "columns": [
                              "current_behavior",
                              "current_action",
                              "current_operation"
                            ],
                            "rows": [
                              [
                                "shape",
                                "clarify",
                                "instructions"
                              ]
                            ]
                          }
                        }
                      ],
                      "scenarios": [
                        {
                          "name": "User configures workspace in fresh session",
                          "steps": [
                            "Given BehaviorActionState does not exist",
                            "And user enters command: workspace C:\\dev\\project",
                            "When CLI processes workspace command",
                            "Then CLI responds \"OK workspace=C:\\dev\\project\"",
                            "And BehaviorActionState.working_directory is set to \"C:\\dev\\project\""
                          ]
                        }
                      ]
                    },
                    {
                      "name": "Display Existing State",
                      "sequential_order": 4,
                      "connector": "or",
                      "users": [
                        "CLI"
                      ],
                      "story_type": "system",
                      "test_file": "test_run_interactive_repl.py",
                      "test_class": "TestDisplayExistingState",
                      "test_method": "test_cli_displays_existing_state_with_progress",
                      "acceptance_criteria": [
                        "WHEN BehaviorActionState exists, THEN CLI displays current position in header Progress line",
                        "WHEN state exists, THEN CLI displays compact menu with navigation commands",
                        "WHEN user types status, THEN CLI displays full workflow hierarchy with progress indicators"
                      ],
                      "scenario_outlines": [
                        {
                          "name": "CLI displays existing state in header",
                          "steps": [
                            "Given BehaviorActionState exists",
                            "And BehaviorActionState.current_behavior is story_bot.<behavior>",
                            "And BehaviorActionState.current_action is story_bot.<behavior>.<action>",
                            "And BehaviorActionState.action_phase is <phase>",
                            "And BehaviorActionState.working_directory is \"C:\\dev\\project\"",
                            "And Bot.behaviors contains all behaviors from Background: Bot Configuration",
                            "When CLI launches in REPL mode",
                            "Then CLI displays header with \"STORY_BOT CLI\"",
                            "And CLI displays \"Bot Path: <bot_path>\"",
                            "And CLI displays \"Work Path: C:\\dev\\project\"",
                            "And CLI displays \"Progress: <behavior>.<action>.<operation>\"",
                            "And CLI displays compact menu with status, back, current, next, help, exit commands"
                          ],
                          "examples": {
                            "columns": [
                              "behavior",
                              "action",
                              "phase",
                              "operation"
                            ],
                            "rows": [
                              [
                                "shape",
                                "build",
                                "instructions_given",
                                "instructions"
                              ],
                              [
                                "discovery",
                                "validate",
                                "submitted",
                                "submit"
                              ],
                              [
                                "scenarios",
                                "clarify",
                                "not_started",
                                "instructions"
                              ]
                            ]
                          }
                        }
                      ]
                    }
                  ]
                },
                {
                  "type": "and",
                  "connector": null,
                  "stories": [
                    {
                      "name": "Show Workflow Hierarchy Via Status Command",
                      "sequential_order": 1,
                      "connector": null,
                      "users": [
                        "CLI"
                      ],
                      "story_type": "system",
                      "test_file": "test_run_interactive_repl.py",
                      "test_class": "TestShowWorkflowHierarchyViaStatusCommand",
                      "test_method": "test_show_hierarchy_for_current_position",
                      "acceptance_criteria": [
                        "WHEN user types status command, THEN CLI displays three-level workflow hierarchy",
                        "WHEN displaying hierarchy, THEN CLI shows behaviors -> actions -> operations with status indicators",
                        "WHEN current position is shown, THEN CLI marks it with [*] indicator",
                        "WHEN step is completed, THEN CLI marks it with [OK] indicator",
                        "WHEN step is not started, THEN CLI marks it with [ ] indicator"
                      ],
                      "scenario_outlines": [
                        {
                          "name": "Display hierarchy showing current position via status command",
                          "steps": [
                            "Given BehaviorActionState exists with current position shape.build.instructions",
                            "And BehaviorActionState has completed_actions=[\"shape.clarify\", \"shape.strategy\"]",
                            "When user types \"status\" command",
                            "Then CLI displays \"Progress: shape.build.instructions\"",
                            "And CLI displays \"Behaviors: shape [*] -> prioritization [ ] -> discovery [ ] -> exploration [ ] -> scenarios [ ] -> tests [ ] -> code [ ]\"",
                            "And CLI displays \"  Actions: clarify [OK] -> strategy [OK] -> build [*] -> validate [ ] -> render [ ]\"",
                            "And CLI displays \"    Operations: instructions [*] -> submit [ ] -> confirm [ ]\"",
                            "And CLI displays \"[*] current  [OK] done  [ ] not started\""
                          ]
                        }
                      ]
                    },
                    {
                      "name": "Display Behaviors and Actions on Startup",
                      "sequential_order": 2,
                      "connector": "and",
                      "users": [
                        "CLI"
                      ],
                      "story_type": "system",
                      "test_file": "test_run_interactive_repl.py",
                      "test_class": "TestShowAvailableBehaviorsAndActions",
                      "test_method": "test_show_available_behaviors_and_actions",
                      "acceptance_criteria": [
                        "WHEN CLI starts, THEN CLI displays list of all available behaviors",
                        "WHEN CLI starts, THEN CLI displays list of all available actions in compact format"
                      ],
                      "scenario_outlines": [
                        {
                          "name": "Show available behaviors and actions",
                          "steps": [
                            "Given bot has multiple behaviors loaded from bot_config.json",
                            "When CLI displays startup menu",
                            "Then CLI displays \"Behaviors: shape | prioritization | discovery | exploration | scenarios | tests | code\"",
                            "And CLI displays \"Actions: clarify | strategy | build | validate | render\""
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "Navigate Workflow",
              "sequential_order": 3,
              "story_groups": [
                {
                  "type": "and",
                  "connector": null,
                  "stories": [
                    {
                      "name": "Navigate To Behavior",
                      "sequential_order": 3,
                      "connector": "and",
                      "users": [
                        "User"
                      ],
                      "story_type": "user",
                      "test_file": "test_run_interactive_repl.py",
                      "test_class": "TestNavigateToBehavior",
                      "test_method": "test_user_navigates_to_different_behavior",
                      "acceptance_criteria": [
                        "WHEN user navigates to behavior, THEN CLI jumps to that behavior's first action",
                        "WHEN CLI jumps to behavior, THEN CLI executes first action's instructions operation",
                        "WHEN execution completes, THEN CLI displays instructions to user"
                      ],
                      "scenario_outlines": [
                        {
                          "name": "User navigates to different behavior",
                          "steps": [
                            "Given BehaviorActionState.current_behavior is <current_behavior>",
                            "And BehaviorActionState.current_action is <current_action>",
                            "And Bot.behaviors contains all behaviors from Background: Bot Configuration",
                            "And Behavior \"<target_behavior>\" has actions from Background: Behavior Actions",
                            "And user enters command: behavior <target_behavior>",
                            "When CLI processes navigation command",
                            "Then CLI responds \"OK behavior=<target_behavior>\"",
                            "And CLI displays \"CURRENT: story_bot.<target_behavior>.clarify\"",
                            "And CLI displays breadcrumbs: \"[<target_behavior>] clarify* -> strategy -> build -> validate -> render\"",
                            "And BehaviorActionState.current_behavior is updated to <target_behavior>",
                            "And BehaviorActionState.current_action is set to clarify"
                          ],
                          "examples": {
                            "columns": [
                              "current_behavior",
                              "current_action",
                              "target_behavior"
                            ],
                            "rows": [
                              [
                                "shape",
                                "build",
                                "discovery"
                              ],
                              [
                                "discovery",
                                "validate",
                                "exploration"
                              ],
                              [
                                "scenarios",
                                "clarify",
                                "tests"
                              ],
                              [
                                "code",
                                "validate",
                                "scenarios"
                              ]
                            ]
                          }
                        },
                        {
                          "name": "User navigates to invalid behavior",
                          "steps": [
                            "Given Bot.behaviors contains all behaviors from Background: Bot Configuration",
                            "And user enters command: behavior <invalid_behavior>",
                            "When CLI processes navigation command",
                            "Then CLI responds \"ERROR: behavior '<invalid_behavior>' not found\"",
                            "And CLI displays \"Available behaviors: shape, prioritization, discovery, exploration, scenarios, tests, code\"",
                            "And BehaviorActionState remains unchanged"
                          ],
                          "examples": {
                            "columns": [
                              "invalid_behavior"
                            ],
                            "rows": [
                              [
                                "invalid"
                              ],
                              [
                                "nonexistent"
                              ],
                              [
                                "test"
                              ]
                            ]
                          }
                        }
                      ]
                    },
                    {
                      "name": "Navigate To Action",
                      "sequential_order": 4,
                      "connector": "and",
                      "users": [
                        "User"
                      ],
                      "story_type": "user",
                      "test_file": "test_run_interactive_repl.py",
                      "test_class": "TestNavigateToAction",
                      "test_method": "test_user_navigates_to_action_within_current_behavior",
                      "acceptance_criteria": [
                        "WHEN user navigates to action, THEN CLI jumps to that action",
                        "WHEN CLI jumps to action, THEN CLI executes action's instructions operation",
                        "WHEN execution completes, THEN CLI displays instructions to user"
                      ],
                      "scenario_outlines": [
                        {
                          "name": "User navigates to action within current behavior",
                          "steps": [
                            "Given BehaviorActionState.current_behavior is <current_behavior>",
                            "And BehaviorActionState.current_action is <current_action>",
                            "And Behavior \"<current_behavior>\" has actions from Background: Behavior Actions",
                            "And BehaviorActionState.completed_actions contains: <completed_actions>",
                            "And user enters command: action <target_action>",
                            "When CLI processes navigation command",
                            "Then CLI responds \"OK action=<target_action>\"",
                            "And CLI displays \"CURRENT: story_bot.<current_behavior>.<target_action>\"",
                            "And CLI displays breadcrumbs showing <target_action> as current with * marker",
                            "And breadcrumbs show <completed_actions> with [OK] markers",
                            "And BehaviorActionState.current_action is updated to <target_action>"
                          ],
                          "examples": {
                            "columns": [
                              "current_behavior",
                              "current_action",
                              "completed_actions",
                              "target_action"
                            ],
                            "rows": [
                              [
                                "shape",
                                "clarify",
                                "[]",
                                "validate"
                              ],
                              [
                                "shape",
                                "build",
                                "[\"clarify\", \"strategy\"]",
                                "validate"
                              ],
                              [
                                "discovery",
                                "validate",
                                "[\"clarify\", \"strategy\", \"build\"]",
                                "render"
                              ],
                              [
                                "scenarios",
                                "strategy",
                                "[\"clarify\"]",
                                "build"
                              ]
                            ]
                          }
                        },
                        {
                          "name": "User navigates to invalid action",
                          "steps": [
                            "Given BehaviorActionState.current_behavior is <current_behavior>",
                            "And Behavior \"<current_behavior>\" has actions from Background: Behavior Actions",
                            "And user enters command: action <invalid_action>",
                            "When CLI processes navigation command",
                            "Then CLI responds \"ERROR: action '<invalid_action>' not found in behavior '<current_behavior>'\"",
                            "And CLI displays \"Available actions: clarify, strategy, build, validate, render\"",
                            "And BehaviorActionState.current_action remains unchanged"
                          ],
                          "examples": {
                            "columns": [
                              "current_behavior",
                              "invalid_action"
                            ],
                            "rows": [
                              [
                                "shape",
                                "test"
                              ],
                              [
                                "discovery",
                                "invalid"
                              ],
                              [
                                "code",
                                "nonexistent"
                              ]
                            ]
                          }
                        }
                      ]
                    },
                    {
                      "name": "Navigate with Back/Next/Current",
                      "sequential_order": 5,
                      "connector": "and",
                      "users": [
                        "User"
                      ],
                      "story_type": "user",
                      "test_file": "test_run_interactive_repl.py",
                      "test_class": "TestNavigateWithinBehavior",
                      "test_method": "test_user_executes_workflow_navigation_commands",
                      "acceptance_criteria": [
                        "WHEN user types next, THEN CLI advances to next action and executes instructions",
                        "WHEN user types back, THEN CLI moves to previous action and executes instructions",
                        "WHEN user types current, THEN CLI re-executes current operation",
                        "WHEN next reaches last action of behavior, THEN CLI crosses to next behavior's first action",
                        "WHEN back reaches first action of behavior, THEN CLI crosses to previous behavior's last action"
                      ],
                      "scenario_outlines": [
                        {
                          "name": "User advances with next command",
                          "steps": [
                            "Given user is at <current_position>",
                            "When user types \"next\"",
                            "Then CLI moves to <next_position>",
                            "And CLI executes <next_position>",
                            "And CLI displays instructions/results to user"
                          ],
                          "examples": {
                            "columns": [
                              "current_position",
                              "next_position"
                            ],
                            "rows": [
                              [
                                "shape.clarify.instructions",
                                "shape.strategy.instructions"
                              ],
                              [
                                "shape.render.confirm",
                                "prioritization.clarify.instructions"
                              ],
                              [
                                "discovery.validate.submit",
                                "discovery.validate.confirm"
                              ]
                            ]
                          }
                        },
                        {
                          "name": "User moves back with back command",
                          "steps": [
                            "Given user is at <current_position>",
                            "When user types \"back\"",
                            "Then CLI moves to <previous_position>",
                            "And CLI executes <previous_position>",
                            "And CLI displays instructions/results to user"
                          ],
                          "examples": {
                            "columns": [
                              "current_position",
                              "previous_position"
                            ],
                            "rows": [
                              [
                                "shape.strategy.instructions",
                                "shape.clarify.instructions"
                              ],
                              [
                                "prioritization.clarify.instructions",
                                "shape.render.confirm"
                              ],
                              [
                                "discovery.validate.confirm",
                                "discovery.validate.submit"
                              ]
                            ]
                          }
                        },
                        {
                          "name": "User re-executes with current command",
                          "steps": [
                            "Given user is at shape.build.instructions",
                            "And user has already seen instructions",
                            "When user types \"current\"",
                            "Then CLI re-executes shape.build.instructions",
                            "And CLI displays instructions again"
                          ]
                        }
                      ]
                    },
                    {
                      "name": "Set Scope Parameter",
                      "sequential_order": 6,
                      "connector": "and",
                      "users": [
                        "User"
                      ],
                      "story_type": "user",
                      "deferred_to_increment": 13,
                      "note": "Actual parsing and storage logic implemented in Increment 13 (REPL Story Parameters - Mock Backend). Increment 10 only tests error handling and prompts.",
                      "acceptance_criteria": [
                        "WHEN user enters scope.type=value, THEN CLI stores scope parameter in state",
                        "WHEN scope parameter is set, THEN CLI confirms with OK message",
                        "WHEN user enters status, THEN CLI displays current scope parameters"
                      ],
                      "scenario_outlines": [
                        {
                          "name": "User sets scope parameter",
                          "steps": [
                            "Given user is in REPL",
                            "When user enters scope parameter",
                            "Then scope is set for next action"
                          ]
                        }
                      ]
                    },
                    {
                      "name": "Exit REPL",
                      "sequential_order": 7,
                      "connector": "and",
                      "users": [
                        "User"
                      ],
                      "story_type": "user",
                      "test_file": "test_run_interactive_repl.py",
                      "test_class": "TestExitREPL",
                      "test_method": "test_user_exits_repl",
                      "acceptance_criteria": [
                        "WHEN user enters exit, THEN CLI terminates gracefully",
                        "WHEN exiting, THEN CLI displays goodbye message",
                        "WHEN CLI terminates, THEN process returns to shell"
                      ],
                      "scenarios": [
                        {
                          "name": "User exits REPL",
                          "steps": [
                            "Given CLI is running in REPL mode",
                            "When user enters command: \"exit\"",
                            "Then CLI displays \"Goodbye!\"",
                            "And CLI terminates REPL loop",
                            "And Process returns to shell"
                          ]
                        }
                      ],
                      "scenario_outlines": [
                        {
                          "name": "User exits REPL",
                          "steps": [
                            "Given REPL is running",
                            "When user enters 'exit' command",
                            "Then CLI displays goodbye message",
                            "And REPL terminates"
                          ]
                        }
                      ]
                    },
                    {
                      "name": "Display Confirm and Continue Prompt",
                      "sequential_order": 1,
                      "connector": null,
                      "users": [
                        "CLI"
                      ],
                      "story_type": "system",
                      "test_file": "test_run_interactive_repl.py",
                      "test_class": "TestDisplayConfirmAndContinuePrompt",
                      "test_method": "test_cli_displays_action_completion_and_prompts_for_continuation",
                      "acceptance_criteria": [
                        "WHEN action completes, THEN CLI displays results summary",
                        "WHEN results are displayed, THEN CLI identifies next action",
                        "WHEN prompting to continue, THEN CLI asks user to confirm (y/n/review)"
                      ],
                      "scenario_outlines": [
                        {
                          "name": "CLI displays action completion and prompts for continuation",
                          "steps": [
                            "Given BehaviorActionState.current_behavior is \"<behavior>\"",
                            "And BehaviorActionState.current_action is \"<action>\"",
                            "And User has completed work following instructions",
                            "And Action \"<action>\" has completed with results: <results_summary>",
                            "When user prepares to run submit operation",
                            "Then CLI displays \"EXECUTED <behavior>.<action>\"",
                            "And CLI displays \"Results:\"",
                            "And CLI displays results summary: \"<results_display>\"",
                            "And CLI identifies next action: \"<next_action>\"",
                            "And CLI prompts \"Continue to next action (<next_action>)? (y/n/review)\""
                          ],
                          "examples": {
                            "columns": [
                              "behavior",
                              "action",
                              "results_summary",
                              "results_display",
                              "next_action"
                            ],
                            "rows": [
                              [
                                "shape",
                                "clarify",
                                "{questions_answered: 7, evidence_types: 3}",
                                "- Answered 7 key questions\\n- Provided 3 evidence types",
                                "strategy"
                              ],
                              [
                                "shape",
                                "strategy",
                                "{decisions_made: 5, assumptions: 2}",
                                "- Made 5 decisions\\n- Listed 2 assumptions",
                                "build"
                              ],
                              [
                                "shape",
                                "build",
                                "{items_added: 12, mode: 'create'}",
                                "- Added 12 items\\n- Mode: create",
                                "validate"
                              ]
                            ]
                          }
                        }
                      ]
                    },
                    {
                      "name": "Enter Confirm Results",
                      "sequential_order": 2,
                      "connector": "and",
                      "users": [
                        "User"
                      ],
                      "story_type": "user",
                      "test_file": "test_run_interactive_repl.py",
                      "test_class": "TestEnterConfirmResults",
                      "test_method": "test_user_confirms_action_completion_and_advances_workflow",
                      "acceptance_criteria": [
                        "WHEN user confirms with y, THEN CLI advances to next action and updates breadcrumbs",
                        "WHEN user enters n, THEN CLI remains at current action",
                        "WHEN user enters review, THEN CLI displays detailed results"
                      ],
                      "scenario_outlines": [
                        {
                          "name": "User confirms action completion and advances workflow",
                          "steps": [
                            "Given BehaviorActionState.current_behavior is \"<behavior>\"",
                            "And BehaviorActionState.current_action is \"<current_action>\"",
                            "And BehaviorActionState.completed_actions are: <completed_actions>",
                            "And CLI is prompting to continue to: \"<next_action>\"",
                            "When user runs confirm operation with confirmation: \"y\"",
                            "Then CLI displays \"OK advancing to <next_action>\"",
                            "And BehaviorActionState.current_action becomes \"<next_action>\"",
                            "And BehaviorActionState.completed_actions become <new_completed_actions>",
                            "And CLI displays \"CURRENT: story_bot.<behavior>.<next_action>\"",
                            "And CLI displays breadcrumbs: \"<breadcrumbs>\""
                          ],
                          "examples": {
                            "columns": [
                              "behavior",
                              "current_action",
                              "next_action",
                              "completed_actions",
                              "new_completed_actions",
                              "breadcrumbs"
                            ],
                            "rows": [
                              [
                                "shape",
                                "clarify",
                                "strategy",
                                "[]",
                                "[clarify]",
                                "[shape] clarify [OK] -> strategy* -> build -> validate -> render"
                              ],
                              [
                                "shape",
                                "strategy",
                                "build",
                                "[clarify]",
                                "[clarify,strategy]",
                                "[shape] clarify [OK] -> strategy [OK] -> build* -> validate -> render"
                              ],
                              [
                                "shape",
                                "build",
                                "validate",
                                "[clarify,strategy]",
                                "[clarify,strategy,build]",
                                "[shape] clarify [OK] -> strategy [OK] -> build [OK] -> validate* -> render"
                              ]
                            ]
                          }
                        }
                      ]
                    },
                    {
                      "name": "Validate Confirm Syntax and Parameters",
                      "sequential_order": 3,
                      "connector": "and",
                      "users": [
                        "CLI"
                      ],
                      "story_type": "system",
                      "acceptance_criteria": [
                        "WHEN validating confirm parameters, THEN CLI checks completed work fields",
                        "WHEN confirm data is invalid, THEN CLI displays validation errors"
                      ]
                    },
                    {
                      "name": "Confirm Advances Across Behaviors",
                      "sequential_order": 9,
                      "connector": "and",
                      "users": [
                        "User"
                      ],
                      "story_type": "user",
                      "acceptance_criteria": [
                        "WHEN user confirms last action of behavior, THEN CLI marks behavior complete",
                        "WHEN behavior is complete, THEN CLI moves to next behavior's first action",
                        "WHEN CLI moves to next behavior, THEN CLI executes next behavior's first action's instructions"
                      ],
                      "scenarios": [
                        {
                          "name": "Confirm at last action moves to next behavior",
                          "steps": [
                            "Given current position is shape.render.submit",
                            "And shape.render is the last action of shape behavior",
                            "When user types \"confirm\"",
                            "Then CLI marks shape.render as complete",
                            "And CLI marks shape behavior as complete",
                            "And CLI moves to prioritization.clarify.instructions",
                            "And CLI executes prioritization.clarify.instructions",
                            "And CLI displays instructions for prioritization.clarify"
                          ]
                        },
                        {
                          "name": "Confirm within behavior advances to next action",
                          "steps": [
                            "Given current position is shape.clarify.submit",
                            "When user types \"confirm\"",
                            "Then CLI marks shape.clarify as complete",
                            "And CLI moves to shape.strategy.instructions",
                            "And CLI executes shape.strategy.instructions"
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "Help",
              "sequential_order": 3,
              "story_groups": [
                {
                  "type": "and",
                  "connector": null,
                  "stories": [
                    {
                      "name": "Request Help",
                      "sequential_order": 1,
                      "connector": null,
                      "users": [
                        "User"
                      ],
                      "story_type": "user",
                      "test_file": "test_run_interactive_repl.py",
                      "test_class": "TestRequestHelp",
                      "test_method": "test_user_requests_help_for_current_behavior",
                      "acceptance_criteria": [
                        "WHEN user enters help, THEN CLI displays all available command",
                        "WHEN user enters help <action>, THEN CLI displays detailed action help"
                      ],
                      "scenario_outlines": [
                        {
                          "name": "User requests help for current behavior",
                          "steps": [
                            "Given current behavior is <behavior>",
                            "And Behavior has actions: <actions>",
                            "And Action \"<action>\" has parameters: <parameters>",
                            "And user enters command: help",
                            "When CLI processes help request",
                            "Then CLI displays \"Available Actions for behavior: <behavior>\"",
                            "And CLI displays action list with descriptions",
                            "And CLI displays navigation commands"
                          ],
                          "examples": {
                            "columns": [
                              "behavior",
                              "actions",
                              "action",
                              "parameters"
                            ],
                            "rows": [
                              [
                                "shape",
                                "[\"clarify\", \"strategy\", \"build\", \"validate\", \"render\"]",
                                "build",
                                "[\"--scope <dict>\"]"
                              ],
                              [
                                "discovery",
                                "[\"clarify\", \"strategy\", \"build\", \"validate\", \"render\"]",
                                "validate",
                                "[\"--scope <dict>\", \"--background <flag>\"]"
                              ],
                              [
                                "scenarios",
                                "[\"clarify\", \"strategy\", \"build\", \"validate\", \"render\"]",
                                "clarify",
                                "[\"--key-questions-answered <dict>\", \"--evidence-provided <dict>\"]"
                              ]
                            ]
                          }
                        },
                        {
                          "name": "User requests detailed help for specific action",
                          "steps": [
                            "Given current behavior is <behavior>",
                            "And Action \"<action>\" exists in behavior",
                            "And Action has description: <description>",
                            "And Action has parameters: <parameters>",
                            "And user enters command: help <action>",
                            "When CLI processes detailed help request",
                            "Then CLI displays \"## <action> - <description>\"",
                            "And CLI displays \"Full command:\"",
                            "And CLI displays \"  action <action> <parameter_syntax>\"",
                            "And CLI displays \"Parameters:\" with type annotations",
                            "And CLI displays \"Examples:\" with concrete values"
                          ],
                          "examples": {
                            "columns": [
                              "behavior",
                              "action",
                              "description",
                              "parameters",
                              "parameter_syntax"
                            ],
                            "rows": [
                              [
                                "shape",
                                "build",
                                "Build knowledge graph for build",
                                "[\"--scope <dict>\"]",
                                "--scope '{\"type\": \"epic\", \"value\": [\"Epic Name\"]}'"
                              ],
                              [
                                "discovery",
                                "validate",
                                "Validate knowledge graph against rules",
                                "[\"--scope <dict>\", \"--background <flag>\"]",
                                "--scope '{\"type\": \"all\"}' --background"
                              ],
                              [
                                "scenarios",
                                "clarify",
                                "Gather context by asking questions",
                                "[\"--key-questions-answered <dict>\"]",
                                "--key-questions-answered '{\"q1\": \"answer\"}'"
                              ]
                            ]
                          }
                        }
                      ]
                    },
                    {
                      "name": "Request Status",
                      "sequential_order": 2,
                      "connector": "and",
                      "users": [
                        "User"
                      ],
                      "story_type": "user",
                      "test_file": "test_run_interactive_repl.py",
                      "test_class": "TestRequestStatus",
                      "test_method": "test_user_requests_status_display",
                      "acceptance_criteria": [
                        "WHEN user enters status, THEN CLI displays current behavior/action, working directory, and breadcrumbs"
                      ],
                      "scenario_outlines": [
                        {
                          "name": "User requests status display",
                          "steps": [
                            "Given BehaviorActionState.current_behavior is \"<behavior>\"",
                            "And BehaviorActionState.current_action is \"<action>\"",
                            "And BehaviorActionState.working_directory is \"<working_dir>\"",
                            "And BehaviorActionState.completed_actions are: <completed_actions>",
                            "When user enters command: \"status\"",
                            "Then CLI displays \"CURRENT: story_bot.<behavior>.<action>\"",
                            "And CLI displays \"Working Directory: <working_dir>\"",
                            "And CLI displays breadcrumbs: \"<breadcrumbs>\""
                          ],
                          "examples": {
                            "columns": [
                              "behavior",
                              "action",
                              "working_dir",
                              "completed_actions",
                              "breadcrumbs"
                            ],
                            "rows": [
                              [
                                "shape",
                                "build",
                                "C:\\dev\\my-project",
                                "[clarify,strategy]",
                                "[shape] clarify [OK] -> strategy [OK] -> build* -> validate -> render"
                              ],
                              [
                                "prioritization",
                                "clarify",
                                "C:\\dev\\my-project",
                                "[]",
                                "[prioritization] clarify* -> strategy -> build -> validate -> render"
                              ],
                              [
                                "discovery",
                                "validate",
                                "C:\\dev\\another-proj",
                                "[clarify,strategy,build]",
                                "[discovery] clarify [OK] -> strategy [OK] -> build [OK] -> validate* -> render"
                              ]
                            ]
                          }
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "Execute Workflow Operations (Mock)",
              "sequential_order": 4,
              "story_groups": [
                {
                  "type": "and",
                  "connector": null,
                  "stories": [
                    {
                      "name": "Execute Mock Action and Display Results",
                      "sequential_order": 1,
                      "connector": "and",
                      "users": [
                        "CLI"
                      ],
                      "story_type": "system",
                      "acceptance_criteria": [
                        "WHEN user requests action execution, THEN CLI mocks the execution",
                        "WHEN execution completes, THEN CLI displays mock results",
                        "WHEN displaying results, THEN CLI advances workflow state",
                        "WHEN workflow advances, THEN CLI loops back to display"
                      ],
                      "scenarios": [
                        {
                          "name": "Execute mock action in Increment 10",
                          "steps": [
                            "Given user is at shape.build.instructions",
                            "When user types build",
                            "Then CLI returns mock BuildInstructions",
                            "And CLI displays instructions to user",
                            "And CLI loops back to prompt"
                          ]
                        }
                      ]
                    },
                    {
                      "name": "Enter Action",
                      "sequential_order": 1,
                      "connector": null,
                      "users": [
                        "User"
                      ],
                      "story_type": "user",
                      "test_file": "test_run_interactive_repl.py",
                      "test_class": "TestEnterAction",
                      "test_method": "test_user_executes_current_action_mock",
                      "acceptance_criteria": [
                        "WHEN user enters run, THEN CLI executes current action and displays response"
                      ],
                      "scenario_outlines": [
                        {
                          "name": "User executes current action (mock)",
                          "steps": [
                            "Given BehaviorActionState.current_behavior is \"<behavior>\"",
                            "And BehaviorActionState.current_action is \"<action>\"",
                            "When user runs instructions operation with command: \"run\"",
                            "Then CLI displays \"EXECUTING <behavior>.<action>.instructions\"",
                            "And CLI displays \"[mock response - not executing real action]\"",
                            "And CLI displays mock response: {\"status\": \"success\", \"action\": \"<action>\", \"data\": {...}}"
                          ],
                          "examples": {
                            "columns": [
                              "behavior",
                              "action"
                            ],
                            "rows": [
                              [
                                "shape",
                                "clarify"
                              ],
                              [
                                "shape",
                                "strategy"
                              ],
                              [
                                "shape",
                                "build"
                              ],
                              [
                                "prioritization",
                                "validate"
                              ],
                              [
                                "discovery",
                                "render"
                              ]
                            ]
                          }
                        }
                      ]
                    },
                    {
                      "name": "Retrieve and Display Bot Behavior Action Instructions",
                      "sequential_order": 6,
                      "connector": "and",
                      "users": [
                        "CLI"
                      ],
                      "story_type": "system",
                      "acceptance_criteria": [
                        "WHEN action executes, THEN CLI calls action.instructions with context",
                        "WHEN instructions are returned, THEN CLI displays formatted instructions to user"
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "Execute Behavior Actions",
      "sequential_order": 3.0,
      "domain_concepts": [
        {
          "name": "Behavior Workflow",
          "responsibilities": [
            {
              "name": "Determine next Action",
              "collaborators": [
                "Behavior",
                "Action",
                "State"
              ]
            },
            {
              "name": "Track state",
              "collaborators": [
                "Behavior",
                "Action",
                "State"
              ]
            }
          ]
        }
      ],
      "sub_epics": [
        {
          "name": "Gather Context",
          "sequential_order": 1.0,
          "domain_concepts": [
            {
              "name": "GatherContextAction",
              "responsibilities": [
                {
                  "name": "Inject gather context instructions",
                  "collaborators": [
                    "Behavior",
                    "Guardrails",
                    "Required Clarifications"
                  ]
                },
                {
                  "name": "Inject questions and evidence",
                  "collaborators": [
                    "Behavior",
                    "Guardrails",
                    "Key Questions",
                    "Evidence"
                  ]
                }
              ]
            },
            {
              "name": "Guardrails",
              "responsibilities": [
                {
                  "name": "Provide required context",
                  "collaborators": [
                    "Key Questions",
                    "Evidence"
                  ]
                },
                {
                  "name": "Guide planning decisions",
                  "collaborators": [
                    "Decision Criteria",
                    "Assumptions"
                  ]
                },
                {
                  "name": "Define recommended human activity",
                  "collaborators": [
                    "Human",
                    "Instructions"
                  ]
                }
              ]
            }
          ],
          "test_file": "test_gather_context.py",
          "story_groups": [
            {
              "type": "and",
              "connector": "and",
              "stories": [
                {
                  "name": "Inject Guardrails As Part Of Clarify Requirements",
                  "sequential_order": 1,
                  "connector": "and",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_gather_context.py",
                  "test_class": "TestInjectGuardrailsAsPartOfClarifyRequirements",
                  "acceptance_criteria": [
                    "WHEN gather_context action executes",
                    "AND behavior folder exists with guardrails/required_context/key_questions.json",
                    "AND behavior folder exists with guardrails/required_context/evidence.json",
                    "THEN instructions should contain actual questions (not {{key_questions}} placeholder)",
                    "AND instructions should contain actual evidence (not {{evidence}} placeholder)",
                    "WHEN guardrails don't exist",
                    "THEN gather_context should not fail",
                    "AND action should execute with base instructions only"
                  ],
                  "scenarios": [
                    {
                      "name": "Gather context injects guardrails from behavior folder",
                      "steps": "GIVEN: behavior folder: 1_shape (with number prefix)\nAND: guardrails/required_context/key_questions.json exists\nAND: guardrails/required_context/evidence.json exists\nWHEN: gather_context action executes\nTHEN: instructions should contain actual questions (not {{key_questions}} placeholder)\nAND: instructions should contain actual evidence (not {{evidence}} placeholder)\nAND: guardrails section includes key_questions with actual data\nAND: guardrails section includes evidence with actual data",
                      "test_method": "test_action_injects_questions_and_evidence"
                    },
                    {
                      "name": "Gather context handles missing guardrails gracefully",
                      "steps": "GIVEN: behavior folder exists but no guardrails\nWHEN: gather_context action executes\nTHEN: action should succeed without guardrails\nAND: instructions contain base instructions only\nAND: no error is raised",
                      "test_method": "test_action_uses_base_instructions_when_guardrails_missing"
                    },
                    {
                      "name": "Gather context handles malformed guardrails gracefully",
                      "steps": "GIVEN: guardrails files exist but contain invalid JSON\nWHEN: gather_context action executes\nTHEN: action should handle malformed JSON gracefully\nAND: action should continue with base instructions",
                      "test_method": "test_action_handles_malformed_guardrails_json"
                    }
                  ]
                },
                {
                  "name": "Track Activity for Gather Context Action",
                  "sequential_order": 2,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_gather_context.py",
                  "test_class": "TestTrackActivityForGatherContextAction",
                  "acceptance_criteria": [
                    "WHEN GatherContextAction executes",
                    "THEN Action creates activity entry with timestamp, action name, behavior name",
                    "AND Activity entry appended to {project_area}/activity_log.json"
                  ],
                  "scenarios": [
                    {
                      "name": "Track activity when gather_context action starts",
                      "steps": "Given behavior is 'discovery'\nAnd action is 'gather_context'\nWhen gather_context action starts execution\nThen Activity logger creates entry with:\n  - timestamp=[start timestamp]\n  - action_state='story_bot.discovery.gather_context'\n  - inputs={source_files_count: 2, context_type: \"exploration\"}\nAnd Entry is appended to activity log at project_area/\nAnd Activity log records action initiation",
                      "test_method": "test_track_activity_when_gather_context_action_starts"
                    },
                    {
                      "name": "Track activity when gather_context action completes",
                      "steps": "Given gather_context action started at timestamp='2025-12-03T10:00:00Z'\nAnd activity log has entry for gather_context  \nWhen gather_context action finishes execution at timestamp='2025-12-03T10:05:30Z'\nThen Activity logger creates completion entry with:\n  - action_state='story_bot.discovery.gather_context'\n  - outputs={questions_count: 5, evidence_count: 3, file_path: \"clarifications.json\"}\n  - duration=330 (seconds: 5.5 minutes)\nAnd Entry is appended to activity log\nAnd Activity log shows complete execution record with metrics and file path",
                      "test_method": "test_track_activity_when_gather_context_action_completes"
                    },
                    {
                      "name": "Track multiple gather_context invocations across behaviors",
                      "steps": "Given activity log contains entry for story_bot.shape.gather_context completed at 09:00\nAnd activity log contains entry for story_bot.discovery.gather_context completed at 10:00\nWhen both entries are present in activity log\nThen activity log contains 2 separate entries:\n  - Entry 1: action_state='story_bot.shape.gather_context', timestamp='2025-12-03T09:00:00Z'\n  - Entry 2: action_state='story_bot.discovery.gather_context', timestamp='2025-12-03T10:00:00Z'\nAnd Each entry has its own inputs (metrics/paths), outputs (metrics/paths), and duration\nAnd Activity log distinguishes same action in different behaviors using full path",
                      "test_method": "test_track_multiple_gather_context_invocations_across_behaviors"
                    }
                  ]
                },
                {
                  "name": "Store Clarification Data",
                  "sequential_order": 3,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_gather_context.py",
                  "test_class": "TestStoreClarificationData",
                  "acceptance_criteria": [
                    "WHEN gather_context action stores clarification data",
                    "THEN gather_context saves to {project_area}/docs/stories/clarification.json",
                    "AND clarification.json contains behavior-specific key_questions and evidence structure",
                    "WHEN clarification data already exists",
                    "THEN existing data is preserved when saving new data"
                  ],
                  "scenarios": [
                    {
                      "name": "Save clarification data when parameters provided",
                      "steps": "GIVEN: gather_context action has collected key questions and evidence\nWHEN: gather_context action stores clarification data with parameters\nTHEN: gather_context saves to {project_area}/docs/stories/clarification.json",
                      "test_method": "test_save_clarification_data_when_parameters_provided"
                    },
                    {
                      "name": "Preserve existing clarification data when saving",
                      "steps": "GIVEN: clarification.json already exists with data\nWHEN: gather_context action saves new clarification data\nTHEN: existing data is preserved\nAND: new data is merged with existing data",
                      "test_method": "test_preserve_existing_clarification_data_when_saving"
                    },
                    {
                      "name": "Skip saving when no clarification parameters provided",
                      "steps": "GIVEN: gather_context action executes\nWHEN: no clarification parameters are provided\nTHEN: clarification.json is not created or updated",
                      "test_method": "test_skip_saving_when_no_clarification_parameters_provided"
                    }
                  ]
                },
                {
                  "name": "Proceed To Decide Planning",
                  "sequential_order": 4,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_gather_context.py",
                  "test_class": "TestProceedToDecidePlanning",
                  "acceptance_criteria": [
                    "WHEN GatherContextAction completes execution",
                    "AND Human says action is done",
                    "THEN GatherContextAction saves Workflow State (per \"Saves Behavior State\" story)",
                    "AND Workflow injects next action instructions (per \"Inject Next Behavior-Action\" story)",
                    "AND Workflow proceeds to decide_planning_criteria"
                  ],
                  "scenarios": [
                    {
                      "name": "Seamless transition from gather_context to decide_planning_criteria",
                      "steps": "Given behavior is 'discovery'\nAnd gather_context action is complete\nAnd Human confirms \"done\" or \"proceed\"\nWhen gather_context action finalizes\nThen Action saves Workflow State with:\n  - current_behavior='story_bot.discovery'\n  - current_action='story_bot.discovery.gather_context'\n  - timestamp=[completion time]\nAnd Action loads gather_context/action configuration\nAnd Action reads next_action='decide_planning_criteria'\nAnd Action injects AI instructions: \"When done, proceed to decide_planning_criteria\"\nAnd AI invokes decide_planning_criteria tool\nAnd Workflow transitions seamlessly to next action",
                      "test_method": "test_seamless_transition_from_gather_context_to_decide_planning_criteria"
                    },
                    {
                      "name": "User must confirm before transition",
                      "steps": "Given gather_context action is complete\nAnd Human has NOT yet confirmed completion\nWhen gather_context action waits for human feedback\nThen Action does NOT save workflow state as completed\nAnd Action does NOT inject next action instructions\nAnd Action does NOT proceed to decide_planning_criteria\nAnd AI waits for human to say \"done\" before transitioning"
                    },
                    {
                      "name": "Workflow state captures gather_context completion",
                      "steps": "Given gather_context action completes at timestamp='2025-12-03T10:05:30Z'\nAnd Human confirms \"done\"\nWhen Action saves workflow state\nThen workflow state is updated with:\n  - current_action='story_bot.exploration.gather_context'\n  - timestamp='2025-12-03T10:05:30Z'\nAnd completed_actions list includes: {action_state: 'story_bot.exploration.gather_context', timestamp: '2025-12-03T10:05:30Z'}\nAnd State persists to project_area/workflow state\nAnd If workflow is interrupted after this point, gather_context is marked as completed",
                      "test_method": "test_workflow_state_captures_gather_context_completion"
                    },
                    {
                      "name": "Workflow resumes at decide_planning_criteria after interruption",
                      "steps": "Given gather_context is completed and chat was interrupted\nWhen user reopens chat and invokes bot tool\nThen Router forwards to decide_planning_criteria action",
                      "test_method": "test_workflow_resumes_at_decide_planning_criteria_after_interruption"
                    }
                  ]
                },
                {
                  "name": "Load Base Action Config",
                  "sequential_order": 5,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_gather_context.py",
                  "test_class": "TestLoadBaseActionConfig",
                  "acceptance_criteria": [
                    "WHEN Action loads configuration",
                    "THEN Action loads base action configuration",
                    "AND Configuration includes action settings"
                  ]
                },
                {
                  "name": "Access Actions",
                  "sequential_order": 6,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_gather_context.py",
                  "test_class": "TestAccessActions",
                  "acceptance_criteria": [
                    "WHEN Action needs to access other actions",
                    "THEN Action can access action registry",
                    "AND Action can retrieve action configurations"
                  ]
                },
                {
                  "name": "Initialize Action",
                  "sequential_order": 7,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_gather_context.py",
                  "test_class": "TestInitializeAction",
                  "acceptance_criteria": [
                    "WHEN Action is initialized",
                    "THEN Action loads required configuration",
                    "AND Action sets up action context"
                  ]
                },
                {
                  "name": "Load Guardrails",
                  "sequential_order": 8,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_gather_context.py",
                  "test_class": "TestLoadGuardrails",
                  "acceptance_criteria": [
                    "WHEN Action needs guardrails",
                    "THEN Action loads guardrails from behavior folder",
                    "AND Guardrails are available for injection"
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "Decide Planning Criteria Action",
          "sequential_order": 2.0,
          "domain_concepts": [
            {
              "name": "PlanningAction",
              "responsibilities": [
                {
                  "name": "Inject planning instructions",
                  "collaborators": [
                    "Behavior",
                    "Guardrails",
                    "Planning"
                  ]
                },
                {
                  "name": "Inject decision criteria and assumptions",
                  "collaborators": [
                    "Behavior",
                    "Guardrails",
                    "Decision Criteria",
                    "Assumptions",
                    "Recommended Human Activity"
                  ]
                }
              ]
            },
            {
              "name": "Guardrails",
              "responsibilities": [
                {
                  "name": "Provide required context",
                  "collaborators": [
                    "Key Questions",
                    "Evidence"
                  ]
                },
                {
                  "name": "Guide planning decisions",
                  "collaborators": [
                    "Decision Criteria",
                    "Assumptions"
                  ]
                },
                {
                  "name": "Define recommended human activity",
                  "collaborators": [
                    "Human",
                    "Instructions"
                  ]
                }
              ]
            }
          ],
          "test_file": "test_decide_planning_criteria.py",
          "story_groups": [
            {
              "type": "and",
              "connector": "or",
              "stories": [
                {
                  "name": "Inject Planning Criteria Into Instructions",
                  "sequential_order": 1,
                  "connector": "and",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "acceptance_criteria": [
                    "WHEN MCP Specific Behavior Action Tool invokes Planning Action",
                    "THEN Action checks for guardrails in behavior/guardrails/planning/",
                    "WHEN guardrails exist, THEN Action loads typical_assumptions.json and decision_criteria files",
                    "AND Action injects planning guardrails into planning section"
                  ]
                },
                {
                  "name": "Track Activity for Planning Action",
                  "sequential_order": 2,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_decide_planning_criteria.py",
                  "test_class": "TestTrackActivityForPlanningAction",
                  "acceptance_criteria": [
                    "WHEN PlanningAction executes",
                    "THEN Action creates activity entry with timestamp, action name, behavior name",
                    "AND Activity entry appended to {project_area}/activity_log.json"
                  ],
                  "scenarios": [
                    {
                      "name": "Track activity when planning action starts",
                      "steps": "Given behavior is 'exploration'\nAnd action is 'decide_planning_criteria'\nWhen decide_planning_criteria action starts execution\nThen Activity logger creates entry with:\n  - timestamp=[start timestamp]\n  - action_state='story_bot.exploration.decide_planning_criteria'\n  - inputs={questions_count: 5, evidence_count: 3, context_file_path: \"clarifications.json\"}\nAnd Entry is appended to activity log at project_area/\nAnd Activity log records action initiation",
                      "test_method": "test_track_activity_when_planning_action_starts"
                    },
                    {
                      "name": "Track activity when planning action completes",
                      "steps": "Given decide_planning_criteria action started at timestamp='2025-12-03T10:15:00Z'\nAnd activity log has entry for decide_planning_criteria\nWhen decide_planning_criteria action finishes execution at timestamp='2025-12-03T10:25:00Z'\nThen Activity logger creates completion entry with:\n  - action_state='story_bot.exploration.decide_planning_criteria'\n  - outputs={criteria_count: 4, assumptions_count: 2, decisions_count: 3, file_path: \"planning.json\"}\n  - duration=600 (seconds: 10 minutes)\nAnd Entry is appended to activity log\nAnd Activity log shows complete execution record with duration",
                      "test_method": "test_track_activity_when_planning_action_completes"
                    }
                  ]
                },
                {
                  "name": "Save Final Assumptions and Decisions",
                  "sequential_order": 3,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user"
                },
                {
                  "name": "Proceed To Build Knowledge",
                  "sequential_order": 4,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_decide_planning_criteria.py",
                  "test_class": "TestProceedToBuildKnowledge",
                  "acceptance_criteria": [
                    "WHEN PlanningAction completes execution",
                    "WHEN Human says action is done",
                    "THEN PlanningAction saves Workflow State (per \"Saves Behavior State\" story)",
                    "AND Workflow injects next action instructions (per \"Inject Next Behavior-Action\" story)",
                    "AND Workflow proceeds to build_knowledge"
                  ],
                  "scenarios": [
                    {
                      "name": "Seamless transition from planning to build_knowledge",
                      "steps": "Given behavior is 'discovery'\nAnd decide_planning_criteria action is complete\nAnd Human confirms \"done\" or \"proceed\"\nWhen decide_planning_criteria action finalizes\nThen Action saves Workflow State with:\n  - current_behavior='story_bot.discovery'\n  - current_action='story_bot.discovery.decide_planning_criteria'\n  - timestamp=[completion time]\nAnd Action loads decide_planning_criteria/action configuration\nAnd Action reads next_action='build_knowledge'\nAnd Action injects AI instructions: \"When done, proceed to build_knowledge\"\nAnd AI invokes build_knowledge tool\nAnd Workflow transitions seamlessly to next action",
                      "test_method": "test_seamless_transition_from_planning_to_build_knowledge"
                    },
                    {
                      "name": "User must confirm before transition",
                      "steps": "Given decide_planning_criteria action is complete\nAnd Human has NOT yet confirmed completion\nWhen decide_planning_criteria action waits for human feedback\nThen Action does NOT save workflow state as completed\nAnd Action does NOT inject next action instructions\nAnd Action does NOT proceed to build_knowledge\nAnd AI waits for human to say \"done\" before transitioning"
                    },
                    {
                      "name": "Workflow state captures planning completion",
                      "steps": "Given decide_planning_criteria action completes at timestamp='2025-12-03T10:25:00Z'\nAnd Human confirms \"done\"\nWhen Action saves workflow state\nThen workflow state is updated with:\n  - current_action='story_bot.exploration.decide_planning_criteria'\n  - timestamp='2025-12-03T10:25:00Z'\nAnd completed_actions list includes: {action_state: 'story_bot.exploration.decide_planning_criteria', timestamp: '2025-12-03T10:25:00Z'}\nAnd State persists to project_area/workflow state\nAnd If workflow is interrupted after this point, planning is marked as completed",
                      "test_method": "test_workflow_state_captures_planning_completion"
                    }
                  ]
                },
                {
                  "name": "Inject Strategy Into Instructions",
                  "sequential_order": 5,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_decide_strategy_criteria_action.py",
                  "test_class": "TestInjectStrategyIntoInstructions",
                  "acceptance_criteria": [
                    "WHEN Strategy is generated",
                    "THEN Strategy is injected into action instructions",
                    "AND Instructions include strategy guidance"
                  ]
                },
                {
                  "name": "Store Strategy Data",
                  "sequential_order": 6,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_decide_strategy_criteria_action.py",
                  "test_class": "TestStoreStrategyData",
                  "acceptance_criteria": [
                    "WHEN Strategy data is generated",
                    "THEN Strategy data is stored to project area",
                    "AND Strategy data persists for later use"
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "Build Knowledge",
          "sequential_order": 3.0,
          "domain_concepts": [
            {
              "name": "BuildKnowledgeAction",
              "responsibilities": [
                {
                  "name": "Inject knowledge graph template",
                  "collaborators": [
                    "Behavior",
                    "Content",
                    "Knowledge Graph Spec",
                    "Knowledge Graph"
                  ]
                },
                {
                  "name": "Inject builder instructions",
                  "collaborators": [
                    "Behavior",
                    "Content",
                    "Build Instructions"
                  ]
                },
                {
                  "name": "Save Knowledge graph",
                  "collaborators": [
                    "Behavior",
                    "Content",
                    "Knowledge Graph"
                  ]
                }
              ]
            },
            {
              "name": "Content",
              "responsibilities": [
                {
                  "name": "Render outputs",
                  "collaborators": [
                    "Template",
                    "Renderer",
                    "Render Spec"
                  ]
                },
                {
                  "name": "Synchronize formats",
                  "collaborators": [
                    "Synchronizer",
                    "Extractor",
                    "Synchronizer Spec"
                  ]
                },
                {
                  "name": "Save knowledge graph",
                  "collaborators": [
                    "Knowledge Graph"
                  ]
                },
                {
                  "name": "Load rendered content",
                  "collaborators": [
                    "na"
                  ]
                },
                {
                  "name": "Present rendered content",
                  "collaborators": [
                    "na"
                  ]
                }
              ]
            }
          ],
          "test_file": "test_build_knowledge.py",
          "story_groups": [
            {
              "type": "and",
              "connector": null,
              "stories": [
                {
                  "name": "Load Story Graph Into Memory",
                  "sequential_order": 1,
                  "connector": "opt",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_build_knowledge.py",
                  "test_class": "TestLoadStoryGraphIntoMemory",
                  "acceptance_criteria": [
                    "WHEN Story graph file exists",
                    "THEN StoryMap loads epics, sub_epics, story_groups, stories, and scenarios",
                    "AND StoryMap provides walk method to traverse all nodes",
                    "WHEN Story graph file does not exist",
                    "THEN StoryMap raises FileNotFoundError"
                  ]
                },
                {
                  "name": "Inject Knowledge Graph Template and Builder Instructions",
                  "sequential_order": 2,
                  "connector": "opt",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_class": "TestInjectKnowledgeGraphTemplateForBuildKnowledge",
                  "acceptance_criteria": [
                    "WHEN Build Knowledge Action executes",
                    "THEN Action loads knowledge graph template from behavior/content/knowledge_graph/",
                    "AND Action injects knowledge graph template path into instructions",
                    "AND knowledge_graph_template field is present in instructions",
                    "AND template file path exists and is accessible",
                    "WHEN knowledge graph template does not exist",
                    "THEN Action raises FileNotFoundError with appropriate error message"
                  ]
                },
                {
                  "name": "Track Activity for Build Knowledge Action",
                  "sequential_order": 3,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_class": "TestTrackActivityForBuildKnowledgeAction",
                  "acceptance_criteria": [
                    "WHEN BuildKnowledgeAction executes",
                    "THEN Action creates activity entry with timestamp, action name, behavior name",
                    "AND Activity entry appended to {project_area}/activity_log.json"
                  ]
                },
                {
                  "name": "Update Existing Knowledge Graph",
                  "sequential_order": 4,
                  "connector": "opt",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_build_knowledge.py",
                  "test_class": "TestUpdateExistingKnowledgeGraph",
                  "acceptance_criteria": [
                    "WHEN Build Knowledge Action updates existing story graph",
                    "THEN Action updates existing story-graph.json file",
                    "AND Action adds increments array to existing file",
                    "AND Existing epics and data are preserved"
                  ],
                  "scenarios": [
                    {
                      "name": "Behavior updates existing story graph JSON",
                      "steps": "GIVEN: Existing story-graph.json file exists\nWHEN: Build Knowledge Action executes for behavior\nTHEN: Action updates existing story-graph.json\nAND: Action adds increments array\nAND: Existing epics are preserved",
                      "test_method": "test_behavior_updates_existing_story_graph_json"
                    }
                  ]
                },
                {
                  "name": "Proceed To Render Output",
                  "sequential_order": 5,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_class": "TestProceedToRenderOutput",
                  "acceptance_criteria": [
                    "WHEN BuildKnowledgeAction completes execution",
                    "THEN BuildKnowledgeAction saves Workflow State (per \"Saves Behavior State\" story)",
                    "AND BuildKnowledgeAction submits content for saving",
                    "AND Workflow automatically proceeds to render_output (auto_progress: true, no human confirmation needed)"
                  ]
                },
                {
                  "name": "proactively Validate knowledge against rules",
                  "sequential_order": 1,
                  "connector": "and",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "acceptance_criteria": [
                    "WHEN BuildKnowledgeAction it's the initial pass of building the knowledge graphTHEN Build Knowledge Action invokes the Validate Rules action to understand if what is generated violates any rules\n(see Validate Knowledge & Content Against Rules)",
                    "WHEN Validate Rules action is finsihed generateing the validation report THEN the BuildKnowledgeAction goes through all of the violations to determine if any corrective action needs to be taken AND the system updates the knowledge graph based on the recommendations.",
                    "WHEN BuildKnowledgeAction Is finished making corrections.\nTHEN BuildKnowledgeAction tells AI to notify the user of what corrections it made as part of presenting the fact that it's done building knowledge."
                  ],
                  "scenarios": [
                    {
                      "name": "Build knowledge forwards to validate action bot and receives enhanced instructions",
                      "steps": "Given Agent is initialized with agent_name='test_story_bot'\nAnd Project has finished generating knowledge graph\nAnd Behavior is '{behavior_name}'\nAnd Common rules directory exists at 'agile_bot/bots/test_story_bot/rules/'\nAnd Behavior rules directory exists at 'agile_bot/bots/test_story_bot/behaviors/{behavior_number}_{behavior_name}/3_rules/'\nAnd Action is 'build_knowledge'\nAnd Knowledge graph exists at 'agile_bot/bots/test_story_bot/docs/stories/story-graph.json'\nAnd Behavior has validation rules '{validation_rules}'\nAnd Validation rules have code scanners '{code_scanners}'\nAnd Code scanners are stubbed to return '{code_scanner_output}'\nWhen Build knowledge action forwards to validate_action_bot with knowledge graph at 'agile_bot/bots/test_story_bot/docs/stories/story-graph.json'\nThen Validate action bot runs stubbed code scanners '{code_scanners}' against knowledge graph\nAnd Stubbed scanners return '{code_scanner_output}'\nAnd Validation report is generated with '{code_scanner_output}'\nAnd Enhanced instructions are returned to build_knowledge action\nAnd Enhanced instructions contain '{enhanced_instructions}'",
                      "test_method": "test_build_knowledge_forwards_to_validate_action_bot_and_receives_enhanced_instructions"
                    }
                  ]
                },
                {
                  "name": "Create Build Scope",
                  "sequential_order": 7,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_build_knowledge.py",
                  "test_class": "TestCreateBuildScope",
                  "acceptance_criteria": [
                    "WHEN Build knowledge action needs scope",
                    "THEN Action creates build scope from parameters",
                    "AND Scope defines what to build"
                  ]
                },
                {
                  "name": "Filter Knowledge Graph",
                  "sequential_order": 8,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_build_knowledge.py",
                  "test_class": "TestFilterKnowledgeGraph",
                  "acceptance_criteria": [
                    "WHEN Knowledge graph needs filtering",
                    "THEN Action filters knowledge graph by scope",
                    "AND Filtered graph contains only relevant content"
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "Render Output",
          "sequential_order": 4.0,
          "domain_concepts": [
            {
              "name": "RenderOutputAction",
              "responsibilities": [
                {
                  "name": "Inject render output instructions",
                  "collaborators": [
                    "Behavior",
                    "Content",
                    "Render Spec",
                    "Renderer"
                  ]
                },
                {
                  "name": "Inject templates",
                  "collaborators": [
                    "Behavior",
                    "Content",
                    "Render Spec",
                    "Template"
                  ]
                },
                {
                  "name": "Inject transformers",
                  "collaborators": [
                    "Behavior",
                    "Content",
                    "Transformer"
                  ]
                },
                {
                  "name": "Load + inject structured content",
                  "collaborators": [
                    "Behavior",
                    "Content",
                    "Knowledge Graph"
                  ]
                }
              ]
            },
            {
              "name": "Renderer",
              "responsibilities": [
                {
                  "name": "Render complex output",
                  "collaborators": [
                    "Template",
                    "Knowledge Graph",
                    "Transformer"
                  ]
                },
                {
                  "name": "Render outputs using components in context",
                  "collaborators": [
                    "AI Chat",
                    "Template",
                    "Content"
                  ]
                }
              ]
            },
            {
              "name": "Template",
              "responsibilities": [
                {
                  "name": "Define output structure",
                  "collaborators": [
                    "Placeholder"
                  ]
                },
                {
                  "name": "Transform content",
                  "collaborators": [
                    "Transformer",
                    "Content"
                  ]
                },
                {
                  "name": "Load template",
                  "collaborators": [
                    "Behavior",
                    "Content"
                  ]
                }
              ]
            },
            {
              "name": "Content",
              "responsibilities": [
                {
                  "name": "Render outputs",
                  "collaborators": [
                    "Template",
                    "Renderer",
                    "Render Spec"
                  ]
                },
                {
                  "name": "Synchronize formats",
                  "collaborators": [
                    "Synchronizer",
                    "Extractor",
                    "Synchronizer Spec"
                  ]
                },
                {
                  "name": "Save knowledge graph",
                  "collaborators": [
                    "Knowledge Graph"
                  ]
                },
                {
                  "name": "Load rendered content",
                  "collaborators": [
                    "na"
                  ]
                },
                {
                  "name": "Present rendered content",
                  "collaborators": [
                    "na"
                  ]
                }
              ]
            }
          ],
          "test_file": "test_render_output.py",
          "story_groups": [
            {
              "type": "and",
              "connector": null,
              "stories": [
                {
                  "name": "Track Activity for Render Output Action",
                  "sequential_order": 4,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_class": "TestTrackActivityForRenderOutputAction",
                  "acceptance_criteria": [
                    "WHEN RenderOutputAction executes",
                    "THEN Action creates activity entry with timestamp, action name, behavior name",
                    "AND Activity entry appended to {project_area}/activity_log.json"
                  ]
                },
                {
                  "name": "Proceed To Validate Rules",
                  "sequential_order": 5,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_class": "TestProceedToValidateRules",
                  "acceptance_criteria": [
                    "WHEN RenderOutputAction completes execution",
                    "WHEN Human says action is done",
                    "THEN RenderOutputAction saves Workflow State (per \"Saves Behavior State\" story)",
                    "AND RenderOutputAction submits content for saving",
                    "AND Workflow injects next action instructions (per \"Inject Next Behavior-Action\" story)",
                    "AND Workflow proceeds to validate_rules"
                  ]
                },
                {
                  "name": "Load Render Configurations",
                  "sequential_order": 1,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_load_rendered_content.py",
                  "test_class": "TestLoadRenderConfigurations",
                  "acceptance_criteria": [
                    "WHEN render_output action executes",
                    "THEN Action discovers render folder using *_content/*_render pattern",
                    "AND Action loads all *.json files from render folder",
                    "AND Action reads each render JSON configuration",
                    "AND Action loads instructions.json from render folder if it exists",
                    "AND Action verifies synchronizer classes exist and have render method"
                  ],
                  "scenarios": [
                    {
                      "name": "Render output discovers and loads render JSON files",
                      "steps": "Given Behavior folder contains 2_content/2_render/ folder\nAnd Render folder contains render JSON file\nWhen render_output action executes for the behavior\nThen render_output discovers render folder using *_content/*_render pattern\nAnd render_output loads all *.json files from render folder\nAnd render_output reads each render JSON configuration",
                      "test_method": "test_render_output_discovers_and_loads_render_json_files"
                    },
                    {
                      "name": "Render output loads instructions.json from render folder",
                      "steps": "Given Render folder contains instructions.json file\nAnd Render folder contains render JSON configuration files\nWhen render_output discovers render folder\nThen render_output loads instructions.json if it exists\nAnd render_output stores render_instructions for later injection\nAnd render_instructions are separate from render_configs",
                      "test_method": "test_render_output_loads_instructions_json_from_render_folder"
                    },
                    {
                      "name": "Render output verifies synchronizer classes exist and have render method",
                      "steps": "Given Render JSON file exists with synchronizer field\nWhen render_output loads render JSON file\nThen render_output verifies synchronizer field contains full module path and class name\nAnd render_output verifies synchronizer class can be imported\nAnd render_output verifies synchronizer class has render method\nAnd render_output stores synchronizer class path in render config",
                      "test_method": "test_render_output_verifies_synchronizer_classes_exist_and_have_render_method"
                    },
                    {
                      "name": "Render output handles missing render folder",
                      "steps": "Given Behavior folder does not contain 2_content/2_render/ folder\nWhen render_output action executes for the behavior\nThen render_output reports error (render folder is required for render_output action)\nAnd render_output cannot proceed without render configurations",
                      "test_method": "test_render_output_handles_missing_render_folder"
                    },
                    {
                      "name": "Render output handles unreadable render JSON files",
                      "steps": "Given Render folder contains multiple *.json files\nAnd One render JSON file cannot be read (corrupted or invalid JSON)\nWhen render_output loads render JSON files\nThen render_output skips unreadable render JSON file\nAnd render_output continues loading other *.json files from render folder\nAnd render_output does not fail entire load process",
                      "test_method": "test_render_output_handles_unreadable_render_json_files"
                    },
                    {
                      "name": "Render output handles invalid synchronizer classes",
                      "steps": "Given Render JSON file exists with synchronizer field\nAnd Synchronizer class cannot be imported or does not have render method\nWhen render_output loads render JSON file\nThen render_output reports error for that render config\nAnd render_output continues loading other render configs\nAnd render_output does not fail entire load process",
                      "test_method": "test_render_output_handles_invalid_synchronizer_classes"
                    }
                  ]
                },
                {
                  "name": "Inject Template Instructions",
                  "sequential_order": 2,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_load_rendered_content.py",
                  "test_class": "TestInjectTemplateInstructions",
                  "acceptance_criteria": [
                    "WHEN render_output action processes template-only render configs",
                    "THEN Action loads template file from templates folder",
                    "AND Action injects template content into instructions",
                    "AND render_configs array includes template content"
                  ],
                  "scenarios": [
                    {
                      "name": "Render output loads template files from render JSON",
                      "steps": "Given Render JSON file specifies template field\nAnd Render JSON does not have synchronizer field\nAnd Template file exists at 2_content/2_render/templates/\nWhen render_output processes template-only render configs\nThen render_output checks for template field in configuration\nAnd render_output loads template file from templates folder\nAnd render_output loads template file as text content\nAnd render_output stores template content with render config",
                      "test_method": "test_render_output_loads_template_files_from_render_json"
                    },
                    {
                      "name": "Render output injects template content into instructions",
                      "steps": "Given Render JSON file exists without synchronizer field\nAnd Render JSON file specifies template field\nAnd render_output has loaded render JSON file\nAnd render_output has loaded template file\nWhen render_output merges instructions\nThen render_output injects render_configs array into merged instructions\nAnd render_configs[0] includes config with name from render JSON file\nAnd render_configs[0] includes loaded template content from template file",
                      "test_method": "test_render_output_injects_template_content_into_instructions"
                    },
                    {
                      "name": "Render output handles missing template files gracefully",
                      "steps": "Given Render JSON specifies template file that does not exist\nAnd Render JSON does not have synchronizer field\nAnd Other render JSONs with templates do exist\nWhen render_output loads template files\nThen render_output skips missing template file\nAnd render_output continues loading other templates\nAnd render_output includes successfully loaded templates with render configs",
                      "test_method": "test_render_output_handles_missing_template_files_gracefully"
                    }
                  ]
                },
                {
                  "name": "Inject Synchronizer Instructions",
                  "sequential_order": 3,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_load_rendered_content.py",
                  "test_class": "TestInjectSynchronizerInstructions",
                  "acceptance_criteria": [
                    "WHEN render_output action processes synchronizer-based render configs",
                    "THEN Action includes synchronizer configs in render_configs array",
                    "AND Action includes synchronizer execution instructions in base_instructions",
                    "AND Instructions specify how to instantiate and call synchronizer render method"
                  ],
                  "scenarios": [
                    {
                      "name": "Render output includes synchronizer configs in render_configs array",
                      "steps": "Given Render JSON file exists with synchronizer field\nAnd Render JSON file specifies renderer_command (optional, for render method variant)\nAnd render_output has loaded render JSON file\nAnd Synchronizer class has been verified\nWhen render_output processes synchronizer-based render configs\nThen render_output includes config with synchronizer field in render_configs array\nAnd render_configs[0] includes config with name from render JSON file\nAnd render_configs[0] includes synchronizer class path\nAnd render_configs[0] includes renderer_command (if specified)\nAnd render_configs[0] includes input and output paths from render JSON",
                      "test_method": "test_render_output_includes_synchronizer_configs_in_render_configs_array"
                    },
                    {
                      "name": "Render output includes synchronizer execution instructions in base_instructions",
                      "steps": "Given Render JSON file exists with synchronizer field\nAnd Render JSON file specifies renderer_command (optional, for render method variant)\nAnd Render JSON file specifies input and output\nAnd render_output has processed synchronizer-based render configs\nWhen render_output merges instructions\nThen base_instructions contain instruction to instantiate synchronizer class\nAnd base_instructions contain instruction to call render method on synchronizer instance\nAnd base_instructions specify render method call with input and output paths\nAnd base_instructions specify renderer_command if provided (for method variant)",
                      "test_method": "test_render_output_includes_synchronizer_execution_instructions_in_base_instructions"
                    }
                  ]
                },
                {
                  "name": "Inject Render Instructions And Configs",
                  "sequential_order": 6,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_render_output.py",
                  "test_class": "TestInjectRenderInstructionsAndConfigs",
                  "acceptance_criteria": [
                    "WHEN Render instructions are needed",
                    "THEN Action injects render instructions and configs",
                    "AND Instructions include render configuration"
                  ]
                },
                {
                  "name": "Get Render Instructions",
                  "sequential_order": 7,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_render_output.py",
                  "test_class": "TestGetRenderInstructions",
                  "acceptance_criteria": [
                    "WHEN Action needs render instructions",
                    "THEN Action retrieves render instructions",
                    "AND Instructions are available for rendering"
                  ]
                },
                {
                  "name": "Merge Base And Render Instructions",
                  "sequential_order": 8,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_render_output.py",
                  "test_class": "TestMergeBaseAndRenderInstructions",
                  "acceptance_criteria": [
                    "WHEN Base and render instructions exist",
                    "THEN Action merges base and render instructions",
                    "AND Merged instructions combine both sets"
                  ]
                },
                {
                  "name": "Render Output Using Synchronizers",
                  "sequential_order": 9,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_render_output.py",
                  "test_class": "TestRenderOutputUsingSynchronizers",
                  "acceptance_criteria": [
                    "WHEN Output needs rendering",
                    "THEN Action uses synchronizers to render output",
                    "AND Synchronizers execute render method"
                  ]
                },
                {
                  "name": "Inject Render Instructions And Configs",
                  "sequential_order": 6,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_render_output.py",
                  "test_class": "TestInjectRenderInstructionsAndConfigs",
                  "acceptance_criteria": [
                    "WHEN Render instructions are needed",
                    "THEN Action injects render instructions and configs",
                    "AND Instructions include render configuration"
                  ]
                },
                {
                  "name": "Get Render Instructions",
                  "sequential_order": 7,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_render_output.py",
                  "test_class": "TestGetRenderInstructions",
                  "acceptance_criteria": [
                    "WHEN Action needs render instructions",
                    "THEN Action retrieves render instructions",
                    "AND Instructions are available for rendering"
                  ]
                },
                {
                  "name": "Merge Base And Render Instructions",
                  "sequential_order": 8,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_render_output.py",
                  "test_class": "TestMergeBaseAndRenderInstructions",
                  "acceptance_criteria": [
                    "WHEN Base and render instructions exist",
                    "THEN Action merges base and render instructions",
                    "AND Merged instructions combine both sets"
                  ]
                },
                {
                  "name": "Render Output Using Synchronizers",
                  "sequential_order": 9,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_render_output.py",
                  "test_class": "TestRenderOutputUsingSynchronizers",
                  "acceptance_criteria": [
                    "WHEN Output needs rendering",
                    "THEN Action uses synchronizers to render output",
                    "AND Synchronizers execute render method"
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "Validate Knowledge & Content Against Rules",
          "sequential_order": 5.0,
          "domain_concepts": [
            {
              "name": "ValidateRulesAction",
              "responsibilities": [
                {
                  "name": "Inject common bot rules",
                  "collaborators": [
                    "Base Bot",
                    "Rules",
                    "Common Rules"
                  ]
                },
                {
                  "name": "Inject behavior specific rules",
                  "collaborators": [
                    "Behavior",
                    "Rules",
                    "Behavior Rules"
                  ]
                },
                {
                  "name": "Load + inject content for validation",
                  "collaborators": [
                    "Behavior",
                    "Content",
                    "Knowledge Graph",
                    "Rendered Outputs"
                  ]
                }
              ]
            },
            {
              "name": "Rule",
              "responsibilities": [
                {
                  "name": "Validate content",
                  "collaborators": [
                    "Knowledge Graph",
                    "Violations"
                  ]
                },
                {
                  "name": "Find behavior specific rules from context",
                  "collaborators": [
                    "Behavior"
                  ]
                },
                {
                  "name": "Find common bot rules from context",
                  "collaborators": [
                    "Base Bot"
                  ]
                },
                {
                  "name": "Load + inject diagnostics results",
                  "collaborators": [
                    "AI Chat",
                    "Violations",
                    "Corrections"
                  ]
                },
                {
                  "name": "Suggest corrections",
                  "collaborators": [
                    "Violations",
                    "Suggestions",
                    "Fixes"
                  ]
                },
                {
                  "name": "Provide examples - Do",
                  "collaborators": [
                    "Example",
                    "Description"
                  ]
                },
                {
                  "name": "Provide examples - Dont",
                  "collaborators": [
                    "Example",
                    "Description"
                  ]
                },
                {
                  "name": "Specialized examples",
                  "collaborators": [
                    "Language",
                    "Framework",
                    "Pattern"
                  ]
                }
              ]
            },
            {
              "name": "CorrectBotAction",
              "responsibilities": [
                {
                  "name": "Inject correct bot instructions",
                  "collaborators": [
                    "Behavior",
                    "Correct Bot Instructions"
                  ]
                },
                {
                  "name": "Load + inject diagnostics results",
                  "collaborators": [
                    "Content",
                    "Diagnostic Report",
                    "Violations",
                    "Suggestions"
                  ]
                }
              ]
            }
          ],
          "test_file": "test_validate_knowledge_and_content_against_rules.py",
          "story_groups": [
            {
              "type": "and",
              "connector": null,
              "stories": [
                {
                  "name": "Inject Validation Rules for Validate Rules Action",
                  "sequential_order": 1,
                  "connector": "and",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_validate_knowledge_and_content_against_rules.py",
                  "test_class": "TestInjectValidationRulesForValidateRulesAction",
                  "acceptance_criteria": [
                    "WHEN MCP Specific Behavior Action Tool invokes Validate Rules Action",
                    "THEN Action loads common bot rules from base_bot/rules/",
                    "AND Action loads behavior-specific rules",
                    "AND Action merges and injects rules into validation section"
                  ]
                },
                {
                  "name": "Track Activity for Validate Rules Action",
                  "sequential_order": 2,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_class": "TestTrackActivityForValidateRulesAction",
                  "acceptance_criteria": [
                    "WHEN ValidateRulesAction executes",
                    "THEN Action creates activity entry with timestamp, action name, behavior name, violations count",
                    "AND Activity entry appended to {project_area}/activity_log.json"
                  ]
                },
                {
                  "name": "Invoke Complete Validation Workflow",
                  "sequential_order": 3,
                  "connector": "or",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_validate_knowledge_and_content_against_rules.py",
                  "test_class": "TestInvokeCompleteValidationWorkflow",
                  "acceptance_criteria": [
                    "WHEN ValidateRulesAction completes execution",
                    "THEN Action returns instructions with base_instructions (primary) and validation_rules (supporting context)",
                    "AND Action returns content_to_validate information (project location, rendered outputs, clarification.json, planning.json, report_path)",
                    "THEN Action presents validation results to user",
                    "AND Action instructions include report_path where validation report should be saved (validation-report.md in docs/stories/)",
                    "WHEN AI generates validation report",
                    "THEN AI saves validation report to file at report_path location",
                    "WHEN Human says action is done",
                    "THEN ValidateRulesAction saves Workflow State (per \"Saves Behavior State\" story)",
                    "AND validate_rules is terminal action (next_action: null, workflow completes)"
                  ],
                  "scenarios": [
                    {
                      "name": "validate_rules marks workflow as complete",
                      "steps": "Given validate_rules action is complete\nAnd validate_rules is terminal action (next_action=null)\nWhen validate_rules finalizes\nThen Workflow is marked as complete (no next action)",
                      "test_method": "test_validate_rules_marks_workflow_as_complete"
                    },
                    {
                      "name": "validate_rules does NOT inject next action instructions",
                      "steps": "Given validate_rules action is complete\nAnd validate_rules is terminal action\nWhen validate_rules finalizes\nThen No next action instructions injected",
                      "test_method": "test_validate_rules_does_not_inject_next_action_instructions"
                    },
                    {
                      "name": "Workflow state shows all actions completed",
                      "steps": "Given validate_rules completes as final action\nWhen Action tracks completion\nThen Activity log records the completion",
                      "test_method": "test_workflow_state_shows_all_actions_completed"
                    },
                    {
                      "name": "Activity log records full workflow completion",
                      "steps": "Given validate_rules completes at timestamp\nWhen Activity logger records completion\nThen Activity log shows validate_rules completed and workflow finished",
                      "test_method": "test_activity_log_records_full_workflow_completion"
                    }
                  ]
                },
                {
                  "name": "Discovers Scanners",
                  "sequential_order": 1,
                  "connector": "and",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_validate_knowledge_and_content_against_rules.py",
                  "test_class": "TestDiscoversScanners",
                  "acceptance_criteria": [
                    "WHEN scanner discovery is executed for rule files THEN scanners are discovered from rule files containing scanner properties",
                    "WHEN scanner class path is found in rule file THEN scanner class is located and validated",
                    "WHEN scanner metadata is extracted THEN metadata includes rule_name, description, and behavior_name",
                    "WHEN scanners are registered THEN scanners are organized in catalog grouped by behavior_name",
                    "WHEN rule file is malformed THEN error is logged and valid scanners are still registered",
                    "WHEN scanner class is not found THEN error is logged and scanner is not registered",
                    "WHEN rule file is missing scanner property THEN error is logged and scanner is not registered"
                  ],
                  "scenarios": [
                    {
                      "name": "Scanner discovery extracts metadata and registers scanners",
                      "steps": "Given Agent is initialized with agent_name='test_story_bot'\nAnd Project has finished generating knowledge graph\nAnd Behavior is '{behavior_name}'\nAnd Common rules directory exists at 'agile_bot/bots/test_story_bot/rules/'\nAnd Behavior rules directory exists at 'agile_bot/bots/test_story_bot/behaviors/{behavior_number}_{behavior_name}/3_rules/'\nGiven Rule files exist at '{rule_file_paths}'\nAnd Rule files contain '{rule_file_content}'\nWhen Scanner discovery is executed for rule files at '{rule_file_paths}'\nThen Scanners are discovered: '{registered_scanners}'\nAnd Scanner class found status is '{scanner_class_found}'\nAnd Scanner metadata is extracted from rule file with content '{rule_file_content}'\nAnd Scanner metadata is '{scanner_metadata}'\nAnd Scanners '{registered_scanners}' are registered in catalog for behaviors '{behaviors}'\nAnd Catalog structure is '{catalog_structure}'\nAnd Catalog size is '{catalog_size}'",
                      "test_method": "test_scanner_discovery_extracts_metadata_and_registers_scanners"
                    }
                  ]
                },
                {
                  "name": "Run Scanners against Knowledge Graph",
                  "sequential_order": 2,
                  "connector": "and",
                  "users": [
                    "Scanner"
                  ],
                  "story_type": "user",
                  "test_file": "test_validate_knowledge_and_content_against_rules.py",
                  "test_class": "TestRunScannersAgainstKnowledgeGraph",
                  "acceptance_criteria": [
                    "WHEN scanners are executed against knowledge graph THEN violations are detected at exact line numbers",
                    "WHEN violations are detected THEN violation details include rule_name, location, violation_message, and severity",
                    "WHEN multiple scanners execute THEN violations from all scanners are aggregated"
                  ],
                  "scenarios": [
                    {
                      "name": "Scanners detect violations in knowledge graph",
                      "steps": "Given Agent is initialized with agent_name='test_story_bot'\nAnd Project has finished generating knowledge graph\nAnd Behavior is '{behavior_name}'\nAnd Common rules directory exists at 'agile_bot/bots/test_story_bot/rules/'\nAnd Behavior rules directory exists at 'agile_bot/bots/test_story_bot/behaviors/{behavior_number}_{behavior_name}/3_rules/'\nAnd Scanners are discovered and registered for {behavior} and {rule file}:\n  - Common rules: 'agile_bot/bots/test_story_bot/rules/'\n  - Behavior rules: 'agile_bot/bots/test_story_bot/behaviors/{behavior_number}_{behavior_name}/3_rules/'\nAnd Knowledge graph exists at 'agile_bot/bots/test_story_bot/docs/stories/story-graph.json'\nGiven Knowledge graph contains '{knowledge_graph_problems}'\nAnd Rule file is '{rule_file}'\nWhen Scanners are executed against knowledge graph containing '{knowledge_graph_problems}'\nThen Violations are detected at '{expected_violation_line}'\nAnd Violation details are '{expected_violation_details}'\nAnd Report format is '{expected_report_format}'\nAnd Report structure is '{expected_report_structure}'",
                      "test_method": "test_scanners_detect_violations_in_knowledge_graph"
                    },
                    {
                      "name": "Single scanner execution detects violations",
                      "steps": "Given Knowledge graph contains '{knowledge_graph_problems}'\nAnd Scanner '{scanner}' is selected for execution\nWhen Single scanner '{scanner}' is executed against knowledge graph containing '{knowledge_graph_problems}'\nThen Violation line is '{expected_violation_line}'\nAnd Violation details are '{expected_violation_details}'",
                      "test_method": "test_single_scanner_execution_detects_violations"
                    },
                    {
                      "name": "Multiple scanners execute and aggregate violations",
                      "steps": "Given Scanners are discovered and registered\nAnd Knowledge graph exists at 'agile_bot/bots/test_story_bot/docs/stories/story-graph.json'\nAnd Knowledge graph contains '{knowledge_graph_problems}'\nAnd Multiple scanners '{scanners}' are selected for execution\nWhen Multiple scanners '{scanners}' are executed against knowledge graph containing '{knowledge_graph_problems}'\nThen Violations per scanner are '{expected_violations_per_scanner}'\nAnd Total violations are '{expected_total_violations}'",
                      "test_method": "test_multiple_scanners_execute_and_aggregate_violations"
                    },
                    {
                      "name": "Scanner execution order and isolation",
                      "steps": "Given Scanners are discovered and registered\nAnd Knowledge graph exists at 'agile_bot/bots/test_story_bot/docs/stories/story-graph.json'\nAnd Knowledge graph contains '{knowledge_graph_problems}'\nAnd Scanner execution order is '{scanner_execution_order}'\nAnd Scanner failure behavior is '{scanner_failure_behavior}'\nWhen Scanners execute in '{scanner_execution_order}' order against knowledge graph containing '{knowledge_graph_problems}'\nThen Result is '{expected_result}'",
                      "test_method": "test_scanner_execution_order_and_isolation"
                    }
                  ]
                },
                {
                  "name": "Run AST Scanners against Knowledge Graph (OUT OF SCOPE)",
                  "sequential_order": 3,
                  "connector": "or",
                  "users": [
                    "Scanner"
                  ],
                  "story_type": "user",
                  "acceptance_criteria": [
                    "WHEN Scanner configured with AST parsing processes code files THEN Scanner parses code into abstract syntax tree AND Scanner traverses AST nodes to detect structural violations AND Scanner records violation location (file path, line number, node type, violation description)"
                  ]
                },
                {
                  "name": "Validate Rules According To Scope",
                  "sequential_order": 4,
                  "connector": "and",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_validate_knowledge_and_content_against_rules.py",
                  "test_class": "TestValidateRulesAccordingToScope",
                  "acceptance_criteria": [
                    "WHEN ValidateRulesAction receives scope parameter",
                    "THEN Action validates only files matching scope",
                    "AND Action respects test_file, code_file, or knowledge_graph scope"
                  ]
                },
                {
                  "name": "Generate Violation Report",
                  "sequential_order": 5,
                  "connector": "and",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "test_file": "test_validate_knowledge_and_content_against_rules.py",
                  "test_class": "TestGenerateViolationReport",
                  "acceptance_criteria": [
                    "WHEN violation report is generated THEN report is generated in requested format",
                    "WHEN violations are grouped THEN violations are organized by behavior_name, rule_name, location, or severity",
                    "WHEN report is written to file THEN file is created at specified output destination"
                  ],
                  "scenarios": [
                    {
                      "name": "Violation report generation in different formats",
                      "steps": "Given Agent is initialized with agent_name='test_story_bot'\nAnd Project has finished generating knowledge graph\nAnd Behavior is '{behavior_name}'\nAnd Common rules directory exists at 'agile_bot/bots/test_story_bot/rules/'\nAnd Behavior rules directory exists at 'agile_bot/bots/test_story_bot/behaviors/{behavior_number}_{behavior_name}/3_rules/'\nAnd Scanners have executed against knowledge graph\nGiven Violations have been detected: '{violations_data}'\nAnd Report format is '{report_format}'\nWhen Violation report is generated with violations '{violations_data}' and format '{report_format}'\nThen Report structure is '{expected_report_structure}'",
                      "test_method": "test_violation_report_generation_in_different_formats"
                    },
                    {
                      "name": "Violation grouping and organization",
                      "steps": "Given Violations have been detected: '{violations_data}'\nAnd Violations are from behaviors '{behaviors}'\nWhen Violations are grouped and organized with violations '{violations_data}' from behaviors '{behaviors}'\nThen Grouping is '{expected_grouping}'\nAnd Organization is '{expected_organization}'",
                      "test_method": "test_violation_grouping_and_organization"
                    },
                    {
                      "name": "Report output and persistence",
                      "steps": "Given Violations have been detected: '{violations_data}'\nAnd Report format is '{report_format}'\nAnd Output destination is '{output_destination}'\nWhen Report is generated with format '{report_format}' and violations '{violations_data}' and written to '{output_destination}'\nThen Output is '{expected_output}'",
                      "test_method": "test_report_output_and_persistence"
                    }
                  ]
                },
                {
                  "name": "Report Validation and Error Handling",
                  "sequential_order": 5,
                  "connector": "and",
                  "users": [
                    "Bot Behavior"
                  ],
                  "story_type": "user",
                  "acceptance_criteria": [
                    "WHEN ValidateRulesAction receives violations data as array THEN Report is generated successfully with violations including exact line_number and severity",
                    "WHEN ValidateRulesAction receives violations data that is not an array THEN Error is reported: \"Violations data must be an array\" AND No report is generated",
                    "WHEN ValidateRulesAction receives violations with missing fields (location, violation_message) THEN Partial report is generated AND Missing fields are handled gracefully AND Report includes available fields including severity",
                    "WHEN ValidateRulesAction receives violations with null values THEN Report is generated with nulls preserved or replaced with defaults AND Severity is preserved",
                    "WHEN ValidateRulesAction receives array with 1000+ violations THEN Report is generated AND Large array is handled efficiently AND All violations are included with severity",
                    "WHEN ValidateRulesAction receives violations data with circular references THEN Error is reported: \"Circular reference detected in violations data\"",
                    "WHEN ValidateRulesAction receives violations with missing severity THEN Report is generated AND Missing severity is handled gracefully AND Default severity is applied or null is preserved"
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
  ],
  "increments": [
    {
      "name": "User Manually Drops Config In to AI Chat",
      "priority": 1,
      "stories": [
        "Generate Bot Tools"
      ]
    },
    {
      "name": "Simplest MCP",
      "priority": 2,
      "stories": [
        "Generate MCP Bot Server",
        "Generate Behavior Action Tools",
        "Deploy MCP BOT Server",
        "Inject Validation Rules for Validate Rules Action",
        "Restart MCP Server To Load Code Changes",
        "Invoke Bot Tool"
      ]
    },
    {
      "name": "Workflow",
      "priority": 3,
      "stories": [
        "Generate Behavior Tools",
        "Generate MCP Bot Server",
        "Inject Knowledge Graph Template and Builder Instructions",
        "Track Activity for Build Knowledge Action",
        "Proceed To Render Output",
        "Track Activity for Gather Context Action",
        "Proceed To Decide Planning",
        "Load Render Configurations",
        "Inject Template Instructions",
        "Inject Synchronizer Instructions",
        "Track Activity for Render Output Action",
        "Track Activity for Validate Rules Action",
        "Initialize Project Location",
        "Close Current Action",
        "Execute Behavior",
        "Find Behavior Folder",
        "Forward To Current Action",
        "Forward To Current Behavior and Current Action",
        "Invoke Behavior Actions in Workflow Order",
        "Invoke Behavior in Workflow Order",
        "Track Activity For Workspace"
      ]
    },
    {
      "name": "CLI",
      "priority": 4,
      "stories": [
        "Generate BOT CLI code",
        "Generate Cursor Command Files",
        "Invoke Bot CLI",
        "Invoke Bot Behavior CLI",
        "Invoke Bot Behavior Action CLI",
        "Get Help for Command Line Functions"
      ]
    },
    {
      "name": "Inject / Store Content",
      "priority": 6,
      "stories": [
        "Load Story Graph Into Memory",
        "Update Existing Knowledge Graph",
        "Save Final Assumptions and Decisions",
        "Store Clarification Data",
        "Inject Guardrails As Part Of Clarify Requirements",
        "Store Context Files",
        "Stores Activity for Initialize Project Action",
        "Guards Prevent Writes Without Project",
        "Initialize Project Creates Context Folder",
        "Inject Next Behavior Reminder",
        "Input File Copied To Context Folder",
        "Load And Merge Behavior Action Instructions"
      ]
    },
    {
      "name": "Code Scanner",
      "priority": 7,
      "stories": [
        "Inject Validation Rules for Validate Rules Action",
        "Discovers Scanners",
        "Run Scanners against Knowledge Graph",
        "Track Activity for Validate Rules Action",
        "Handle Validate Rules Exceptions",
        "Run All Scanners",
        "Run Scanners Against Test Code",
        "Run Scanners Against Code",
        "Load Rules Collection",
        "Find Rule By Name",
        "Iterate Rules",
        "Load Rule From File",
        "Load Scanner For Rule",
        "Get Rule Properties",
        "Create Validation Scope",
        "Load Scanner Class",
        "Load Scanner Classes",
        "Perform Incremental Validation",
        "Scope Based Parameter Handling",
        "Validation With All Parameter Combinations",
        "Inject Rules Into AI Chat Message",
        "Example Story",
        "Another Story"
      ]
    },
    {
      "name": "Refactoring",
      "priority": 8,
      "stories": [
        "Create Build Scope",
        "Filter Knowledge Graph",
        "Inject Render Instructions And Configs",
        "Get Render Instructions",
        "Merge Base And Render Instructions",
        "Render Output Using Synchronizers",
        "Detect Trigger Words Through Extension",
        "Get Trigger Priority",
        "Match Text Against Triggers",
        "CLI Accepts Scope With Python Dict Syntax",
        "CLI Normalizes Python Dict To JSON",
        "CLI Builds Parameters From Arguments",
        "CLI Handles Scope In Real Usage",
        "CLI Preserves Array Values In Scope",
        "Scope Based Parameter Handling",
        "Validation Parameter Variations",
        "CLI Type Safe Action Context",
        "CLI Context Builder Parses Typed Context",
        "CLI Parser Generator Creates Action Parsers",
        "Bootstrap Workspace",
        "Generate Help",
        "Generate Cursor Awareness Files",
        "Generate Help Parameters From Action Context Classes",
        "Insert Context Into Instructions",
        "Inject Status Update Breadcrumbs Into Instructions",
        "Load Bot Configuration",
        "Load Behavior Configuration",
        "Load Bot Behaviors",
        "Load Actions",
        "Load Base Action Configuration",
        "Access Bot Paths",
        "Get Base Instructions",
        "Load Behavior Config",
        "Manage Behaviors Collection",
        "Resolve Bot Paths",
        "Filter Action Based On Scope",
        "Inject Strategy Into Instructions",
        "Store Strategy Data"
      ]
    },
    {
      "name": "LangGraph Orchestration",
      "priority": 9,
      "stories": [
        "Route to Default Behavior Action",
        "Route to BotLangFlow",
        "Invoke BotLangActionNode",
        "Prepare Action Instructions",
        "Process Bot Behavor Action Instructions Automatically",
        "Process Behavor Action Instructions Through AI Chat",
        "Confirm Behavor Action Instruction Response",
        "Return to chat and pause for human-in-the-loop Node",
        "Handle Execution Modes",
        "Resume BotLangFlow from Checkpoint"
      ]
    },
    {
      "name": "Front-End REPL (Interactive Testing)",
      "priority": 10,
      "stories": [
        "Launch REPL Loop",
        "Detect TTY Input",
        "Display Fresh Start",
        "Display Existing State",
        "Show Current Position In Workflow Breadcrumbs",
        "Show Available Behaviors and Actions",
        "Navigate To Behavior",
        "Navigate To Action",
        "Navigate Within Behavior",
        "Request Help",
        "Request Status",
        "Enter Action",
        "Prompt For Basic Parameters",
        "Prompt For Story Scope Parameters",
        "Prompt For File Scope Parameters",
        "Display Confirm and Continue Prompt",
        "Enter Confirm Results",
        "Advance To Next Action",
        "Loop Back To Display State",
        "Exit REPL"
      ]
    },
    {
      "name": "REPL Generation",
      "priority": 11,
      "stories": [
        "Generate REPL Command Definitions",
        "Generate CLI Entry Point",
        "Generate Cursor Commands",
        "Generate Help Documentation"
      ]
    },
    {
      "name": "REPL Base Parameters (No Scope)",
      "priority": 12,
      "stories": [
        "Display Fresh Start",
        "Display Existing State",
        "Show Current Position In Workflow Breadcrumbs",
        "Show Available Behaviors and Actions",
        "Navigate To Behavior",
        "Navigate To Action",
        "Request Help",
        "Request Status",
        "Enter Action",
        "Parse Command Input",
        "Validate Instruction Syntax and Regular Parameters",
        "Display Confirm and Continue Prompt",
        "Enter Confirm Results",
        "Execute Current Action",
        "Display Action Output",
        "Advance To Next Action",
        "Loop Back To Display State"
      ]
    },
    {
      "name": "REPL Story Parameters (Mock Backend)",
      "priority": 13,
      "stories": [
        "Set Scope Parameter",
        "Enter Action",
        "Parse Command Input",
        "Validate Instruction Syntax and Regular Parameters",
        "Prompt For Story Scope Parameters",
        "Display Confirm and Continue Prompt",
        "Enter Confirm Results",
        "Execute Current Action",
        "Display Action Output",
        "Advance To Next Action"
      ]
    },
    {
      "name": "REPL Story Parameters (Real Backend)",
      "priority": 14,
      "stories": [
        "Set Scope Parameter",
        "Enter Action",
        "Parse Command Input",
        "Validate Instruction Syntax and Regular Parameters",
        "Prompt For Story Scope Parameters",
        "Display Confirm and Continue Prompt",
        "Enter Confirm Results",
        "Execute Current Action",
        "Display Action Output",
        "Advance To Next Action",
        "Retrieve and Display Bot Behavior Action Instructions"
      ]
    },
    {
      "name": "REPL File Parameters (Mock Backend)",
      "priority": 15,
      "stories": [
        "Set Scope Parameter",
        "Enter Action",
        "Parse Command Input",
        "Validate Instruction Syntax and Regular Parameters",
        "Prompt For File Scope Parameters",
        "Display Confirm and Continue Prompt",
        "Enter Confirm Results",
        "Execute Current Action",
        "Display Action Output",
        "Advance To Next Action"
      ]
    },
    {
      "name": "REPL File Parameters (Real Backend)",
      "priority": 16,
      "stories": [
        "Set Scope Parameter",
        "Enter Action",
        "Parse Command Input",
        "Validate Instruction Syntax and Regular Parameters",
        "Prompt For File Scope Parameters",
        "Display Confirm and Continue Prompt",
        "Enter Confirm Results",
        "Execute Current Action",
        "Display Action Output",
        "Advance To Next Action"
      ]
    }
  ]
}