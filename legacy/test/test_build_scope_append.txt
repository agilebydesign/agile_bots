# ============================================================================
# STORY: Create Build Scope (Sub-epic: Build Knowledge)
# ============================================================================

class TestCreateBuildScope:
    """Story: Create Build Scope (Sub-epic: Build Knowledge)"""
    
    @pytest.mark.parametrize("parameters,expected_scope_contains", [
        # Example 1: Scope 'all'
        ({'scope': 'all'}, {'all': True}),
        # Example 2: Story names
        ({'story_names': ['Story1']}, {'story_names': ['Story1']}),
        # Example 3: Multiple story names
        ({'story_names': ['Story1', 'Story2']}, {'story_names': ['Story1', 'Story2']}),
        # Example 4: Increment priorities
        ({'increment_priorities': [1]}, {'increment_priorities': [1]}),
        # Example 5: Multiple increment priorities
        ({'increment_priorities': [1, 2]}, {'increment_priorities': [1, 2]}),
        # Example 6: Epic names
        ({'epic_names': ['Epic A']}, {'epic_names': ['Epic A']}),
        # Example 7: Multiple epic names
        ({'epic_names': ['Epic A', 'Epic B']}, {'epic_names': ['Epic A', 'Epic B']}),
        # Example 8: Increment names
        ({'scope': 'Increment 1'}, {'increment_names': ['Increment 1']}),
        # Example 9: No parameters (defaults to 'all')
        ({}, {'all': True}),
        # Example 10: Combined story_names and epic_names
        ({'story_names': ['Story1'], 'epic_names': ['Epic A']}, 
         {'story_names': ['Story1'], 'epic_names': ['Epic A']}),
    ])
    def test_build_scope_created_with_different_parameter_combinations(self, parameters, expected_scope_contains):
        """
        SCENARIO: Build scope created with different parameter combinations
        GIVEN: Parameters dict with scope configuration
        WHEN: BuildScope instantiated with parameters
        THEN: BuildScope scope property returns expected configuration
        """
        # Given: Parameters dict
        # When: BuildScope instantiated
        build_scope = when_build_scope_instantiated(parameters)
        
        # Then: BuildScope scope property returns expected configuration
        then_build_scope_contains_all_expected(build_scope, expected_scope_contains)
    
    def test_build_scope_defaults_to_all_when_no_parameters(self):
        """
        SCENARIO: Build scope defaults to 'all' when no parameters provided
        GIVEN: Empty parameters dict
        WHEN: BuildScope instantiated
        THEN: Scope defaults to 'all'
        """
        # Given: Empty parameters
        parameters = {}
        
        # When: BuildScope instantiated
        build_scope = when_build_scope_instantiated(parameters)
        
        # Then: Scope defaults to 'all'
        then_build_scope_contains(build_scope, 'all', True)
    
    def test_action_uses_build_scope_to_define_build_scope(self, bot_directory, workspace_directory):
        """
        SCENARIO: Action uses BuildScope to define build scope
        GIVEN: BuildKnowledgeAction with parameters
        WHEN: Action executes with scope parameters
        THEN: Uses BuildScope class and includes scope in instructions
        """
        # Given: Environment bootstrapped
        bootstrap_env(bot_directory, workspace_directory)
        bot_name = 'story_bot'
        behavior_name = 'exploration'
        
        # Create behavior setup
        from agile_bot.bots.base_bot.test.test_helpers import create_actions_workflow_json
        from agile_bot.bots.base_bot.test.test_execute_behavior_actions import create_minimal_guardrails_files
        create_actions_workflow_json(bot_directory, behavior_name)
        create_minimal_guardrails_files(bot_directory, behavior_name, bot_name)
        
        # Create knowledge graph directory and config
        kg_dir = given_knowledge_graph_directory_created(bot_directory, behavior_name)
        given_knowledge_graph_config_and_template_created(kg_dir)
        
        # Create behavior and action
        behavior = _create_behavior(bot_directory, bot_name, behavior_name, workspace_directory)
        action = BuildKnowledgeAction(behavior=behavior)
        parameters = given_build_parameters_with_scope('all')
        
        # When: Action executes with scope parameters
        # Then: Uses BuildScope class
        then_action_uses_build_scope_class(action, parameters)








