{
  "name": "build_knowledge",
  "description": "Build story graph from content area and render using story graph renderer",
  "workflow": true,
  "order": 4,
  "next_action": "validate_output",
  "instructions": [
    "IMPORTANT: Follow these action instructions specifically. Frame the behavior instructions above within the context of this action.",
    "",
    "@build-instructions.txt",
    "",
    "**BUILD PROCESS:**",
    "",
    "**1. Load Context**",
    "Load clarification.json, planning.json, and source material from context sources (listed above).",
    "",
    "**2. Load Build Configs**",
    "From `{bot}/behaviors/{behavior}/content/`, each folder contains:",
    "- `build_*.json` - Config (name, path, template, output)",
    "- `instructions.json` - Build instructions",
    "- `template-file.json` - Output schema/structure",
    "",
    "**3. Execute Build**",
    "1. Load config, instructions, and template (injected as 'story_graph_template')",
    "2. Check if output file exists - read it FIRST",
    "3. Follow instructions.json - match template structure exactly (check '_explanation' section)",
    "4. Apply context from Step 1",
    "5. If file exists: ADD/EXTEND only, never overwrite/delete",
    "6. Validate against template schema",
    "7. Write to `{project_area}/{config.path}/{config.output}`",
    "- Read existing files before changes - preserve all content",
    "- Match template structure exactly - don't invent schemas",
    "- Trace all knowledge to clarification/planning data",
    "- Process builds sequentially - validate each",
    "",
    "**4. SOURCE TRACEABILITY**",
    "Knowledge artifacts should include source references when available:",
    "- `context_source` field on epics, sub_epics, story_groups, stories, and domain concepts",
    "- Format: `{\"file\": \"filename.pdf\", \"page\": \"12\", \"section\": \"3.2.1 Payment Flow\"}`",
    "- For multiple sources: use array of source objects",
    "- If source is chat/conversation: `{\"type\": \"chat\", \"description\": \"User clarification on approval workflow\"}`",
    "- If source is code: `{\"file\": \"path/to/file.py\", \"lines\": \"45-67\", \"function\": \"process_payment\"}`",
    "- Prefer tracing knowledge to a source when possible",
    "- When source is unclear, mark as `{\"type\": \"inferred\", \"basis\": \"description of inference basis\"}`"
  ]
}
