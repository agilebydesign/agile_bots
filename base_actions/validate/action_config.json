{
  "name": "validate_rules",
  "description": "Validate story graph and/or artifacts against behavior-specific rules, checking for violations and compliance",
  "workflow": true,
  "order": 5,
  "auto_confirm": false,
  "next_action": "render_output",
  "instructions": [
    "IMPORTANT: Follow these action instructions specifically. Frame the behavior instructions above within the context of this action.",
    "",
    "## Step 1: Scanner Violation Review",
    "",
    "{{scanner_output}}",
    "",
    "Carefully review all scanner-reported violations as follows:",
    "1. For each violation message, locate the corresponding element in the story graph.",
    "2. Open the relevant rule file and read all DO and DON'T examples thoroughly.",
    "3. Decide if the violation is **Valid** (truly a rule breach per examples) or a **False Positive** (explain why if so).",
    "4. Determine the **Root Cause** (e.g., 'incorrect concept naming', 'missing actor', etc.).",
    "5. Assign a **Theme** grouping based on the type of issue (e.g., 'noun-only naming', 'incomplete acceptance criteria').",
    "6. Extract an **Example** from the actual code/content showing the problem.",
    "7. Suggest a clear, concrete **Fix** with a code example informed by DO examples in the rule.",
    "",
    "## Step 2: Manual Rule Review",
    "",
    "{{rules}}",
    "",
    "Scanner tools don't cover or catch every rule violation. Do a second pass:",
    "1. Carefully read each rule file, fully reviewing DO and DON'T sections, and every provided example.",
    "2. Inspect {scope} for compliance.",
    "3. Compare the properties and content of each element against the rule's requirements.",
    "4. Document any violations the scanner could not find.",
    "5. For each violation, extract an **Example** showing the problem and provide a **Fix** with code example.",
    "",
    "## Violations Found",
    "",
    "Record ALL findings (scanner + manual) using this readable format. Group by theme for narrow IDE chat panels:",
    "",
    "### [Theme Name] (X violations)",
    "",
    "**1. [Rule Name]**",
    "- Location: `path.to.element`",
    "- Status: Valid / False Positive",
    "- Source: Scanner / Manual / Both",
    "- Problem: `\"actual problematic text\"`",
    "- Fix: `\"corrected text\"`",
    "- Root Cause: Brief explanation",
    "",
    "**2. [Rule Name]**",
    "- Location: `path.to.element`",
    "- ...",
    "",
    "---",
    "",
    "### [Next Theme] (Y violations)",
    "...",
    "",
    "Use this list format instead of tables - tables are unreadable in narrow IDE side chat panels.",
    "",
    "## Step 3: Summarize Findings & Recommendations",
    "",
    "Provide a concise summary:",
    "- Report how many **scanner violations** were valid vs false positives.",
    "- Enumerate any **additional manual findings** not caught by scanners.",
    "- Group all violations by recurring theme or pattern.",
    "- Split violations into **Priority Fixes** (must resolve before continuing) and **Optional Improvements**.",
    "",
    "Present your summary and await user confirmation before automatically applying or proposing corrections."
  ]
}
